<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[C# èªžè¨€ç‰¹æ€§æ›´æ–° - C# 12]]></title>
    <url>%2Fcontent%2F20240708-whats-new-in-csharp-12.html</url>
    <content type="text"><![CDATA[C# å„ç‰ˆæœ¬æ–°ç‰¹æ€§æ‘˜è¦ï¼ŒåŒ…å«è‡ªå·±çš„æƒ³æ³•èˆ‡å¯¦å‹™ä¸Šçš„åå¥½ã€‚ é è¨­å»ºæ§‹å­ (Primary constructors)å¯å¥—ç”¨åˆ°æ‰€æœ‰é¡žåˆ¥èˆ‡çµæ§‹ã€‚å…¶ä»–å»ºæ§‹å­å¯ä»¥é¸æ“‡å‘¼å«é è¨­å»ºæ§‹å­ã€‚ 12345678910public class Person(string name, int age)&#123; public string Name &#123; get; &#125; = name; public int Age &#123; get; &#125; = age; // Calling the primary constructor using `this(name, age)` is required. public Person(string name) : this(name, 0) &#123; &#125;&#125; é›†åˆé‹ç®—å¼ (Collection expressions)åƒ List&lt;string&gt; b = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]; é€™æ¨£çš„èªžæ³•èƒ½å¥—ç”¨åˆ°æ›´å¤š â€œé¡žé›†åˆâ€ åž‹åˆ¥ï¼ŒåŒ…å«é™£åˆ—ã€Span&lt;T&gt;ã€ReadOnlySpan&lt;T&gt;ã€å’Œå…¶ä»–æ”¯æ´é›†åˆåˆå§‹è¨­å®šå¼çš„åž‹åˆ¥ã€‚ å¦å¤–èƒ½åƒæ˜¯ä¸‹é¢ç¯„ä¾‹é€™æ¨£é€éŽæ•£ä½ˆé‹ç®—å­ (spread element) ä¾†çµ„åˆé›†åˆï¼š1234int[] row0 = [1, 2, 3];int[] row1 = [4, 5, 6];int[] row2 = [7, 8, 9];int[] single = [.. row0, .. row1, .. row2]; ref readonly åƒæ•¸ (ref readonly parameters)Default lambda parameters12345// Default increment to 1var IncrementBy = (int source, int increment = 1) =&gt; source + increment;Console.WriteLine(IncrementBy(5)); // 6Console.WriteLine(IncrementBy(5, 2)); // 7 è¨­å®šä»»ä½•é¡žåž‹çš„åˆ¥å (Alias any type)å¯é€éŽ using é—œéµå­—è¨­å®šä»»ä½•åž‹åˆ¥çš„åˆ¥åã€‚123456789101112131415using System;using IntArray = int[];class Program&#123; static void Main() &#123; IntArray numbers = new int[] &#123; 1, 2, 3, 4, 5 &#125;; Console.WriteLine("Array elements:"); foreach (var number in numbers) &#123; Console.WriteLine(number); &#125; &#125;&#125; åˆæ˜¯å€‹éœ€è¦ä¾è³´å¼·åŠ›çš„ç¨‹å¼ç¢¼å“è³ªç®¡ç†æ©Ÿåˆ¶çš„ç‰¹æ€§ã€‚ å…§åµŒé™£åˆ— (Inline arrays)Runtime æˆ–å…¶ä»–å¥—ä»¶é–‹ç™¼äººå“¡ç”¨ä»¥æå‡æ•ˆèƒ½çš„æ©Ÿåˆ¶ï¼Œä¸€èˆ¬äººé€šå¸¸ä¸æœƒç”¨ã€‚ ExperimentalAttribute (Experimental attribute)ç”¨ System.Diagnostics.CodeAnalysis.ExperimentalAttribute ä¾†æ¨™è¨»å¯¦é©—æ€§åŠŸèƒ½ï¼Œå­˜å–æ™‚ç·¨è­¯å™¨æœƒå‡ºç¾ warningã€‚ ä»¥å‰ä¸å¾—å·²åªèƒ½ç”¨ ObsoleteAttribute æ­é…æè¿°ä¾†æ¨™è¨˜å¯¦é©—æ€§åŠŸèƒ½ï¼Œç¾åœ¨æœ‰æ›´é©ç•¶å·¥å…·å¯ä»¥ç”¨äº†ã€‚ Interceptorsé€™æ˜¯å€‹å¯¦é©—æ€§åŠŸèƒ½ï¼Œä»¥å¾Œå¯èƒ½æœƒè¢«ç§»é™¤æˆ–å¤§æ”¹ã€‚ åƒè€ƒChatGPT Whatâ€™s new in C# 12]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# èªžè¨€ç‰¹æ€§æ›´æ–° - C# 11]]></title>
    <url>%2Fcontent%2F20240630-whats-new-in-csharp-11.html</url>
    <content type="text"><![CDATA[C# å„ç‰ˆæœ¬æ–°ç‰¹æ€§æ‘˜è¦ï¼ŒåŒ…å«è‡ªå·±çš„æƒ³æ³•èˆ‡å¯¦å‹™ä¸Šçš„åå¥½ã€‚ ç‰¹æ€§å¯æ”¯æ´æ³›åž‹ (Generic attributes)å¯åœ¨ç‰¹æ€§ä¸Šä½¿ç”¨æ³›åž‹åƒæ•¸ã€‚1234public class GenericAttribute&lt;T&gt; : Attribute &#123; &#125;[GenericAttribute&lt;string&gt;]public string Method() =&gt; default; ä½†æœ‰ä¸€äº›é™åˆ¶ï¼š å¿…é ˆæ˜¯å·²ç¢ºå®šçš„åž‹åˆ¥ï¼Œä¾‹å¦‚ GenericAttribute&lt;string&gt;ï¼›ä¸èƒ½æ˜¯ä¸ç¢ºå®šçš„æ³›åž‹åž‹åˆ¥åƒæ˜¯ GenericAttribute&lt;T&gt;ã€‚ åž‹åˆ¥å¼•æ•¸å’Œ typeof æœ‰ç›¸åŒçš„é™åˆ¶ï¼Œä¸å…è¨±éœ€è¦ metadata annotation çš„åž‹åˆ¥ï¼Œåƒæ˜¯ dynamicã€string? ç­‰å¯ç‚º null çš„åƒè€ƒåž‹åˆ¥ã€(int x, int y) ç­‰å„ç¨® Tupleã€‚ä½†ä¸Šè¿°æƒ…å¢ƒåˆ†åˆ¥å¯ç”¨ objectã€stringã€ValueTuple&lt;int, int&gt; å–ä»£ã€‚ é—œæ–¼ metadata annotation ä»¥åŠç‚ºä»€éº¼æœ‰é€™äº›é™åˆ¶æ‡‰è©²æ‰¾æ™‚é–“æ·±å…¥ç ”ç©¶èƒŒå¾Œçš„æ©Ÿåˆ¶ã€‚ æ”¯æ´æ³›åž‹æ•¸å­¸é‹ç®— (Generic math support)é€éŽåœ¨ä»‹é¢ä¸­åŠ å…¥ static abstract æˆ– static virtual çš„é‹ç®—å­å¤šè¼‰ä¾†è¨‚å®šä¸€è‡´çš„è¦ç¯„èˆ‡æ…£ä¾‹ã€‚ä¸”æ³›åž‹æ•¸å­¸é‹ç®—æ”¯æ´ä¸‹é¢çš„ä¸€äº›ç‰¹æ€§ï¼š é‹ç®—å­å¤šè¼‰ 12345678910111213141516171819202122232425262728293031323334353637using System;public interface IMathOperations&lt;TSelf&gt; where TSelf : IMathOperations&lt;TSelf&gt;&#123; static abstract TSelf operator +(TSelf left, TSelf right);&#125;public struct MyNumber : IMathOperations&lt;MyNumber&gt;&#123; public int Value &#123; get; &#125; public MyNumber(int value) &#123; Value = value; &#125; public static MyNumber operator +(MyNumber left, MyNumber right) &#123; return new MyNumber(left.Value + right.Value); &#125; public override string ToString() =&gt; Value.ToString();&#125;public class Program&#123; public static void Main() &#123; MyNumber a = new MyNumber(10); MyNumber b = new MyNumber(5); MyNumber resultAdd = a + b; Console.WriteLine($"Addition: &#123;resultAdd&#125;"); // Output: Addition: 15 &#125;&#125; checked é‹ç®—å­å¤šè¼‰å’Œéš±å«çš„ unchecked é‹ç®—å­å¤šè¼‰å¯ä»¥åŒæ™‚å­˜åœ¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657using System;public interface IMathOperations&lt;TSelf&gt; where TSelf : IMathOperations&lt;TSelf&gt;&#123; static abstract TSelf operator +(TSelf left, TSelf right); static abstract TSelf operator checked +(TSelf left, TSelf right);&#125;public struct MyNumber : IMathOperations&lt;MyNumber&gt;&#123; public int Value &#123; get; &#125; public MyNumber(int value) &#123; Value = value; &#125; // Normal addition operator public static MyNumber operator +(MyNumber left, MyNumber right) &#123; return new MyNumber(left.Value + right.Value); &#125; // Checked addition operator public static MyNumber operator checked +(MyNumber left, MyNumber right) &#123; return new MyNumber(checked(left.Value + right.Value)); &#125; public override string ToString() =&gt; Value.ToString();&#125;public class Program&#123; public static void Main() &#123; MyNumber a = new MyNumber(int.MaxValue); MyNumber b = new MyNumber(1); // Using the generic method with checked context try &#123; MyNumber resultChecked = checked(a + b); Console.WriteLine(resultChecked); // This will throw OverflowException &#125; catch (OverflowException) &#123; Console.WriteLine("Overflow in checked context"); &#125; // Using the generic method with normal addition MyNumber c = new MyNumber(10); MyNumber d = new MyNumber(5); MyNumber resultUnchecked = c + d; Console.WriteLine(resultUnchecked); // Output: 15 &#125;&#125; ä¸å¸¶æ­£è² è™Ÿçš„å³ç§»é‹ç®—å­ &gt;&gt;&gt; (unsigned right-shift operator)&gt;&gt;&gt; æ˜¯é‚è¼¯ç§»ä½ (Logical Shift)ï¼Œä¸åŒæ–¼ &gt;&gt; æ˜¯ç®—æ•¸ç§»ä½ (Arithmetic Shift)ã€‚ å¯¬é¬†çš„ä½ç§»é‹ç®—å­ç¬¬äºŒå€‹é‹ç®—å…ƒå¯ä»¥ä¸æ˜¯ int æˆ–éš±å«å¯è½‰æ›æˆ int çš„åž‹åˆ¥ã€‚ ä¸Šè¿°ç‰¹æ€§æœ‰äº›åœ¨ C# 11 ä»¥å‰å°±å·²ç¶“å­˜åœ¨ï¼Œåªæ˜¯ä¸æ˜¯é€éŽå¯¦ä½œä»‹é¢ä¾†é”æˆã€‚é€™å€‹æ–°ç‰¹æ€§æ¯”è¼ƒåå‘è¨­è¨ˆé¢ï¼Œè®“ä¸€äº›ç‰¹æ€§èƒ½ç¶“ç”±ä»‹é¢ä¾†è¦ç¯„ï¼Œä½†ç¼ºé»žæ˜¯å¦‚æžœç”¨èˆŠç‰ˆçš„æ–¹å¼å¯¦ä½œä¹Ÿå¯ä»¥é‹ä½œï¼Œç¶­è­·ä¸Šå°±å¾ˆå®¹æ˜“å‡ºç¾å…©å¥—åšæ³•ã€‚å°±æˆ‘çš„è§’åº¦è€Œè¨€ï¼Œé›–ç„¶æœ‰ä¸€é»žå„ªé»žï¼Œä½†å¦‚æžœå¼•å…¥åˆ°æ²’æœ‰å¼·åŠ›æ…£ä¾‹ç´„æŸçš„åœ˜éšŠä¸­å¯èƒ½æœƒé€ æˆæ›´å¤§çš„åæ•ˆæžœã€‚ IntPtr å’Œ UIntPtr çš„åˆ¥å (Numeric IntPtr and UIntPtr)åˆ†åˆ¥æ˜¯ nint å’Œ nuintã€‚ å­—ä¸²æ’è£œä¸­çš„åˆ†è¡Œç¬¦è™Ÿ (Newlines in string interpolations)å­—ä¸²æ’è£œå¯ç›´æŽ¥æ–·è¡Œã€‚ List patternsé‡å° List å’Œé™£åˆ—çš„èªžæ³•ç³–ï¼Œåƒæ˜¯é€™æ¨£ï¼š1234567891011void Foo(IList&lt;int&gt; list)&#123; var ans = list switch &#123; [1, 2, 3] =&gt; "Matched exactly [1, 2, 3]", [1, _, 3] =&gt; "Matched pattern [1, _, 3]", _ =&gt; "No match" &#125;; ans.Dump();&#125; è¦è®“ switch æ¨¡å¼æ¯”å°å¯ç”¨ï¼Œ list åªèƒ½æ˜¯é™£åˆ—ã€ IList&lt;T&gt; æˆ–å…¶è¡ç”Ÿåž‹åˆ¥ã€‚ æ”¹å–„çš„æ–¹æ³•ç¾¤çµ„è½‰æ›è‡³å§”æ´¾ (Improved method group conversion to delegate)ä»¥ä¸‹é¢ç¯„ä¾‹æ¯”å°å·®ç•°ï¼š12345678910111213141516171819202122using System;public class Program&#123; public static void Main() &#123; Action&lt;string&gt; action1 = PrintMessage; Action&lt;string&gt; action2 = PrintMessage; // In C# 10 and earlier, these will be different instances. Output: False // In C# 11, these may be the same instance due to caching. Output: True Console.WriteLine(object.ReferenceEquals(action1, action2)); action1("Hello from action1!"); // Output: Hello from action1! action2("Hello from action2!"); // Output: Hello from action2! &#125; public static void PrintMessage(string message) &#123; Console.WriteLine(message); &#125;&#125; åŽŸå§‹å­—ä¸²å¸¸å€¼ (Raw string literals)ä»¥ &quot;&quot;&quot; é–‹å§‹èˆ‡çµå°¾ï¼Œå¯æ”¯æ´ä»»æ„æ–‡å­—ï¼ŒåŒ…æ‹¬ç©ºç™½å­—å…ƒã€åˆ†è¡Œç¬¦è™Ÿã€å…§åµŒå¼•è™Ÿå’Œå…¶ä»–ç‰¹æ®Šå­—å…ƒã€‚å¯æ­é… $$ ä½¿ç”¨ã€‚ ä½†æ­é… $$ ä½¿ç”¨æ™‚ï¼Œè¦å‰‡æœ‰ä¸€äº›ç´°ç¯€ä¸Šçš„ä¸åŒï¼Œå…ˆçŸ¥é“å°±å¥½ä¹‹å¾Œå†è£œå‘ã€‚ è‡ªå‹•é è¨­çµæ§‹ (Auto-default struct)è‡ªå‹•æŠŠæœªåˆå§‹åŒ–çš„æ¬„ä½è¨­ç‚ºè©²åž‹åˆ¥é è¨­å€¼ï¼Œå¦‚ä¸‹é¢ç¨‹å¼ç¢¼åœ¨èˆŠç‰ˆç„¡æ³•ç·¨è­¯ä½†åœ¨ C# 11 å¯ä»¥ç·¨è­¯ï¼Œæœªåˆå§‹åŒ–çš„å±¬æ€§ Y æœƒæ˜¯ default(int)ã€‚ æ˜¯é‡å°æ¬„ä½ï¼Œä½†å±¬æ€§å…¶å¯¦æ˜¯ backing field + getter + setter çš„çµ„åˆï¼Œæ‰€ä»¥ä¹Ÿé©ç”¨ã€‚ 12345678910public struct Point&#123; public int X &#123; get; &#125; public int Y &#123; get; &#125; public Point(int x) &#123; X = x; &#125;&#125; å­—ä¸²å¸¸æ•¸æ¨¡å¼æ¯”å°å¯å¥—ç”¨åˆ° Span&lt;char&gt; å’Œ ReadOnlySpan&lt;char&gt; ä¸Šå¦‚ä¸‹æ–¹ç¯„ä¾‹ï¼Œåœ¨ C# 11 ä¸Šå¯ä»¥é‹ä½œã€‚123456789101112131415void ProcessSpan(ReadOnlySpan&lt;char&gt; span)&#123; switch (span) &#123; case "Hello": Console.WriteLine("Greeting detected."); break; case "World": Console.WriteLine("World detected."); break; default: Console.WriteLine("Unknown span."); break; &#125;&#125; æ“´å…… nameof çš„é©ç”¨ç¯„åœ (Extended nameof scope)nameof() å¯é‹ç”¨åœ¨ç‰¹æ€§ä¸Šä½œç‚ºåƒæ•¸å‚³å…¥ï¼Œåœ¨åƒæ•¸é©—è­‰æƒ…å¢ƒä¸‹å¯æ–¹ä¾¿çš„å°å‡ºæœ‰å•é¡Œçš„åƒæ•¸åç¨±ã€‚ 1234public void MyMethod([Validation(nameof(param))]int param)&#123; Console.WriteLine("Method executed.");&#125; UTF-8 å­—ä¸²å¸¸å€¼ (UTF-8 string literals)é¡žä¼¼æ–¼ 123m è¡¨ç¤º decimal 123ï¼Œ&quot;Hello, ä¸–ç•Œ! ðŸŒ&quot;u8 è¡¨ç¤ºä»¥ UTF-8 ç·¨ç¢¼çš„å­—ä¸²ï¼ŒçœåŽ»ä¸€äº›è½‰ç¢¼çš„æ“ä½œã€‚12345678910111213class Program&#123; static void Main() &#123; ReadOnlySpan&lt;byte&gt; utf8StringLiteral = "Hello, ä¸–ç•Œ! ðŸŒ"u8; // 48 65 6C 6C 6F 2C 20 E4 B8 96 E7 95 8C 21 20 F0 9F 8C 8D foreach (byte b in utf8StringLiteral) &#123; Console.Write($"&#123;b:X2&#125; "); &#125; &#125;&#125; å¿…è¦æˆå“¡ (Required members)å¯å°‡ required ä¿®é£¾è©žåŠ åˆ°å±¬æ€§å’Œæ¬„ä½ä¸Šï¼Œå¼·è¿«å»ºæ§‹å­å’Œå‘¼å«ç«¯åˆå§‹åŒ–é€™äº›å€¼ã€‚ ref æ¬„ä½å’Œ ref scoped è®Šæ•¸file å­˜å–ä¿®é£¾è©ž (File local types)ä¸åŒæ–¼å…¶ä»–å­˜å–ä¿®é£¾è©žé—œæ³¨åœ¨ Assembly æˆ–é¡žåˆ¥ï¼Œ file ä»¥æª”æ¡ˆç‚ºåŸºæº–å°‡å¯è¦‹åº¦é™ç¸®åœ¨å–®ä¸€æª”æ¡ˆä¸­ã€‚ çµè«–å¾žé€™é™£å­å¾ž C# 7 ä¸€è·¯è¿½ä¸Šä¾†ï¼Œåˆ°å¾Œé¢ç™¼ç¾åŸºæ–¼ C# 7 å¾Œé¢çš„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§å¦å¤–å†åšçš„å»¶ä¼¸æˆ‘å·²ç¶“çœ‹ä¸å¤ªæ‡‚äº†ï¼Œç­‰çœ‹å®Œ C# 12 å¾Œé‚„æ˜¯è¦å†å›žé ­å¾žç‰¹æ€§çš„è§’åº¦å…¨é¢äº†è§£ã€‚ åƒè€ƒChatGPT Whatâ€™s new in C# 11]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# èªžè¨€ç‰¹æ€§æ›´æ–° - C# 10]]></title>
    <url>%2Fcontent%2F20240629-whats-new-in-csharp-10.html</url>
    <content type="text"><![CDATA[C# å„ç‰ˆæœ¬æ–°ç‰¹æ€§æ‘˜è¦ï¼ŒåŒ…å«è‡ªå·±çš„æƒ³æ³•èˆ‡å¯¦å‹™ä¸Šçš„åå¥½ã€‚ å¯¦å€¼åž‹åˆ¥çš„ Record (Record structs)ç”¨ record struct æˆ–æ˜¯ readonly record struct ä¾†å®šç¾©å¯¦å€¼åž‹åˆ¥çš„ Recordã€‚ struct åž‹åˆ¥çš„æ”¹å–„å¯ä»¥åœ¨çµæ§‹é¡žåž‹ä¸ŠåŠ ä¸Šç„¡åƒæ•¸å»ºæ§‹å­ä¸¦åœ¨å…¶ä¸­åˆå§‹åŒ–æ¬„ä½æˆ–å±¬æ€§ã€‚ä¸” with å·¦é‚Šçš„åž‹åˆ¥å¯ä»¥æ˜¯çµæ§‹åž‹åˆ¥æˆ–æ˜¯åŒ¿ååƒè€ƒåž‹åˆ¥ã€‚ æ’è£œå­—ä¸²è™•ç†å¸¸å¼ (Interpolated string handler)æ²’ç”¨éŽï¼Œä½†å¾ž ChatGPT çš„èªªæ˜Žçœ‹èµ·ä¾†ï¼Œåƒæ˜¯å¯ä»¥æŠŠå­—ä¸²æ’è£œè½‰æ›æˆç‰¹å®šçš„ handler ä¸¦è¼¸å‡ºå®¢è£½åŒ–çµæžœè€Œä¸æ˜¯é è¨­çš„å­—ä¸²ã€‚ä½†å€¼å¾—æ³¨æ„ä»–èƒŒå¾Œçš„æ©Ÿåˆ¶ä¸åƒæ˜¯è½‰åž‹ï¼Œè€Œæ˜¯ç·¨è­¯å™¨åœ¨ç‰¹å®šæƒ…å¢ƒ(ä»¥å­—ä¸²æ’è£œç‚ºå¼•æ•¸å‚³å…¥æ™‚)æ‰æœƒå°‡å…¶ç·¨è­¯æˆå‘¼å« CustomInterpolatedStringHandlerã€‚ ä»¥ ChatGPT çš„ç¯„ä¾‹å±•ç¤ºå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475using System;using System.Runtime.CompilerServices;using System.Text;[InterpolatedStringHandler]public ref struct CustomInterpolatedStringHandler&#123; private StringBuilder _builder; public CustomInterpolatedStringHandler(int literalLength, int formattedCount) &#123; _builder = new StringBuilder(literalLength); Console.WriteLine($"Literal length: &#123;literalLength&#125;, formatted count: &#123;formattedCount&#125;"); &#125; public void AppendLiteral(string literal) &#123; _builder.Append(literal); Console.WriteLine($"Appended literal: &#123;literal&#125;"); &#125; public void AppendFormatted&lt;T&gt;(T value) &#123; _builder.Append(value?.ToString()); Console.WriteLine($"Appended formatted: &#123;value&#125;"); &#125; public void AppendFormatted&lt;T&gt;(T value, string format) where T : IFormattable &#123; _builder.Append(value?.ToString(format, null)); Console.WriteLine($"Appended formatted with format: &#123;value&#125; with format &#123;format&#125;"); &#125; public void AppendFormatted(string value) &#123; _builder.Append(value); Console.WriteLine($"Appended formatted string: &#123;value&#125;"); &#125; public void AppendFormatted(string value, int alignment) &#123; _builder.Append(value.PadRight(alignment)); Console.WriteLine($"Appended formatted string with alignment: &#123;value&#125; with alignment &#123;alignment&#125;"); &#125; public void AppendFormatted&lt;T&gt;(T value, int alignment) where T : IFormattable &#123; _builder.Append(value?.ToString()?.PadRight(alignment)); Console.WriteLine($"Appended formatted with alignment: &#123;value&#125; with alignment &#123;alignment&#125;"); &#125; public void AppendFormatted&lt;T&gt;(T value, int alignment, string format) where T : IFormattable &#123; _builder.Append(value?.ToString(format, null)?.PadRight(alignment)); Console.WriteLine($"Appended formatted with alignment and format: &#123;value&#125; with alignment &#123;alignment&#125; and format &#123;format&#125;"); &#125; public override string ToString() =&gt; _builder.ToString();&#125;public static class CustomLogger&#123; public static void Log(CustomInterpolatedStringHandler handler) &#123; Console.WriteLine(handler.ToString()); &#125;&#125;class Program&#123; static void Main() &#123; CustomLogger.Log($"Hello, &#123;Environment.UserName&#125;. Today is &#123;DateTime.Now:MMMM dd, yyyy&#125;."); &#125;&#125; è¼¸å‡ºæ˜¯åƒé€™æ¨£ï¼š123456Literal length: 7, formatted count: 2Appended literal: Hello, Appended formatted: RonAppended literal: . Today is Appended formatted with format: 29 June, 2024 with format MMMM dd, yyyyHello, Ron. Today is 29 June, 2024. CustomInterpolatedStringHandler é¡žä¼¼æ–¼ duck typing çš„æ¦‚å¿µï¼Œä¾è³´æ–¼å¯¦ç¾ç‰¹å®šçš„æ–¹æ³•ï¼Œä½†æˆ‘å€‹äººä¸å¤ªå–œæ­¡é€™ç¨®é¢¨æ ¼ï¼Œå› ç‚ºæ²’æœ‰å¯¦ä½œä»‹é¢æˆ–ç¹¼æ‰¿çˆ¶é¡žåˆ¥æ™‚æ‰€èƒ½å¾—åˆ°çš„ç›¸é—œæ–¹æ³•çš„æç¤ºï¼Œåªèƒ½é è¨˜æ†¶æˆ–æŸ¥æ–‡ä»¶åŽ»å¯«ï¼Œç¶­è­·çš„æ™‚å€™ä¹Ÿæœƒå¤šå‡ºå¾ˆå¤šéœ€è¦è¨˜æ†¶çš„ç´°ç¯€ã€‚å¦å¤–é€™å€‹è½‰æ›è¡Œç‚ºå¤ªéš±æ™¦ï¼Œçœ‹ä¾†æ˜¯éœ€è¦æ­é…å®Œæ•´çš„æ–‡ä»¶èªªæ˜Žæ‰èƒ½ä½¿ç”¨çš„ç‰¹æ€§ï¼Œä¸ç„¶ç¶­è­·çš„äººæœƒå¾ˆé›£æ„è­˜åˆ°æœ‰å®¢è£½åŒ–çš„å­—ä¸²æ’è£œã€‚ å…¨åŸŸ using æŒ‡ç¤ºè©ž (Global using directives)ç”¨ global using èªžæ³•ä¾†è®“æ•´å€‹å°ˆæ¡ˆé è¨­å¼•å…¥å¸¸ç”¨å‘½åç©ºé–“ï¼Œæ¸›å°‘å–®ä¸€å€‹ *.cs æª”æ¡ˆä¸­çš„ usingã€‚ å¦‚æžœæœ‰ä½¿ç”¨å¤ å®Œå–„çš„ IDE ä¸‹çœ‹èµ·ä¾†å¼Šå¤§æ–¼åˆ©ï¼Œæ–¹ä¾¿æ²’å¤šå°‘ä½†å®¹æ˜“è¡ç”Ÿæ›´å¤šçš„ç¶­è­·æˆæœ¬ï¼Œå…¨åŸŸçš„å‘½åç©ºé–“å’Œå„æª”æ¡ˆé–“å‘½åç©ºé–“ä¸‹åŒåé¡žåˆ¥æ··æ·†çš„æƒ…æ³æœƒæ›´é›£æŽ’æŸ¥ï¼Œè¦é¿å…çš„è©±å…¨åŸŸçš„ using é‚„å¾—ç¶“éŽåš´è¬¹çš„è¨­è¨ˆã€è¦ç¯„èˆ‡ç¨‹å¼ç¢¼å¯©æŸ¥åˆ¶åº¦ï¼Œæœƒå¢žåŠ ä¸å°‘ç¶­è­·æˆæœ¬ã€‚ æª”æ¡ˆç¯„åœçš„å‘½åç©ºé–“å®£å‘Š (File-scoped namespace declaration)å°±çœæŽ‰ä¸€å€‹ç¸®æŽ’è€Œå·²ã€‚ 12345678910111213// Just save 1 indentionnamespace MyNamespace;class A&#123; // ....&#125;class B&#123; // ....&#125; åˆæ­¥çœ‹ä¾†æ˜¯å€‹å¹«åŠ©å¾ˆå°çš„åŠŸèƒ½ï¼Œé è¨­æœ‰å¥—ç”¨å°±ç”¨ï¼Œæ²’å¥—ç”¨çš„è©±ä¹Ÿæ²’å¿…è¦åˆ»æ„åŽ»æ”¹ã€‚ æ“´å……å±¬æ€§åœ¨æ¨¡å¼æ¯”å°æ™‚çš„æ¨¡å¼ (Extended property patterns)12345678910// beforeif (person is &#123; Address: &#123; City: "Springfield" &#125; &#125;)&#123; //...&#125;// afterif (person is &#123; Address.City: "Springfield" &#125; &#125;)&#123; //...&#125; Lambda é‹ç®—å¼æ”¹å–„ (Lambda expression improvements) ç·¨è­¯å™¨å¯ä»¥å¾ž Lambda é‹ç®—å¼æˆ–æ–¹æ³•ç¾¤çµ„æŽ¨æ–·å§”æ´¾é¡žåž‹ï¼Œä¾‹å¦‚ï¼švar add = (int x, int y) =&gt; x + y; å¯ä»¥ä½¿ç”¨æŽ¨æ–·åž‹åˆ¥ varã€‚ å¦‚æžœç„¡æ³•æŽ¨è«–åž‹åˆ¥å‰‡è¦è‡ªå·±å®šç¾©ã€‚ Attribute å¯ä»¥åŠ åœ¨ Lambda é‹ç®—å¼ä¸Šã€‚ é€™è®“ Lambda é‹ç®—å¼æ›´åƒä¸€å€‹æ–¹æ³•ã€‚ å¸¸æ•¸å·®è£œå­—ä¸² (Constant interpolated strings)å¦‚æžœå­—ä¸²æ’è£œçš„å…ƒç´ éƒ½æ˜¯å¸¸æ•¸ï¼Œå‰‡å­—ä¸²æ’è£œçš„çµæžœå¯ç‚ºå¸¸æ•¸ï¼Œåœ¨ç·¨è­¯æœŸç¢ºå®šå­—ä¸²å…§å®¹ä¾†æå‡æ•ˆèƒ½å’Œå®‰å…¨æ€§ã€‚ 1234const string firstName = "John";const string lastName = "Doe";// Both firstName and lastName are constant, so fullName can be constant.const string fullName = $"&#123;firstName&#125; &#123;lastName&#125;"; Record çš„ ToString æ–¹æ³•å¯ç¦æ­¢ç¹¼æ‰¿ (Record types can seal ToString)12345678910using System;public record Person(string FirstName, string LastName)&#123; // Sealed ToString() public sealed override string ToString() &#123; return $"&#123;FirstName&#125; &#123;LastName&#125;"; &#125;&#125; Assignment and declaration in same deconstructionå°±å¯ä»¥æ›´éˆæ´»çš„ä½¿ç”¨è§£æ§‹å­ï¼Œå¦‚ä¸‹1234567891011// before 1(int x, int y) = point;// before 2int x1 = 0;int y1 = 0;(x1, y1) = point;// afterint x = 0;(x, int y) = point; æ”¹å–„æ˜Žç¢ºæŒ‡æ´¾ (Improved definite assignment)æ­¤æ”¹é€²ä¸»è¦æ˜¯é‡å°ç·¨è­¯å™¨åœ¨åˆ†æžè®Šæ•¸æ˜¯å¦å·²è¢«æ­£ç¢ºåˆå§‹åŒ–æ™‚æä¾›æ›´æº–ç¢ºçš„åˆ¤æ–·ï¼Œæ¸›å°‘èª¤åˆ¤çš„ç©ºå€¼è­¦å‘Šã€‚ åœ¨æ–¹æ³•ä¸Šå…è¨± AsyncMethodBuilder ç‰¹æ€§ (Allow AsyncMethodBuilder attribute on methods)å…è¨±åœ¨æ–¹æ³•ä¸ŠåŠ  AsyncMethodBuilderAttributeã€‚ CallerArgumentExpression attribute diagnostics123456789101112131415161718192021222324252627282930using System;using System.Runtime.CompilerServices;public static class Validator&#123; public static void Ensure(bool condition, [CallerArgumentExpression(nameof(condition))] string? message = null) &#123; if (!condition) &#123; throw new ArgumentException($"Condition failed: &#123;message&#125;"); &#125; &#125;&#125;class Program&#123; static void Main(string[] args) &#123; int x = 5; int y = 10; // This will not throw an exception Validator.Ensure(x &lt; y); // This will throw an exception with a detailed message // "Condition failed: x &gt; y" Validator.Ensure(x &gt; y); &#125;&#125; å¦‚ä¸Šç¯„ä¾‹ï¼Œè®“ codition çš„åƒæ•¸å…§å®¹ (x &gt; y) åšç‚º message çš„å€¼ï¼Œæ–¹ä¾¿é™¤éŒ¯ã€‚ çµè«–C# 10 å¤§å¤šæ˜¯ä¸€äº›æ¯”è¼ƒå°çš„æ“´å±•ï¼Œçœ‹èµ·ä¾†è¼•é¬†å¤šäº†ã€‚ åƒè€ƒWhatâ€™s new in C# 10 ChatGPT]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# èªžè¨€ç‰¹æ€§æ›´æ–° - C# 9]]></title>
    <url>%2Fcontent%2F20240624-whats-new-in-csharp-9.html</url>
    <content type="text"><![CDATA[C# å„ç‰ˆæœ¬æ–°ç‰¹æ€§æ‘˜è¦ï¼ŒåŒ…å«è‡ªå·±çš„æƒ³æ³•èˆ‡å¯¦å‹™ä¸Šçš„åå¥½ã€‚ record (Record types)ç”¨æ›´ç°¡æ½”çš„èªžæ³•å®šç¾©é¡žåˆ¥ï¼Œå±¬æ–¼åƒè€ƒåž‹åˆ¥ï¼Œå¯å®šç¾©å¯è®Š (Mutable) å±¬æ€§èˆ‡ä¸å¯è®Š (Immutable) å±¬æ€§ã€‚é›–ç„¶å¦‚æ­¤ï¼Œä½† Record ä¸»è¦ç›®çš„é‚„æ˜¯ç”¨æ–¼ä¸å¯è®Šå±¬æ€§çš„ã€‚ 1234567891011// The FirstName and the LastName are immutable properties,// whereas the Age is mutable property.public record Person(string FirstName, string LastName)&#123; public int Age &#123; get; set; &#125;&#125;// Create with immutable properties.var ron = new Person("Ron", "Sun");// Modify the mutable property.ron.Age = 100; Record æ”¯æ´å¯è®Šå±¬æ€§æ¯”è¼ƒåƒæ˜¯ç‚ºäº†æé«˜æ”¯æ´åº¦ï¼Œç•¢ç«Ÿå¾ˆå¤šæ™‚å€™ä¸€å€‹å¹¾ä¹Žéƒ½æ˜¯ä¸å¯è®Šå±¬æ€§çš„ DTO å°±æ˜¯å¯èƒ½åŒ…å«å¹¾å€‹å¯è®Šå±¬æ€§ã€‚ é‚„æœ‰ä¸€äº›ç‰¹æ€§ï¼š æ”¯æ´ä½ç½®èªžæ³• (Positional Syntax)ï¼Œä¾‹å¦‚ï¼šPerson ron = new(&quot;Ron&quot;, &quot;Sun&quot;);ã€‚ å¯¦å€¼ç›¸ç­‰ (Value equality)ï¼Œç•¶åž‹åˆ¥ç›¸åŒä¸”æ‰€æœ‰æ¬„ä½èˆ‡å±¬æ€§éƒ½ç›¸åŒæ™‚ï¼Œå…©å€‹è®Šæ•¸å¯ä»¥ç”¨ == ä¾†åˆ¤å®šç›¸ç­‰ï¼Œé€™å’Œä¸€èˆ¬åƒè€ƒåž‹åˆ¥ä¸åŒã€‚ éžç ´å£žæ€§è®ŠåŒ– (Nondestructive mutation)ï¼Œä½¿ç”¨ with é—œéµå­—ä¾†è¤‡è£½ç‰©ä»¶ä¸¦è³¦å€¼è¦è®ŠåŒ–çš„å…§å®¹ï¼Œä¾‹å¦‚ï¼šPerson newRon = ron with { FirstName = &quot;Ron 2.0&quot; };ã€‚ å…§å»ºçš„æ ¼å¼åŒ– (Built-in formatting for display)ï¼Œé€éŽ ToString() æ–¹æ³•èƒ½å¾—åˆ°ä¸€å€‹é è¨­çš„æ ¼å¼åŒ–å­—ä¸²ï¼Œä¾‹å¦‚ï¼šPerson { FirstName = Ron, LastName = Sun, Age = 0 }ã€‚ ç¹¼æ‰¿çš„é™åˆ¶ (Inheritance)ï¼ŒRecord ä¹‹é–“å¯ä»¥ç¹¼æ‰¿ï¼Œä½† Record å’Œ class äº’ç›¸ä¸èƒ½ç¹¼æ‰¿ã€‚ æ•´é«”çœ‹èµ·ä¾†é™¤äº†ç°¡åŒ–èªžæ³•å¤–ï¼Œå¦å¤–ä¹Ÿæƒ³ç”¨åƒè€ƒåž‹åˆ¥ä¾†æ¨¡æ“¬å¯¦å€¼åž‹åˆ¥çš„ç‰¹æ€§ï¼Œä¾†å¾—åˆ°å…©è€…çš„å„ªé»žã€‚ä¸¦ä¸”æä¾›ä¸€äº›é è¨­ç‰¹æ€§ä¾†é”åˆ°æ–¹ä¾¿ä½¿ç”¨çš„æ•ˆæžœï¼Œä½†å› ç‚ºé€™äº›è¨­è¨ˆé€ æˆä»–å’Œä¸€èˆ¬é¡žåˆ¥æœ‰ç¨®éžå¸¸ç›¸ä¼¼å»åˆæœ‰å¾ˆå¤šä¸åŒçš„æƒ…æ³ï¼Œä¹‹å¾Œéœ€è¦å°± Record é€™å€‹ä¸»é¡Œå¦å¤–æ·±å…¥æŽ¢è¨Žã€‚ åƒ…ä¾›åˆå§‹åŒ–çš„ Setter (Init only setters)ç²¾ç¢ºä¾†èªªæ˜¯å±¬æ€§åªèƒ½åœ¨å»ºæ§‹å­ä¸­è³¦å€¼ï¼Œä¸€æ—¦é›¢é–‹å»ºæ§‹å­å°±ä¸èƒ½å†è³¦å€¼äº†ã€‚ ä½¿ç”¨åˆå§‹è¨­å®šå¼å¯ä»¥è³¦å€¼ (åˆå§‹è¨­å®šå¼ç·¨è­¯å¾Œæ˜¯åœ¨å»ºæ§‹å­ä¸­è³¦å€¼)ï¼š123456789101112public class Person&#123; public string FirstName &#123; get; init; &#125; public string LastName &#123; get; init; &#125; public int Age &#123; get; init; &#125;&#125;var ron = new Person&#123; FirstName = "Ron", LastName = "Sun",&#125;; å»ºæ§‹å­ä¸­è³¦å€¼ï¼Œç”šè‡³ä¿®æ”¹éƒ½å¯ä»¥ (å±•ç¤ºç”¨ï¼Œå…ˆä¸ç®¡é‚è¼¯æ˜¯å¦åˆç†)ï¼š1234567891011121314151617public class Person&#123; public Person(string firstName, string lastName, int age) &#123; FirstName = firstName; LastName = lastName; Age = age; if(age &gt; 17) &#123; FirstName = firstName + lastName; LastName = null; &#125; &#125; public string FirstName &#123; get; init; &#125; public string LastName &#123; get; init; &#125; public int Age &#123; get; init; &#125;&#125; çœ‹èµ·ä¾†ä¹Ÿæ˜¯ç‚ºäº† Immutable æ‰€åšï¼Œç”¨åœ¨ä¸æƒ³è¢«å·æ”¹å±¬æ€§å€¼çš„æƒ…å¢ƒé‚„æ»¿å¥½ç”¨çš„ã€‚ä¾‹å¦‚éš¨æ„ä¿®æ”¹å‚³å…¥æ–¹æ³•çš„åƒæ•¸ä¸­çš„å±¬æ€§ï¼Œå†æŠŠè©²åƒæ•¸å‚³éžåˆ°å…¶ä»–æ–¹æ³•ä¸­ï¼Œæœ€å¾Œé›£ä»¥è¿½è¹¤åƒæ•¸å€¼çš„ç¾æ³ã€‚ æœ€ä¸Šå±¤é™³è¿°å¼ (Top-level statements)çœç•¥ Prgram é¡žåˆ¥å’Œ Main æ–¹æ³•çš„å¤§éƒ¨åˆ†ç¨‹å¼ç¢¼ã€‚ çœ‹èµ·ä¾†æœ‰é»žé›žè‚‹ï¼Œå¯¦éš›å°ˆæ¡ˆæ²’ç”šéº¼æ•ˆç›Šï¼Œä½†ç”¨ RoslynPad ç­‰å·¥å…·åšå¯¦é©—æ™‚ä¸ç”¨å†æŠŠæ•´å€‹ Main æ–¹æ³•åˆ»å‡ºä¾†æœ‰æ¯”è¼ƒæ–¹ä¾¿ã€‚ æ›´å¤šçš„æ¨¡å¼æ¯”å° (Pattern matching enhancements)æ‹¬è™Ÿã€andã€orã€notã€&gt;ã€&lt;ã€= ç­‰ï¼Œå¦‚ä¸‹ç¶œåˆç¯„ä¾‹ã€‚ 12public static bool IsLetterOrSeparator(this char c) =&gt; c is (&gt;= 'a' and &lt;= 'z') or (&gt;= 'A' and &lt;= 'Z') or '.' or ','; é€™ç¬¦è™Ÿå¯¦åœ¨å¤ªå¤šäº†ï¼Œæžœç„¶é‚„æ˜¯éœ€è¦å¦å¤–é–‹ä¸€ç¯‡æ–‡ç« è©³ç´°ä»‹ç´¹ã€‚ Performance and interopFit and finish features åŸºæ–¼ new é—œéµå­—çš„æŽ¨è«–åž‹åˆ¥ã€‚ 123Person p = new();InitPerson(new(), "Ron", "Sun");// void InitPerson(Person p, string firstName, string lastName) static ä¿®é£¾è©žå¯åŠ åœ¨åœ¨ lambda é‹ç®—å¼æˆ–åŒ¿åæ–¹æ³•ä¸Šã€‚ å…¶ä»–çœ‹ä¸å¤ªæ‡‚çš„ä¹‹å¾Œå†ç ”ç©¶ã€‚ ç¨‹å¼ç¢¼ç”¢ç”Ÿå™¨çš„æ”¯æ´çµè«–C# 9 æœ‰ä¸€äº›æ¯”è¼ƒæ–°ç‰¹æ€§è¡ç”Ÿå‡ºå¾ˆå¤šå¯ä»¥ç ”ç©¶çš„ç´°ç¯€ï¼Œé€™ç¯‡å…ˆæ¦‚ç•¥æ€§çš„ç´€éŒ„ä¸€ä¸‹ï¼Œä¹‹å¾Œæ ¹æ“šç‰¹æ€§å†å¦å¤–æ·±ç©¶ç™¼æ–‡ã€‚ å·²ç¶“è·Ÿä¸å¤ªä¸Šäº†ã€‚ åƒè€ƒWhatâ€™s new in C# 9.0 (åŽŸæ–‡ä»¶å·²ç¶“è¢«åˆªé™¤ï¼Œé€™æ˜¯ Archive ç¶²ç«™çš„å­˜æª”) ChatGPT]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ C# ä¸­æŽ§åˆ¶éžåŒæ­¥æ“ä½œçš„ç¸½è¶…æ™‚æ™‚é–“]]></title>
    <url>%2Fcontent%2F20240623-async-batch-timedout.html</url>
    <content type="text"><![CDATA[åœ¨ä¹‹å‰çš„å°ˆæ¡ˆä¸­ï¼Œæˆ‘å€‘é‡åˆ°äº†ä¸€å€‹æƒ…å¢ƒï¼Œåœ¨éœ€è¦è™•ç†å¤šå€‹éžåŒæ­¥æ“ä½œï¼Œä¾‹å¦‚å¤šå€‹ç¶²çµ¡è«‹æ±‚æˆ–æ–‡ä»¶è™•ç†æ™‚ï¼Œéœ€è¦è¨­å®šä¸€å€‹ç¸½å’Œçš„è¶…æ™‚æ™‚é–“ï¼Œç•¶è¶…éŽé€™å€‹æ™‚é–“æ™‚ï¼Œåªå›žå‚³æˆåŠŸåŸ·è¡Œçš„éžåŒæ­¥æ“ä½œçµæžœï¼Œä¸¦æ”¾æ£„é‚„æ²’åšå®Œçš„éƒ¨åˆ†ã€‚é€™ç¯‡æ–‡ç« æœƒèªªæ˜Žå¦‚ä½•æ‡‰å°é€™ç¨®ç‰¹æ®Šéœ€æ±‚ã€‚ å•é¡Œç´°ç¯€èªªæ˜Žå°æ–¼æ‰¹æ¬¡éžåŒæ­¥æ“ä½œï¼Œä¸€èˆ¬æœ‰å…©ç¨®ç­–ç•¥ï¼šä¸€æ˜¯ä½¿ç”¨ Task.WhenAll åœ¨æ‰€æœ‰æ“ä½œéƒ½å®Œæˆæ™‚ç¹¼çºŒï¼›äºŒæ˜¯ä½¿ç”¨ Task.WhenAny åœ¨ä»»ä¸€æ“ä½œå®Œæˆæ™‚ç¹¼çºŒã€‚ä½†é€™å…©ç¨®ç­–ç•¥éƒ½ä¸èƒ½è§£æ±ºé€™å€‹å•é¡Œï¼šåœ¨ç‰¹å®šæ™‚é–“ç¯„åœå…§åªè™•ç†å·²å®Œæˆçš„æ“ä½œã€‚ è§£æ±ºæ–¹æ¡ˆä½¿ç”¨ Task.WhenAny æ­é…ä¸€å€‹è¨ˆæ™‚ç”¨çš„ Task ä¾†é”åˆ°ç›®æ¨™ã€‚ 123456789101112131415161718192021222324252627282930public class AsyncTimeoutExample&#123; public async Task&lt;List&lt;string&gt;&gt; ProcessTasksWithTimeout(IEnumerable&lt;Task&lt;string&gt;&gt; tasks, TimeSpan timeout) &#123; // The key point is the timer task. var timeoutTask = Task.Delay(timeout); var taskList = new List&lt;Task&lt;string&gt;&gt;(tasks) &#123; timeoutTask &#125;; var results = new List&lt;string&gt;(); while (taskList.Count &gt; 0) &#123; Task completedTask = await Task.WhenAny(taskList); // Timed out, stop then return completed results. if (completedTask == timeoutTask) &#123; break; &#125; taskList.Remove(completedTask); if (completedTask is Task&lt;string&gt; resultTask) &#123; // A task completed in time. // Keep the result and continue until timeout or every tasks are completed. results.Add(await resultTask); &#125; &#125; return results; &#125;&#125; çµè«–é€™å€‹éœ€æ±‚å…¶å¯¦å¾ˆç‰¹æ®Šï¼Œä¸€èˆ¬æƒ…å¢ƒä¸‹ä¸æœƒé‡åˆ°ï¼Œä½†ä½¿ç”¨ä¸€å€‹è¨ˆæ™‚ç”¨çš„ Task æ­é… Task.WhenAny çš„ç­–ç•¥å¾ˆæœ‰è¶£ï¼Œæ‰€ä»¥è¨˜éŒ„ä¸€ä¸‹ï¼Œä¾›æœªä¾†åƒè€ƒã€‚ åƒè€ƒChatGPT]]></content>
      <categories>
        <category>C#</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨éžåŒæ­¥æƒ…å¢ƒä¸‹ä½¿ç”¨ ConcurrentDictionary]]></title>
    <url>%2Fcontent%2F20240622-concurrent-dictionary.html</url>
    <content type="text"><![CDATA[åœ¨è™•ç†éžåŒæ­¥æ“ä½œæ™‚ï¼Œç•¶å¤šå€‹éžåŒæ­¥ä»»å‹™åŒæ™‚æ“ä½œå…±äº«è³‡æºæ™‚ï¼Œå¯èƒ½æœƒå°Žè‡´è³‡æ–™ä¸ä¸€è‡´ã€‚é€™ç¯‡æ–‡ç« å°‡èšç„¦æ–¼å¦‚ä½•åœ¨éžåŒæ­¥æƒ…å¢ƒä¸‹ä½¿ç”¨ ConcurrentDictionary å–ä»£ Dictionary ä¾†è§£æ±ºé€™äº›å•é¡Œã€‚ å•é¡Œç¨‹å¼ç¢¼123456789101112131415161718192021222324[HttpGet]public async Task&lt;IActionResult&gt; Foo()&#123; var dic = new Dictionary&lt;long, long&gt;(); var tasks = new List&lt;Task&gt;(); var rdm = new Random(); int i = 0; while (i++ &lt; 10) &#123; // Do NOT await here. var t = HttpRequest(dic, rdm.Next()); tasks.Add(t); &#125; await Task.WhenAll(tasks); return Ok(); async Task HttpRequest(Dictionary&lt;long, long&gt; dic, int num) &#123; await Task.Delay(500); dic[num] = num; &#125;&#125; åœ¨é€™æ®µç¨‹å¼ç¢¼ä¸­ï¼Œæˆ‘å€‘æ¨¡æ“¬åŒæ™‚ç™¼é€å¤šå€‹ Http Request çš„æ“ä½œï¼Œç”±æ–¼å¤šå€‹è«‹æ±‚ä¸éœ€äº’ç›¸ç­‰å¾…ï¼Œå› æ­¤æ¯æ¬¡å‘¼å« HttpRequest æ–¹æ³•æ™‚ä¸¦ä¸æœƒåŠ ä¸Š await é—œéµå­—ï¼Œè€Œæ˜¯åœ¨æ‰€æœ‰è«‹æ±‚éƒ½ç™¼å‡ºå¾Œå†ç­‰å¾…æ‰€æœ‰çµæžœå®Œæˆï¼Œä»¥é”åˆ°æ•ˆèƒ½ç›®æ¨™ã€‚ ä½†æ¯å€‹ Http Request å®Œæˆå¾Œéƒ½æœƒæ“ä½œä¸€å€‹å…±äº«çš„ Dictionary&lt;long, long&gt; ç‰©ä»¶ï¼Œé€™åœ¨éžåŒæ­¥æƒ…å¢ƒä¸‹å¼•ç™¼å¤šåŸ·è¡Œç·’æ“ä½œæ™‚ï¼Œæœƒæœ‰éžå¸¸å°çš„æ©ŸçŽ‡å°Žè‡´è³‡æ–™ä¸ä¸€è‡´ã€‚ è§£æ±ºæ–¹æ¡ˆï¼šä½¿ç”¨ ConcurrentDictionaryç‚ºäº†è§£æ±ºä¸Šè¿°å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥å°‡ Dictionary æ›æˆ ConcurrentDictionary é€™å€‹åŸ·è¡Œåºå®‰å…¨çš„é¡žåˆ¥ï¼Œå…è¨±å¤šå€‹åŸ·è¡Œç·’å®‰å…¨åœ°æ“ä½œå…¶ä¸­çš„è³‡æ–™ã€‚ ä»¥ä¸‹æ˜¯ä¿®æ”¹å¾Œçš„ç¨‹å¼ç¢¼ï¼š 123456789101112131415161718192021222324[HttpGet]public async Task&lt;IActionResult&gt; Foo()&#123; var dic = new ConcurrentDictionary&lt;long, long&gt;(); var tasks = new List&lt;Task&gt;(); var rdm = new Random(); int i = 0; while (i++ &lt; 10) &#123; // Do NOT await here. var t = HttpRequest(dic, rdm.Next()); tasks.Add(t); &#125; await Task.WhenAll(tasks); return Ok(); async Task HttpRequest(ConcurrentDictionary&lt;long, long&gt; dic, int num) &#123; await Task.Delay(500); dic[num] = num; &#125;&#125; çµè«–å…¶å¯¦ç•¶åˆé–‹ç™¼æ™‚æœ‰é–ƒéŽä¸€é»žç–‘æ…®ï¼Œä½†å› ç‚ºé€™åªæ˜¯ä¸€å€‹è³¦å€¼çš„æ¥µç°¡å–®æ“ä½œï¼Œä¸€æ™‚è¼•çŽ‡ä»¥ç‚ºä¸æœƒå‡ºéŒ¯ï¼Œå°Žè‡´åœ¨ä¸Šç·šå¾Œç™¼ç”Ÿè³‡æ–™ä¸ä¸€è‡´çš„å•é¡Œï¼Œä¸”å› ç‚ºé€™å€‹å•é¡Œä¸€å€‹æœˆåªç™¼ç”Ÿä¸€å…©æ¬¡æ‰€ä»¥å¤šèŠ±äº†å¾ˆå¤šæ™‚é–“è’é›†è³‡è¨Šå’Œè¿½æŸ¥åŽŸå› ï¼ŒçœŸçš„åˆ’ä¸ä¾†ã€‚é™¤äº† ConcurrentDictionary å¤–ï¼Œå¾žå®ƒçš„å‘½åç©ºé–“å¯ä»¥ç™¼ç¾é‚„æœ‰å…¶ä»–é‡å°åŸ·è¡Œç·’å®‰å…¨æ‰€è¨­è¨ˆçš„é¡žåˆ¥ï¼Œä¹Ÿæ‡‰å–„åŠ åˆ©ç”¨ã€‚ åƒè€ƒChatGPT]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è³‡æ–™æŸ¥è©¢å¾ˆæ…¢çš„åŽŸå› èˆ‡å› æ‡‰æ–¹å¼]]></title>
    <url>%2Fcontent%2F20240526-identify-and-solve-slow-data-queries.html</url>
    <content type="text"><![CDATA[åœ¨å¯¦éš›å°ˆæ¡ˆä¸­ï¼Œè³‡æ–™æŸ¥è©¢ç·©æ…¢æ˜¯ä¸€å€‹å¸¸è¦‹çš„å•é¡Œï¼Œå¦‚ä½•æ‰¾å‡ºå…·é«”åŽŸå› æˆäº†ä¸€å€‹å¾ˆé‡è¦çš„ä¸»é¡Œã€‚ä½†åœ¨å·¥ä½œä¸­ï¼Œå¾ˆå¤šäººå¾€å¾€éŽæ–¼æ³¨é‡å–®ä¸€é¢å‘è€Œæ²’æœ‰ç²¾ç¢ºçš„æ‰¾å‡ºçœŸæ­£çš„ç“¶é ¸ã€‚ä¾‹å¦‚ï¼Œå› ç‚º ORM ä½¿ç”¨ä¸ç•¶è€Œå°Žè‡´æ•ˆèƒ½ä½Žè½ï¼Œå»å°‡å•é¡Œæ­¸å’Žæ–¼ ORM æœ¬èº«é€²è€Œç¦ç”¨ ORMã€‚ç›´æŽ¥æ’°å¯« SQL æŸ¥è©¢é›–ç„¶å¯èƒ½è¼ƒå¿«ï¼Œä½†å¤±åŽ»äº† ORM çš„å„ªå‹¢ã€‚å¦‚æžœèƒ½å…ˆæ„è­˜åˆ° ORM ä½¿ç”¨ä¸ç•¶çš„å•é¡Œä¸¦åŠ ä»¥æ”¹å–„ï¼Œæˆ–è¨±èƒ½åŒæ™‚é”åˆ°æ•ˆèƒ½éœ€æ±‚ä¸¦ä¿æœ‰ ORM çš„å„ªå‹¢ã€‚ æ‰¾åˆ°å•é¡Œå¾Œçš„è§£æ±ºæ–¹æ¡ˆåˆæ˜¯å¦ä¸€å€‹è¤‡é›œçš„éŽç¨‹ï¼Œæœ¬æ–‡å°‡ç°¡å–®è¨˜éŒ„å¹¾å€‹æŽ’æŸ¥è³‡æ–™æŸ¥è©¢ç·©æ…¢çš„å¸¸è¦‹æ–¹å‘åŠæ‡‰å°æ–¹å¼ã€‚ å¾ž ORM é–‹å§‹æŽ¥çºŒä¸€é–‹å§‹èªªçš„ï¼Œå¾ž ORM å¸¸è¦‹å•é¡Œé–‹å§‹æŽ’æŸ¥ã€‚ N+1 Problem (N+1 Queries)ä»¥ä¸‹é¢ç¨‹å¼ç¢¼ç‚ºç¯„ä¾‹ï¼Œä¸¦æœ‰ä»¥ä¸‹å‰æï¼š ä½¿ç”¨ Entity Framework Core ä½œç‚º ORMã€‚ å•Ÿç”¨ Lazy Loadingã€‚ 12345678910using (var context = new MyDbContext())&#123; // 1 Query. var authors = context.Authors.ToList(); foreach (var author in authors) &#123; // Additional N Queries. var books = author.Books; &#125;&#125; ä¸Šé¢çš„ç¯„ä¾‹ä¸­ç¸½å…±æœƒç”¢ç”Ÿ 1 (context.Authors) + N (author.Books) æ¬¡æŸ¥è©¢ã€‚ä¹Ÿå°±æ˜¯èªªå¦‚æžœè³‡æ–™åº«ä¸­æœ‰ 1000 å€‹ä½œè€…ï¼Œå°±æœƒå…ˆåŸ·è¡Œä¸€æ¬¡æŸ¥è©¢ä¾†æŸ¥å‡ºæ‰€æœ‰ä½œè€…è³‡è¨Šï¼Œä¸¦åœ¨è¿´åœˆä¸­é¡å¤–æŸ¥è©¢ 1000 æ¬¡å„å€‹ä½œè€…çš„è‘—ä½œã€‚ è€Œæ­£ç¢ºçš„åšæ³•æ‡‰è©²å¦‚ä¸‹ï¼š123456789101112using (var context = new AppDbContext())&#123; // A single query. var authorsWithBooks = context.Authors .Include(a =&gt; a.Books) .ToList(); foreach (var author in authorsWithBooks) &#123; // No additional queries are executed here. var books = author.Books; &#125;&#125; é€™å€‹åšæ³•åœ¨ä¸€é–‹å§‹æŸ¥è©¢å‡ºä½œè€…æ™‚ï¼Œä¹Ÿå°‡æ‰€æœ‰ä½œè€…çš„è‘—ä½œæŸ¥è©¢å‡ºä¾†ï¼Œè¿´åœˆä¸­å°±åªæ˜¯å­˜å–è¨˜æ†¶é«”ä¸­çš„è³‡æ–™ï¼Œå¦‚æžœè³‡æ–™åº«ä¸­æœ‰ 1000 å€‹ä½œè€…ï¼Œç›¸ç•¶æ–¼çœä¸‹äº† 1000 æ¬¡é¡å¤–æŸ¥è©¢ã€‚ æ¿«ç”¨ Lazy Loadingå¦‚æžœæ²’æœ‰æ³¨æ„ Lazy Loading çš„ç‰¹æ€§å°±å¾ˆå®¹æ˜“åœ¨å­˜å– Model çš„éŽç¨‹ï¼Œä¸ç¶“æ„çš„é€ æˆå¤§é‡çš„é¡å¤–æŸ¥è©¢ã€‚ä¾‹å¦‚ä¸‹é¢ç¯„ä¾‹ï¼š 1234567891011121314using (var context = new MyDbContext())&#123; // The 1st query. var author = context.Authors.FirstOrDefault(); // The 2nd query. var books = author.Books; // The 3rd query var awards = author.Awards; // Much more queries via navigations. // ...&#125; Entity Framework Core é è¨­ä¸å•Ÿç”¨ Lazy Loading å°±è®“æˆ‘è¦ºå¾—å¾ˆæ”¾å¿ƒï¼Œå³ä½¿æ˜¯è³‡æ·ºåŒäº‹ä¹Ÿä¸å®¹æ˜“èª¤ç”¨ã€‚ LINQ æŸ¥è©¢æ‰€ç¿»è­¯å‡ºä¾†çš„ SQL ä¸å¤ ç†æƒ³æ—¢ç„¶ ORM çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å°‡ LINQ ç¿»è­¯æˆ SQLï¼Œå°±æ‡‰è©²é©æ™‚çš„é–‹å•Ÿç›¸æ‡‰çš„ Log åŠŸèƒ½ä¾†å°å‡ºç¿»è­¯çµæžœï¼Œä¸¦è©¦è‘—é€éŽèª¿æ•´ LINQ èªžå¥ä¾†å¾—åˆ°æ›´ç†æƒ³çš„ SQLã€‚ å°çµåœ¨åˆ†æž ORM çš„æ•ˆèƒ½å½±éŸ¿æ™‚ï¼Œå…ˆç¢ºå®šä¸æ˜¯èª¤ç”¨é€ æˆçš„æ•ˆèƒ½ç“¶é ¸å†ä¾†è¨Žè«– ORM æœ¬èº«å°æ•ˆèƒ½çš„å½±éŸ¿æœƒæ¯”è¼ƒæ°ç•¶ã€‚ è³‡æ–™åº«èˆ‡ SQL æ•ˆèƒ½ORM èƒ½åšçš„å°±æ˜¯ç¿»è­¯ï¼Œé™¤äº†ç¿»è­¯æ•ˆæžœä¸ç†æƒ³çš„å› ç´ å¤–ï¼Œå¦å¤–ä¸€å€‹é¢å‘æ˜¯å¾žè³‡æ–™åº«èˆ‡ SQL æœ¬èº«ä¾†æŽ’æŸ¥ã€‚ Cartesian Explosion (ç¬›å¡å…’çˆ†ç‚¸)é€™æ˜¯å¾ˆç¶“å…¸çš„å•é¡Œï¼Œç¶²è·¯ä¸Šè³‡æºå¾ˆå¤šæ‰€ä»¥é€™é‚Šå°±ç”¨å€‹ç¯„ä¾‹ç°¡ä»‹ä¸€ä¸‹å°±å¥½ã€‚ 123456-- Count: 1 AUTHORS * N BOOKS * M AWARDSSELECT a.NAME AS AUTHOR_NAME, b.TITLE AS BOOK_TITLE, aw.AWARD_NAME AS AWARD_NAMEFROM AUTHORS aJOIN BOOKS b ON a.AUTHOR_ID = b.AUTHOR_IDJOIN AWARDS aw ON a.AUTHOR_ID = aw.AUTHOR_ID;WHERE a.NAME = 'John Smith' å‡è¨­é€™å€‹ä½œè€…é—œè¯ 20 æœ¬æ›¸ä¸”ä»–å¾—äº† 10 å€‹çŽé …ï¼Œä¸Šé¢çš„æŸ¥è©¢æœƒæŸ¥å‡º 200 (10 * 20) ç­†è³‡æ–™ï¼Œä¾æ­¤é¡žæŽ¨ï¼Œé€™å€‹ç¾è±¡åœ¨æ˜Ÿåž‹æž¶æ§‹(Star Schema)çš„æƒ…å¢ƒæœƒæ›´æ˜Žé¡¯ã€‚ä½†å¦‚æžœæˆ‘å€‘æŠŠå®ƒæ‹†æˆå…©å€‹æŸ¥è©¢å¦‚ä¸‹ï¼Œå‰‡åªæœƒç”¢ç”Ÿç¸½å…± 30 (10 + 20) ç­†è³‡æ–™ã€‚12345-- Count: 1 AUTHORS * N BOOKSSELECT a.AUTHOR_ID, a.NAME AS AUTHOR_NAME, b.TITLE AS BOOK_TITLEFROM AUTHORS aJOIN BOOKS b ON a.AUTHOR_ID = b.AUTHOR_IDWHERE a.NAME = 'John Smith'; 12345-- Count: 1 AUTHORS * M AWARDSSELECT a.AUTHOR_ID, a.NAME AS AUTHOR_NAME, aw.AWARD_NAME AS AWARD_NAMEFROM AUTHORS aJOIN AWARDS aw ON a.AUTHOR_ID = aw.AUTHOR_IDWHERE a.NAME = 'John Smith'; é›–ç„¶ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œè¼ƒå°‘çš„æŸ¥è©¢æ¬¡æ•¸èƒ½å¸¶ä¾†æ›´å¥½çš„æ•ˆèƒ½ï¼Œä½†åœ¨ç¬›å¡å…’çˆ†ç‚¸å•é¡Œä¸‹ï¼Œéœ€è¦è¦–æƒ…æ³æ‹†åˆ†æŸ¥è©¢ä»¥é¿å…éŽå¤šè³‡æ–™é€ æˆè¨˜æ†¶é«”è² æ“”ã€‚å¤§é‡è³‡æ–™é™¤äº†å°è¨˜æ†¶é«”æ˜¯è² æ“”å¤–ï¼Œæ‡‰ç”¨ç¨‹å¼è™•ç†é€™äº›è³‡æ–™ä¹Ÿæœƒæ‹–æ…¢åŸ·è¡Œæ™‚é–“ã€‚åœ¨æ¥µç«¯æƒ…æ³ä¸‹ï¼Œå¤šæ¬¡æŸ¥è©¢å¯èƒ½é å¿«æ–¼ä¸€æ¬¡å¼•ç™¼ç¬›å¡å…’çˆ†ç‚¸çš„æŸ¥è©¢ã€‚ åŸ·è¡Œè¨ˆåŠƒ (Execution Plan)é€éŽåŸ·è¡Œè¨ˆåŠƒæŸ¥çœ‹æŸ¥è©¢åŸ·è¡Œçš„éŽç¨‹ï¼Œèƒ½å¤ æœ‰æ•ˆçš„åˆ¤å®šå‡ºä¸»è¦æ•ˆèƒ½å•é¡Œã€‚å¸¸è¦‹çš„è§£æ±ºæ–¹æ¡ˆå¦‚ä¸‹ï¼š Indexæœ€å¸¸è¦‹çš„è™•ç†æ–¹å¼ï¼Œé©ç•¶çš„ç´¢å¼•èƒ½å¤§å¹…æå‡æŸ¥è©¢é€Ÿåº¦ï¼Œè€Œç´¢å¼•ç¨®é¡žèˆ‡ç´°ç¯€éžå¸¸å¤šï¼Œéœ€è¦å¦å¤–èŠ±æ™‚é–“ç ”ç©¶ã€‚ Partitionç´¢å¼•ä¸æ˜¯è¬èƒ½ï¼Œç•¶ä¸€å¼µè¡¨çš„è³‡æ–™é‡èˆ‡æŸ¥è©¢ç¯„åœå¤ å¤§æ™‚ï¼Œå³ä½¿ä½¿ç”¨ Index é€²è¡Œç¯„åœæŸ¥è©¢ä¹Ÿæœƒé€ æˆæ•ˆèƒ½ä½Žè½çš„å•é¡Œï¼Œé€™æ™‚å€™ Partition (ä»¥ Oracle ä¾†èªª) å°±èƒ½æœ‰æ•ˆçš„é€²ä¸€æ­¥æå‡æŸ¥è©¢æ•ˆèƒ½ã€‚ å¦ä¸€å€‹æ¦‚å¿µæ˜¯åˆ†ç‰‡(Shard)ï¼Œå…©è€…å·®ç•°åƒè€ƒå…¶ä»–è³‡æ–™ è³‡æ–™æ­¸æª”(Archive)å°‡å°‘ç”¨çš„è³‡æ–™ (é€šå¸¸æ˜¯èˆŠè³‡æ–™) åˆ†æ•£åˆ°å…¶ä»–è³‡æ–™åº«ä¸­ï¼Œæ¸›å°‘å¸¸ç”¨è³‡æ–™åº«ä¸­çš„è³‡æ–™é‡ã€‚ä½†é€™å€‹ç­–ç•¥å¾ˆä¾è³´å•†å‹™å±¤é¢ä½¿ç”¨è³‡æ–™çš„æ–¹å¼ï¼Œåªåœ¨å­˜åœ¨å°‘ç”¨è³‡æ–™æ™‚æ‰æœ‰ç”¨ã€‚ å¦å¤–é€™å€‹åšæ³•å¾ˆè¤‡é›œï¼š é¦–å…ˆè¦å…ˆåˆ¶å®šè³‡æ–™é·ç§»çš„æ™‚é–“å’Œç›¸é—œæ“ä½œï¼Œå¦‚æžœè¦ä¸åœæ©Ÿé·ç§»é›£åº¦æœƒæ›´é«˜ã€‚ æŸ¥è©¢æ™‚ï¼Œå¦‚æžœå°‘ç”¨è³‡æ–™çµ‚ç©¶é‚„æ˜¯è¦ç”¨åˆ°ï¼Œé‚£æ‡‰ç”¨ç¨‹å¼ä¸­æŸ¥è©¢å°±è¦è€ƒæ…®å…©å€‹è³‡æ–™åº«ä¾†æºï¼Œéžå¸¸éº»ç…©ã€‚ æ‰¿ä¸Šï¼Œè·¨è³‡æ–™åº«æŸ¥è©¢å°æ–¼éœ€è¦æŽ’åºèˆ‡åˆ†é çš„åŠŸèƒ½ä¾†èªªæ˜¯é›£ä»¥è·¨è¶Šçš„éšœç¤™ï¼Œé€™å€‹é™åˆ¶æœƒç›´æŽ¥é™ç¸®é€™å€‹è§£æ³•çš„é©ç”¨ç¯„åœã€‚ å°çµè³‡æ–™åº«å’Œ SQL åˆ†æžç¯„åœå¾ˆå»£ï¼Œé€™é‚Šæçš„æ˜¯æˆ‘è¦‹éŽçš„éƒ¨åˆ†ã€‚ ç¸½çµæœƒæƒ³å¯«é€™ç¯‡æ˜¯å› ç‚ºåœ¨é¢å°æ•ˆèƒ½å•é¡Œæ™‚ï¼Œå¸¸è¦‹åˆ°æ‰¾ä¸åˆ°çœŸæ­£çš„ç“¶é ¸ä½†å»èŠ±å¾ˆå¤šç²¾ç¥žåœ¨å¾®å°çš„æ”¹å–„ä¸Šçš„æƒ…æ³ï¼Œæˆ–æ˜¯æ²’æ„è­˜åˆ°èª¤ç”¨å·¥å…·è€Œæ£„ç”¨å·¥å…·ï¼Œå¯¦åœ¨å¾ˆå¯æƒœã€‚ åƒè€ƒPartitioning &amp; Sharding â€” choosing the right scaling method]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Entity Framework Core é ç†±]]></title>
    <url>%2Fcontent%2F20240512-ef-core-warmup.html</url>
    <content type="text"><![CDATA[åœ¨ä½¿ç”¨ Entity Framework Core (EF Core) é€²è¡Œè³‡æ–™å­˜å–æ“ä½œæ™‚ï¼Œåˆæ¬¡æŸ¥è©¢æ™‚æœƒæœ‰è€—æ™‚è¼ƒé•·çš„ç¾è±¡ã€‚é€™ç¨®å»¶é²ä¸»è¦æ˜¯å› ç‚º EF Core åœ¨ç¬¬ä¸€æ¬¡åŸ·è¡ŒæŸ¥è©¢æ™‚éœ€è¦é€²è¡Œä¸€ç³»åˆ—çš„åˆå§‹åŒ–æ­¥é©Ÿã€‚é€™äº›æ­¥é©Ÿé€ æˆçš„å»¶é²å¯èƒ½æœƒå°æ•ˆèƒ½æ•æ„Ÿçš„æ‡‰ç”¨ç¨‹å¼é€ æˆä¸åˆ©çš„å½±éŸ¿ã€‚ä¾‹å¦‚åœ¨ WebAPI æœå‹™ä¸­ï¼Œå¦‚æžœåˆå§‹åŒ–èŠ±è²»å¤ªå¤šæ™‚é–“å¯èƒ½é€ æˆé€£ç·šè¶…æ™‚ã€‚è€Œä¸”åœ¨æ•ˆèƒ½ç›£æ¸¬æ™‚ï¼Œé€™ç¨®åˆå§‹åŒ–æ‰€é€ æˆçš„å»¶é²å¯èƒ½æœƒç”¢ç”Ÿæ¥µç«¯çš„åŸ·è¡Œæ™‚é–“è³‡æ–™å½±éŸ¿åˆ°æ•ˆèƒ½çš„è§£è®€ã€‚ ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œé€šå¸¸æœƒåœ¨æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•éšŽæ®µåŠ å…¥ä¸€äº›é ç†±çš„æ“ä½œï¼Œä»¥æå‰å®Œæˆä¸€äº›å¿…è¦çš„åˆå§‹åŒ–æ­¥é©Ÿã€‚é€™ç¯‡æ–‡ç« æœƒä»‹ç´¹å…©ç¨®é ç†±è§£æ³•ï¼Œè¦æ³¨æ„çš„æ˜¯é€™å…©å€‹è§£æ³•ä¸æ˜¯é‡å°æ‰€æœ‰çš„åˆå§‹åŒ–æ­¥é©Ÿï¼Œç›®çš„åªæ˜¯è¦é”åˆ°è§¸ç™¼ DbContext.OnModelCreating() çš„æ•ˆæžœä¾†é™ä½Žé¦–æ¬¡æŸ¥è©¢çš„å»¶é²æ™‚é–“ã€‚ è§£æ³•ä¸€ï¼š dbContext.Set&lt;T&gt;ä»¥ ASP.NET Core ä¾†èªªï¼Œåœ¨ Startup.cs ä¸­çš„ Configure æ–¹æ³•ä¸­æ³¨å…¥ DbContext ä¾†é”åˆ°æ•ˆæžœæ˜¯æœ€å¸¸è¦‹çš„ä½œæ³•ï¼Œå¦‚ä¸‹ï¼š 12345public void Configure(IApplicationBuilder app, DbContext dbContext)&#123; // Warmup operation, trigger DbContext.OnModelCreating() to reduce the initialization delay on first query. dbContext.Set&lt;Blog&gt;().FirstOrDefault();&#125; é€™æ˜¯æœ€ç°¡å–®çš„è§£æ³•ï¼Œä½†ç‰¹å®šçš„ Model é€²è€Œç”¢ç”Ÿé¡å¤–çš„ä¾è³´é€™å€‹ç¼ºé»žæœƒå¸¶ä¾†å¹¾å€‹é¢¨éšªå’Œé™åˆ¶ï¼š è©² Model è¢«ç§»é™¤æ™‚çœ‹ä¼¼ç„¡é—œçš„é ç†±åŠŸèƒ½ä¹Ÿéœ€è¦ä¸€ä½µä¿®æ”¹è€Œä½¿ç”¨å…¶ä»– Modelã€‚ æœƒéœ€è¦ç‰¹åˆ¥å¯«è¨»è§£èªªæ˜Žç›®çš„ï¼Œå¦å‰‡å¾ŒæœŸç¶­è­·æ™‚å¾ˆå¯èƒ½è¢«èª¤ç•¶æˆå¤šé¤˜çš„ç¨‹å¼ç¢¼è€Œåˆªé™¤ï¼Œæœ€éº»ç…©çš„æ˜¯åˆªé™¤å¾ŒçŸ­æœŸå…§å¯èƒ½é‚„ä¸æœƒç”¢ç”Ÿæ˜Žé¡¯çš„å•é¡Œã€‚ é›£ä»¥é€šç”¨åŒ–ï¼Œä¾‹å¦‚å…¬å¸å…§éƒ¨å¦‚æžœæœ‰é€šç”¨å¥—ä»¶æ™‚ï¼Œæœƒå› ç‚ºä¾è³´ç‰¹å®šè³‡æ–™åº«å°æ‡‰çš„ Model è€Œç„¡æ³•å°‡é ç†±åŠŸèƒ½åŠ å…¥å…¶ä¸­ã€‚ è§£æ³•äºŒï¼š ExecuteSqlRaw()ç‚ºäº†é¿å…è§£æ³•ä¸€æ‰€ç”¢ç”Ÿçš„å‰¯ä½œç”¨ï¼Œå¯ä»¥ç”¨åŸ·è¡Œä¸€å€‹å’Œè³‡æ–™è¡¨ç„¡é—œçš„æŸ¥è©¢é”åˆ°æ•ˆæžœï¼Œå¦‚ä¸‹ï¼š 12345public void Configure(IApplicationBuilder app, DbContext dbContext)&#123; // Warmup operation, trigger DbContext.OnModelCreating() to reduce the initialization delay on first query. dbContext.Database.ExecuteSqlRaw("SELECT 1 FROM DUAL");&#125; é€™å€‹è§£æ³•è§£æ±ºäº†ä¾è³´ç‰¹å®šçš„ Modelï¼Œé€™å€‹å„ªé»žå¸¶ä¾†äº†å¾ˆå¤§çš„é€šç”¨æ€§ã€‚ä»¥æˆ‘é‡åˆ°çš„æƒ…å¢ƒä¾†èªªï¼Œèƒ½è¼•æ˜“çš„å°‡é ç†±åŠŸèƒ½æŠ½é›¢åˆ°å…§éƒ¨å¥—ä»¶ä¸­æä¾›è·¨éƒ¨é–€åŒäº‹ä½¿ç”¨ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š 1234567891011// In internal library.public namespace MyCompany.EFCoreEnhancement&#123; public static class DbContextExtension &#123; public static void Warmup(this DbContext context) &#123; context.Database.ExecuteSqlRaw("SELECT 1 FROM DUAL"); &#125; &#125;&#125; 12345// In application using the internal library.public void Configure(IApplicationBuilder app, DbContext dbContext)&#123; dbContext.Warmup();&#125; çµè«–ä¸€èˆ¬ä¾†èªªé™¤éžå·²æœ‰ç¾æˆ API å¯ç”¨ï¼Œå¦å‰‡ä¸å»ºè­°ä¸€é–‹å§‹å°±åšé ç†±åŠŸèƒ½ã€‚å¦‚æžœè¦åšå‰‡æ˜¯è¦–ä½¿ç”¨æƒ…å¢ƒï¼Œå–®ä¸€å°ˆæ¡ˆæˆ–å­˜å–å–®ä¸€è³‡æ–™åº«çš„æƒ…å¢ƒè§£æ³•ä¸€åŠ è¨»è§£å°±å¾ˆå¤ ç”¨äº†ã€‚è§£æ³•äºŒå‰‡æ˜¯åŸºæ–¼æœ€å¤§åŒ–é€šç”¨æ€§çš„è€ƒé‡è¨­è¨ˆçš„ï¼Œé€™å€‹æ–¹æ¡ˆåœ¨æŠŠé ç†±åŠŸèƒ½æŠ½é›¢åˆ°é€šç”¨å¥—ä»¶æ™‚æ‰æœ‰æ˜Žé¡¯çš„å„ªå‹¢ã€‚]]></content>
      <categories>
        <category>C#</category>
        <category>Packages</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç‚ºä»€éº¼é™£åˆ—ç´¢å¼•çš„å­˜å–æ˜¯å¸¸æ•¸æ™‚é–“è¤‡é›œåº¦ O(1)]]></title>
    <url>%2Fcontent%2F20240427-why-access-array-index-constant-time.html</url>
    <content type="text"><![CDATA[å¯èƒ½åªæœ‰æˆ‘ä¸çŸ¥é“ï¼Œä½†æ˜¯ä¸è¨˜ä¸‹ä¾†åˆè¦ºå¾—éœ€è¦è§£é‡‹çš„æ™‚å€™æœƒè§£é‡‹ä¸å‡ºä¾†ã€‚ é™£åˆ—æ˜¯åœ¨ç¨‹å¼è¨­è¨ˆä¸­å¸¸è¦‹çš„è³‡æ–™çµæ§‹ï¼Œå°‡å¤šå€‹å›ºå®šå¤§å°çš„å…ƒç´ å­˜æ”¾åœ¨é€£çºŒçš„è¨˜æ†¶é«”ä½å€ä¸­ï¼Œè€Œé€™æ®µè¨˜æ†¶é«”çš„èµ·å§‹ä½å€æ˜¯å·²çŸ¥çš„ã€‚ç•¶è¦å­˜å–é™£åˆ—ä¸­çš„æŸå€‹å…ƒç´ æ™‚å°±èƒ½é€éŽèµ·å§‹ä½å€åŠ ä¸Šåç§»é‡ä¾†è¨ˆç®—å‡ºç›®æ¨™å…ƒç´ çš„è¨˜æ†¶é«”ä½å€ï¼Œè€Œä¸éœ€è¦ä¸€å€‹ä¸€å€‹çš„èµ°è¨ªæ‰€æœ‰å…ƒç´ åŽ»æ‰¾å‡ºç›®æ¨™å…ƒç´ ã€‚ å¦å¤–ï¼ŒWhy is indexing faster than binary search é€™ç¯‡æ–‡ç« æåˆ°é€™ä»¶äº‹èƒŒå¾Œèˆ‡ç¡¬é«”é‹ä½œæœ‰é—œã€‚ è¨ˆç®—ç›®æ¨™å…ƒç´ çš„è¨˜æ†¶é«”ä½ç½®å…¬å¼å¦‚ä¸‹ï¼š1å…ƒç´ ä½å€ = èµ·å§‹ä½å€ + (ç›®æ¨™ç´¢å¼• Ã— å…ƒç´ å¤§å°) ç”±æ–¼è¨ˆç®—å…ƒç´ ä½å€çš„éŽç¨‹ä¸ä¾è³´æ–¼é™£åˆ—çš„å¤§å°ï¼Œè€Œåƒ…æ¶‰åŠä¸€æ¬¡è¨ˆç®—æ“ä½œï¼Œå› æ­¤ç„¡è«–ç´¢å¼•å¤§å°å¦‚ä½•ï¼Œé€™å€‹æ“ä½œçš„æ™‚é–“éƒ½æ˜¯å›ºå®šçš„ã€‚é€™å°±æ˜¯ç‚ºä»€éº¼èªªé™£åˆ—ç´¢å¼•çš„å­˜å–æ™‚é–“è¤‡é›œåº¦æ˜¯ O(1)ï¼Œå³å¸¸æ•¸æ™‚é–“è¤‡é›œåº¦ã€‚ çµè«–é€™æ˜¯å€‹å¾ˆå°çš„çŸ¥è­˜é»žï¼Œå¯«å‡ºä¾†æ¯”è¼ƒåƒæ˜¯å‚™å¿˜ä¸¦å¹«åŠ©æˆ‘ç†æ¸…æ€ç·’ï¼Œè€Œéœ€è¦å›žç­”é€™å€‹å•é¡Œæ™‚ä¹Ÿèƒ½æ¯”è¼ƒé †æš¢çš„å›žç­”ã€‚ å¦ä¸€æ–¹é¢åƒè€ƒè³‡æ–™ä¸­æœ‰å¾ˆå¤šåœ–æ–‡ä¸¦èŒ‚ä¸”æ·±å…¥çš„è¬›è§£ï¼Œé€éŽé€£çµè¨˜éŒ„èµ·ä¾†éœ€è¦æ™‚ä¹Ÿèƒ½æ›´æ·±å…¥çš„äº†è§£ã€‚ åƒè€ƒHow accessing an array element is constant time ?Why does accessing an Array element take O(1) time?Why is Array Access Constant TimeWhy is indexing faster than binary search]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è²¬ä»»éˆæ¨¡å¼ - Fluent é¢¨æ ¼]]></title>
    <url>%2Fcontent%2F20240404-fluent-chain-of-responsibility.html</url>
    <content type="text"><![CDATA[ä¸€èˆ¬ç¯„ä¾‹ä¸­çš„è²¬ä»»éˆï¼Œè² è²¬çµ„åˆå„å¯¦ä½œçš„ Handler æ™‚é€šå¸¸æœƒå¦‚ä¸‹æ–¹é€™æ¨£çµ„åˆï¼Œé€™æ¨£çš„åšæ³•ä¸ç®¡å¾žæ“ä½œä¸Šé‚„æ˜¯é–±è®€ä¸Šéƒ½æ¯”è¼ƒä¸å‹å–„ï¼š12345678910111213141516// InitIHandler positiveEven = new PositiveEvenHandler();IHandler negativeEven = new NegativeEvenHandler();IHandler positiveOdd = new PositiveOddHandler();IHandler negativeOdd = new NegativeOddHandler();// ConfigurepositiveEven.SetNext(negativeEven);negativeEven.SetNext(positiveOdd);positiveOdd.SetNext(negativeOdd);// Call the chainpositiveEven.Handle(1);positiveEven.Handle(-1);positiveEven.Handle(2);positiveEven.Handle(-2); é€™ç¯‡ä¸»è¦æ˜¯ç´€éŒ„é€éŽç°¡å–®çš„ä¿®æ”¹è®“ Handler èƒ½æ›´ç°¡å–®çš„çµ„åˆè²¬ä»»éˆã€‚ ä»¥ Fluent API é¢¨æ ¼çµ„åˆæ ¹æ“šä¸Šé¢çš„ç¯„ä¾‹ï¼Œå¦‚æžœèƒ½å°‡çµ„åˆè²¬ä»»éˆæ”¹æˆ Fluent API é¢¨æ ¼ï¼Œèƒ½æœ‰æ•ˆæå‡æ˜“ç”¨æ€§ï¼Œå¦‚ä¸‹ï¼š1234567891011// Init and ConfigureIHandler root = new PositiveEvenHandler();root.SetNext(new NegativeEvenHandler()) .SetNext(new PositiveOddHandler()) .SetNext(new NegativeOddHandler());// Call the chainroot.Handle(1);root.Handle(-1);root.Handle(2);root.Handle(-2); è€Œå„ç¯€é»žçš„å¯¦ä½œé‡é»žå‰‡æ˜¯å°‡ void SetNext(IHandler next) æ”¹æˆå›žå‚³ä¸‹ä¸€å€‹ç¯€é»žçš„å¯¦ä¾‹ IHandler SetNext(IHandler next)ï¼Œéžå¸¸ç°¡å–®å°±èƒ½è®“æ•´å€‹è²¬ä»»éˆæ›´æ˜“ç”¨ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105public interface IHandler&#123; IHandler SetNext(IHandler handler); void Handle(int number);&#125;public class PositiveEvenHandler : IHandler&#123; private IHandler _nextHandler; public IHandler SetNext(IHandler handler) &#123; _nextHandler = handler; return handler; &#125; public void Handle(int number) &#123; if (number &gt; 0 &amp;&amp; number % 2 == 0) &#123; Console.WriteLine($"Positive even number &#123;number&#125;"); return; &#125; if (_nextHandler != null) &#123; _nextHandler.Handle(number); &#125; &#125;&#125;public class NegativeEvenHandler : IHandler&#123; private IHandler _nextHandler; public IHandler SetNext(IHandler handler) &#123; _nextHandler = handler; return handler; &#125; public void Handle(int number) &#123; if (number &lt; 0 &amp;&amp; -number % 2 == 0) &#123; Console.WriteLine($"Negative even number &#123;number&#125;"); return; &#125; if (_nextHandler != null) &#123; _nextHandler.Handle(number); &#125; &#125;&#125;public class PositiveOddHandler : IHandler&#123; private IHandler _nextHandler; public IHandler SetNext(IHandler handler) &#123; _nextHandler = handler; return handler; &#125; public void Handle(int number) &#123; if (number &gt; 0 &amp;&amp; number % 2 == 1) &#123; Console.WriteLine($"Positive odd number &#123;number&#125;"); return; &#125; if (_nextHandler != null) &#123; _nextHandler.Handle(number); &#125; &#125;&#125;public class NegativeOddHandler : IHandler&#123; private IHandler _nextHandler; public IHandler SetNext(IHandler handler) &#123; _nextHandler = handler; return handler; &#125; public void Handle(int number) &#123; if (number &lt; 0 &amp;&amp; -number % 2 == 1) &#123; Console.WriteLine($"Negative odd number &#123;number&#125;"); return; &#125; if (_nextHandler != null) &#123; _nextHandler.Handle(number); &#125; &#125;&#125; å…¶ä»–ä½œæ³• - Next å±¬æ€§å–ä»£ SetNext æ–¹æ³•ä¹Ÿæ˜¯å€‹ç°¡åŒ–çµ„åˆçš„ç¨‹å¼ç¢¼çš„æ–¹å¼ï¼Œä½†é€™ç¨®æ–¹å¼ç•¶æ•´å€‹è²¬ä»»éˆå¾ˆé•·æ™‚å¯è®€æ€§ç¨å·®ï¼Œæ­é… DI æ“ä½œèµ·ä¾†ä¹Ÿä¸å¤ªé †æš¢ã€‚ ä½†å„ªé»žå°±æ˜¯ç›´æŽ¥ç”¨è‡ªå‹•å¯¦ä½œå±¬æ€§å°±å¥½ï¼Œä¸ç”¨å†é¡å¤–å¯¦ä½œ SetNext æ–¹æ³•ã€‚ 12345678910111213IHandler chain = new PositiveEvenHandler&#123; Next = new &#123; Next = new NegativeEvenHandler &#123; Next = new PositiveOddHandler &#123; Next = new NegativeOddHandler&#123;&#125; &#125; &#125; &#125;&#125;; çµè«–ä¹‹å‰çš„æ–‡ç« æåˆ°éŽçš„ï¼Œè¨­è¨ˆæ¨¡å¼åªæ˜¯å€‹æ¨£æ¿ï¼Œå¯¦å‹™ä¸Šæ‡‰è©²é‡å°èªžè¨€ç‰¹æ€§èˆ‡æ‡‰ç”¨å ´æ™¯åšé©ç•¶çš„èª¿æ•´ã€‚ åƒè€ƒDesign Patternâ€” è²¬ä»»éˆæ¨¡å¼(Chain of Responsibility Pattern)]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# èªžè¨€ç‰¹æ€§æ›´æ–° - C# 8]]></title>
    <url>%2Fcontent%2F20240324-whats-new-in-csharp-8.html</url>
    <content type="text"><![CDATA[C# å„ç‰ˆæœ¬æ–°ç‰¹æ€§æ‘˜è¦ï¼ŒåŒ…å«è‡ªå·±çš„æƒ³æ³•èˆ‡å¯¦å‹™ä¸Šçš„åå¥½ã€‚ å”¯è®€æˆå“¡ (Readonly members)å…è¨±åœ¨çµæ§‹ (struct) æˆå“¡ä¸Šå–®ç¨ä½¿ç”¨ readonly ä¿®é£¾è©žã€‚å…¶ä¸­æœ‰ä¸€äº›ç²¾ç´°çš„é™åˆ¶ï¼Œé•åçš„è©±æœƒæœ‰ Warning æˆ–å› è€Œç„¡æ³•ç·¨è­¯ï¼Œæ‰€ä»¥ä¸ç”¨åˆ»æ„åŽ»è¨˜ã€‚ é è¨­ä»‹é¢æ–¹æ³• (Default interface methods)ä»‹é¢ä¸­å¯ä»¥æœ‰é è¨­å¯¦ä½œæ–¹æ³•ï¼Œæ‰“ç ´ä»¥å‰ä»‹é¢ç„¡æ³•å¯¦ä½œçš„é™åˆ¶ã€‚ä¸»è¦çš„å„ªé»žæ˜¯è®“ API é–‹ç™¼è€…å¯ä»¥åœ¨å¾ŒçºŒç‰ˆæœ¬ä¸ŠåŠ ä¸Šæ–°çš„ä»‹é¢æ–¹æ³•è€Œä¸æœƒé€ æˆç ´å£žæ€§è®Šæ›´ (Breakin Changes)ï¼Œç®—æ˜¯æ–¹ä¾¿ä½†æ˜¯é è¨­ä»‹é¢æ–¹æ³•æœ‰å¾ˆå¤šé™åˆ¶ï¼Œä¸¦ä¸æ˜¯è¡¨é¢ä¸Šçš„ â€œä»‹é¢ä¸­çš„æ–¹æ³•å¯ä»¥æœ‰å¯¦ä½œå…§å®¹â€ é€™éº¼å–®ç´”ï¼Œé€™å€‹ä¹‹å¾Œå†å¦å¤–ç™¼æ–‡æŽ¢è¨Žã€‚è€Œé€™å€‹ç‰¹æ€§é™¤äº†æ–¹ä¾¿å¤–ï¼Œä¹Ÿæœƒè®“ä»‹é¢å’ŒæŠ½è±¡æ–¹æ³•ä¹‹é–“çš„ç•Œç·šæ›´ç‚ºæ¨¡ç³Šï¼Œé€™æ™‚å€™è¨­è¨ˆçš„æ™‚å€™å°±æ‡‰è©²æ›´å¾žç‰©ä»¶å°Žå‘è¨­è¨ˆçš„è§’åº¦ä¾†æ±ºå®šå…©è€…çš„ä½¿ç”¨æ™‚æ©Ÿï¼Œè€Œä¸å–®å–®åªæ˜¯çœ‹èªžè¨€ç‰¹æ€§çš„å·®ç•°ã€‚ æ“´å¤§æ¨¡å¼æ¯”å°çš„æ‡‰ç”¨ (More patterns in more places)æ¨¡å¼æ¯”å°å¾ž C# 8 å¾Œæ›´æ–°çš„éžå¸¸è¿…é€Ÿï¼Œäº”èŠ±å…«é–€ç³ç‘¯æ»¿ç›®çš„å¾ˆå¤šï¼Œå¦‚æžœä¸æ˜¯è¦çœ‹è®Šæ›´æ­·ç¨‹çš„è©±ï¼ŒæŽ¨è–¦ç›´æŽ¥çœ‹å®Œæ•´æ•™å­¸ï¼š Pattern matching overview Patterns switch é‹ç®—å¼ (Switch expressions)è®“ switch èªžå¥æ›´ç²¾ç°¡ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š1234567891011121314151617181920public enum Color&#123; Red, Green, Blue, Yellow&#125;public string GetColorHex(Color color)&#123; return color switch &#123; Color.Red =&gt; "#FF0000", Color.Green =&gt; "#00FF00", Color.Blue =&gt; "#0000FF", Color.Yellow =&gt; "#FFFF00", // Default _ =&gt; throw new ArgumentOutOfRangeException(nameof(color), color, null) &#125;;&#125; é€™ä¸åªæ˜¯èªžæ³•å¤–è§€çš„æ”¹è®Šï¼Œswitch å€å¡Šçš„ä¸»é«”ä¹Ÿè®Šæˆäº†é‹ç®—å¼ (Expression)ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„é™³è¿°å¼ (Statement)ã€‚ å±¬æ€§æ¨¡å¼ (Property patterns)ã€Tuple æ¨¡å¼ (Tuple patterns)ã€ä½ç½®æ¨¡å¼ (Positional patterns)é›–ç„¶å‘½åä¸Šæ˜¯ Property patternsï¼Œä½†ä»–çš„æ„æ€ä¸æ˜¯åœ¨ Property ä¸Šä½¿ç”¨æ¨¡å¼æ¯”å°ï¼Œè€Œæ˜¯ä½¿ç”¨æ¨¡å¼æ¯”å°æ™‚å¯ä»¥é‡å°ç›®æ¨™åž‹åˆ¥çš„å±¬æ€§ä¾†æ¯”å°ã€‚å¤§æ¦‚å°±æ˜¯ç”¨ä¸€å †ç¬¦è™Ÿä¾†è¡¨é”å°å±¬æ€§çš„åž‹åˆ¥ã€å€¼ç¯„åœç­‰åˆ¤æ–·ï¼Œä¸»è¨´æ˜¯ç¨‹å¼ç¢¼çš„ç°¡æ½”ã€‚ Tuple æ¨¡å¼å’Œä½ç½®æ¨¡å¼ä¾æ­¤é¡žæŽ¨ã€‚ using å®£å‘Š (Using declarations)ä¸åŒæ–¼ä»¥å¾€çš„1234using (var foo = new Foo())&#123; // Somthing to do&#125; è€Œæ”¹ç”¨12using var foo = new Foo();// Somthing to do å·®åˆ¥åœ¨æ–¼ä»¥å¾€æˆ‘å€‘è¦å°‡ using å€å¡Šå¦å¤–æ¡†èµ·ä¾†ï¼Œå¸¸å¸¸éœ€è¦è™•ç†å€å¡Šå…§å®£å‘Šçš„åƒæ•¸åœ¨å€å¡Šå¤–ç„¡æ³•ä½¿ç”¨çš„å•é¡Œï¼Œä¸é›£ä½†å¾ˆé›œï¼Œä¸”ç¶“å¸¸è¢«è¿«è¦æŠŠå®£å‘Šèˆ‡è³¦å€¼åˆ†é–‹ï¼Œç¨‹å¼ç¢¼å°±æ¯”è¼ƒäº‚ï¼Œå·®ç•°å¦‚ä¸‹ï¼š1234567var v1;using (var foo = new Foo())&#123; v1 = foo.GetV1();&#125;var v2 = v1 * 2; 1234using var foo = new Foo();// Place only code related to "foo" in this scope to make it disposed ASAP.var v1 = foo.GetV1();var v2 = v1 * 2; å¦‚ä¸Šç¯„ä¾‹è¨»è§£æ‰€ç¤ºï¼Œåœ¨æ–°çš„èªžæ³•ä¸­æˆ‘å€‘ä¸ç”¨é—œå¿ƒå€å¡Šï¼Œå€å¡Šç¯„åœæœƒåœ¨ç·¨è­¯æ™‚æœŸæ±ºå®šï¼Œä½†ç›¸å°çš„å°±æ˜¯è¦æ³¨æ„ using å®£å‘Šçš„è®Šæ•¸æ‡‰è©²ç›¡æ—©ä½¿ç”¨ï¼Œé¿å…åœ¨ä¸­é–“æ”¾å…¶ä»–ç„¡é—œç¨‹å¼ç¢¼é€ æˆå¯¦éš›çš„ using å€å¡Šå¤ªå¤§ã€‚ éœæ…‹å€åŸŸå‡½å¼ (Static local functions)éœæ…‹å€åŸŸå‡½å¼èƒ½è®“æˆ‘å€‘çš„å€åŸŸå‡½å¼ä¸æ•æ‰å¤–å±¤çš„è®Šæ•¸ï¼Œä½†é€™éƒ¨åˆ†æ˜¯é€éŽ Warning CS8421 ä¾†é”åˆ°çš„ã€‚ å€åŸŸå‡½å¼çš„è®Šæ•¸æ•æ‰ç‰¹æ€§æœƒç”¢ç”Ÿé—œæ³¨é»žç™¼æ•£åˆ°å¤–å±¤æ–¹æ³•çš„å‰¯ä½œç”¨ï¼Œåˆå› ç‚ºé è¨­æœƒè‡ªå‹•æ•æ‰å¤–å±¤çš„è®Šæ•¸å°Žè‡´å¹³å¸¸é–‹ç™¼æ™‚å¾ˆé›£ç¢ºä¿æ‰€éœ€è³‡è¨Šéƒ½ç”±åƒæ•¸åˆ—æä¾›è€Œä¸æ˜¯é€éŽè®Šæ•¸æ•æ‰ï¼Œéœæ…‹å€åŸŸå‡½å¼çš„ç‰¹é»žå¯ä»¥æœ‰æ•ˆé¿å…é€™å€‹å›°æ“¾ã€‚ ref struct å¯å¯¦ä½œ IDisposable (Disposable ref structs)å°±å­—é¢ä¸Šçš„æ„æ€ï¼ŒåŒæ™‚ä¹Ÿé©ç”¨ readonly ref structã€‚ å¯ç‚º Null çš„åƒè€ƒåž‹åˆ¥ (Nullable reference types)åƒè€ƒåž‹åˆ¥æœ¬ä¾†å°±å¯ä»¥æ˜¯ Nullï¼Œé€™å€‹ç‰¹æ€§ä½¿å¾—åƒè€ƒåž‹åˆ¥ç·¨è­¯æ™‚è¢«è¦–ç‚ºä¸å¯ç‚º Nullï¼Œä¸¦ç”±ç·¨è­¯å™¨åˆ†æžæ˜¯å¦å¯èƒ½èª¤ç”¨ä½¿å…¶å€¼ç‚º nullã€‚çœ‹èµ·ä¾†æ˜¯åœ¨ç©ºå€¼åˆ¤æ–·é€™å€‹è­°é¡Œä¸Šï¼Œé€éŽå¼·åˆ¶è¦ç¯„è¿«ä½¿é–‹ç™¼è€…åš´æ ¼æª¢è¦–ç©ºå€¼æƒ…å¢ƒï¼Œå¦‚æžœåœ¨å·²æœ‰åš´æ ¼è¦ç¯„çš„å°ˆæ¡ˆä¸Šä½¿ç”¨æœ‰éŒ¦ä¸Šæ·»èŠ±çš„æ•ˆæžœï¼Œä½†å¦‚æžœç¾æœ‰å°ˆæ¡ˆè¦ç¯„èˆ‡å“è³ªä¸å¤ æˆ–é–‹ç™¼ç¿’æ…£ä¸åš´è¬¹ï¼Œå•Ÿç”¨é€™å€‹ç‰¹æ€§å¹«åŠ©ä¸å¤§ï¼Œç”šè‡³é©å¾—å…¶åè®“ç¨‹å¼ç¢¼é¢¨æ ¼æ›´ä¸ä¸€è‡´ã€‚ éžåŒæ­¥è³‡æ–™æµ (Asynchronous streams)é›–ç„¶åå­—æœ‰ streams å­—çœ¼ï¼Œä½†ä»–å’Œ Stream åž‹åˆ¥ç„¡é—œï¼Œæ˜¯æä¾›éžåŒæ­¥è¿­ä»£çš„ä¸€ç¨®ç‰¹æ€§ã€‚ å¦‚ä¸‹æ–¹ç¯„ä¾‹ç¨‹å¼ï¼Œæœ‰å¹¾å€‹é—œéµï¼š async æ–¹æ³• å›žå‚³ IAsyncEnumerable&lt;T&gt; å‘¼å«ç«¯è¿­ä»£æ™‚éœ€è¦åœ¨å‰é¢åŠ  await é—œéµå­—ï¼Œä¸é™å®šä½¿ç”¨ foreach çš„æƒ…å¢ƒï¼Œåœ¨è‡ªå·±æ“ä½œè¿­ä»£å™¨çš„æƒ…å¢ƒä¹Ÿé©ç”¨å¦‚ await using var enumerator = numberGenerator.GetAsyncEnumerator();ã€‚ 1234567891011121314151617181920212223using System;using System.Collections.Generic;using System.Threading.Tasks;class Program&#123; static async Task Main(string[] args) &#123; await foreach (var number in GenerateNumbersAsync(5)) &#123; Console.WriteLine(number); &#125; &#125; static async IAsyncEnumerable&lt;int&gt; GenerateNumbersAsync(int count) &#123; for (int i = 0; i &lt; count; i++) &#123; await Task.Delay(1000); yield return i; &#125; &#125;&#125; ä¸Šé¢ç¯„ä¾‹æ¯ç§’éƒ½èƒ½å›žå‚³ä¸€å€‹çµæžœï¼Œä½†ä»¥å‰é€šå¸¸åªèƒ½ç­‰åˆ° GenerateNumbersAsync() å®Œæˆå†ä¸€æ¬¡å›žå‚³å¦‚ä¸‹ï¼š1234567891011121314151617181920static async Task&lt;IEnumerable&lt;int&gt;&gt; GenerateNumbersAsync(int count)&#123; var numbers = new List&lt;int&gt;(); for (int i = 0; i &lt; count; i++) &#123; await Task.Delay(1000); numbers.Add(i); &#125; return numbers;&#125;// Doesn't work, returns `IEnumerable&lt;Task&lt;int&gt;&gt;` also doesn't work.// static async Task&lt;IEnumerable&lt;int&gt;&gt; GenerateNumbersAsync(int count)// &#123;// for (int i = 0; i &lt; count; i++)// &#123;// await Task.Delay(1000);// yield return i;// &#125;// &#125; è€Œæ ¹æ“š ChatGPT çš„ç¯„ä¾‹ï¼Œä¸ä½¿ç”¨é€™å€‹ç‰¹æ€§è¦æ¯ç§’éƒ½èƒ½å›žå‚³ä¸€å€‹çµæžœçš„è©±ï¼Œç¨‹å¼ç¢¼å°±æœƒåƒä¸‹é¢é€™æ¨£é›£ä»¥é–±è®€ï¼š12345678910111213141516171819202122using System;using System.Threading.Tasks;class Program&#123; static async Task Main(string[] args) &#123; await GenerateNumbersAsync(5, async number =&gt; &#123; Console.WriteLine(number); await Task.Delay(1000); &#125;); &#125; static async Task GenerateNumbersAsync(int count, Func&lt;int, Task&gt; processNumber) &#123; for (int i = 0; i &lt; count; i++) &#123; await processNumber(i); &#125; &#125;&#125; IAsyncDisposable (Asynchronous disposable)å¦‚å­—é¢ä¸Šçš„éžåŒæ­¥ disposeï¼Œä¸Šé¢çš„éžåŒæ­¥è³‡æ–™æµä¸­æåˆ°çš„ IAsyncEnumerable&lt;T&gt; å°±ç¹¼æ‰¿è‡ª IAsyncDisposableã€‚ ç´¢å¼•å’Œç¯„åœ (Indices and ranges)ç”¨æ›´ç°¡æ½”çš„èªžæ³•è¡¨é”ç´¢å¼•å’Œç¯„åœï¼Œæä¾›å…©å€‹æ–°çš„åž‹åˆ¥ System.Index å’Œ System.Rangeï¼Œä¸¦é€éŽ ^ (å€’æ•¸) å’Œ .. (åˆ°) ç¬¦è™Ÿä¾†ä½¿ç”¨ã€‚ è¦æ³¨æ„çš„æ˜¯ç¬¬ä¸€å€‹æ˜¯ 0ï¼Œä½†å€’æ•¸ç¬¬ä¸€å€‹æ˜¯ ^1 ã€‚ æ­¸ç´ä¸€ä¸‹è¦å‰‡ï¼š ^n æ˜¯å€’æ•¸ç¬¬ n å€‹ (å³ sequence[sequence.Length - n] çš„æ¦‚å¿µ)ã€‚ x..y æ˜¯ç´¢å¼• x (åŒ…å«) åˆ°ç´¢å¼• y (ä¸åŒ…å«)ï¼Œçœç•¥ x ä»£è¡¨å¾žé ­é–‹å§‹ã€‚çœç•¥ y ä»£è¡¨åˆ°åº•ç‚ºæ­¢ã€‚ x å’Œ y å¯ä»¥æ˜¯ ^m å’Œ ^n é€™æ¨£è¡¨ç¤ºã€‚ ç´¢å¼• x å¿…é ˆå°æ–¼æˆ–ç­‰æ–¼ç´¢å¼• yï¼Œè€Œ ^m å’Œ ^n æŽ¨è«–æˆ x å’Œ y å¾Œäº¦åŒã€‚ ç¯„ä¾‹å¦‚ä¸‹ï¼š12345678910111213141516171819202122string str = "This is a book.";Index first = 0;Index firstFromEnd = ^1;str[first].Dump(); // Tstr[firstFromEnd].Dump(); // .str[0].Dump(); // Tstr[^1].Dump(); // .Range range = 10..14;Range rangeFromEnd = ^5..^1;str[range].Dump(); // bookstr[rangeFromEnd].Dump(); // bookstr[10..14].Dump(); // bookstr[^5..^1].Dump(); // bookstr[5..^8].Dump(); // isstr[^10..7].Dump(); // isstr[..7].Dump(); // This isstr[10..].Dump(); // book.str[0..^0].Dump(); // This is a book.str[..].Dump(); // This is a book. é›–ç„¶æ­£å‘å’Œå€’æ•¸å¯ä»¥æ··ç”¨ï¼Œä½†ä¸è¦æ¿«ç”¨ä¸ç„¶å¯è®€æ€§ä¹Ÿæœƒå·®ã€‚ ??= (Null-coalescing assignment)ç¯„ä¾‹ï¼š1message ??= "Default Message"; åŒç¾©æ–¼1234if (message == null)&#123; message = "Default Message";&#125; éžè¨—ç®¡çµæ§‹åž‹åˆ¥ (Unmanaged constructed types)å¦‚æžœçµæ§‹åªåŒ…å«éžè¨—ç®¡åž‹åˆ¥çš„å±¬æ€§æ™‚ï¼Œè©²çµæ§‹ä¹Ÿæ˜¯éžè¨—ç®¡åž‹åˆ¥ã€‚ å·¢ç‹€é‹ç®—å¼ä¸­çš„ Stackalloc (Stackalloc in nested expressions)å¦‚æžœ stackalloc é‹ç®—å¼çš„çµæžœæ˜¯ Span&lt;T&gt; æˆ– ReadOnlySpan&lt;T&gt; å°±å¯ä»¥ä¸ç”¨å¦å¤–æŒ‡æ´¾çµ¦å¦å¤–ä¸€å€‹è®Šæ•¸ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š1234567Span&lt;int&gt; numbers = stackalloc[] &#123; 1, 2, 3, 4, 5, 6 &#125;;// In earlier version:// Span&lt;int&gt; searchNumbers = stackalloc[] &#123; 2, 4, 6, 8 &#125;;// var idx = numbers.IndexOfAny(searchNumbers);// Now:var idx = numbers.IndexOfAny(stackalloc[] &#123; 2, 4, 6, 8 &#125;); æ“´å……å…§æ’é€å­—å­—ä¸² (Enhancement of interpolated verbatim strings)å¯æ”¯æ´ $@&quot;...&quot; å’Œ @$&quot;...&quot;ï¼Œé †åºä¸æœƒé€ æˆç·¨è­¯éŒ¯èª¤ã€‚ åƒè€ƒWhatâ€™s new in C# 8.0 (åŽŸæ–‡ä»¶å·²ç¶“è¢«åˆªé™¤ï¼Œé€™æ˜¯ Archive ç¶²ç«™çš„å­˜æª”)]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# èªžè¨€ç‰¹æ€§æ›´æ–° - C# 7]]></title>
    <url>%2Fcontent%2F20240203-whats-new-in-csharp-7.html</url>
    <content type="text"><![CDATA[C# å„ç‰ˆæœ¬æ–°ç‰¹æ€§æ‘˜è¦ï¼ŒåŒ…å«è‡ªå·±çš„æƒ³æ³•èˆ‡å¯¦å‹™ä¸Šçš„åå¥½ã€‚ C# 7 ç³»åˆ—æ¯”è¼ƒç‰¹æ®Šï¼Œç¸½å…±ç¶“éŽ 7.0ã€7.1ã€7.2ã€7.3 å››å€‹ç‰ˆæœ¬ï¼Œä¸”ç¯„åœæœ‰é«˜åº¦é‡ç–Šï¼Œæ‰€ä»¥é€™é‚Šä¸åˆ†é–‹çœ‹ï¼Œç›´æŽ¥ä¾ç…§ 2021 å¹´ç‰ˆå®˜æ–¹æ•´åˆéŽçš„æ–‡ä»¶å°‡ C# 7 çš„æ–°ç‰¹æ€§ä¸€èµ·çœ‹ã€‚ Tuples å’Œ Discardså…·å Tupleä»¥å‰çš„ Tuple æ²’è¾¦æ³•å…·åï¼Œæ‰€ä»¥æœƒç”¢ç”Ÿå¾ˆå¤š tuple.Item1 é€™é¡žçš„å‘¼å«ï¼Œåš´é‡å½±éŸ¿ç¨‹å¼ç¢¼çš„å¯è®€æ€§ï¼Œå…·å Tuple å‡ºç¾å¾Œå¾ˆå¤§ç¨‹åº¦è§£æ±ºäº†é€™å€‹å•é¡Œï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š12345678public (int Id, string Name) GetPerson()&#123; return (1, "Ron");&#125;// Callervar user = GetPerson();$"ID: &#123;user.Id&#125;, Name: &#123;user.Name&#125;".Dump(); // ID: 1, Name: Ron ä½†é€™ä¹Ÿè¡ç”Ÿå‡ºå¦å¤–ä¸€å€‹å•é¡Œå°±æ˜¯å‘½åé¢¨æ ¼ï¼Œé€™é‚Šæˆ‘å»ºè­°ä¾ç…§å‘¼å«ç«¯çš„ä½¿ç”¨æ–¹å¼ä¾†æ±ºå®šï¼Œä»¥æœ¬ä¾‹ä¾†èªªï¼Œå‘¼å«ç«¯ä½¿ç”¨ä¸Šåƒæ˜¯å°‡ä»–è¦–ç‚ºå±¬æ€§ï¼Œå› æ­¤ä½¿ç”¨é›™é§å³°ã€‚ä½†å¦‚æžœåƒä¸‹é¢çš„æƒ…å¢ƒï¼Œå°±æ‡‰è©²ä½¿ç”¨å–®é§å³°ï¼Œå› ç‚ºå‘¼å«ç«¯ä½¿ç”¨ä¸Šåƒæ˜¯å€åŸŸè®Šæ•¸ï¼š12(var id, var name) = (1, "Ron");$"ID: &#123;id&#125;, Name: &#123;name&#125;".Dump(); // ID: 1, Name: Ron å¦å¤–é‚„è¦æ³¨æ„é€™ç¨®é¢¨æ ¼çš„ Tuple å…¶å¯¦èƒŒå¾Œæ˜¯ç·¨è­¯æˆ System.ValueTuple è€Œä¸æ˜¯å‚³çµ±çš„ System.Tupleï¼Œé€™å…©ç¨®åž‹åˆ¥æœ‰ä¸€äº›å·®ç•°ã€‚ Discards12345678public (int Id, string Name, string Address) GetPerson()&#123; return (1, "Ron", "My Home");&#125;// Caller, discard the Address(var id, var name, _) = GetPerson();$"ID: &#123;id&#125;, Name: &#123;name&#125;".Dump(); // ID: 1, Name: Ron å¦‚ä¸Šç¯„ä¾‹ï¼Œç”¨ä¸åˆ°çš„è®Šæ•¸å¯ä»¥ç”¨ä¸€å€‹åº•ç·š _ å–ä»£ï¼Œå¯ä»¥è®“ç¶­è­·çš„äººä¸ç”¨é—œæ³¨ç„¡ç”¨çš„è³‡è¨Šã€‚ä½†é€™ä¹Ÿä¸æ˜¯ä»–å”¯ä¸€çš„ä½¿ç”¨æƒ…å¢ƒï¼Œè©³ç´°æƒ…å¢ƒåƒè€ƒ Discards å®˜æ–¹æ–‡ä»¶ã€‚ C# æ€Žéº¼è™•ç† Tuple çš„åå­—?å°‡ä¸€æ®µç°¡å–®çš„ç¨‹å¼ç¢¼ç·¨è­¯å¾Œï¼Œé€éŽåçµ„è­¯å·¥å…·åçµ„è­¯å›žä½Žç‰ˆæœ¬çš„ C# å¯ä»¥ç™¼ç¾ï¼Œæœ€å¾Œé‚„æ˜¯å‘¼å« Item1ã€Item2ï¼Œæ‰€ä»¥å…·å Tuple å…¶å¯¦æ˜¯ä¸€ç¨®ç·¨è­¯æ™‚æœŸçš„èªžæ³•ç³–ã€‚ è§£æ§‹ (Deconstruction)é›–ç„¶è§£æ§‹çœ‹èµ·ä¾†æ˜¯å¦å¤–ä¸€å€‹ä¸»é¡Œäº†ï¼Œä½†å¯èƒ½æ˜¯å› ç‚º Tupleã€Discardsã€è§£æ§‹ï¼Œä¸‰è€…å¤ªå¸¸äº’ç›¸æ­é…ä½¿ç”¨ï¼Œå®˜æ–¹æ–‡ä»¶ä¸­æ˜¯å°‡ä»–å’Œ Discards æ”¾åœ¨ä¸€èµ·çš„ï¼Œè§£æ§‹ä¸åªèƒ½å¥—ç”¨åˆ° Tuple é‚„èƒ½é€éŽå¯¦ä½œ Deconstruct æ–¹æ³•å¥—ç”¨åˆ°å…¶ä»–åž‹åˆ¥ä¸Šã€‚ ç›´æŽ¥çœ‹ Discards å’Œ Deconstructing tuples and other types ä¾†äº†è§£æœƒæ›´å…¨é¢ã€‚ é€™é‚Šè¦æ³¨æ„ä¸€ä¸‹ï¼Œå¯«é€™ç¯‡æ–‡ç« æ™‚ C# å·²ç¶“æ›´æ–°åˆ° 12 ç‰ˆäº†ï¼Œå®˜æ–¹çš„è¦æ ¼ä»‹ç´¹ä¸­æœƒå¤¾å¾ˆå¤šå¾Œé¢ç‰ˆæœ¬æ–°å¢žçš„ç‰¹æ€§ã€‚ æ¨¡å¼æ¯”å° (Pattern matching)é€™å€‹åŠŸèƒ½æ¯”è¼ƒåƒæ˜¯ç‚ºäº†å¯è®€æ€§çš„æ“´å……ï¼Œä¸»è¦ç”¨é€”åœ¨æ–¼ç”¨ is é—œéµå­—ä¾†åšåž‹åˆ¥ç¢ºèªèˆ‡è½‰æ›ï¼›ç”¨ when é—œéµå­—ä¾†åšé™„åŠ æ¢ä»¶åˆ¤æ–·ï¼›é¡å¤–æ­é… switch ä¾†é€éŽç°¡å–®çš„èªžæ³•é”åˆ°è¤‡é›œçš„é‹ç”¨ã€‚ is é—œéµå­—1234567891011121314public void Do(object obj)&#123; if (obj is int i) &#123; // Do somthing using i. return; &#125; if (obj is string s) &#123; // Do somthing using s. return; &#125;&#125; å¾žä¸Šè¿°ç¯„ä¾‹å¯ä»¥çœ‹åˆ°ä»¥å‰éœ€è¦å…ˆé€éŽ is åˆ¤æ–·åž‹åˆ¥å¾Œå†è½‰åž‹ (æˆ–ä½¿ç”¨ as å¾Œå†åˆ¤æ–·ç©ºå€¼å¾Œè™•ç†)ï¼Œç¾åœ¨å¯ä»¥å°‡å…©å€‹è¡Œç‚ºåˆä¸€è®“å¯ç¶­è­·æ€§æé«˜å¾ˆå¤šã€‚ switch123456789101112131415161718192021private static void Do(object obj)&#123; switch (obj) &#123; case int i: // Do somthing using i. break; case string s: // Do somthing using s. break; case DateTime dt when dt.Year == 2021: // Do somthing using dt which contains Year is 2021. break; case null: // Do somthing for null scenario. break; default: // Default behavior. break; &#125;&#125; å¾žä¸Šè¿°ç¯„ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œswitch é—œéµå­—åœ¨ä½¿ç”¨ä¸Šèƒ½æ›´æœ‰å½ˆæ€§çš„è¨­å®šæ¢ä»¶äº†ã€‚ é€™å€‹è¦æ ¼ä¾ç„¶æ˜¯ç·¨è­¯æ™‚æœŸçš„èªžæ³•ç³–ï¼Œ switch æœ¬èº«çš„é™åˆ¶ä¸¦æ²’æœ‰æ”¹è®Šï¼Œä¸Šé¢çš„ç¯„ä¾‹ç·¨è­¯å¾Œå…¶å¯¦æ˜¯ ifã€else ifã€else æ¢ä»¶å¼çš„çµ„åˆã€‚ Async mainåœ¨ Main ä¸Šå¯ä»¥åŠ ä¸Š async é—œéµå­—äº†ã€‚æ¯”è¼ƒæ„å¤–çš„æ˜¯é€™ä¹Ÿæ˜¯èªžæ³•ç³–ï¼Œä¿å“¥æœ‰ä¸€ç¯‡æ–‡ç« æä¾›è©³ç´°çš„èªªæ˜Žã€‚ å€åŸŸå‡½å¼ (Local functions)å€åŸŸå‡½å¼å…è¨±ä¸€å€‹æ–¹æ³•ä¸­åŒ…å«å¦å¤–ä¸€å€‹æ–¹æ³•ï¼Œè€Œå€åŸŸå‡½å¼åªèƒ½è¢«åŒ…å«ä»–çš„æ–¹æ³•å‘¼å«ã€‚é€™å€‹è¨­è¨ˆä¸»è¦ç”¨æ–¼è¿­ä»£å™¨å’ŒéžåŒæ­¥æ–¹æ³•ä¸­ã€‚ å¯¦å‹™ä½¿ç”¨æƒ…å¢ƒè€Œåœ¨å¯¦å‹™ä¸Šï¼Œåœ¨æ»¿è¶³ä»¥ä¸‹æ¢ä»¶ä¸‹ï¼Œä¹Ÿå¯è€ƒæ…®ä½¿ç”¨å€åŸŸå‡½å¼ï¼š æœ‰è¶³å¤ çš„ç†ç”±å°‡è©²å€å¡ŠæŠ½é›¢ï¼š é€šå¸¸é€™ç¨®æƒ…å¢ƒä¸‹å¦‚æžœä¸æŠ½é›¢çš„è©±ï¼ŒåŽŸæ–¹æ³•æœƒéŽæ–¼è‚¥å¤§ï¼Œä»¥å‰å¸¸è¦‹çš„ä½œæ³•æ˜¯ç”¨ #region åŒ…è¦†èµ·ä¾†ï¼Œä½†é€™ç¨®åšæ³•å°ç¶­è­·æ²’æœ‰å¤ªå¤§çš„å¹«åŠ©ã€‚ è©²æ–¹æ³•åšç‚ºç§æœ‰æ–¹æ³•ä»ç„¶éŽæ–¼ç‰¹æ®Šï¼š å¾ˆå¤šæ™‚å€™æœƒæœ‰ç¨‹å¼ç¢¼å€å¡Šå…§å®¹éŽæ–¼ç‰¹æ®Šï¼Œé›¢é–‹ä¸»æ–¹æ³•å¾Œç„¡æ³•å°è£æˆä¸€å€‹æ–¹æ³•ã€‚ ä½¿ç”¨æ³¨æ„äº‹é …å€åŸŸå‡½å¼ä¸å®œæ¿«ç”¨ï¼Œå¦‚æžœæ¿«ç”¨æœƒç™¼ç¾ä¸»è¦æ–¹æ³•ä»ç„¶å¾ˆè‚¥å¤§ï¼Œä¸”æœƒå¢žåŠ æŽ’ç‰ˆçš„é›£åº¦ã€‚é—œæ–¼å€åŸŸå‡½å¼æŽ’ç‰ˆä¸Šæˆ‘è‡ªå·±æœ‰å¹¾å€‹å»ºè­°è¦é»žï¼š å€åŸŸå‡½å¼é›†ä¸­æ”¾åœ¨æœ€ä¸‹æ–¹ä¸”è¦åœ¨ return å¾Œï¼Œé€™æ¨£å€åŸŸå‡½å¼æ‰ä¸æœƒç©¿æ’åœ¨å‘¼å«ç«¯çš„ç¨‹å¼ç¢¼ä¸­é€ æˆæ›´å¤§çš„æ··äº‚ã€‚ å³ä½¿æ–¹æ³•ç„¡å›žå‚³ä¹Ÿè¦åœ¨å€åŸŸå‡½å¼å‰åŠ ä¸Š return;ï¼Œç”¨ä»¥æ›´æ˜Žç¢ºçš„å€éš”å‘¼å«ç«¯ç¨‹å¼ç¢¼å’Œå€åŸŸå‡½å¼éƒ¨åˆ†ã€‚ å¦‚ä¸‹ç¯„ä¾‹ï¼š1234567891011121314public void Do(int a, int b, bool c)&#123; var a2 = LocalFunction(a); int ans = c ? LocalFunction(a2 + b) : LocalFunction(a * b); // Always return at the last line of primary implementation. return; // Local functions int LocalFunction(int num) &#123; return num * 2; &#125;&#125; å€åŸŸå‡½å¼ä¹Ÿæ˜¯ç·¨è­¯æ™‚æœŸçš„èªžæ³•ç³–ä¸”æœ‰å¾ˆå¤šç´°ç¯€è¦èªªï¼Œå°¤å…¶æ˜¯åƒæ•¸å‚³éžçš„éƒ¨åˆ†ï¼Œé€™éƒ¨åˆ†ä¹‹å¾Œå†å¦å¤–å¯«ä¸€ç¯‡ä¾†è©³ç´°èªªæ˜Žã€‚ æ›´å¤šæˆå“¡æ”¯æ´é‹ç®—å¼ä¸»é«” (More expression-bodied members)é‹ç®—å¼ä¸»é«”å¥—ç”¨åˆ°æ›´å¤šæˆå“¡ä¸Šï¼ŒåŒ…å«å»ºæ§‹å­ã€Finalizerã€ä»¥åŠåœ¨å±¬æ€§å’Œç´¢å¼•å­ä¸Šçš„ get èˆ‡ set å­˜å–å­ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425public class MyContainer&#123; private List&lt;string&gt; items = new List&lt;string&gt;(); private string label; // Expression-bodied constructor public MyContainer(string initialLabel) =&gt; Label = initialLabel; // Expression-bodied finalizer ~MyContainer() =&gt; Console.WriteLine("Finalizing or cleaning up MyContainer."); // Expression-bodied property get and set accessors public string Label &#123; get =&gt; label; set =&gt; label = value ?? "Default label"; &#125; // Expression-bodied indexer public string this[int index] &#123; get =&gt; items[index]; set =&gt; items[index] = value; &#125;&#125; è¦æ³¨æ„çš„æ˜¯ Finalizerï¼ŒèˆŠç¨± Destructor çš„èªžæ³• ~ å¯¦éš›ä¸Šæ˜¯å€‹èªžæ³•ç³–ï¼Œç·¨è­¯å¾Œå…¶å¯¦æ˜¯ Finalize() æ–¹æ³•ã€‚ throw é‹ç®—å¼ (Throw expressions)throw ä¸€ç›´éƒ½æ˜¯é™³è¿°å¼ (Statement) è€Œéžé‹ç®—å¼ (Expression)ï¼Œä¹Ÿå› æ­¤ä»¥å‰å¾ˆå¤šé‹ç®—å¼ä¸­ç„¡æ³•åŒ…å« throw (ä¾‹å¦‚åœ¨ä¸‰å…ƒé‹ç®—å­ä¸­)ï¼Œè€Œåœ¨ C# 7.0 ä¸­æ–°å¢žçš„ throw é‹ç®—å¼ è§£æ±ºäº†é€™å€‹é™åˆ¶ã€‚ é è¨­å¸¸å€¼é‹ç®—å¼ (Default literal expressions)æ“´å¤§ default é‹ç®—å­çš„é©ç”¨ç¯„åœåˆ°é‹ç®—å¼ä¸Š æ•¸å€¼å¸¸å€¼çš„èªžæ³•å¢žå¼·åŠŸèƒ½ (Numeric literal syntax improvements)å…è¨±åˆ©ç”¨ _ ç¬¦è™Ÿä¾†åˆ†éš”æ•¸å­—è€Œä¸å½±éŸ¿æ•¸å€¼æœ¬èº«ï¼Œé¡žä¼¼æ–¼åƒåˆ†ä½ç¬¦è™Ÿçš„åŠŸèƒ½ä¸”åŒæ™‚èƒ½å¥—ç”¨åˆ°äºŒé€²ä½æ•¸å€¼ä¸Šï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š123int binary = 0b001_0000;int number = 10_000_000;decimal money = 1_000.123_456; out è®Šæ•¸ (out variables)å¯ä»¥æŠŠ out è®Šæ•¸çš„å®£å‘Šå’Œå‚³éžå¯«åœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹ï¼š1int.TryParse(str, out int number); é€™å€‹ç‰¹æ€§é›–ç„¶çœ‹èµ·ä¾†ä¸èµ·çœ¼ï¼Œä½†æ˜¯åœ¨å¯¦å‹™ä¸Šå°æ–¼ç¶­è­·æ˜¯æœ‰éžå¸¸å¤§çš„å¹«åŠ©çš„ï¼Œä»–èƒ½é¿å…è®“è®Šæ•¸çš„å®£å‘Šå’Œä½¿ç”¨çš„ä½ç½®è·é›¢å¤ªé ï¼Œå¦‚ä¸‹é¢ç¯„ä¾‹æ˜¯å¯¦å‹™ä¸Šå¸¸è¦‹çš„ç—›é»žã€‚é¦–å…ˆçœ‹é€™æ®µç¨‹å¼ç¢¼ï¼Œå› ç‚ºç¶­è­·æˆ–å„ç¨®é—œä¿‚å°Žè‡´è®Šæ•¸ number å’Œ decimal çš„å®£å‘Šé é›¢ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨çš„ä½ç½®ï¼Œé€²è€Œé€ æˆé–±è®€æ™‚å¿…é ˆåŒæ™‚é—œæ³¨é€™éº¼ä¸€å¤§æ®µç¨‹å¼ç¢¼ä¸¦å¿½ç•¥ä¸­é–“ç©¿æ’çš„å„ç¨®é›œè¨Šã€‚12345678910111213141516171819202122232425int number;// Unrelated code, making it hard to track 'number'for (int i = 0; i &lt; 10; i++) &#123; Console.WriteLine("Loop 1: " + i);&#125;string temp = "Hello";Console.WriteLine(temp.ToUpper());bool flag = true;if (flag) &#123; Console.WriteLine("Flag is true");&#125;decimal money;// Unrelated code, making it hard to track 'money'foreach (var item in new List&lt;string&gt; &#123; "a", "b", "c" &#125;) &#123; Console.WriteLine("Item: " + item);&#125;DateTime now = DateTime.Now;Console.WriteLine("Current time: " + now);// Usage of 'number' and 'money' is separated from its declarationint.TryParse(str, out number);decimal.TryParse(str2, out money); ä½†å¥—ç”¨é€™å€‹ç‰¹æ€§ï¼Œç¶­è­·éŽç¨‹æˆ‘å€‘å°±ä¸ç”¨é—œæ³¨é‚£äº›é›œè¨Šè€Œèƒ½ç›´æŽ¥éŽ–å®šåœ¨çœŸæ­£çš„ç›®æ¨™ä¸Šã€‚12int.TryParse(str, out int number);decimal.TryParse(str2, out decimal money); é€™å€‹å•é¡Œçš„ä¸»å› æ˜¯ä¸å¥½çš„é–‹ç™¼ç¿’æ…£ï¼Œä½†é•·æœŸå¤šäººé–‹ç™¼çš„å°ˆæ¡ˆå¾ˆé›£å®Œå…¨é¿å…é€™å€‹ç¾è±¡ã€‚é‡æ§‹å’Œ Code Reivew èƒ½ç·©è§£é€™å€‹å•é¡Œï¼Œä½†çµ‚ç©¶æ˜¯é¡å¤–çš„æˆæœ¬ï¼Œå› æ­¤å¾žèªžè¨€ç‰¹æ€§ä¸Šç›´æŽ¥é¿å…æ˜¯æ›´ç†æƒ³çš„ã€‚ éžå¾Œç½®å…·åå¼•æ•¸ (Non-trailing named arguments)å…·åå¼•æ•¸éžå¿…è¦æ”¾åœ¨æœ€å¾Œï¼Œä¾‹å¦‚ï¼š1234// In C# 7.1 and earlier, named arguments should be trailing.DisplayPersonDetails(35, "Ron", city: "New York");// In C# 7.2 and later, named arguments do not necessarily have to be trailing.DisplayPersonDetails(age: 35, "Ron", city: "New York"); é€™è®“æˆ‘å€‘å¯ä»¥ä¸ç”¨ç‚ºäº†é·å°±å‰æŽ’çš„å…·åå¼•æ•¸è€Œå°‡å…¶å¾Œæ‰€æœ‰å¼•æ•¸å…·åï¼Œä½†å¾žå¦å¤–ä¸€å€‹è§’åº¦ä¾†çœ‹ï¼Œä½¿ç”¨å…·åå¼•æ•¸æ™‚æé«˜å¯è®€æ€§å‰æ‡‰è©²å…ˆæ€è€ƒæ–¹æ³•åƒæ•¸åˆ—çš„è¨­è¨ˆæ˜¯å¦éœ€è¦æ”¹å–„ã€‚ private protected å­˜å–ä¿®é£¾è©ž (private protected access modifier)é™åˆ¶å­˜å–ç¯„åœåœ¨ protected AND internalï¼Œæ¯” protected internal ä»£è¡¨çš„ protected OR internal å­˜å–ç¯„åœæ›´ç‹¹çª„ã€‚ æ”¹å–„é¸æ“‡å¤šè¼‰çš„è¦å‰‡ (Improved overload candidates)å¢žåŠ ä¸‰å€‹è§£æžè¦å‰‡ä¾†è®“æ›´æ˜Žç¢ºçš„é¸æ“‡å¤šè¼‰ã€‚ è€å¯¦èªªæˆ‘ä¸æƒ³ç‰¹åˆ¥åŽ»è¨˜é€™äº›è¤‡é›œçš„è¦å‰‡ï¼Œå› ç‚ºé€™äº›è¦å‰‡æ˜¯å»ºç«‹åœ¨å‘¼å«å¤šè¼‰æ–¹æ³•æ™‚æœƒæ··æ·†çš„å‰æï¼Œé€šå¸¸é€™ä»£è¡¨å¤šè¼‰è¨­è¨ˆå¾—ä¸å¤ å¥½ï¼Œæ‡‰è©²å„ªå…ˆè€ƒæ…®æ”¹å–„å¤šè¼‰æ–¹æ³•çš„è¨­è¨ˆã€‚ æ“´å……å®‰å…¨ç¨‹å¼ç¢¼çš„èƒ½åŠ› (Enabling more efficient safe code)å¹¾ä¹Žéƒ½æ˜¯æ²’ç”¨éŽçš„ç‰¹æ€§ï¼Œæ‰€ä»¥ç›´æŽ¥çœ‹å®˜æ–¹æ–‡ä»¶ï¼Œæ²’ç”šéº¼å¥½èªªçš„ã€‚ å¥—ç”¨ ref åˆ°å€åŸŸè®Šæ•¸å’Œå›žå‚³å€¼ä¸Š / ref æ¢ä»¶é‹ç®—å¼ (Ref locals and returns / Conditional ref expressions)å…è¨±å‚³å€çµ¦å€åŸŸè®Šæ•¸ï¼Œä¾‹å¦‚ï¼š12345678910111213public class Program&#123; public static void Main() &#123; int[] numbers = &#123; 1, 2, 3 &#125;; ref int two = ref numbers[1]; two = 0; Console.WriteLine(two); // 0 Console.WriteLine(numbers[1]); // 0 &#125;&#125; å…è¨±å›žå‚³æ™‚å‚³å€ï¼Œä¾‹å¦‚ï¼š123456789101112131415161718public class Program&#123; public static void Main() &#123; int[] numbers = &#123; 1, 2, 3 &#125;; ref var two = ref GetTwo(numbers); two = 0; Console.WriteLine(two); // 0 Console.WriteLine(numbers[1]); // 0 &#125; static ref int GetTwo(int[] numbers) &#123; return ref numbers[1]; &#125;&#125; ref æ¢ä»¶é‹ç®—å¼ï¼Œä¾‹å¦‚ï¼š1ref var i = ref (numbers1 != null ? ref numbers1[0] : ref numbers2[0]); é™¤éžå¾ˆå¿…è¦å¦å‰‡æˆ‘ä¸ç”¨ ref çš„ï¼Œå› ç‚ºå°æ–¼é–‹ç™¼ã€ç¶­è­·äººå“¡ä¾†èªªé–€æª»è¼ƒé«˜ä¸”å®¹æ˜“è¢«æ¿«ç”¨ï¼Œä¸”åˆ°ç›®å‰ç‚ºæ­¢å·¥ä½œä¸Šå¯ä»¥ä½¿ç”¨ ref çš„æƒ…å¢ƒå…¶å¯¦éƒ½æœ‰å…¶ä»–æˆæœ¬ä¸é«˜ä¸”ä½Žå‰¯ä½œç”¨çš„æ›¿ä»£æ–¹æ¡ˆã€‚ ç•¶ç„¶ä¹Ÿä¸æ˜¯èªª ref ä¸å¥½ï¼Œç›¸ä¿¡ä»–åœ¨ä¸€äº›æ•ˆèƒ½æ¥µåº¦æ•æ„Ÿçš„æƒ…å¢ƒæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ in åƒæ•¸ä¿®é£¾è©žè£œå……ç¾æœ‰çš„ ref å’Œ outã€‚ref å‚³å€ï¼Œè¢«å‘¼å«çš„æ–¹æ³•ä¸ä¸€å®šè¦ç‚ºå…¶è³¦å€¼ï¼›out å‚³å€ï¼Œè¢«å‘¼å«çš„æ–¹æ³•ä¸€å®šè¦ç‚ºå…¶è³¦å€¼ï¼Œä»£è¡¨é€™å€‹å¼•æ•¸åœ¨å‚³å…¥å‰è³¦å€¼é€šå¸¸æ˜¯æ²’æ„ç¾©çš„ï¼›in å‚³å€ï¼Œè¢«å‘¼å«çš„æ–¹æ³•ä¸èƒ½ç‚ºå…¶è³¦å€¼ã€‚1234567891011121314void Do(ref string a, out string b, in string c)&#123; // Must to have b = "B"; // Can not assign to "in" parameter. // c = "C";&#125;string s1 = "a";// Bad, assignment here generally doesn't make sense.string s2 = "b";// Need to have value generally.string s3 = "c";Do(ref s1, out s2, in s3); æ›´å¤šåž‹åˆ¥æ”¯æ´ fixed é™³è¿°å¼ (More types support the fixed statement)åœ¨ C# 7.3 ä¹‹å¾Œï¼Œæ‰€æœ‰åŒ…å« GetPinnableReference() æ–¹æ³•ä¸”å›žå‚³ ref T æˆ– ref readonly T çš„åž‹åˆ¥éƒ½èƒ½å¥—ç”¨ fixedã€‚ fixed ç´¢å¼•æ¬„ä½ä¸éœ€è¦é‡˜é¸ (Indexing fixed fields does not require pinning)123456789101112131415161718192021222324252627282930using System;public unsafe struct MyStruct&#123; public fixed int FixedArray[10];&#125;public class Example&#123; public static void Main() &#123; MyStruct myStruct = new MyStruct(); // Before C# 7, pinning required fixed (int* ptr = myStruct.FixedArray) &#123; for (int i = 0; i &lt; 10; i++) &#123; ptr[i] = i; &#125; &#125; // After C# 7, no pinning required for (int i = 0; i &lt; 10; i++) &#123; // Direct indexing is now allowed myStruct.FixedArray[i] = i; &#125; &#125;&#125; stackalloc é™£åˆ—æ”¯æ´åˆå§‹è¨­å®šå¼ (stackalloc arrays support initializers)C# 7.3 ä¹‹å‰ï¼š12345int* arr = stackalloc int[3];arr[0] = 1;arr[1] = 3;arr[2] = 5; C# 7.3 ä¹‹å¾Œï¼š1int* arr = stackalloc int[3] &#123; 1, 3, 5 &#125;; æ“´å……æ³›åž‹é™åˆ¶å¯ä»¥é™åˆ¶ System.Enum æˆ– System.Delegate åšç‚ºæ³›åž‹åž‹åˆ¥çš„é™åˆ¶ï¼›ä¹Ÿå¯ä»¥ç”¨ unmanaged é™åˆ¶ç‚ºä¸å¯ç©ºçš„éžè¨—ç®¡åž‹åˆ¥ã€‚ æœ€æœ‰æ„Ÿçš„æ˜¯ System.Enum ä»¥å‰è¦é™åˆ¶æ³›åž‹åž‹åˆ¥åªèƒ½ç”¨ struct å†åŠ ä¸Šä¸€äº›é©—è­‰ç¨‹å¼ç¢¼ï¼Œæ²’è¾¦æ³•åœ¨ç·¨è­¯æ™‚æœŸç²¾æº–é™åˆ¶åˆ—èˆ‰ç‚ºæ³›åž‹åž‹åˆ¥ã€‚ æ–°çš„ç·¨è­¯é¸é …é€™éƒ¨åˆ†æ²’ç”¨éŽï¼Œå°±ç•™å€‹é€£çµå‚™æŸ¥ã€‚ çµè«–C# 7 å¤šäº†å¾ˆå¤šæ±è¥¿ï¼Œæœ€æ˜Žé¡¯çš„æ˜¯å„ç¨®èªžæ³•ç³–ï¼Œé¢å°èªžæ³•ç³–ï¼Œæ‡‰è©²æ‰¾æ™‚é–“æ›´ä»”ç´°çš„ç ”ç©¶ä»–å€‘ç·¨è­¯å¾Œå¯¦éš›çš„æ¨£å­é¿å…èª¤ç”¨ã€‚ åƒè€ƒWhatâ€™s new in C# 7.0 through C# 7.3 (åŽŸæ–‡ä»¶å·²ç¶“è¢«åˆªé™¤ï¼Œé€™æ˜¯ Archive ç¶²ç«™çš„å­˜æª”)]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¯é‡ç”¨çš„ XML æ–‡ä»¶è¨»è§£]]></title>
    <url>%2Fcontent%2F20240122-reuseable-xml-documentation-comments.html</url>
    <content type="text"><![CDATA[åœ¨é–‹ç™¼ C# å°ˆæ¡ˆæ™‚ï¼Œæˆ‘å€‘ç¶“å¸¸ä½¿ç”¨ XML æ–‡ä»¶è¨»è§£ ä¾†ç‚ºåž‹åˆ¥æˆ–æˆå“¡å¯«èªªæ˜Žï¼Œé€™é¡žåž‹çš„è¨»è§£é™¤äº†å¯ä»¥æé«˜ç¶­è­·æ€§å¤–ï¼Œä¹Ÿå¯ä»¥é€éŽå·¥å…·è‡ªå‹•è½‰åŒ–æˆ API æ–‡ä»¶ã€‚ ä½†æ˜¯è¨»è§£ä¹Ÿæ˜¯éœ€è¦ç¶­è­·çš„ï¼Œåœ¨å¤šè¼‰æ–¹æ³•çš„è¨»è§£ç¶“å¸¸é¢è‡¨ä¸€å€‹å•é¡Œå°±æ˜¯ä¸€ç¾¤å¤šè¼‰æ–¹æ³•é€šå¸¸æœ‰è‘—ç›¸ä¼¼çš„è¨»è§£ï¼Œç¶­è­·æ™‚éœ€è¦ä¸€å€‹ä¸€å€‹ä¿®æ”¹å…¶å¯¦å¾ˆå®¹æ˜“ä½¿å¾—æœ€å¾Œä¸åŒå¤šè¼‰é–“çš„è¨»è§£æœ‰è‘—è¨±å¤šç´°å¾®çš„ä¸ä¸€è‡´ã€‚å¦ä¸€æ–¹é¢é€™æ¨£ä¹Ÿè®“ç¶­è­·è¨»è§£è®Šå¾—æ›´éº»ç…©ç‘£ç¢Žã€‚ XML æ–‡ä»¶è¨»è§£ å®˜æ–¹æ–‡ä»¶å¾ˆè©³ç´°ï¼Œé€™ç¯‡æ–‡ç« ä¸è©³ç´°èªªæ˜Žé€™äº›å…§å®¹ï¼Œè€Œæœƒèšç„¦åœ¨é‡ç”¨è¨»è§£çš„æ–¹å¼ã€‚ &lt;inheritdoc&gt;é¦–å…ˆæ˜¯ &lt;inheritdoc&gt; é€™å€‹æ¨™è¨˜ï¼Œé€™ç®—æ˜¯æ¯”è¼ƒå¸¸ç”¨çš„éƒ¨åˆ†ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š123456789101112131415161718192021public class FluentUriBuilder&#123; /// &lt;summary&gt; /// Create &lt;see cref="FluentUriBuilder"/&gt;. /// &lt;/summary&gt; /// &lt;returns&gt;Created &lt;see cref="FluentUriBuilder"/&gt;.&lt;/returns&gt; public static FluentUriBuilder Create() &#123; return new FluentUriBuilder(); &#125; /// &lt;summary&gt; /// &lt;inheritdoc cref="Create()"/&gt; With passed &lt;paramref name="uri"/&gt;. /// &lt;/summary&gt; /// &lt;param name="uri"&gt;Uri.&lt;/param&gt; /// &lt;returns&gt;Created &lt;see cref="FluentUriBuilder"/&gt;.&lt;/returns&gt; public static FluentUriBuilder Create(Uri uri) &#123; return new FluentUriBuilder(uri); &#125;&#125; é¦–å…ˆå¯ä»¥çœ‹åˆ°ç„¡åƒæ•¸æ–¹æ³• Create() æœ‰ä¸€è¡Œè¨»è§£ Create &lt;see cref=&quot;FluentUriBuilder&quot;/&gt;.ï¼Œå°æ–¼å¦å¤–ä¸€å€‹å¤šè¼‰ä¾†èªªæ‡‰è©²ä¹Ÿè¦å¥—ç”¨ç›¸åŒçš„è¨»è§£ç‚ºåŸºåº•ï¼Œå¯èƒ½æœƒéœ€è¦åŠ ä¸Šé‡å°è©²å¤šè¼‰çš„ç‰¹åˆ¥æè¿°ï¼Œé€™æ™‚å€™å°±å¯ä»¥ç”¨ &lt;inheritdoc cref=&quot;Create()&quot;/&gt; çš„æ–¹å¼ä¾† â€œç¹¼æ‰¿â€ ç„¡åƒæ•¸æ–¹æ³•çš„è¨»è§£ï¼Œä¸¦é™„åŠ é¡å¤–çš„èªªæ˜Žã€‚ ä½†é€™å€‹æ–¹æ³•æœ‰äº›ç¼ºé»žï¼Œé¦–å…ˆï¼Œç•¶å¤šè¼‰æ•¸é‡ä¸€å¤šçš„æ™‚å€™è¨»è§£å…§å®¹å°±æœƒæœ‰å¾ˆå¤šç¹¼æ‰¿èªžå¥ï¼Œå¯è®€æ€§ä¸å¤ªå¥½ï¼›å…¶æ¬¡ï¼Œåœ¨æ±ºå®šè¦ç”¨å“ªå€‹å¤šè¼‰çš„è¨»è§£ç•¶åŸºåº•æ™‚ä¹Ÿå®¹æ˜“æœ‰æ¨™æº–ä¸ä¸€è‡´çš„æƒ…æ³ã€‚é€™å…©å€‹ç¼ºé»žéƒ½æœƒè®“è¨»è§£çš„ç¶­è­·æ‰“äº†ä¸å°‘æŠ˜æ‰£ã€‚ æ•´é«”ä¾†èªªï¼Œå ªç”¨ä½†å¯ç¶­è­·æ€§åå·®ã€‚ &lt;include&gt;åŒæ¨£çš„ç¨‹å¼ç¢¼ç‰‡æ®µï¼Œè®Šæˆä¸‹é¢é€™æ¨£ï¼š12345678910111213141516171819202122public class FluentUriBuilder&#123; /// &lt;summary&gt; /// &lt;include file='Properties/SharedComments.xml' path='SharedComments/Method[@name="FluentUriBuilder.Create"]'/&gt; /// &lt;/summary&gt; /// &lt;returns&gt;Created &lt;see cref="FluentUriBuilder"/&gt;.&lt;/returns&gt; public static FluentUriBuilder Create() &#123; return new FluentUriBuilder(); &#125; /// &lt;summary&gt; /// &lt;include file='Properties/SharedComments.xml' path='SharedComments/Method[@name="FluentUriBuilder.Create"]'/&gt; /// With passed &lt;paramref name="uri"/&gt;. /// &lt;/summary&gt; /// &lt;param name="uri"&gt;Uri.&lt;/param&gt; /// &lt;returns&gt;Created &lt;see cref="FluentUriBuilder"/&gt;.&lt;/returns&gt; public static FluentUriBuilder Create(Uri uri) &#123; return new FluentUriBuilder(uri); &#125;&#125; é€™å€‹åšæ³•ç›´æŽ¥æŠŠå…±ç”¨è¨»è§£æª”ç¨ç«‹å‡ºåŽ»æˆä¸€å€‹ XML æª”æ¡ˆå­˜æ”¾åœ¨ Properties ä¸­ï¼Œå¦‚ä¸‹ï¼š12345&lt;SharedComments&gt; &lt;Method name="FluentUriBuilder.Create"&gt; Create &lt;see cref="FluentUriBuilder"/&gt;. &lt;/Method&gt;&lt;/SharedComments&gt; å„ªé»žåœ¨æ–¼é¿å… &lt;inheritdoc&gt; åœ¨æ–¹æ³•é–“ç›¸äº’ â€œç¹¼æ‰¿â€ æ‰€å¼•ç™¼çš„æ··äº‚ï¼Œä½†ç›¸å°çš„ç¼ºé»žå°±æ˜¯æœƒéœ€è¦é¡å¤–çš„è¨»è§£æª”ï¼Œä¸”ä»¥å¯è®€æ€§å·®ä¾†èªªå’Œ &lt;inheritdoc&gt; ä¸ç›¸ä¸Šä¸‹ã€‚ çµè«–é›–ç„¶ XML æ–‡ä»¶è¨»è§£å¾ˆç°¡å–®ï¼Œä½†å…¶å¯¦ä»–æœ‰å„å¼å„æ¨£çš„æ¨™è¨˜è®“æˆ‘å€‘åœ¨ç¶­è­·ç¨‹å¼éŽçš„éŽç¨‹å°±é †ä¾¿ç¶­è­· API è¨»è§£ï¼Œèƒ½ç‚ºè‡ªå‹•ç”¢ç”Ÿçš„ API æä¾›å¾ˆå¤§çš„å¹«åŠ©æœ€å¤§åŒ–é™ä½Žé¡å¤–ç¶­è­·æ–‡ä»¶çš„æˆæœ¬èˆ‡é¢¨éšªã€‚ è€Œè¨»è§£å› ç‚ºæ²’æœ‰ç·¨è­¯å™¨çš„ä¿è­·æ‰€ä»¥å¯«å£žå¾ˆé›£å¯Ÿè¦ºï¼Œå¦‚æžœèƒ½æ´»ç”¨ XML æ–‡ä»¶è¨»è§£çš„è©±ä¹Ÿèƒ½æ›´å®¹æ˜“çš„ç¶­æŒé«˜å“è³ªçš„è¨»è§£ã€‚ åƒè€ƒXML documentation comments]]></content>
      <categories>
        <category>C#</category>
        <category>NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ EF Core ä¸­è‡ªå®šç¾© ValueConverter]]></title>
    <url>%2Fcontent%2F20231225-efcore-customize-valueconverter.html</url>
    <content type="text"><![CDATA[é—œæ–¼ EF Core ä¸­çš„å€¼è½‰æ› (Value Conversion)ï¼Œå®˜æ–¹æ–‡ä»¶å·²ç¶“å±•ç¤ºçš„éžå¸¸è©³ç´°ï¼Œä½†é€™æ¨£çš„å¯¦ä½œä½¿å¾—å€¼è½‰æ›å’Œ DbContext é«˜åº¦ç›¸ä¾ï¼Œåœ¨ä¸­å°åž‹å°ˆæ¡ˆä¸­é€™æ¨£å·²ç¶“è¶³å¤ ï¼Œä½†åœ¨è¤‡é›œçš„ç”¢å“ç¾¤ä¸­ï¼Œå¦‚æžœéœ€è¦åŸºæ–¼ EF Core å»ºç«‹å…§éƒ¨å…±ç”¨çš„å¥—ä»¶ï¼Œå°±æœƒé›£ä»¥å°‡é€™äº›å®¢è£½åŒ–çš„ ValueConverter å¾žå¥—ä»¶ä¸­æŠ½é›¢ï¼Œä¹Ÿé›£ä»¥è®“æ‡‰ç”¨ç¨‹å¼è‡ªè¡Œæ“´å……è‡ªå·±ç‰¹æ®Šçš„ ValueConverterï¼Œæœ¬æ–‡ä¸»è¦æä¾›å¦å¤–ä¸€å€‹é¢å‘çš„å¯¦ä½œä¾†é”åˆ°æ›´ä½Žçš„è€¦åˆåº¦èˆ‡æ›´é«˜çš„å¯æ“´å……æ€§ã€‚ å‰è¨€é€šå¸¸æˆ‘å€‘ä¸éœ€è¦è‡ªå·±å®¢è£½åŒ– Value Convertersï¼Œä½†å¯¦å‹™ç’°å¢ƒç¸½æ˜¯ä¸æœƒé€™éº¼å–®ç´”ã€‚ ä»¥ä¸€å€‹å¯¦å‹™çš„ä¾‹å­ä¾†èªªï¼ŒèˆŠçš„è³‡æ–™åº«åœ¨å°‡çœŸå‡å€¼æ¬„ä½çš„å€¼å­˜æˆ 1 ä»£è¡¨ falseï¼Œ2 ä»£è¡¨ trueï¼Œç„¶å¾Œåœ¨ç¨‹å¼ä¸­ç”¨ä¸€å€‹åˆ—èˆ‰ TrueFalseEnum ä¾†è¡¨é”æ™‚ï¼Œè€ŒåŒä¸€å€‹è³‡æ–™åº«åˆæœ‰æ­£å¸¸çš„çœŸå‡å€¼æ¬„ä½æ˜¯å­˜æˆ 0 ä»£è¡¨ false è€Œ 1 ä»£è¡¨ trueï¼Œä¸¦åœ¨ç¨‹å¼ä¸­è½‰æˆ boolã€‚ ç•¶æœ‰æ©Ÿæœƒé‡æ•´èˆŠç³»çµ±æ™‚ï¼Œæƒ³è¦çµ±ä¸€é€™ç¨®çœŸå‡å€¼çš„åž‹åˆ¥ä½†åˆå› ç‚ºè¦é¿å…æœªé‡æ•´éƒ¨åˆ†å‡ºéŒ¯è€Œä¸èƒ½ç›´æŽ¥ä¿®æ­£è³‡æ–™åº«çš„è³‡æ–™æ™‚ï¼Œå°±éœ€è¦åœ¨ EF Core è½‰æ›éŽç¨‹ç›´æŽ¥é€éŽä¸åŒçš„ ValueConverter ä¾†è®“é€™å…©ç¨®æƒ…å¢ƒéƒ½èƒ½å’Œ bool äº’ç›¸è½‰æ›ã€‚ æˆ–æ˜¯å¦å¤–ä¸€ç¨®è³‡æ–™åº«è¨­è¨ˆä¸ç•¶çš„æƒ…å¢ƒï¼Œä¾‹å¦‚ä¸€å¼µè¡¨å°‡æ™‚é–“å€é–“æ¬„ä½è¨­è¨ˆæˆæ•¸å­—ä»£è¡¨å°æ™‚ï¼Œå¦å¤–ä¸€å¼µè¡¨çš„æ™‚é–“å€é–“æ¬„ä½å¯èƒ½æ˜¯ä»£è¡¨åˆ†ï¼Œé€™ç¨®ä¸ä¸€è‡´å¾ˆå®¹æ˜“é€ æˆç¨‹å¼ä¸­æ“ä½œçš„å›°é›£ï¼Œç¶­è­·çš„å·¥ç¨‹å¸«å¸¸å¸¸éœ€è¦åˆ†å¿ƒæƒ³ç¾åœ¨é€™å€‹æ•¸å­—ä»£è¡¨çš„æ˜¯æ™‚ã€åˆ†é‚„æ˜¯ç§’ï¼Œä¹Ÿå®¹æ˜“ä¸å°å¿ƒå¼„éŒ¯ç”¢ç”Ÿ bugã€‚ é€™æ™‚å€™ä¸ç®¡æ˜¯æ–°å°ˆæ¡ˆé‚„æ˜¯é‡æ•´èˆŠç³»çµ±ï¼Œéƒ½æœƒé¢è‡¨åˆ°è³‡æ–™åº«æ¬„ä½è®Šæ›´å›°é›£ä½†åˆä¸æƒ³è®“ç¨‹å¼é·å°±è³‡æ–™åº«ä¸ç•¶è¨­è¨ˆçš„å…©é›£ã€‚ é€™æ™‚å€™ä¹Ÿå¾ˆé©åˆç”¨ä¸åŒçš„ Value Converters ä¾†è½‰æ›æ•¸å­—å’Œ TimeSpan ä¹‹é¡žçš„ä¸€è‡´çš„åž‹åˆ¥ï¼Œæå‡ç¨‹å¼ç¢¼çš„å¯ç¶­è­·æ€§ã€‚ æŠ½è±¡ä¾†èªªï¼Œå°±æ˜¯ç•¶è³‡æ–™åº«å’Œç¨‹å¼ä¸­çš„åž‹åˆ¥ç„¡æ³•ç”¨é è¨­æ©Ÿåˆ¶è½‰æ›æ™‚ï¼Œå°±å¯ä»¥è€ƒæ…®å®¢è£½åŒ– Value Converters. å¯¦ä½œå¦å¤–ç¹¼æ‰¿ä¸¦å¯¦ä½œ ValueConverter&lt;&gt;é¦–å…ˆæˆ‘å€‘å¯ä»¥åƒè€ƒ EF Core å…§å»ºçš„å„ç¨® Value Converters ä¾†å¯¦ä½œï¼Œä¾‹å¦‚ï¼šDateTimeToTicksConverter.csã€‚ æä¾›ä¸€å€‹å®¢è£½çš„ Attributeæä¾›ä¸€å€‹ ValueConverterAttributeï¼Œè®“ä½¿ç”¨è€…å¯ä»¥æ”¾åœ¨ Entity Domain Model ä¸­å¦‚ä¸‹ï¼š12345678910[Table("PERSON")]public class Person&#123; [Column("WHATEVER")] public bool Whatever &#123; get; set; &#125; [Column("IS_DELETED")] [ValueConverter(typeof(BooleanToTrueFalse))] public bool IsDeleted &#123; get; set; &#125;&#125; Whatever æ¬„ä½å°±æ˜¯æ­£å¸¸çš„å¸ƒæž—å€¼ (0 å’Œ 1)ï¼Œè€Œ IsDeleted æ¨™è¨˜å¥—ç”¨ BooleanToTrueFalse é€™å€‹ Value Converter ä¾†é©æ‡‰è³‡æ–™åº«ä¸­ä¸ç•¶çš„çœŸå‡å€¼ (1 å’Œ 2)ï¼Œåœ¨ç¨‹å¼ä¸­æˆ‘å€‘å¯ä»¥ä¸€è‡´çš„æ“ä½œ boolï¼Œè€Œè³‡æ–™åº«çš„æ•´ç†å‰‡å¯ä»¥ç­‰ç¨‹å¼æ•´ç†å®Œå¾Œå†å¦å¤–åˆ†æ¡ˆè™•ç†ã€‚ DbContext ä¸­çš„å¯¦ä½œé€™æ˜¯éžå¸¸é‡è¦çš„ä¸€éƒ¨ä»½ï¼Œå¦‚æžœæˆ‘å€‘ç…§å®˜æ–¹æ–‡ä»¶çš„ä½œæ³•ï¼Œæœƒè®“ DbContext å’Œ ValueConverter ç›´æŽ¥ä¸”é«˜åº¦ä¾è³´ï¼Œé€™é‚Šæˆ‘å€‘é€éŽ ValueConverterAttribute ä¾†è§£é™¤ä»–å€‘çš„ä¾è³´ï¼Œç¨‹å¼ç¢¼ç¯„ä¾‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930public class MyDbContext : DbContext&#123; private string _entityAssemblyName; public MyDbContext( DbContextOptions&lt;MyDbContext&gt; options, Setting settings) : base(options) &#123; _entityAssemblyName = settings.EntityAssemblyName; &#125; protected override void OnModelCreating(ModelBuilder modelBuilder) &#123; var entityTypes = Assembly.Load(_entityAssemblyName).GetTypes(); foreach (var type in entityTypes) &#123; var entity = modelBuilder.Entity(type); foreach (var property in type.GetProperties()) &#123; var converterAttribute = property.GetCustomAttribute&lt;ValueConverterAttribute&gt;(); if (converterAttribute != null) &#123; var converter = (ValueConverter)Activator.CreateInstance(converterAttribute.Type); entity.Property(property.Name).HasConversion(converter); &#125; &#125; &#125; &#125;&#125; æˆ‘å€‘å¯ä»¥åœ¨ OnModelCreating ä¸­é€éŽåµæ¸¬ ValueConverterAttribute ä»¥åŠåå°„ä¾†è¨­å®š Value Conversionsã€‚ è¦æ³¨æ„é€™å€‹åªæ˜¯ç”¨ä¾†å±•ç¤ºæ¦‚å¿µï¼Œç´°ç¯€éƒ¨åˆ†é‚„éœ€è¦è¦–æƒ…æ³ä»”ç´°è¨­è¨ˆã€‚ å…¶ä»–æ‡‰ç”¨é€™ç¨®è¨­è¨ˆä¸é™æ–¼æœ¬æ–‡æåˆ°çš„ Value Converters çš„æƒ…å¢ƒï¼Œåªè¦æ˜¯æœƒåœ¨ MyDbContext ä¸­çš„å„æ–¹æ³•ä¸­å’Œå¤–éƒ¨ (ä¾‹å¦‚ Entity Domain Model) ç”¢ç”Ÿç›´æŽ¥ä¾è³´çš„æƒ…å¢ƒï¼Œéƒ½å¯ä»¥ç”¨é€™ç¨®è¨­è¨ˆä¾†è§£è€¦ã€‚ æ³¨æ„äº‹é …ä»¥ä¸‹æ˜¯ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é …ï¼š ç›´æŽ¥æœå°‹çµ„ä»¶ä¾†æ‰¾å‡ºæ¨™æœ‰ç‰¹å®š Attribute çš„æˆå“¡æ˜¯æ•ˆèƒ½å¾ˆå·®çš„åšæ³•ï¼Œåœ¨æœ¬ä¾‹ä¸­å¯ä»¥æŽ¥å—æ˜¯å› ç‚º OnModelCreating åªæœƒåœ¨åˆå§‹åŒ–æ™‚åŸ·è¡Œä¸€æ¬¡ï¼Œæ•´é«”æ•ˆèƒ½å½±éŸ¿ä¸å¤§ï¼ŒåŠ ä¸Šæˆ‘é‡åˆ°çš„æ˜¯éžå¸¸é‡è¦–è§£è€¦èˆ‡å½ˆæ€§çš„æƒ…å¢ƒï¼Œæ‰€ä»¥æ˜¯åˆ©å¤§æ–¼å¼Šçš„ã€‚ é€™ç¨®è¨­è¨ˆä¸é©ç”¨æ–¼ç„¡è·¨å°ˆæ¡ˆå…±ç”¨éœ€æ±‚çš„ DbContextã€‚ çµè«–åŸºç¤Žç”¨æ³•å…¶å¯¦å®˜æ–¹æ–‡ä»¶éƒ½æœ‰ï¼Œä½†æ˜¯å¯¦å‹™ä¸Šå¾€å¾€æ¯”æ–‡ä»¶ä¸Šçš„ç¯„ä¾‹è¤‡é›œï¼Œé€™æ™‚å€™å°±éœ€è¦è®Šé€šä¸¦è©¦è‘—æ‰¾å‡ºå…¶ä»–æ›´é©åˆçš„è§£æ±ºæ–¹æ¡ˆï¼Œä½†ä¹Ÿè¦äº†è§£åˆ°ä¸åŒçš„æ©Ÿåˆ¶å„æœ‰ä¸åŒçš„ç¼ºé»žï¼Œéœ€è¦è¬¹æ…Žè©•ä¼°ã€‚ åƒè€ƒValue Conversions ValueConversion on GitHub]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ Switch-Case ä¸­ä½¿ç”¨é‡åå€åŸŸè®Šæ•¸èˆ‡å»¶ä¼¸æŽ¢è¨Ž]]></title>
    <url>%2Fcontent%2F20231217-switch-case-variable-scoping.html</url>
    <content type="text"><![CDATA[å•é¡Œèµ·å§‹æ–¼ä¸€å€‹æƒ…å¢ƒå¦‚ä¸‹ï¼š1234567891011121314switch (cryptoType)&#123; case CryptoType.AesEncrypt: var key = ""; var iv = ""; break; case CryptoType.AesDecrypt: var key = ""; var iv = ""; break; // Others default: break;&#125; é€™æ™‚å€™å› ç‚º case ä¹‹é–“çš„å€åŸŸè®Šæ•¸åå­—é‡è¤‡äº†æ‰€ä»¥ç·¨è­¯ä¸æœƒé€šéŽã€‚ ç¾å¯¦æƒ…å¢ƒæ›´è¤‡é›œï¼ŒCryptoType å¯èƒ½æœ‰å¹¾åå€‹ã€‚ é€™é‚Šè¦å…ˆè²æ˜Žï¼Œç†è«–ä¸Šé€™ç¨®å¤§é‡çš„ switch-case æœ‰å¾ˆå¤šè¨­è¨ˆå¯ä»¥ç®¡ç†å®ƒï¼Œä½†å¯¦å‹™ä¸Šæ˜¯ä¸€å€‹è€èˆŠåˆç¼ºä¹æž¶æ§‹çš„å°ˆæ¡ˆï¼Œç”šè‡³äº‚åˆ°é‡æ§‹å¾Œçš„æª”æ¡ˆæ”¾å“ªéƒ½åªæœƒæ›´äº‚çš„ç¨‹åº¦ï¼Œè€Œå¦‚æžœåªæ˜¯æŠ½å‡ºæ–¹æ³•ï¼Œé‚£ä¸€äº›ç°¡å–®çš„æƒ…å¢ƒå°±æœƒå› æ­¤è¢«æŠ½å‡ºå¤§é‡å°åž‹æ–¹æ³•ï¼Œä¸”éƒ½æ”¾åœ¨åŒä¸€å€‹é¡žåˆ¥ä¸­ä¹Ÿä¸æœƒæ¯”è¼ƒå¥½ã€‚ ç¸½ä¹‹ï¼Œé€™å€‹ä¾‹å­åªæ˜¯æ‹¿ä¾†èªªæ˜Žå€åŸŸè®Šæ•¸èˆ‡å…¶ä½œç”¨åŸŸå’Œç”Ÿå‘½é€±æœŸï¼Œä¸è¡¨ç¤ºä¾‹å­ä¸­çš„è¨­è¨ˆæ˜¯æ°ç•¶çš„ã€‚ ä½¿ç”¨å€å¡Šé™å®šä½œç”¨åŸŸåœ¨ cases ä¸­å»ºç«‹åˆ©ç”¨å€å¡Š {} å»ºç«‹ç¨ç«‹çš„ä½œç”¨åŸŸï¼š 123456789101112131415161718switch (cryptoType)&#123; case CryptoType.AesEncrypt: &#123; var key = ""; var iv = ""; &#125; break; case CryptoType.AesDecrypt: &#123; var key = ""; var iv = ""; &#125; break; // Others default: break;&#125; å€å¡Š (Block) èˆ‡å€åŸŸè®Šæ•¸ç”Ÿå‘½é€±æœŸåœ¨ C# ä¸­ï¼Œå€å¡Š {} ä¸åƒ…æ˜¯ ifã€for ç­‰æŽ§åˆ¶æµèªžå¥çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ä½œç”¨åŸŸçš„ç•Œå®šè€…ã€‚åœ¨ä¸€å€‹å€å¡Šå…§å®šç¾©çš„å€åŸŸè®Šæ•¸ï¼Œå…¶ä½œç”¨åŸŸé™å®šåœ¨è©²å€å¡Šå…§ã€‚é€™æ„å‘³è‘—åŒä¸€è®Šæ•¸åå¯ä»¥åœ¨ä¸åŒå€å¡Šä¸­ç¨ç«‹ä½¿ç”¨ï¼Œä¸æœƒç›¸äº’å½±éŸ¿ã€‚ å¦å¤–å¦‚æžœæœ‰å¿…è¦çš„æ™‚å€™ï¼Œä½¿ç”¨å€å¡Šä¾†é™å®šè®Šæ•¸çš„ä½œç”¨åŸŸï¼Œä¸åƒ…æœ‰åŠ©æ–¼è§£æ±ºå‘½åè¡çªï¼Œé‚„å¯ä»¥è®“å€åŸŸè®Šæ•¸å› ç‚ºçµæŸå€å¡Šè€Œé‡‹æ”¾ã€‚ ä½†æ˜¯é€™æ¨£åšæœƒçŠ§ç‰²å¾ˆå¤§çš„å¯è®€æ€§èˆ‡å¯ç¶­è­·æ€§åŽ»å¾—åˆ°å¾®ä¹Žå…¶å¾®çš„æ•ˆç›Šï¼Œåªèƒ½èªª â€œç†è«–ä¸Šå¯ä»¥é€™æ¨£åšâ€ã€‚ å¦å¤–ï¼ŒåŸºæ–¼å¥½å¥‡ç¨å¾®åŽ»çœ‹äº† C# çš„èªžè¨€è¦æ ¼æ›¸æ€Žéº¼æè¿°é€™ç¨®åŸºç¤Žåˆ°ä¸çŸ¥é“æ€Žéº¼æè¿°çš„èªžæ³•ï¼Œæ‰ç™¼ç¾å…¶å¯¦é€™äº›çœ‹ä¼¼åŸºç¤Žçš„æ±è¥¿ï¼Œç´°ç¯€é‚„çœŸçš„ä¸å°‘ï¼Œä¾‹å¦‚ï¼š å€åŸŸè®Šæ•¸ã€å€å¡Šã€‚ çµè«–å…¶å¯¦å–®ç¨ç”¨å€å¡ŠæŽ§åˆ¶å€åŸŸè®Šæ•¸çš„ç”Ÿå‘½é€±æœŸå°±æ˜¯ä¸€å¥è©±çš„äº‹ï¼Œå¯¦åœ¨å¾ˆçŒ¶è±«è¦ä¸è¦å¯«æˆä¸€ç¯‡ã€‚ ä½†å¯¦å‹™ä¸Šå¯èƒ½é‚„æ˜¯æœƒé‡åˆ°è¦ç¶­è­·è‚¥å¤§çš„ switch-case åˆç„¡æ³•æ”¹è¨­è¨ˆçš„æƒ…å¢ƒï¼Œå°Žè‡´è®Šæ•¸åç¨±å¸¸å¸¸é‡è¤‡ï¼Œå¦‚æžœä¸ç”¨å€å¡Šåˆ†éš”é–‹å°±æœƒå‡ºç¾ç‚ºäº†é¿å…å€åŸŸè®Šæ•¸é‡åè€Œç”¢ç”Ÿå†—é•·é›£é–±è®€çš„è®Šæ•¸ï¼Œä¹Ÿæœƒè®“è®Šæ•¸å‘½åæ™‚é‚„è¦åŽ»è€ƒæ…®ç¾å­˜çš„ case ä¸­æœƒä¸æœƒå‡ºç¾ç›¸åŒçš„åå­—é€ æˆç´°å¾®å»å¸¸æ…‹å‡ºç¾çš„å¹²æ“¾ã€‚ æƒ³æƒ³é‚„æ˜¯å¯«ä¸€ç¯‡ç´€éŒ„ä¸€ä¸‹å¥½äº†ã€‚ åƒè€ƒC# standard specification]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è¨­è¨ˆ WebAPI é€šç”¨å›žå‚³æ¨¡æ¿]]></title>
    <url>%2Fcontent%2F20231216-consistent-webapi-returns.html</url>
    <content type="text"><![CDATA[åœ¨æˆ‘ä»¥å¾€çš„å·¥ä½œç¶“é©—ä¸­ï¼Œè™•ç†éŽä¸å°‘ WebAPI çš„ç¶­è­·å·¥ä½œï¼Œæ™®éé¢è‡¨çš„ä¸€å€‹å•é¡Œæ˜¯å›žå‚³è³‡æ–™çš„ä¸ä¸€è‡´æ€§ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œå¸¸è¦‹çš„å¹¾ç¨®å›žå‚³æ ¼å¼åŒ…æ‹¬ï¼š ç´”å€¼ï¼š trueã€100 ç­‰ï¼Œæœƒå‡ºç¾åœ¨å›žå‚³å–®ä¸€å€¼çš„ API ä¸­ã€‚ ç‰©ä»¶ï¼š {&quot;name&quot;: &quot;Ron&quot;, &quot;gender&quot;: &quot;Male&quot;}ï¼Œæœƒå‡ºç¾åœ¨å›žå‚³ç‰©ä»¶çš„ API ä¸­ã€‚ ç‰©ä»¶å«ç‹€æ…‹ï¼š {&quot;status&quot;: &quot;1001&quot;, &quot;name&quot;: &quot;Ron&quot;, &quot;gender&quot;: &quot;Male&quot;}ï¼Œæœƒå‡ºç¾åœ¨å‘¼å«ç«¯éœ€è¦çŸ¥é“æ›´å¤šç‹€æ…‹ç´°ç¯€æ™‚ã€‚ å…¶ä»–è®Šç¨®ï¼šé™¤äº†è³‡æ–™å¤–é‚„æœ‰å„ç¨®ç‹€æ…‹ã€éŒ¯èª¤ã€è¨Šæ¯ç­‰æ¬„ä½ï¼Œä½†æ ¼å¼èˆ‡åç¨±ä¸çµ±ä¸€ã€‚ é€™å€‹ç¾è±¡é€ æˆçš„å•é¡Œå°±æ˜¯æ˜Žæ˜Žæ˜¯åŒä¸€å€‹ç«™å°å°å¤–æä¾›æœå‹™ï¼Œå›žå‚³çš„ç‹€æ…‹è¨Šæ¯å»æ¯å€‹ API éƒ½ä¸ä¸€æ¨£ï¼Œä¸åƒ…å°ä½¿ç”¨è€…ä¸å‹å–„ï¼Œä¹Ÿæœƒè®“æŽ¥æ‰‹ç¶­è­·çš„äººç„¡æ‰€é©å¾žã€‚ æœ¬ç¯‡æ–‡ç« æœƒä»‹ç´¹ä¸¦åˆ†æžçš„å¹¾ç¨®è§£æ±ºæ–¹æ¡ˆï¼Œæ‰€æœ‰æ–¹æ¡ˆéƒ½æœ‰é«˜ä¸€è‡´æ€§èˆ‡é—œæ³¨é»žåˆ†é›¢çš„å…±åŒå„ªé»žï¼Œä½†ä¹Ÿæœ‰äº›ä¸åŒçš„ç¼ºé»žã€‚ ç”¨ Header è¡¨ç¤ºç‹€æ…‹é€™æ˜¯å€‹å¾ˆå¸¸è¦‹çš„åšæ³•ï¼Œç”¨ Header è¡¨ç¤ºç‹€æ…‹ï¼Œè€Œå›žå‚³çš„ Body ä¸­å‰‡åªåŒ…å«è³‡æ–™æœ¬èº«ã€‚ å„ªé»ž æŠŠç‹€æ…‹å’Œè³‡æ–™å¾¹åº•å€åˆ†é–‹ï¼Œå…·æœ‰é«˜åº¦å½ˆæ€§å’Œç›¸å®¹æ€§ï¼Œå°¤å…¶é©åˆæ–¼éœ€è¦å›žå‚³éžå­—ä¸²é¡žåž‹è³‡æ–™ (å¦‚ä¸²æµã€multipart/form-data) çš„æƒ…å¢ƒã€‚ ç¼ºé»ž ç®¡ç†ä¸ä¾¿ éœ€è¦è¼ƒå¤šæ–‡ä»¶è¼”åŠ©ã€‚ éœ€è¦é©ç•¶è¨­è¨ˆä¾†é›†ä¸­ä¾†æ”¶ç´å„ç¨® Header çš„å¸¸æ•¸ï¼Œé¿å…åˆ°è™•æ•£è½çš„ Magic Stringã€‚ è¼ƒä¸ç›´è¦ºï¼Œé–‹ç™¼è€…å’Œä½¿ç”¨è€…éƒ½éœ€è¦èªçŸ¥åˆ° Header ä¸­æœ‰åŒ…å«ç‹€æ…‹è¨Šæ¯ã€‚ ç”¨åŸºåº•é¡žåˆ¥æ”¶ç´ç‹€æ…‹ç›¸é—œæ¬„ä½123456789101112public class ResponseModelBase&#123; public string Status &#123; get; set; &#125; public string Message &#123; get; set; &#125;&#125;public class Person : ResponseModelBase&#123; public string Name &#123; get; set; &#125; public Gender Gender &#123; get; set; &#125;&#125; å¦‚ä¸Šé¢ç¯„ä¾‹ï¼Œä½¿ç”¨ ResponseModelBase åšç‚ºåŸºåº•é¡žåˆ¥ä¾†æ”¶ç´ç‹€æ…‹é¡žçš„è³‡è¨Šï¼Œä»–æœƒè¢«æ‰€æœ‰ API çš„å›žå‚³é¡žåˆ¥ç¹¼æ‰¿ï¼Œä»–èˆ‡ä½¿ç”¨ Header çš„è§£æ±ºæ–¹æ¡ˆæœ‰è‘—ç›¸ä¼¼çš„å„ªé»žä¸¦è§£æ±ºäº†ä¸€äº› Header çš„ç¼ºé»žï¼Œä½†ä¹Ÿç”¢ç”Ÿä¸åŒé¢ç›¸çš„ç¼ºé»žã€‚ å„ªé»ž ç®¡ç†ç¨å¾®å®¹æ˜“ï¼Œåªéœ€è¦æåˆ°ç¹¼æ‰¿ ResponseModelBase å³å¯ã€‚ ç›´è¦ºï¼Œç‹€æ…‹å°±åœ¨ Body ä¸­ã€‚ ç¼ºé»ž åªæ”¯æ´å›žå‚³å­—ä¸²çš„æƒ…å¢ƒã€‚ å¦‚æžœè¡ç”Ÿé¡žåˆ¥ (å¦‚ Person) èˆ‡åŸºåº•é¡žåˆ¥ (å¦‚ ResponseModelBase) æœ‰åŒåæ¬„ä½ï¼Œæœƒé€ æˆå‘½åä¸Šçš„å›°æ“¾ã€ç¼ºé™·æˆ–æ··æ·†ã€‚ ç”±æ–¼ç„¡æ³•é æ¸¬æœªä¾†çš„è¦æ ¼è®ŠåŒ–ï¼Œé€™ç¨®é¢¨éšªé›£ä»¥é¿å…ã€‚ (åŸºåº•é¡žåˆ¥çš„æ¬„ä½ç”¨å¾ˆç‰¹æ®Šçš„å‘½åä¸ç®—å€‹è§£æ³•)ã€‚ ç¹¼æ‰¿é€šç”¨æ³›åž‹é¡žåˆ¥1234567891011121314public class ResponseModel&lt;T&gt;&#123; public string Status &#123; get; set; &#125; public string Message &#123; get; set; &#125; public T Data &#123; get; set; &#125;&#125;public class Person&#123; public string Name &#123; get; set; &#125; public Gender Gender &#123; get; set; &#125;&#125; å¦‚ä¸Šç¯„ä¾‹ï¼Œå€Ÿç”¨ä»¥åŒ…å«å–ä»£ç¹¼æ‰¿çš„æ¦‚å¿µï¼Œè¨­è¨ˆæ³›åž‹é¡žåˆ¥å–ä»£åŸºåº•é¡žåˆ¥ï¼Œè€Œ API å›žå‚³çš„åž‹åˆ¥å‰‡æœƒè®Šæˆ ResponseModel&lt;Person&gt;ã€‚ å„ªé»ž ç®¡ç†ç¨å¾®å®¹æ˜“ï¼Œåªéœ€è¦æåˆ° ResponseModel&lt;T&gt; å³å¯ã€‚ ç›´è¦ºï¼Œç‹€æ…‹å°±åœ¨ Body ä¸­ã€‚ åŸºç¤Žé¡žåˆ¥ (å¦‚ Person) ä¸ç”¨æ“”å¿ƒå’Œ ResponseModel&lt;T&gt; ä¸­çš„æ¬„ä½åŒåã€‚ ç¼ºé»ž åªæ”¯æ´å›žå‚³å­—ä¸²çš„æƒ…å¢ƒã€‚ æ¯”èµ·ç¹¼æ‰¿ï¼Œæ³›åž‹åž‹åˆ¥åœ¨ä½¿ç”¨æ™‚çš„ç¨‹å¼ç¢¼æ¯”è¼ƒå†—é•·ã€‚ çµè«–é€™å¹¾ç¨®æ–¹æ¡ˆå„æœ‰åˆ©å¼Šï¼Œä½†è‡³å°‘éƒ½èƒ½è§£æ±ºæ–‡ç« é–‹é ­æåˆ°çš„ä¸€è‡´æ€§ã€ç¶­è­·æ€§å’Œä½¿ç”¨è€…å‹å¥½åº¦çš„å•é¡Œã€‚ç¸½çµå»ºè­°å¦‚ä¸‹ï¼š ç•¶é æœŸæœƒå›žå‚³éžå­—ä¸²åž‹æ…‹çš„ Body æ™‚ï¼Œé¸æ“‡ Header è§£æ±ºæ–¹æ¡ˆï¼Œä½†éœ€è¦æ³¨æ„ç®¡ç†çš„è¤‡é›œæ€§ã€‚ ç•¶é æœŸåªæœƒå›žå‚³å­—ä¸² Body æ™‚ï¼Œé¸æ“‡æ³›åž‹è§£æ±ºæ–¹æ¡ˆã€‚ ä¸è¦é¸æ“‡ç¹¼æ‰¿é€šç”¨é¡žåˆ¥çš„è§£æ³•ï¼Œæåˆ°ä»–åªæ˜¯è¦è¨˜éŒ„ä»–å’Œæ³›åž‹åž‹åˆ¥è¨­è¨ˆä¸Šçš„å·®ç•°ã€‚ åƒè€ƒé–‹ç™¼ç¶“é©—ã€‚]]></content>
      <categories>
        <category>C#</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å®¢è£½ .NET ç¨‹å¼ç¢¼åˆ†æžèˆ‡è‡ªå‹•ä¿®æ­£]]></title>
    <url>%2Fcontent%2F20230812-write-roslyn-analyzer-and-code-fix.html</url>
    <content type="text"><![CDATA[.NET ç·¨è­¯å™¨å¹³å° (Roslyn) åˆ†æžå™¨ æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç¨‹å¼ç¢¼åˆ†æžè¦å‰‡è®“æˆ‘å€‘æ›´å®¹æ˜“ç¶­æŒè‰¯å¥½çš„ç¨‹å¼ç¢¼å“è³ªï¼Œä½†æœ‰æ™‚å€™æˆ‘å€‘æœƒéœ€è¦è‡ªå·±å®šç¾©ä¸€äº›è¦å‰‡ä¾†ç¬¦åˆå°ˆæ¡ˆé–‹ç™¼è¦ç¯„ã€‚å®˜æ–¹ä»¥åŠå…¶ä»–ç¶²è·¯æ–‡ç« å…¶å¯¦å·²ç¶“æä¾›äº†ä¸å°‘è³‡è¨Šï¼Œä½†å› ç‚ºæ­¥é©Ÿå’Œèªªæ˜ŽçœŸçš„å¾ˆå¤šï¼Œäº†è§£èµ·ä¾†å¤ªèŠ±æ™‚é–“ï¼Œæ–¼æ˜¯æƒ³è‡ªå·±ä¾†æ•´ç†ä¸€ä¸‹è®“éœ€è¦çš„äººå¯ä»¥å¿«é€Ÿèµ°å®Œæ‰€æœ‰æ­¥é©Ÿã€‚ ç”¨ Visual Studio æ¨£æ¿å»ºç«‹å°ˆæ¡ˆ æ‰“é–‹ Visual Studio (é€™é‚Šç”¨ 2022 ç‰ˆä¾†ç¤ºç¯„)ã€‚ File &gt; New &gt; Projectï¼Œé¸æ“‡ Analyzer with code fix (.NET Standard) å¦‚ä¸‹åœ–ï¼š æ‰¾ä¸åˆ°çš„è©±å°±æ˜¯æ²’å®‰è£ç›¸é—œå…ƒä»¶ï¼Œåƒè€ƒå®˜æ–¹èªªæ˜Žä¾†å®‰è£ã€‚ ä¸‹ä¸€æ­¥ç¹¼çºŒè¨­å®šåç¨±è·¯å¾‘ç­‰ï¼Œé€™é‚Šè¦æ³¨æ„çš„æ˜¯ Framework é¸å–®æ²’æœ‰æ„ç¾©ï¼Œä¸ç®¡é¸å“ªä¸€å€‹å»ºç«‹çš„æ–¹æ¡ˆéƒ½æ˜¯ä¸€æ¨£çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸ç”¨è²»å¿ƒæŒ‘é¸ã€‚ å»ºç«‹å®Œæˆå¦‚ä¸‹åœ–ï¼Œæœƒå¾—åˆ°å››å€‹å°ˆæ¡ˆï¼Œè©³æƒ…åƒè€ƒå®˜æ–¹ä»‹ç´¹ã€‚ å»ºç«‹è¦å‰‡ä¸¦ç™¼ä½ˆé–‹ç™¼èˆ‡æ¸¬è©¦å¾žå‰›å‰›å»ºç«‹çš„æ–¹æ¡ˆæ‰€æä¾›çš„ç¯„æœ¬ç‚ºèµ·é»žã€‚ MyRoslynAnalyzer å°ˆæ¡ˆä¸­å¯«çš„æ˜¯ä¸»è¦çš„ç¨‹å¼ç¢¼åˆ†æžè¦å‰‡ã€‚ MyRoslynAnalyzer.Test å°ˆæ¡ˆä¸­å¯«çš„æ˜¯æ¸¬è©¦ã€‚ MyRoslynAnalyzer.Package æä¾›ä¸€äº›è£½ä½œ NuGet Package æ™‚å€™æ‰€éœ€è¦çš„è¨­å®šèˆ‡å·¥å…·ã€‚ é è¨­å°±å¯ä»¥ç”¨ä¸éœ€è¦æ”¹ã€‚ MyRoslynAnalyzer.Vsix è¨­å®šç‚ºèµ·å§‹å°ˆæ¡ˆå•Ÿå‹•å¾Œæœƒå¦å¤–é–‹ä¸€å€‹ Visual Studio ä¾†å¥—ç”¨å‰é¢å¯«çš„è¦å‰‡ã€‚ æˆ‘æœƒåˆªæŽ‰é€™å€‹å°ˆæ¡ˆã€‚ä»–ä¹Ÿæ˜¯é è¨­å°±å¯ä»¥ç”¨ï¼Œä½†æœƒå¤šé–‹ä¸€å€‹ Visual Studioï¼Œé€™æ¨£äº¤éŒ¯æ“ä½œå°æˆ‘ä¾†èªªå®¹æ˜“æžæ··ï¼Œä¸å¦‚å–®å…ƒæ¸¬è©¦å®Œç›´æŽ¥æŠŠ NuGet Package æ”¾åœ¨è‡ªå·±æœ¬æ©Ÿç„¶å¾Œç”¨å›ºå®šçš„å°ˆæ¡ˆæ¸¬è©¦ã€‚ä½†æ˜¯é€™å€‹åšæ³•æ˜¯å› ç‚ºæˆ‘å·²ç¶“å»ºå¥½æœ¬æ©Ÿ NuGet å„²å­˜åº«äº†ï¼Œå»ºç«‹æœ¬æ©Ÿ NuGet å„²å­˜åº«çš„æ–¹æ³•ä¹‹å‰æœ‰å¯«éŽä¸€ç¯‡ åœ¨æœ¬æ©Ÿä¸Šå»ºç«‹ NuGet å„²å­˜åº«ã€‚ é–‹ç™¼å»ºè­° Hello World å¾ž å®˜æ–¹æä¾›çš„ç¯„ä¾‹å°ˆæ¡ˆ é–‹å§‹çœ‹ã€‚ ç¶œåˆåƒè€ƒ StyleCopAnalyzers å’Œ roslyn-analyzers ä¾†é€²ä¸€æ­¥å­¸ç¿’ã€‚ è³‡æ–™å¤¾çµæ§‹èˆ‡å‘½åç­‰åƒè€ƒ StyleCopAnalyzersã€‚é€™æ˜¯å› ç‚ºä»–ç”¨ç·¨è™Ÿå‘½åï¼Œè³‡æ–™å¤¾çµæ§‹ç”¨è¦å‰‡åˆ†é¡žä¾†åšï¼Œæ•´é«”å°ˆæ¡ˆä¹Ÿæ¯”è¼ƒå–®ç´”ï¼Œé€™å°ç¶­è­·ä¾†èªªå¾ˆæ–¹ä¾¿ã€‚ å¯¦ä½œç´°ç¯€åƒè€ƒ roslyn-analyzersã€‚é€™æ˜¯å› ç‚º StyleCopAnalyzers ç•¢ç«Ÿæ˜¯å¦å¤–ä¸€å¥—å·¥å…·ï¼Œä»–æœ‰ä¸€äº›è‡ªå®šç¾©çš„å…§å®¹ï¼Œç›¸è¼ƒä¹‹ä¸‹åƒè€ƒ roslyn-analyzers çš„å¯¦ä½œèƒ½æœ€å¤§é™åº¦çš„åˆ©ç”¨å…§å»ºçš„ç‰©ä»¶é¿å…è‡ªé€ è¼ªå­æˆ–é¡å¤–ä¾è³´å¦ä¸€å€‹å¥—ä»¶çš„ç‰©ä»¶å¢žåŠ æ²’å¿…è¦çš„è¤‡é›œåº¦ã€‚ä½†æ˜¯ StyleCopAnalyzers çš„è³‡æ–™å¤¾è¤‡é›œï¼Œè¦æ‰¾åˆ°å¯ä»¥åƒè€ƒçš„è¦å‰‡é‚„çœŸä¸å¤ªå¥½æ‰¾ï¼Œä½†å› ç‚ºæ‰€æœ‰è¦å‰‡éƒ½æœƒç¹¼æ‰¿ DiagnosticAnalyzer é¡žåˆ¥ä¸¦åŠ ä¸Š DiagnosticAnalyzerAttributeï¼Œä»¥é€™å€‹ç‚ºé€²å…¥é»žå°±æœƒå¥½æ‰¾å¾ˆå¤šã€‚ å¾žæœ€ç°¡å–®çš„å‘½åè¦å‰‡é–‹å§‹ï¼Œæœƒæ¯”è¼ƒå®¹æ˜“å»ºç«‹ä¿¡å¿ƒã€‚ å–„ç”¨ ChatGPT æˆ– GitHub Copilot è¼”åŠ©ã€‚AI åœ¨é€™é¡žå¾ˆå¸¸è¦‹çš„æƒ…å¢ƒä¸Šè¡¨ç¾å¾—å¾ˆå¥½ï¼Œæˆ‘è‡ªå·±å°±åªç”¨ AI åŠ é è¨­ç¯„ä¾‹å°±å¯¦ä½œå‡ºä¸€äº›ç°¡å–®çš„è¦å‰‡äº†ã€‚ ç™¼ä½ˆç™¼ä½ˆçš„è©±å°±æ˜¯ç›´æŽ¥ç·¨è­¯ MyRoslynAnalyzer.Package ä¸¦ç”¨ Visual Studio å…§å»ºçš„åŠŸèƒ½ä¾†è£½ä½œ nupkg æª”å°±å¥½ï¼Œå¾ˆæ–¹ä¾¿ã€‚ çµè«–å…¶å¯¦å…¥é–€ä¸é›£ï¼Œä½†æ˜¯å°±æ˜¯å®˜æ–¹æ–‡ä»¶éžå¸¸é•·æ‰€ä»¥è¦çœ‹å¾ˆä¹…ã€‚ åƒè€ƒOverview of source code analysis How to write a Roslyn Analyzer Roslyn Analyzer Part 1 - 5 roslyn-analyzers StyleCopAnalyzers]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ¨‚è§€éŽ–èˆ‡æ‚²è§€éŽ–çš„é¸æ“‡]]></title>
    <url>%2Fcontent%2F20230721-optimistic-vs-pessimistic-lock.html</url>
    <content type="text"><![CDATA[åœ¨è³‡æ–™åº«æ“ä½œæ™‚ï¼Œé¢å°å¤šå€‹æ“ä½œçš„ä¸¦è¡Œæ“ä½œï¼Œç‚ºäº†é¿å…è³‡æ–™ä¸ä¸€è‡´å’Œè¡çªæˆ‘å€‘ä¸»è¦æœ‰å…©ç¨®æ–¹æ³•å¯ä»¥é”æˆé€™å€‹ç›®æ¨™ï¼šæ¨‚è§€éŽ– (Optimistic Lock) å’Œæ‚²è§€éŽ– (Pessimistic Lock)ã€‚ä½†æˆ‘å€‘æ‡‰è©²å¦‚ä½•é¸æ“‡é©åˆçš„æ–¹æ³•å‘¢ï¼Ÿ æ¨‚è§€éŽ–å’Œæ‚²è§€éŽ–çš„å¯¦ä½œç¶²è·¯è³‡æºå¤ªå¤šäº†ï¼Œé€™ç¯‡ä¸æœƒç‰¹åˆ¥æã€‚ æ¨‚è§€éŽ–åˆ†æžå€‹äººç¶“é©—ä¾†èªªï¼Œæœƒç”¨ä¸€å€‹ Version æ¬„ä½ä¾†è¨˜éŒ„ç‰ˆæœ¬ï¼Œåœ¨å¯«å…¥è³‡æ–™æ™‚å†åˆ¤æ–·ç‰ˆæœ¬æ˜¯å¦å› ç‚ºè¢«å…¶ä»–æ“ä½œæ›´æ–°éŽï¼Œä»¥æ­¤ç‚ºä¾æ“šä¾†é¿å…äº’ç›¸è¦†è“‹ã€‚ ç‰¹æ€§ ç”±æ‡‰ç”¨ç¨‹å¼æŽ§åˆ¶è€Œä¸æ˜¯è³‡æ–™åº«ä¸­çœŸå¯¦çš„éŽ–ã€‚ è¡çªæ™‚æ¯”è¼ƒæ™šæ›´æ–°çš„é‚£å€‹æ“ä½œæœƒè¢«å–æ¶ˆï¼Œæ‡‰ç”¨ç¨‹å¼ä¸­å¯èƒ½æœƒæ‹‹å‡ºä¾‹å¤–ã€‚ å„ªé»ž Entity Framework Core å’Œ NHibernate ç­‰ ORM æœ‰æ”¯æ´æ¨‚è§€éŽ–ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ ç¼ºé»ž è¡çªæ™‚æ¯”è¼ƒæ™šæ›´æ–°çš„é‚£å€‹æ“ä½œå¦‚æžœä¸€å®šè¦æ›´æ–°å°±éœ€è¦æœ‰é‡è©¦æ©Ÿåˆ¶ï¼Œç•¶è¡çªçŽ‡é«˜æ™‚é‡è©¦é–‹éŠ·æœƒå¾ˆé«˜ã€‚ æ“ä½œå–æ¶ˆä¸¦é‡è©¦çš„æ©Ÿåˆ¶åœ¨æ•ˆèƒ½ä¸Šå¿…ç„¶è¼ƒå·®ï¼Œé‡è©¦æ©Ÿåˆ¶è¦å…¼é¡§è³‡æ–™æ­£ç¢ºæ€§æ™‚è¼ƒè¤‡é›œã€‚ é©ç”¨æƒ…å¢ƒ è¡çªæ™‚åªéœ€è¦èªåˆ—ç¬¬ä¸€å€‹æ“ä½œæ™‚ã€‚ è¡çªæ™‚éœ€è¦èªåˆ—å¾Œé¢çš„æ“ä½œï¼Œä½†æ˜¯ä¸èƒ½ç›´æŽ¥å¯«å…¥è€Œéœ€è¦é‡æ–°åŸ·è¡Œä¸€äº›å•†å‹™é‚è¼¯å†æ›´æ–°æ‰æ­£ç¢ºæ™‚ã€‚ æ‚²è§€éŽ–åˆ†æžæ‚²è§€éŽ–åˆç¨±è¡ŒéŽ– (Row Lock)ï¼Œä¸€é–‹å§‹æ“ä½œæ™‚å°±å…ˆæŠŠè©²ç­†è³‡æ–™éŽ–å®šï¼Œé˜²æ­¢å…¶ä»–æ“ä½œä¿®æ”¹è©²è³‡æ–™ï¼Œè§£éŽ–å¾Œå…¶ä»–æ“ä½œæœƒç¹¼çºŒåŸ·è¡Œï¼Œå®ƒå¯ä»¥é é˜²è¡çªï¼Œè€Œä¸æ˜¯åœ¨äº‹å¾Œè§£æ±ºè¡çªã€‚ ç‰¹æ€§ ç”±è³‡æ–™åº«æä¾›çš„è¡ŒéŽ–ã€‚ è¡çªæ™‚æ‰€æœ‰æ“ä½œæœƒæŽ’éšŠåœ¨è§£éŽ–å¾Œä¾åºåŸ·è¡Œã€‚ å„ªé»ž é¿å…äº‹å¾Œè™•ç†è¡çªçš„é–‹éŠ·ã€‚ ç¼ºé»ž Entity Framework Core å’Œ NHibernate ç­‰ ORM ä¸ç›´æŽ¥æ”¯æ´ï¼Œå¦‚æžœè¦ä½¿ç”¨æœƒéœ€è¦ç”¨ç´” SQL ä¸‹æŒ‡ä»¤ï¼Œä»¥ Oracle ä¾†èªªå°±æ˜¯ SELECT C1, C2 FROM T1 FOR UPDATEã€‚ éŽ–å®šæ™‚è³‡æ–™ç„¡æ³•è¢«ä¿®æ”¹ï¼Œå¦‚æžœå› ç‚ºæ“ä½œä¸ç•¶è€Œæ²’æœ‰åŠæ™‚è§£éŽ–ï¼Œå°±æœƒåš´é‡å½±éŸ¿æ•ˆèƒ½ã€‚ é©ç”¨æƒ…å¢ƒ è¡çªæ™‚å¤šå€‹æ“ä½œå¯ä¾åºåŸ·è¡Œæ™‚(ä¾‹å¦‚å¾Œé¢çš„è®Šæ›´è¦†è“‹ä¹‹å‰çš„è®Šæ›´æ˜¯æ­£ç¢ºçš„æ™‚)ã€‚ çµè«–é€™å…©ç¨®éŽ–äº’æœ‰å„ªç¼ºï¼Œæ‡‰è©²è¦é©ç•¶çš„æ­é…ä½¿ç”¨ã€‚ åƒè€ƒChatGPT]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åƒè€ƒåž‹åˆ¥ç•¶ Dictionary Key çš„æ³¨æ„äº‹é …]]></title>
    <url>%2Fcontent%2F20230720-reference-type-as-dictionary-key.html</url>
    <content type="text"><![CDATA[Dictionary&lt;TKey, TValue&gt; æ˜¯å¾ˆå¸¸ç”¨çš„è³‡æ–™çµæ§‹ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ç´¢å¼•å­ (Indexer) é€éŽç‰¹å®šçš„ Key ä¾†å­˜å–è³‡æ–™ã€‚ ä½†ä½¿ç”¨æ™‚ï¼Œæˆ‘å€‘è¦ç‰¹åˆ¥æ³¨æ„ Key çš„åž‹åˆ¥ï¼Œä½¿ç”¨å€¼åž‹åˆ¥ä½œç‚º Key é€šå¸¸ä¸æœƒæœ‰å•é¡Œï¼Œä½†ç•¶ä½¿ç”¨åƒè€ƒåž‹åˆ¥ä½œç‚º Key æ™‚å°±ä¸ä¸€å®šäº†ã€‚ ä½¿ç”¨åƒè€ƒåž‹åˆ¥ä½œç‚º Key æ™‚çš„å­˜å–å…ˆçœ‹ä¸‹é¢ç¨‹å¼ç¢¼ï¼š1234567891011121314151617public class TwoValue&lt;T1, T2&gt;&#123; public TwoValue(T1 v1, T2 v2) &#123; Value1 = v1; Value2 = v2; &#125; public T1 Value1 &#123; get; &#125; public T2 Value2 &#123; get; &#125;&#125;// The key is `new TwoValue&lt;int, int&gt;(1, 2)`var dic = new Dictionary&lt;TwoValue&lt;int, int&gt;, string&gt;();dic.Add(new TwoValue&lt;int, int&gt;(1, 2), "Hello");dic.TryGetValue(new TwoValue&lt;int, int&gt;(1, 2), out var v1).Dump(); // falsev1.Dump(); // null å¾ž Dictionary çš„ Add(â€¦) æ–¹æ³• ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ–°å¢žé …ç›®çš„æ™‚å€™ï¼ŒKey çš„éƒ¨åˆ†æ˜¯ä»¥å‘¼å« GetHashCode() æ–¹æ³•æ‰€å¾—åˆ°çš„çµæžœç‚ºåŸºæº–ç”¢ç”Ÿçš„ã€‚æˆ‘å€‘ä¹ŸçŸ¥é“åƒè€ƒåž‹åˆ¥çš„ä¸åŒç‰©ä»¶ï¼Œå‘¼å« GetHashCode å¾—åˆ°çš„çµæžœæœƒä¸åŒï¼Œæ‰€ä»¥æ–°å¢žé …ç›®å¾Œåˆä»¥å¦å¤–ä¸€å€‹æ–°å»ºçš„ TwoValue ç‰©ä»¶ç‚º Key åŽ»æŸ¥è©¢ï¼Œå°±æœƒå› ç‚ºæ–°ç‰©ä»¶çš„ GetHashCode() å›žå‚³å’Œ Dictionary å…§ç‰©ä»¶çš„ä¸åŒè€Œæ‰¾ä¸åˆ°ã€‚ é—œæ–¼ Object.GetHashCode() æ€Žéº¼é‹ä½œã€å’Œç‰©ä»¶çš„å¯¦éš›è¨˜æ†¶é«”ä½ç½®æœ‰ä»€éº¼é—œä¿‚ã€å’Œ Object.Equal(object) åˆæœ‰ä»€éº¼é—œä¿‚ï¼Œä¹‹å¾Œå†æ‰¾æ™‚é–“ä»”ç´°äº†è§£ã€‚ ä½¿ç”¨ Tuple ä½œç‚º Key æ™‚çš„å­˜å–ä½†æ˜¯å¦‚æžœä½¿ç”¨çš„æ˜¯ Tuple å°±ä¸åŒäº†ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š123456// The key is `new Tuple&lt;int, int&gt;(1, 2)`var dic = new Dictionary&lt;Tuple&lt;int, int&gt;, string&gt;();dic.Add(new Tuple&lt;int, int&gt;(1, 2), "Hello");dic.TryGetValue(new Tuple&lt;int, int&gt;(1, 2), out var v2).Dump(); // truev2.Dump(); // "Hello" é›–ç„¶ Tuple&lt;T1,T2&gt; æ˜¯åƒè€ƒåž‹åˆ¥ï¼Œä½†å› ç‚ºä»–è¦†å¯«äº† GetHashCode() æ–¹æ³• ä½¿å¾—ç”¢ç”Ÿçš„é›œæ¹Šå€¼å…¶å¯¦æ˜¯æºè‡ªæ–¼å®ƒåŒ…å«çš„ T1 èˆ‡ T2 çš„é›œæ¹Šå€¼ï¼Œæ‰€ä»¥æ‰æœƒé€ æˆåƒè€ƒåž‹åˆ¥çš„ Key å³ä½¿æ˜¯ä¸åŒç‰©ä»¶ä¹Ÿèƒ½ç”¨ä¾†æŸ¥è©¢ Dictionary é …ç›®çš„ç¾è±¡ã€‚ é€™é»žå…¶å¯¦å¾ˆé‡è¦ï¼Œå¦‚æžœä¸çŸ¥é“é€™äº›ç´°ç¯€ï¼Œå¯èƒ½æœƒå› ç‚ºé€™äº›ç¨‹å¼ç¢¼åŸ·è¡Œçµæžœè€Œåå‘æŽ¨æ–·å‡ºåƒæ˜¯ â€œTuple æ˜¯å€¼åž‹åˆ¥â€ é€™æ¨£çš„éŒ¯èª¤èªçŸ¥ï¼Œæˆ–æ˜¯å°åƒè€ƒåž‹åˆ¥çš„ç‰¹æ€§ç”¢ç”Ÿå›°æƒ‘èˆ‡æ··æ·†ã€‚ ä½¿ç”¨åŒ…å«åƒè€ƒåž‹åˆ¥çš„ Tuple ä½œç‚º Key æ™‚çš„å­˜å–ç¶“éŽä¸Šé¢å…©ç¨®æƒ…å¢ƒçš„ç¤ºç¯„ï¼Œæ‡‰è©²ä¸èƒ½çŒœå‡ºé€™å€‹æƒ…å¢ƒæœƒæœ‰ä»€éº¼çµæžœäº†ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š1234567891011121314151617public class TwoValue&lt;T1, T2&gt;&#123; public TwoValue(T1 v1, T2 v2) &#123; Value1 = v1; Value2 = v2; &#125; public T1 Value1 &#123; get; &#125; public T2 Value2 &#123; get; &#125;&#125;// The key is `new TwoValue&lt;int, int&gt;(1, 2), 3)`var dic = new Dictionary&lt;Tuple&lt;TwoValue&lt;int, int&gt;, int&gt;, string&gt;();dic.Add(new Tuple&lt;TwoValue&lt;int, int&gt;, int&gt;(new TwoValue&lt;int, int&gt;(1, 2), 3), "Hello");dic.TryGetValue(new Tuple&lt;TwoValue&lt;int, int&gt;, int&gt;(new TwoValue&lt;int, int&gt;(1, 2), 3), out var v3).Dump(); // falsev3.Dump(); // null å› ç‚º Tuple&lt;T1, T2&gt; æ˜¯ä»¥å…¶æ‰€åŒ…å«çš„åž‹åˆ¥åƒæ•¸å€‘çš„é›œæ¹Šå€¼ç‚ºåŸºç¤ŽåŽ»ç”¢ç”Ÿä»–è‡ªå·±çš„é›œæ¹Šå€¼ï¼Œæ‰€ä»¥ç•¶ç„¶å¦‚æžœåž‹åˆ¥åƒæ•¸ä¸­æœ‰åƒè€ƒåž‹åˆ¥ï¼Œé‚£æ•´å€‹ Tuple&lt;T1, T2&gt; çš„é›œæ¹Šå€¼å°±å¯èƒ½ (å¦‚æžœä»–æ²’æœ‰æ”¹è®Š GetHashCode() çš„è¡Œç‚º) æœƒå› ç‚ºå…¶æ‰€åŒ…å«çš„æˆå“¡ç”¢ç”Ÿä¸åŒé›œæ¹Šå€¼è€Œæœ€çµ‚çµæžœä¹Ÿä¸åŒï¼Œä¸èƒ½å–®ä»¥åž‹åˆ¥åƒæ•¸æ˜¯åƒè€ƒåž‹åˆ¥è€Œåˆ¤å®šä»–é©åˆåšç‚º Dictionary çš„ Keyã€‚ çµè«–ç¸½çµä¾†èªªå°±æ˜¯ï¼Œ Dictionary&lt;TKey, TValue&gt; ä¸­çš„ TKey ç›¡é‡ä¸è¦ç”¨åƒè€ƒåž‹åˆ¥ï¼Œå¦‚æžœè¦ç”¨å¾—è¦ç¢ºå®šä»–ä¸æœƒç”¢ç”Ÿä¸Šè¿°çš„ç–‘æ…®ã€‚ å…¶å¯¦ä¸é›£ç†è§£ï¼Œä½†æ˜¯å¾ˆé›£ç”¨æ–‡å­—èªªæ˜Žï¼Œè‡ªå·±çœ‹èµ·ä¾†éƒ½åƒæ˜¯åœ¨ç¹žå£ä»¤â€¦ åƒè€ƒReference Source]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# éƒ¨åˆ†é¡žåˆ¥ (Partial Class) çš„ä½¿ç”¨å»ºè­°]]></title>
    <url>%2Fcontent%2F20230709-using-partial-class.html</url>
    <content type="text"><![CDATA[åœ¨ C# ä¸­ï¼Œpartial class å¯ä»¥è®“é–‹ç™¼è€…æŠŠä¸€å€‹é¡žåˆ¥åˆ†æ•£åˆ°å¤šå€‹æª”æ¡ˆä¸­ã€‚ç•¶ç¨‹å¼ç·¨è­¯æ™‚ï¼Œé€™äº›åˆ†æ•£çš„éƒ¨åˆ†æœƒè¢«åˆä½µæˆä¸€å€‹å–®ä¸€çš„é¡žåˆ¥ã€‚é€™ç¯‡æœƒæ ¹æ“šä»¥å¾€ç¶“é©—ä¾†ç´€éŒ„ä¸€ä¸‹ä½¿ç”¨å»ºè­°ã€‚ è¨­è¨ˆå»ºè­°æª”ååç¨±æª”ååç¨±æ‡‰è©²æ˜¯ &lt;Class&gt;.&lt;Category&gt;.cs é€™æ¨£çš„æ ¼å¼ã€‚ ä¾‹å¦‚ä¸€å€‹é¡žåˆ¥ Product æœ‰ä¸€å€‹ Product.cs æª”æ¡ˆåŒ…å«äº†ç”¢å“çš„éƒ¨åˆ†è³‡è¨Šï¼Œç•¶éœ€è¦å»ºç«‹å¦å¤–ä¸€å€‹éƒ¨åˆ†é¡žåˆ¥ä¾†åŒ…å«å•†å“å±¬æ€§çš„æ™‚å€™ï¼Œé€™å€‹æ–°çš„éƒ¨åˆ†é¡žåˆ¥å¯ä»¥æ”¾åœ¨å¦å¤–ä¸€å€‹ Product.Properties.cs æª”æ¡ˆä¸­ï¼Œé€™æ¨£åšçš„å¥½è™•æœ‰å¹¾å€‹ï¼š Product.cs æ˜¯ä¸»è¦è³‡è¨Šï¼Œå…¶ä»–è³‡è¨Šå¯ä»¥ä¾ç…§åˆ†é¡žå»ºç«‹åœ¨ä¸åŒæª”æ¡ˆä¸­ï¼Œéžå¸¸æ¸…æ¥šä¹Ÿå®¹æ˜“ç¶­è­·ã€‚ ä½¿ç”¨å¦‚æžœ Visual Studio é–‹ç™¼ï¼Œå»ºç«‹æª”æ¡ˆ Product.Properties.cs çš„æ™‚å€™å®ƒé è¨­çš„çš„é¡žåˆ¥å°±æœƒæ˜¯ Productï¼Œä¸”å°ç¨‹å¼ç¢¼åˆ†æžå·¥å…·ä¾†èªªä¹Ÿæ˜¯ç¬¦åˆè¦ç¯„çš„ (è‡³å°‘æˆ‘ç”¨éŽçš„ç¨‹å¼ç¢¼åˆ†æžæ˜¯é€™æ¨£)ã€‚ å³ä¾¿ä¸æ˜¯ä½¿ç”¨ Visual Studio é–‹ç™¼ï¼Œåœ¨ç¨‹å¼ç·¨ç¢¼è¦ç¯„çš„è¨‚å®šä¸Šä¹Ÿæ¯”è¼ƒå®¹æ˜“ï¼Œä¾‹å¦‚ï¼šä¸€èˆ¬æœƒè¦æ±‚ä¸»æª”åè¦ç¬¦åˆé¡žåˆ¥åç¨±ï¼Œé€™åœ¨éƒ¨åˆ†é¡žåˆ¥çš„æƒ…å¢ƒä¹Ÿé©ç”¨ã€‚ ç´°ç¯€å¯ä¾ç‹€æ³èª¿æ•´ï¼Œä½†å¤§æ–¹å‘ä¾ç…§ &lt;Class&gt;.&lt;Category&gt;.cs é€™æ¨£çš„æ¨¡å¼æ˜¯å‰¯ä½œç”¨æœ€å°çš„ã€‚ æª”æ¡ˆç®¡ç†åŒä¸€å€‹é¡žåˆ¥çš„æ‰€æœ‰éƒ¨åˆ†é¡žåˆ¥æª”æ¡ˆæ”¾åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ä¸‹ï¼Œé¿å…æª”æ¡ˆå››æ•£å„è™•è€Œé›£ä»¥è¿½è¹¤æ•´å€‹é¡žåˆ¥çš„å®Œæ•´æ¨£è²Œã€‚ å…±ç”¨æˆå“¡çš„ç®¡ç†é€™å€‹ä¸»é¡ŒåŒ…å«å»ºæ§‹å­ã€å…±ç”¨æ¬„ä½ã€å…±ç”¨å±¬æ€§ã€å…±ç”¨æ–¹æ³•ç­‰éœ€è¦åœ¨è¢«ä¸åŒæª”æ¡ˆä¸­çš„éƒ¨åˆ†é¡žåˆ¥å…±ç”¨çš„æƒ…å¢ƒã€‚ é€šå¸¸æˆ‘æœƒæŠŠå…±ç”¨æˆå“¡æ”¾åœ¨ä¸»è¦æª”æ¡ˆä¸­ï¼Œä¾‹å¦‚ï¼š Product.cs ä¸­å°±åŒ…å«æ‰€æœ‰å…±ç”¨æˆå“¡ï¼Œä¸”è¦ç¶­è­·éŽç¨‹ä¸­éœ€è¦æ™‚åˆ»æ³¨æ„å‘¼å«æ–¹æ³•æ™‚æ˜¯å¦æœƒç ´å£žé€™å€‹åŽŸå‰‡ã€‚ é©ç”¨æƒ…å¢ƒéš”é›¢è‡ªå‹•ç”Ÿæˆ (Auto-Generated)çš„ç¨‹å¼ç¢¼æœ‰æ™‚å€™æˆ‘å€‘éœ€è¦é€éŽå·¥å…·æˆ–æ¡†æž¶è‡ªå‹•ç”¢ç”Ÿç¨‹å¼ç¢¼ï¼Œæœ€å¸¸è¦‹çš„æƒ…æ³å°±æ˜¯ ORM (å¦‚ Entity Frameworkï¼‰æ‰€ç”¢ç”Ÿçš„è³‡æ–™æ¨¡åž‹ (Entity Data Model)ï¼Œæˆ‘å€‘ä¸æ‡‰è©²åŽ»ä¿®æ”¹é€™äº›è‡ªå‹•ç”Ÿæˆçš„ç¨‹å¼ç¢¼ï¼Œé¿å…ä¹‹å¾Œé‡æ–°ç”Ÿæˆè¦†è“‹æŽ‰æˆ‘å€‘çš„ä¿®æ”¹ï¼Œé€™æ™‚å€™å°±å¯ä»¥ç”¨éƒ¨åˆ†é¡žåˆ¥ä¾†æ“´å……èˆ‡ç¶­è­·ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š1234567891011121314151617// Person.cspublic partial class Person&#123; public int Id &#123; get; set; &#125; public string FirstName &#123; get; set; &#125; public string LastName &#123; get; set; &#125; public DateTime DateOfBirth &#123; get; set; &#125;&#125;// Person.Aggregation.cspublic partial class Person&#123; public string FullName &#123; get =&gt; FirstName + " " + LastName; &#125;&#125; é€™æ¨£ä¸€ä¾†ç•¶é‡æ–°ç”¢ç”Ÿè³‡æ–™æ¨¡åž‹çš„æ™‚å€™å°±åªæœƒå½±éŸ¿åˆ°å·¥å…·æ‰€ç®¡è½„çš„æª”æ¡ˆ Product.cs è€Œå·²ã€‚ å¤§é¡žåˆ¥çš„æ‹†åˆ†æœ‰äº›é¡žåˆ¥å› ç‚ºå®šç¾©çš„éŽæ–¼æŠ½è±¡ä¸”ç¾å¯¦ä¸å…è¨±é‡æ§‹æ™‚ï¼Œå°±å¯ä»¥é€éŽå°‡ä¸€å€‹å¤§é¡žåˆ¥ç´°åˆ†æˆå¤šå€‹å°çš„éƒ¨åˆ†é¡žåˆ¥ï¼Œæå‡ä¸€é»žå¯ç¶­è­·æ€§ï¼›å¦å¤–ä¸€ç¨®æ˜¯è³‡æ–™å®¹å™¨åž‹çš„é¡žåˆ¥ (Model)ï¼Œå°¤å…¶æ˜¯ Context æˆ–æ˜¯ Metadata é€™ä¸€é¡žçš„é¡žåˆ¥å¾ˆå®¹æ˜“å°±åŒ…å±±åŒ…æµ·ï¼Œç¨å¾®åˆ†é¡žä¸€ä¸‹ä¹Ÿæ˜¯æœ‰å¹«åŠ©ã€‚ ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æžœé©åˆï¼Œä¸€é–‹å§‹å°±è¨­è¨ˆæˆä¸åŒé¡žåˆ¥æœƒæ›´ç†æƒ³ï¼›å¦‚æžœä¸é©åˆè¨­è¨ˆæˆä¸åŒé¡žåˆ¥ï¼Œé‚£å†ä¾†è€ƒæ…®éƒ¨åˆ†é¡žåˆ¥ã€‚ åˆ†éšŽæ®µé‡æ§‹æ™‚æœ‰äº›åŒ…è¢±ç‰¹åˆ¥é‡çš„å°ˆæ¡ˆï¼Œè£¡é¢æœƒæœ‰å¾ˆè‚¥åˆå¾ˆäº‚çš„é¡žåˆ¥ï¼Œåååˆä¸å…è¨±ä¸€æ¬¡åˆ°ä½çš„é‡æ§‹æ•´å€‹é¡žåˆ¥ï¼Œé€™æ™‚å€™å°±æœƒéœ€è¦åˆ†éšŽæ®µé‡æ§‹ã€‚è€Œåˆ†éšŽæ®µé‡æ§‹æ™‚å¿…ç„¶æœƒé¢å°é‚Šé‡æ§‹é‚Šç¶­è­·çš„å›°å¢ƒï¼Œä½¿å¾—ä¸€å€‹åŽŸæœ¬å°±å¾ˆäº‚çš„é¡žåˆ¥ä¸­çš„ç¨‹å¼ç¢¼æ–°èˆŠäº¤èžï¼Œå› è€Œæ›´é›£ä»¥ç¶­è­·ï¼Œä¹Ÿå®¹æ˜“å› ç‚ºç¶­è­·ä¸ç•¶å°Žè‡´äº‚ä¸ŠåŠ äº‚ã€‚ é€™é‚Šçš„æ–°èˆŠäº¤èžä¸æ˜¯æŒ‡é‡æ§‹å¾Œç•™è‘—èˆŠç¨‹å¼ç¢¼ä¸åˆªï¼Œè€Œæ˜¯æœ‰äº›é‡æ§‹äº†ä½†æœ‰äº›é‚„æ²’åšçš„æ„æ€ã€‚ é€™æ™‚å€™å¯ä»¥æŠŠèˆŠçš„ç¨‹å¼ç¢¼ç›´æŽ¥æ”¹æˆéƒ¨åˆ†é¡žåˆ¥ç•™åœ¨åŽŸæœ¬çš„æª”æ¡ˆ GhostStory.cs ä¸­ï¼Œå¦å¤–å»ºç«‹ä¸€å€‹æ–°æª”æ¡ˆ GhostStory.Refactoring.cs åŒ…å«æ•´ç†éŽçš„ç¨‹å¼ç¢¼ï¼Œé”åˆ°åˆ†éšŽæ®µé‡æ§‹æœŸé–“ä»ç„¶å¯ä»¥ç¶­è­·èˆŠçš„ç¨‹å¼è€Œä¸æœƒäº’ç›¸å¹²æ“¾çš„æ•ˆæžœã€‚ ç­‰åˆ°å¹¾ç™¾å¹´å¾Œé‡æ§‹çµ‚æ–¼å®Œæˆäº†ï¼Œå°±å¯ä»¥åˆªæŽ‰èˆŠçš„ GhostStory.cs å¾Œå†æŠŠ GhostStory.Refactoring.cs é‡æ–°å‘½æˆå›ž GhostStory.cs ä¸¦ç§»é™¤ partial é—œéµå­—å°±å®Œæˆäº†ã€‚ ç¼ºé»žèˆ‡èª¤ç”¨é¢¨éšªåˆ†é¡žä¸ç•¶æˆ–ç¨‹å¼æ”¾åœ¨ä¸é©åˆçš„æª”æ¡ˆç”¨éƒ¨åˆ†é¡žåˆ¥é›–ç„¶å¯ä»¥é”åˆ°å¤§é¡žåˆ¥åˆ†é¡žç®¡ç†çš„æ•ˆæžœï¼Œä½†å¦‚æžœåˆ†é¡žä¸ç•¶æˆ–å°‡ç¨‹å¼æ”¾åœ¨ä¸é©åˆçš„æª”æ¡ˆä¸­ï¼Œåè€Œæœƒå¢žåŠ ç¶­è­·é›£åº¦ã€‚ å…±ç”¨æˆå“¡é›£ç®¡ç†ç•¶å¤šå€‹ä¸åŒæª”æ¡ˆçš„æ–¹æ³•éœ€è¦å‘¼å«å…±ç”¨æˆå“¡æ™‚ï¼Œé‚£å€‹å…±ç”¨æˆå“¡è¦æ”¾åœ¨å“ªå€‹æª”æ¡ˆä¹Ÿæ˜¯å€‹ä¸å¥½æ±ºå®šçš„ä¸»é¡Œï¼Œç”šè‡³è¤‡é›œä¸€é»žæœƒç”¢ç”Ÿå¤šå€‹æª”æ¡ˆé–“çš„æ–¹æ³•äº¤éŒ¯å‘¼å«è€Œé›£ä»¥è¿½è¹¤èˆ‡ç®¡ç†ã€‚å³ä½¿ä¸€é–‹å§‹æ±ºå®šå¥½äº†ï¼Œç¶­è­·éŽç¨‹ä¹Ÿè¦ä¸€ç›´æ³¨æ„å‘¼å«é—œä¿‚æ˜¯å¦æ°ç•¶ä»¥åŠæ˜¯å¦è¦è®“æˆå“¡æ›æª”æ¡ˆä½çš„å•é¡Œã€‚ é€™é»žæ˜¯æœ€é›£æŽŒæŽ§çš„ï¼Œå› ç‚ºå¾ˆå®¹æ˜“éš¨è‘—ç¶­è­·çš„éŽç¨‹æ…¢æ…¢æ­ªæŽ‰ã€‚ é€ƒé¿è¨­è¨ˆæˆ–é‡æ§‹éƒ¨åˆ†é¡žåˆ¥ç®—æ˜¯å‚™ç”¨æ–¹æ¡ˆï¼Œå¦‚æžœä¸å…ˆè€ƒæ…®å¥½å¥½è¨­è¨ˆè€Œä¸€è‚¡è…¦åœ°ä½¿ç”¨éƒ¨åˆ†é¡žåˆ¥çš„è©±ï¼Œé‚„æ˜¯æœƒç”¢ç”Ÿä¸€å€‹å¤§é›œç‡´é¢¨æ ¼çš„é¡žåˆ¥ï¼Œé•åäº†å–®ä¸€è·è²¬åŽŸå‰‡ (Single Responsibility Principle) ä¸”å®¹æ˜“è®“ç¨‹å¼ç¢¼çš„å¯ç¶­è­·æ€§å¿«é€Ÿä¸‹é™ã€‚ çµè«–éƒ¨åˆ†é¡žåˆ¥æ˜¯å€‹å¾ˆå¥½ç”¨çš„å·¥å…·ï¼Œä½†å¦‚æžœä½¿ç”¨ä¸ç•¶ï¼Œå†å¥½ç”¨çš„å·¥å…·éƒ½æœƒç ¸åˆ°è‡ªå·±çš„è…³ï¼Œæ‰€ä»¥è¨­è¨ˆæ™‚æ‡‰è©²è¦ç¶œåˆè€ƒæ…®å„ªç¼ºé»žèˆ‡å‰¯ä½œç”¨ä»¥åŠéœ€è¦çš„å–æ¨å¾Œå†åšæ±ºå®šã€‚ åƒè€ƒChatGPT é–‹ç™¼ç¶“é©— Naming Conventions For Partial Class Files Best Practices: When not/to use partial classes]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ ORM åšå–®æ¬¡å¤§æŸ¥è©¢çš„æ•ˆèƒ½é™·é˜±]]></title>
    <url>%2Fcontent%2F20230617-large-scale-query-with-orm.html</url>
    <content type="text"><![CDATA[åœ¨é–‹ç™¼éŽç¨‹ä¸­ï¼Œæˆ‘å€‘ç¶“å¸¸éœ€è¦é€éŽ ORM (æˆ‘æ˜¯ä½¿ç”¨ EF Core) å¾žè³‡æ–™åº«ä¸­å–å¾—è³‡è¨Šï¼Œåœ¨æŸ¥è©¢å¾ˆè¤‡é›œçš„æ™‚å€™æˆ‘é€šå¸¸éƒ½æœƒç›¡é‡é€éŽä¸€å€‹æŸ¥è©¢å°±æŠŠè³‡æ–™æº–å‚™å¥½ï¼Œä¸¦è½‰æ›æˆå·¢ç‹€çš„è³‡æ–™çµæ§‹ä»¥ä¾¿æ–¼æ‡‰ç”¨ç¨‹å¼é€²è¡Œæ“ä½œï¼Œé€™æ¨£å¯ä»¥é¿å…å¤šæ¬¡æŸ¥è©¢é€ æˆçš„æ•ˆèƒ½é¢¨éšªã€‚ ä½†å‰é™£å­åœ¨é–‹ç™¼éŽç¨‹æª¢æŸ¥ ORM ç”¢ç”Ÿçš„ SQL æ™‚æ„å¤–ç™¼ç¾æˆ‘çš„èªçŸ¥ä¸ä¸€å®šæ˜¯å°çš„ã€‚ å•é¡Œå› ç‚ºå–®æ¬¡å¤§æŸ¥è©¢é›–ç„¶èƒ½é¿å…å¤šæ¬¡ä¾†å›žæŸ¥è©¢çš„æˆæœ¬ï¼Œä½†æ˜¯ç•¶é‡åˆ°å·¢ç‹€çš„è³‡æ–™çµæ§‹çš„æ™‚å€™ï¼Œå–®æ¬¡å¤§æŸ¥è©¢è½‰æ›å‡ºä¾†çš„ SQL å¯èƒ½æœƒéžå¸¸ç³Ÿï¼Œå•é¡Œä¸»è¦å¯ä»¥åˆ†æˆå…©å€‹æ–¹å‘ã€‚ é€™é‚Šå…ˆé™„ä¸Šä¸€å€‹è¤‡é›œçš„ LINQ æŸ¥è©¢èˆ‡é€éŽ EF Core è½‰åŒ–å‡ºä¾†çš„ SQL ä½œç‚ºä¸‹é¢èªªæ˜Žçš„åƒè€ƒè³‡æ–™ï¼š 1234567891011121314151617181920var courseDetails = _dbContext.Set&lt;Course&gt;() .Where(c =&gt; c.Id == id) .Select(c =&gt; new Detail &#123; Id = c.Id, Name = c.Name, Teacher = c.Teacher.Name, Students = c.Students.Select(s =&gt; new Student &#123; Id = s.Id, Name = s.Name, Grade = s.Grades.FirstOrDefault(g =&gt; g.CourseId == c.Id).Grade, PersonalInfo = new PersonalInfo &#123; Address = s.PersonalInfo.Address, PhoneNumber = s.PersonalInfo.PhoneNumber, &#125; &#125;).ToList(), &#125;) .SingleOrDefault(); 123456789101112131415161718192021222324SELECT "c"."Id", "c"."Name", "t"."Name", "s"."Id", "s"."Name", (SELECT "g"."Grade" FROM "Grades" AS "g" WHERE ("g"."CourseId" = "c"."Id") AND ("g"."StudentId" = "s"."Id") FETCH FIRST ROW ONLY), "p"."Address", "p"."PhoneNumber"FROM "Courses" AS "c" LEFT JOIN "Teachers" AS "t" ON "c"."Id" = "t"."CourseId" JOIN ( SELECT "s".*, "cs"."CourseId" FROM "Students" AS "s" INNER JOIN "CourseStudents" AS "cs" ON "s"."Id" = "cs"."StudentId" ORDER BY "cs"."CourseId" ) AS "s" ON "c"."Id" = "s"."CourseId" LEFT JOIN "PersonalInfos" AS "p" ON "s"."Id" = "p"."StudentId"WHERE "c"."Id" = :idORDER BY "c"."Id", "s"."CourseId" é€™å€‹å•é¡Œæ˜¯å·¥ä½œä¸Šé‡åˆ°çš„ä¹Ÿå·²ç¶“ç¢ºèªéŽå•é¡Œçš„ç¢ºå­˜åœ¨ï¼Œä½†ç•¶ç„¶ä¸èƒ½æ‹¿å…¬å¸å¯¦éš›è³‡æ–™ç•¶ç¯„ä¾‹ï¼Œæ‰€ä»¥é€™é‚Šç”¨ ChatGPT ç”¢ç”Ÿ LINQ å’Œ SQL ä¾†ç•¶ç¯„ä¾‹ï¼Œå› ç‚ºæ˜¯æ©Ÿå™¨ç”¢ç”Ÿçš„å’Œå¯¦éš›é‹ä½œç”¢ç”Ÿçš„ SQL ä¸ä¸€å®šæœƒç›¸åŒç”šè‡³ç„¡æ³•é‹ä½œï¼Œä½†ä½œç‚ºå±•ç¤ºæ¦‚å¿µçš„åƒè€ƒè³‡æ–™å·²ç¶“è¶³å¤ äº†ã€‚ å¤§é‡å¤šé¤˜çš„è³‡æ–™é€™éƒ¨åˆ†å¯ä»¥ç”¨ SQL æœå°‹å‡ºä¾†çš„è³‡æ–™æ˜¯ä¸€å€‹è¡¨æ ¼ç‚ºå‡ºç™¼é»žåŽ»ç†è§£ï¼Œå› ç‚ºé€éŽ SQL æ²’è¾¦æ³•ç›´æŽ¥æœå°‹å‡ºä¸€å€‹å·¢ç‹€çš„è³‡æ–™çµæ§‹ï¼Œæ‰€ä»¥åœ¨æŸ¥åˆ°çš„è³‡æ–™åˆ°æ‡‰ç”¨ç¨‹å¼çš„å·¢ç‹€é¡žåˆ¥ä¸­é–“å‹¢å¿…è¦ç¶“éŽè½‰åŒ–ï¼Œè€Œé€™å€‹è½‰åŒ–æ˜¯ç™¼ç”Ÿåœ¨æ‡‰ç”¨ç¨‹å¼ä¸­çš„ã€‚ å¾žä¸Šé¢çš„ç¯„ä¾‹ä¾†çœ‹ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ä»–ç”¢ç”Ÿçš„ SQL å› ç‚ºåŒ…å«å¤§é‡çš„ JOIN æ‰€ä»¥æœå°‹å‡ºä¾†çš„è³‡æ–™ç­†æ•¸å¯èƒ½æœƒæ¥µå¤§ï¼Œç„¶å¾Œæ‰åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­åˆ†çµ„æ•´åˆã€‚ è€Œé‡é»žåœ¨æ–¼é€™å¤§é‡çš„è³‡æ–™ä¸­çš„å¤šæ•¸æ¬„ä½éƒ½æ˜¯é‡è¤‡çš„å…§å®¹ã€‚ ä»¥å¯¦éš›é‡åˆ°çš„æƒ…å¢ƒä¾†èªªï¼Œæˆ‘åªæ˜¯è¦æœå°‹ä¸€ç­†ä¸»è³‡æ–™ï¼Œä½†å› ç‚ºé—œè¯åˆ°å¾ˆå¤šå…¶ä»–è³‡æ–™è¡¨æ‰€ä»¥å¯¦éš›ä¸Šæœå°‹å‡ºå¹¾åƒç­†çš„è³‡æ–™ï¼Œç„¶å¾Œåœ¨æ‡‰ç”¨ç¨‹å¼ä¸­å°‡å¹¾åƒç­†è³‡æ–™åˆ†çµ„æ•´åˆæˆä¸€å€‹å·¢ç‹€é¡žåˆ¥ã€‚ é€™æœƒé€ æˆçš„å•é¡Œæœ‰ï¼š ç„¡è¬‚çš„è¨˜æ†¶é«”æ¶ˆè€—ï¼Œç”šè‡³ GC çš„è² æ“”é€éŽä¸Šé¢æè¿°ï¼Œå¯æƒ³è€ŒçŸ¥é€™å¹¾åƒç­†ä¸­é‡è¤‡çš„å…§å®¹æœƒé€ æˆå¤šå°‘ç„¡è¬‚çš„è¨˜æ†¶é«”æ¶ˆè€—ï¼Œå¦‚æžœè³‡æ–™å¤ å¤§é‚„å¯èƒ½æœƒé€²ä¸€æ­¥é€ æˆ GC çš„è² æ“”ã€‚ æé«˜å° CPU çš„è² æ“”é€™é»žä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå¤§é‡è³‡æ–™çš„è½‰åŒ–éœ€è¦å¾ˆå¤šé‹ç®—è³‡æºã€‚ ä¸å¿…è¦çš„æŽ’åºå¦å¤–ä¸€å€‹å°±æ˜¯ä¸å¿…è¦çš„æŽ’åºï¼Œå¾žå‰é¢çš„ç¯„ä¾‹å¯ä»¥ç™¼ç¾æ‰€ç”¢ç”Ÿçš„ä¸å¿…è¦çš„æŽ’åºï¼Œé€™å€‹æŽ’åºæœƒä½¿å¾— SQL æœ¬èº«çš„æŸ¥è©¢æˆæœ¬å¤§å¹…æé«˜ã€‚ è‡³æ–¼ç‚ºä»€éº¼æœƒæŽ’åºï¼Œæ ¹æ“š ChatGPT çš„èªªæ³•æ˜¯ï¼šEntity Framework Core åœ¨ç”¢ç”Ÿ SQL èªžå¥æ™‚ï¼Œæœƒåœ¨æŸäº›æƒ…æ³ä¸‹æ’å…¥æŽ’åºæ“ä½œï¼Œä»¥ç¢ºä¿è¿”å›žçš„è³‡æ–™ç¬¦åˆ C# çš„ LINQ æŸ¥è©¢çš„é †åºã€‚é€™é€šå¸¸ç™¼ç”Ÿåœ¨æ¶‰åŠé›†åˆå°Žèˆªå±¬æ€§çš„æŸ¥è©¢ä¸­ï¼Œå› ç‚º EF Core éœ€è¦ä¿è­‰è³‡æ–™çš„é †åºèˆ‡åŽŸå§‹æŸ¥è©¢ç›¸ç¬¦ã€‚é€™ç¨®æŽ’åºæ“ä½œæ˜¯ EF Core ç‚ºäº†è™•ç†å°Žèˆªé›†åˆå±¬æ€§ï¼ˆå¦‚ c.Studentsï¼‰è€Œæ·»åŠ çš„ã€‚å®ƒéœ€è¦æŒ‰ç…§å¤–éµï¼ˆåœ¨é€™è£¡æ˜¯ CourseIdï¼‰çš„é †åºä¾†ç²å–ç›¸é—œçš„ Studentsï¼Œä»¥ä¾¿èƒ½å¤ æ­£ç¢ºåœ°å»ºç«‹å›žå‚³çš„ç‰©ä»¶ã€‚ è§£æ±ºæ–¹æ¡ˆè§£æ±ºæ–¹å¼å…¶å¯¦å°±æ˜¯æŠŠå–®æ¬¡å¤§æŸ¥è©¢è½‰åŒ–æˆå¤šæ¬¡å°æŸ¥è©¢ï¼Œå¦‚ä¸‹ç¯„ä¾‹ã€‚ var courseDetails = _dbContext.Set&lt;Course&gt;() .Where(c =&gt; c.Id == id) .Select(c =&gt; new Detail { Id = c.Id, Name = c.Name, Teacher = c.Teacher.Name, }) .SingleOrDefault(); courseDetails.Students = _dbContext.Set&lt;Student&gt;() .Where(s =&gt; s.Courses.Any(c =&gt; c.Id == courseDetails.Id)) .Select(s =&gt; new Student { Id = s.Id, Name = s.Name, Grade = s.Grades.FirstOrDefault(g =&gt; g.CourseId == courseDetails.Id).Grade, PersonalInfo = new PersonalInfo { Address = s.PersonalInfo.Address, PhoneNumber = s.PersonalInfo.PhoneNumber, } }).ToList(); å› ç‚ºè¢«æ‹†æˆå¹¾æ®µå°æŸ¥è©¢ï¼Œæ‰€ä»¥æ¯ä¸€æ®µæŸ¥è©¢éƒ½æœƒé™ä½Ž JOIN çš„æ•¸é‡ (ç”šè‡³æ²’æœ‰)ï¼Œå› æ­¤å°±èƒ½é¿å…å–®æ¬¡å¤§æŸ¥è©¢çš„æ•ˆèƒ½é™·é˜±äº†ã€‚ ä½†é€™é‚Šé‚„æ˜¯è¦æ³¨æ„ï¼Œä¸æ˜¯æŠŠå·¢ç‹€æ‹†æŽ‰åˆ†é–‹å°±æ˜¯å¥½çš„ï¼Œå¦‚æžœ JOIN å¾Œçš„è³‡æ–™é‡å¾ˆå°ï¼Œå¤šæ¬¡å°æŸ¥è©¢çš„æ•ˆèƒ½æ˜¯å¯èƒ½æ¯”å–®æ¬¡æŸ¥è©¢è¦å·®çš„ï¼Œé€™éƒ¨åˆ†å°±è®Šæˆè¦å› åœ°åˆ¶å®œä¾†åˆ¤å®šäº†ã€‚ ç¸½çµä»¥å‰ç¸½æ˜¯è¦ºå¾—å¤šå€‹å°æŸ¥è©¢æŸ¥è³‡æ–™æ•ˆèƒ½æ¯”è¼ƒå·®ï¼Œæ²’æƒ³åˆ°å…¶å¯¦ä¸ä¸€å®šã€‚ ç¸½çµä¸€ä¸‹å·¢ç‹€ç‰©ä»¶çš„æŸ¥è©¢å¿ƒå¾—ï¼š çœ‹åˆ°å·¢ç‹€ç‰©ä»¶è€ƒæ…®æ‹†æˆå¤šå€‹å°æŸ¥è©¢ã€‚ å·¢ç‹€éƒ¨åˆ†çš„è³‡æ–™é‡å¾ˆå¤§æˆ–é æœŸæœƒå¿«é€Ÿæˆé•·æ™‚ï¼Œæ‹†æˆå°æŸ¥è©¢å¯èƒ½æ¯”è¼ƒå¥½ã€‚ å·¢ç‹€éƒ¨åˆ†çš„è³‡æ–™é‡å¾ˆå°ä¸”å¹¾ä¹Žä¸æœƒå¢žé•·æ™‚ï¼Œä¸æ‹†å¯èƒ½ç¨‹å¼ç¢¼æœƒæ¯”è¼ƒæ•´æ½”ã€‚ æ‹†èˆ‡ä¸æ‹†ä¹‹é–“ï¼Œè¦ç¶œåˆè€ƒé‡å¯è®€æ€§ã€æ•ˆèƒ½å·®ç•°å¹…åº¦ã€è³‡æ–™æ˜¯å¦æœƒå¢žé•·â€¦ç­‰å¤šå€‹è¦ç´ ï¼Œä¹Ÿå¯å°‡ ORM æ‰€ç”¢ç”Ÿçš„ SQL å°å‡ºä¾†å¾Œåˆ†æžä»¥å”åŠ©åˆ¤æ–·ã€‚ åƒè€ƒChatGPT]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ SourceBrowser å»ºç«‹åŽŸå§‹ç¢¼ç€è¦½ç¶²ç«™]]></title>
    <url>%2Fcontent%2F20230312-use-source-browser.html</url>
    <content type="text"><![CDATA[Reference Source æ˜¯ä¸€å€‹éžå¸¸æ–¹ä¾¿çš„è³‡æºå¯ä»¥ç”¨ä¾†æŸ¥çœ‹ .NET Framework çš„ç¨‹å¼ç¢¼ï¼Œè€Œé€™å€‹ç¶²ç«™æ˜¯åˆ©ç”¨ SourceBrowser æ‰€å»ºç«‹çš„ã€‚ å°æ–¼æˆ‘å€‘è‡ªå·±é–‹ç™¼çš„å°ˆæ¡ˆï¼Œé›–ç„¶éƒ½æœ‰åŽŸå§‹ç¢¼å¥½åƒç”¨ä¸åˆ°é€™å€‹å·¥å…·ï¼Œä½†å¾ˆå¤šæ™‚å€™æƒ³å¿«é€ŸæŸ¥çœ‹ç¨‹å¼ç¢¼å»åˆä¸æƒ³è€—è²»è³‡æºåœ¨åŸ·è¡Œ IDE ä¸Šçš„æ™‚å€™(å°¤å…¶åŒæ™‚ç¶­è­·å¤šå°ˆæ¡ˆçš„æ™‚å€™)ï¼Œé€™å€‹å·¥å…·èƒ½æä¾›ä¸€å€‹ä¸éŒ¯çš„ä»‹é¢ä¾†ä½¿ç”¨ã€‚ å®˜æ–¹æä¾›äº†åŸºæœ¬çš„ä½¿ç”¨æ•™å­¸ï¼Œä½†è¦é–‹ Visual Studio ä¾†ç·¨è­¯ SourceBrowser å°ˆæ¡ˆï¼Œæ¯”è¼ƒä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥é€™é‚Šæœƒä½¿ç”¨å®˜æ–¹ä¹Ÿæœ‰æä¾›çš„ NuGet Package ä¾†åšï¼Œç¨å¾®ç´€éŒ„ä¸€ä¸‹éŽç¨‹ï¼Œè®“ä¹‹å¾Œéœ€è¦çš„æ™‚å€™èƒ½æ›´å¿«çš„ä½¿ç”¨ã€‚ åŸºæœ¬ä½¿ç”¨æ­¥é©Ÿä¸‹è¼‰ NuGet Packageä¸‹è¼‰ NuGet Package å¾Œè§£å£“ç¸®å¾Œåªç•™ä¸‹ tools è³‡æ–™å¤¾ã€‚ ä½¿ç”¨ HtmlGenerator.exe ä¾†å»ºç«‹è³‡æ–™æ ¹æ“š GenerateTestSite.cmd å¯ä»¥çŸ¥é“æˆ‘å€‘éœ€è¦ç”¨ HtmlGenerator.exe ä¾†è§£æžç›®æ¨™å°ˆæ¡ˆä¸¦è¼¸å‡ºåˆ°æŒ‡å®šç›®éŒ„ä¸‹ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š1tools\HtmlGenerator.exe "MyGithub\MoreNet.Cryptography\MoreNet.Cryptography.sln" /out:tools\site å°‡è¼¸å‡ºçµæžœä½ˆç½²åˆ°ä¼ºæœå™¨ä¸Šæ ¹æ“š RunTestSite.cmd å¯ä»¥çŸ¥é“æˆ‘å€‘éœ€è¦ä½¿ç”¨ Microsoft.SourceBrowser.SourceIndexServer.dll ä¾†å•Ÿå‹• SourceBrowser ç«™å° (ä¹Ÿå¯ä»¥ç›´æŽ¥åŸ·è¡Œ Microsoft.SourceBrowser.SourceIndexServer.exe)ï¼Œä¾‹å¦‚ï¼š1dotnet Microsoft.SourceBrowser.SourceIndexServer.dll å¦‚æžœæ˜¯åœ¨æœ¬æ©ŸåŸ·è¡Œï¼Œå¾žç€è¦½å™¨ç€è¦½ http://localhost:5000 å°±å¯ä»¥çœ‹åˆ°çµæžœäº†ï¼Œä¹Ÿå¯ä»¥ä½ˆç½²åˆ°ä¼ºæœå™¨ä¸Šæä¾›ç·šä¸ŠæŸ¥è©¢ã€‚ å…¶ä»– ç›¸é—œçš„æŒ‡ä»¤å¯ä»¥è‡ªå·±å¯«æˆ *.bat æª”æ–¹ä¾¿é‡è¤‡ä½¿ç”¨ã€‚ ç”¢ç”Ÿå‡ºä¾†çš„å…§å®¹è‡³å°‘ä¾è³´ dotnetï¼Œè©³ç´°è³‡è¨Šè¦‹å®˜æ–¹èªªæ˜Žï¼Œæˆ‘æœ¬æ©Ÿä¸Šç’°å¢ƒå¤ªé›œæ²’è¾¦æ³•ç²¾æº–é©—è­‰éœ€è¦å“ªäº›ä¾è³´ã€‚ å¯èƒ½é‚„æœ‰å…¶ä»–ä½¿ç”¨æ–¹å¼å’Œåƒæ•¸ï¼Œä½†ç›®å‰ä¸æ€¥è‘—çŸ¥é“æ‰€ä»¥éœ€è¦çš„æ™‚å€™å†çœ‹ GitHub å°±å¥½ çµè«–é›–ç„¶å¾ž GitHub æˆ–å…¶ä»–ç·šä¸Šå„²å­˜åº«å°±èƒ½ç›´æŽ¥çœ‹ç¨‹å¼ç¢¼ï¼Œä½†æ˜¯ SourceBrowser æä¾›æ›´å¼·å¤§çš„åŠŸèƒ½ä¾†æŸ¥çœ‹ç¨‹å¼ç¢¼ä¹‹é–“çš„åƒè€ƒèˆ‡ä¾è³´é—œä¿‚ï¼Œé‚„æ˜¯èƒ½è®“æˆ‘å€‘æ›´æœ‰æ•ˆçŽ‡çš„æŸ¥çœ‹ç¨‹å¼ç¢¼ã€‚ å”¯ä¸€ç¾Žä¸­ä¸è¶³çš„æ˜¯å®ƒä¸æ˜¯éœæ…‹ç¶²ç«™ä¸”æœ‰ä¸€äº›æ¡†æž¶çš„ä¾è³´ï¼Œæ‰€ä»¥ä½ˆç½²æˆæœ¬æ»¿é«˜çš„ã€‚ åƒè€ƒSourceBrowser]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ using ä»¥åŠç•¶ä¾‹å¤–å¾ž finally å€å¡Šæ‹‹å‡ºæ™‚çš„å•é¡Œ]]></title>
    <url>%2Fcontent%2F20230311-problem-about-exception-from-finally-block-of-using.html</url>
    <content type="text"><![CDATA[ç•¶æˆ‘å€‘æƒ³è¦ä½¿ç”¨å¯¦ä½œ IDisposable çš„åž‹åˆ¥æ™‚ï¼Œusing é—œéµå­—é€šå¸¸æ˜¯ä¸äºŒäººé¸ï¼Œä½†æ˜¯å…¶ä¸­å»åŒ…å«ä¸€äº›å°é™·é˜± (åš´æ ¼ä¾†èªªä¸æ˜¯é™·é˜±ï¼Œæ˜¯å¯¦ä½œ IDisposable çš„æ™‚å€™æ²’åšå¥½)ã€‚ èƒŒæ™¯çŸ¥è­˜:using é—œéµå­—å°±æ˜¯ try-finally åŠ ä¸Šå‘¼å« IDisposable.Dispose() çš„èªžæ³•ç³–ï¼Œæ²’æŠŠæ¡çš„è©±æ‰¾å€‹åçµ„è­¯å·¥å…·ç¢ºèªä¸€ä¸‹å°±çŸ¥é“äº†ã€‚ æœ‰å¯èƒ½çš„å•é¡Œæ•æ‰ä¸åˆ°çš„ä¾‹å¤–é¦–å…ˆï¼Œç”¨ä¸‹é¢çš„ç¯„ä¾‹ç¨‹å¼ä¾†èªªæ˜Žï¼š1234567public class Foo : IDisposable&#123; public void Dispose() &#123; throw new Exception("a"); &#125;&#125; 1234567891011121314// callerusing (var f = new Foo())&#123; try &#123; // do something &#125; catch (Exception) &#123; // do something &#125;&#125; // exception thrown here.// never executed from here. æˆ‘å€‘æœ‰ä¸€å€‹å¯¦ä½œ IDisposable çš„é¡žåˆ¥ï¼Œé€™å€‹é¡žåˆ¥æ¨¡æ“¬åœ¨ Dispose æ–¹æ³•ä¸­æ‹‹å‡ºä¾‹å¤–ï¼Œè€Œä¸Šé¢çš„ç¨‹å¼ç¢¼å› ç‚º Foo.Dispose() æ‹‹å‡ºä¾‹å¤–è€Œä½¿å¾—çœ‹èµ·ä¾†èƒ½æ­£å¸¸æ•æ‰ä¾‹å¤–çš„ç¨‹å¼ç¢¼å…¶å¯¦æ˜¯æœƒæœ‰æ¼æ´žçš„ã€‚ æ‹‹å‡ºé æœŸå¤–çš„ä¾‹å¤–é‚£å¦‚æžœæŠŠ try-catch å€å¡Šç§»åˆ° using å¤–å‘¢ï¼Ÿä»¥ä¸‹æ–¹ç¨‹å¼ä¾†èªªæ˜Žï¼š 1234567public class Foo : IDisposable&#123; public void Dispose() &#123; throw new Exception("a"); &#125;&#125; 123456789101112// callertry&#123; using (var f = new Foo()) &#123; throw new Exception("b"); &#125;&#125;catch (Exception ex)&#123; // got exception from Foo.Dispose() and missing the one from try block.&#125; ä¸€æ¨£çš„ Fooï¼Œä¸ä¸€æ¨£çš„å‘¼å«ç«¯ï¼Œä½†æ˜¯é€™æ¨£ä½¿ç”¨æœƒé€ æˆå‘¼å«ç«¯çš„ catch å€å¡Šä¸­æ•æ‰åˆ°çš„ä¾‹å¤–å…¶å¯¦æ˜¯ Foo.Dispose() æ‹‹å‡ºçš„ä¾‹å¤–ï¼Œé€™æ„å‘³è‘—ç•¶å‘¼å«ç«¯ç¨‹å¼ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼ŒéŒ¯èª¤æ ¹æœ¬ä¸æœƒè¢«æ•æ‰åˆ°ï¼Œä¹Ÿå°±ä»£è¡¨ç•¶ Production Issue ç™¼ç”Ÿæ™‚ï¼Œæœƒå®Œå…¨çœ‹ä¸åˆ°å‘¼å«ç«¯ç¨‹å¼çœŸæ­£çš„ä¾‹å¤–ï¼Œåœ¨æœ‰æ™‚é–“å£“åŠ›ä¸‹ç™¼ç”Ÿé€™ç¨®äº‹æ˜¯å¾ˆå¯æ€•çš„ã€‚ å•é¡Œç¸½çµé€™ä»¶äº‹çš„æ ¹æœ¬åŽŸå› æ˜¯å› ç‚ºåœ¨ using çš„ finally å€å¡Šä¸­æ‹‹å‡ºä¾‹å¤–ä½¿å¾—å‘¼å«ç«¯èª¤ä»¥ç‚ºè‡ªå·±æœ‰è€ƒæ…®åˆ°æ‰€æœ‰ä¾‹å¤–ï¼Œæˆ–æ˜¯å‘¼å«ç«¯èª¤ä»¥ç‚ºè‡ªå·±èƒ½æ•æ‰åˆ° try å€å¡Šä¸­çš„ä¾‹å¤–ï¼Œä½†å…¶å¯¦ä¸ç„¶ã€‚ è§£æ±ºæ–¹æ¡ˆæœå‹™æä¾›æ–¹ç¢ºä¿ IDisposable.Dispose() ä¸æ‹‹å‡ºä¾‹å¤–å¦‚æžœè¦å¯¦ä½œ IDisposableï¼Œå¿…é ˆç¢ºä¿ IDisposable.Dispose() æ–¹æ³•ä¸­ä¸æœƒæ‹‹å‡ºä¾‹å¤–ã€‚ (ä¸æŽ¨è–¦) å‘¼å«ç«¯é¿å…ä½¿ç”¨ usingå°±æ˜¯ç”¨æ‰‹å‹•é‡‹æ”¾è³‡æºå–ä»£ usingï¼Œå¦‚ä¸‹ï¼š 12345678910111213var f = new Foo();try&#123; throw new Exception("a");&#125;catch (Exception)&#123; // do something&#125;finally&#123; // release in anther way instead of calling Dispose()&#125; ä¸€èˆ¬ä¾†èªªï¼Œé€™å€‹å•é¡Œæ‡‰è©²æ˜¯æœå‹™æä¾›æ–¹æ‡‰è©²è¦æ³¨æ„çš„ï¼Œæ‰€ä»¥é™¤éžç¢ºå®šæœå‹™æä¾›æ–¹æœ‰é€™å€‹ç¼ºé™·ä¸”æ²’è¾¦æ³•è¦æ±‚æ”¹æ­£ï¼Œä¸ç„¶ä¸æŽ¨è–¦å°‡é€™ç¨®ä½œæ³•ä½œç‚ºé è¨­é¸é …ã€‚ (å¾ˆä¸æŽ¨è–¦) å‘¼å«ç«¯ç”¨å¤šå€‹ try-catch æš´åŠ›è§£å¾ˆä¸æŽ¨è–¦çš„åšæ³•ï¼Œé›–ç„¶ç°¡å–®ä½†å¤ªéŽæš´åŠ›ï¼Œå¾ˆé†œä¸”ç¶­è­·çš„äººå¾ˆå®¹æ˜“è¦ºå¾—é€™æ˜¯å¤šé¤˜çš„è€Œæ‹†æŽ‰å…¶ä¸­ä¸€å€‹ try-catch å€å¡Šã€‚123456789101112131415161718try&#123; using (var f = new Foo()) &#123; try &#123; throw new Exception("a"); &#125; catch (Exception ex) &#123; // do something &#125; &#125;&#125;catch (Exception ex)&#123; // do something else&#125; çµè«–æœƒæƒ³å¯«é€™ç¯‡æ˜¯æºæ–¼é€™å€‹å·²çŸ¥çš„å•é¡Œï¼Œä½†æˆ‘è¦ºå¾—é€™æ˜¯å¾®è»Ÿçš„é‹ï¼Œä¸æ‡‰è©²å› å™Žå»¢é£Ÿè€Œæ”¾æ£„ usingï¼Œä½†è¬ä¸€é‡åˆ°äº†ï¼Œé‚„æ˜¯è¦çŸ¥é“æœ‰é€™å€‹ç¾è±¡ä¾†é¿å…é¬¼æ‰“ç‰†æ‰¾ä¸åˆ°å•é¡Œï¼Œæ‰€ä»¥éœ€è¦ç´€éŒ„ä¸€ä¸‹ä¾†åŠ å¼·å°è±¡ã€‚ åƒè€ƒClose and Abort release resources safely when network connections have dropped]]></content>
      <categories>
        <category>C#</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Hangfire æ­é… Redis æ™‚çš„è³‡æ–™æ¸…ç†æ©Ÿåˆ¶]]></title>
    <url>%2Fcontent%2F20230114-auto-delete-jobs-for-hangfire-with-redis.html</url>
    <content type="text"><![CDATA[Hangfire æ˜¯å¾ˆå¸¸ç”¨çš„å®šæ™‚æŽ’ç¨‹å·¥å…·ï¼Œä»–æœƒå°‡æŽ’ç¨‹å’Œä»»å‹™è³‡è¨Šç´€éŒ„åœ¨è³‡æ–™åº«ä¸­ï¼Œä½†æ˜¯å¦‚æžœä½¿ç”¨ Redis åšè³‡æ–™å„²å­˜æ™‚ï¼Œå°±å¿…é ˆè¬¹æ…Žæ€è€ƒè³‡æ–™æ¸…ç†çš„å•é¡Œï¼Œç•¢ç«Ÿè³‡æ–™å­˜æ”¾åœ¨è¨˜æ†¶é«”ä¸­æ˜¯ä¸å¯èƒ½ä¸åŽ»é™åˆ¶å¤§å°çš„ã€‚ é™åˆ¶è³‡æ–™ç­†æ•¸ä½¿ç”¨ Hangfire.Redis.StackExchange çš„è©±ï¼Œå¯ä»¥é€éŽ RedisStorageOptions ä¸­çš„ SucceededListSize å’Œ DeletedListSize å…©å€‹æ¬„ä½ä¾†é™åˆ¶æˆåŠŸå’Œå·²åˆªé™¤çš„ä»»å‹™çš„åˆ—è¡¨é•·åº¦ï¼Œé¿å…ç„¡é™åˆ¶çš„å¢žé•·ã€‚ ä½†æ˜¯å•é¡Œæ˜¯åœ¨æ–¼å¤±æ•—çš„ä»»å‹™æ€Žéº¼è¾¦? ä¸€é–‹å§‹æ‰¾äº†å¾ˆå¤šç¶²è·¯æ–‡ç« ï¼Œé€šå¸¸éƒ½æ˜¯å»ºè­°ç”¨ Job Filters ä¾†è¨­å®šï¼Œé›–ç„¶çœ‹èµ·ä¾†å¾ˆåˆç†ä½†å¯¦æ¸¬å»ç™¼ç¾å¤±æ•—åˆ—è¡¨ä¸å¯ä»¥æ‰‹å‹•åˆªé™¤ï¼Œæœ€å¾Œæ‰ç™¼ç¾å¯ä»¥é€éŽ AutomaticRetryAttribute ä¾†é”åˆ°ç›®æ¨™ã€‚ é€™å€‹åšæ³•çš„ä¸»è¦é‚è¼¯æ˜¯åœ¨é‡è©¦æ¬¡æ•¸çµæŸå¾Œåˆªé™¤ï¼Œä½¿å¾—ä»»å‹™é€²å…¥å·²åˆªé™¤åˆ—è¡¨ï¼Œè€Œå·²åˆªé™¤åˆ—è¡¨æ˜¯å¯ä»¥è¨­å®šæœ€å¤§é•·åº¦çš„ï¼Œ AutomaticRetryAttribute å¯ä»¥å–®ç¨ç”¨åœ¨éœ€è¦çš„æŽ’ç¨‹ä¸Šï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è¨­å®šåˆ°æ‰€æœ‰æŽ’ç¨‹ï¼Œå¦‚ä¸‹:1234567891011// Startup.cspublic void ConfigureServices(IServiceCollection services)&#123; services .AddHangfire((serviceProvider, config) =&gt; &#123; config .UseFilter(new AutomaticRetryAttribute &#123; Attempts = 0, OnAttemptsExceeded = AttemptsExceededAction.Delete &#125;) ; &#125;)&#125; çµè«–å¤±æ•—åˆ—è¡¨ä¸èƒ½æ‰‹å‹•åˆªé™¤çš„é€™å€‹é™åˆ¶æ»¿åˆç†çš„ï¼Œç•¢ç«Ÿæœ‰é‡è©¦æ©Ÿåˆ¶å­˜åœ¨ï¼Œå¦‚æžœå¯ä»¥æ‰‹å‹•åˆªé™¤é‚£ç­‰æ–¼æ˜¯å’Œé‡è©¦æ©Ÿåˆ¶ç”¢ç”Ÿè¡çªäº†ï¼Œå€’æ˜¯åˆªé™¤å¤±æ•—ä»»å‹™çš„è¨­å®šåœ¨é‡è©¦æ©Ÿåˆ¶çš„è¨­å®šä¸­é€™é»žæ»¿è®“äººæ„å¤–çš„ã€‚ ç„¶å¾Œç¶²è·¯çš„è§£æ³•ä¸èƒ½ç›¡ä¿¡ï¼Œè¦å¯¦é©—éŽæ‰çŸ¥é“èƒ½ä¸èƒ½é‹ä½œã€‚]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[é€éŽ GET ç™¼é€ HTTP Request çš„æ™‚å€™ Uri éŽé•·çš„å•é¡Œ]]></title>
    <url>%2Fcontent%2F20230114-resolve-url-too-long-exception.html</url>
    <content type="text"><![CDATA[å¾ˆå¤šæ™‚å€™æˆ‘å€‘éœ€è¦å¾žå®¢æˆ¶ç«¯å¾žé€éŽ HTTP GET ç™¼é€ Reqeust çµ¦æœå‹™ç«¯ï¼Œä½†åœ¨ä¹‹å‰çš„ä¸€å€‹ ASP.NET Core çš„å°ˆæ¡ˆä¸­å»å› ç‚º Uri éŽé•·è€Œå‡ºç¾äº† Invalid URI: The uri string is too long é€™æ¨£çš„éŒ¯èª¤è¨Šæ¯ã€‚ é€™å€‹å•é¡Œç¶²è·¯ä¸Šå¹¾ä¹Žéƒ½æ˜¯æ”¹ Web Service (ä¾‹å¦‚: IIS) çš„è¨­å®šä¾†è§£æ±ºï¼Œé€™æ˜¯æœ€ç°¡å–®æ–¹ä¾¿çš„æ–¹æ³•ï¼Œä½†å¦‚æžœä¼ºæœå™¨å¾ˆå¤šæˆ–æ˜¯éœ€è¦ç¶“å¸¸æ“´å……ä¼ºæœå™¨æ™‚å°±æœƒé€ æˆä¸å°çš„å›°æ“¾ï¼Œå³ä½¿ä¼ºæœå™¨ä¸å¤šä¹Ÿå¯èƒ½å› ç‚ºé€™äº›ç‘£ç¢Žçš„è¨­å®šé€ æˆç¶­è­·ä¸Šçš„ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥é€™é‚Šæä¾›å¦å¤–ä¸€ç¨®è§£æ±ºæ–¹æ¡ˆã€‚ X-Http-Method-Overrideç·£èµ·X-Http-Method-Override é€™å€‹ Header å…¸åž‹çš„ç”¨æ³•æ˜¯ç”¨æ–¼ç”¨æˆ¶ç«¯å› ç‚ºå„ç¨®é™åˆ¶è€Œç„¡æ³•é…åˆæœå‹™ç«¯çš„è¦æ±‚ä½¿ç”¨ç‰¹å®š HTTP Method æ™‚ï¼Œä»¥é€™ç¯‡æ–‡ç« ç‚ºä¾‹ï¼Œ æœå‹™ç«¯è¦æ±‚çš„æ˜¯ PUT /api/Person/4ï¼Œä½†å®¢æˆ¶ç«¯ç„¡æ³•é…åˆæ™‚ï¼Œå°±å¯ä»¥æ”¹ç”¨ POST /api/Person/4 æ­é… X-Http-Method-Override é€™å€‹ Header (å€¼ç‚º PUT) ä¾†æ”¹è®Šå¯¦éš›ä¸Šçš„ HTTP Methodï¼Œé€™å¯ä»¥ä¸éœ€è¦é·å°±å®¢æˆ¶ç«¯è€Œè®“æœå‹™ç«¯çš„è¨­è¨ˆä¿æŒä¸€è‡´ä¸”åˆç†ã€‚ åˆ©ç”¨é€™å€‹ç‰¹æ€§ï¼Œæˆ‘å€‘å¯ä»¥è©¦è‘—è®“å‘¼å«ç«¯æ”¹ç”¨ HTTP POST ä¾†ç™¼é€ä»¥é¿é–‹ Web Server å° Uri çš„é•·åº¦é™åˆ¶ã€‚ åŒç†ï¼Œå° QueryString çš„é•·åº¦é™åˆ¶ä¹Ÿé©ç”¨ã€‚ å¯¦åšé¦–å…ˆï¼Œå¾žé€™ç¯‡æ–‡ç« æˆ‘å€‘å¯ä»¥çŸ¥é“ ASP.NET Core æœ‰æä¾›ç›¸é—œçš„åŠŸèƒ½ä¾†æ”¯æ´ X-Http-Method-Overrideï¼Œä½†ä»”ç´°çœ‹ UseHttpMethodOverride å’Œ HttpMethodOverrideMiddleware çš„å¯¦åšå¯ä»¥ç™¼ç¾é€™ä¸¦ä¸è¶³ä»¥æ»¿è¶³æˆ‘å€‘çš„éœ€æ±‚ï¼ŒHttpMethodOverrideMiddleware çš„å¯¦åšåªåŒ…å«æ”¹è®Š HTTP Method ä½†ä¸åŒ…å«è™•ç† Body æˆ– QueryStringã€‚ ä½†è‡³å°‘æˆ‘å€‘çŸ¥é“ ASP.NET Core å°æ–¼ X-Http-Method-Override çš„æ”¯æ´æ˜¯é€éŽ Middleware ä¾†å®Œæˆçš„ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è‡ªå·±å¯« Middleware ä¾†é”åˆ°æƒ³è¦çš„æ•ˆæžœã€‚ å»ºç«‹å¦å¤–ä¸€å€‹ Middleware ä¾†è™•ç† Body çš„éƒ¨åˆ†: æ¡†æž¶å…§å»ºçš„éƒ¨ä»½æˆ‘å€‘å°±æ²¿ç”¨å°±å¥½ï¼Œæ‰€ä»¥è‡ªè£½çš„ Middleware åªéœ€è¦è™•ç† Bodyã€‚123456789101112131415161718192021222324252627282930313233343536373839404142public class HttpGetOverrideMiddleware&#123; private const string XHttpMethodOverride = "X-Http-Method-Override"; private readonly RequestDelegate _next; public HttpGetOverrideMiddleware(RequestDelegate next) &#123; _next = next; &#125; public Task Invoke(HttpContext context) &#123; var xHttpMethodOverrideValue = context.Request.Headers[XHttpMethodOverride]; if (HttpMethods.IsGet(xHttpMethodOverrideValue)) &#123; /* pseudo code var body = ReadFromRequestBody(); string anotherQueryString = string.Empty(); if (isJson) &#123; anotherQueryString = ParseBodyFromJsonToQueryString(); &#125; else if (isXml) &#123; anotherQueryString = ParseBodyFromXmlToQueryString(); &#125; else if (whatever) &#123; anotherQueryString = ParseBodyFromWhateverToQueryString(); &#125; context.Request.QueryString += anotherQueryString; ClearBody(); // if possible */ &#125; return _next(context); &#125;&#125; è¨»å†Šä¸¦ä½¿ç”¨: 12345678public class Startup&#123; public void Configure(IApplicationBuilder app) &#123; app.UseHttpMethodOverride(); app.UseMiddleware&lt;HttpGetOverrideMiddleware&gt;(); &#125;&#125; å¦‚ä¸Šæ‰€ç¤ºï¼Œåœ¨ Middleware é‚£ä¸€å±¤å°‡ Body è½‰æ›æˆ QueryString å†ç¹¼çºŒï¼Œé€™æ¨£ä¸€ä¾† Web API çš„è¦æ ¼ä»ç„¶æ˜¯åˆç†çš„ HTTP GETï¼Œ å‘¼å«ç«¯ä¹Ÿå¯ä»¥é€éŽ HTTP POST åŠ ä¸Š X-Http-Method-Override ä¾†å‘¼å«åˆ°åªæ”¯æ´ HTTP GET çš„ APIã€‚ æ³¨æ„äº‹é …: å°‡ Body è½‰æ›ç‚º QueryString çš„éŽç¨‹æœ‰å¾ˆå¤šç‘£ç¢Žçš„ç´°ç¯€è¦è€ƒæ…® å¦‚æžœåŽŸæœ¬çš„ Uri å°±åŒ…å« QueryString çš„è©±(ä¸åˆç†ï¼Œä½†æŠ€è¡“ä¸Šå¯èƒ½ç™¼ç”Ÿ)ä¸èƒ½è¦†è“‹æŽ‰ Body è®€å–å¾Œè¦ä¸è¦æŠŠå…§å®¹æ¸…ç©º? ä¸æ¸…ç©º Body çš„è©±è¦ä¸è¦å…è¨±å¾Œé¢çš„ç¨‹å¼èƒ½é‡è¤‡è®€å– Body? é€™æœƒå½±éŸ¿ Body è®€å–å¾Œè¦ä¸è¦å›žæ² Body è³‡æ–™ç„¡æ³•ç”¨ QueryString å°‡ Body è½‰æ›ç‚º QueryString å¾Œæ•´å€‹ Uri æœƒå¾ˆé•·ï¼Œå¾Œé¢çš„ç¨‹å¼ç›´æŽ¥æ“ä½œæ™‚è¦å°å¿ƒé¿å…å› éŽé•·æ‹‹å‡ºä¾‹å¤–ï¼Œä¾‹å¦‚:new Uri(string) å°±æœ‰æ©Ÿæœƒå› ç‚ºé•·åº¦å¤ªé•·è€Œæ‹‹å‡ºä¾‹å¤–ã€‚ Startup ä¸­å‘¼å« UseHttpMethodOverride() å’Œè¨»å†Š HttpGetOverrideMiddleware çš„é †åºï¼Œèª°å…ˆèª°å¾Œæ¯”è¼ƒåˆç†? çµè«–é€™å€‹åšæ³•çœ‹èµ·ä¾†æœ‰é»žæš´åŠ›ï¼Œä½†å› ç‚º ASP.NET Core ä¹Ÿæ˜¯ç”¨é€™æ¨£çš„æ–¹å¼æ”¯æ´ X-Http-Method-Override çš„ï¼Œæ‰€ä»¥å°±è·Ÿéš¨åŽŸæœ‰çš„åšæ³•ä¸‹åŽ»æ“´å……äº†ã€‚ å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ ASP.NET Core çš„å¾ˆå¤šåŠŸèƒ½ (ä¾‹å¦‚: Health checks) èƒŒå¾Œå…¶å¯¦éƒ½æ˜¯å°è£ Middleware å¾Œæä¾›ä¸€å€‹è¼ƒæ˜“ç”¨æˆ–å¯è®€æ€§è¼ƒé«˜çš„ APIï¼ŒçŸ¥é“é€™é»žå¾Œä¹Ÿèƒ½äº†è§£å¾ˆå¤šé¡žä¼¼çš„åŠŸèƒ½éƒ½å¯ä»¥ç”¨ Middleware ä¾†å¯¦ç¾ï¼Œåªè¦å°å¿ƒä¸è¦å¼„éŒ¯åŸ·è¡Œé †åºçš„è©±æ˜¯å¾ˆå¥½ç”¨çš„ã€‚ åƒè€ƒHTTP PUT or DELETE not allowed? Use X-HTTP-Method-Override for your REST Service with ASP.NET Web API HttpMethodOverrideMiddleware.cs HttpMethodOverrideExtensions.cs]]></content>
      <categories>
        <category>C#</category>
        <category>.NET Core</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[é¿å…åœ¨éœ€è¦ä½¿ç”¨ EF Core çš„ç’°å¢ƒæ“´å…… IEnumerable< T >]]></title>
    <url>%2Fcontent%2F20221115-do-not-let-extension-methods-of-generic-ienumerable-work-with-efcore.html</url>
    <content type="text"><![CDATA[æ“´å……æ–¹æ³•æ˜¯å¾ˆå¸¸ç”¨çš„æŠ€å·§, ä¹‹å‰åœ¨ä½¿ç”¨ Entity Framework Core çš„æ™‚å€™, æ“´å……äº†ä¸€å€‹ IQueryable&lt;T&gt; çš„æ“´å……æ–¹æ³• WhereIf(), å¾Œä¾†æƒ³èªªé€™å€‹æ–¹æ³•ä¹Ÿé©ç”¨æ–¼å…¶ä»–è¡ç”Ÿè‡ª IEnumerable&lt;T&gt; çš„åž‹åˆ¥, ä¸” IQueryable&lt;T&gt; ç¹¼æ‰¿äº† IEnumerable&lt;T&gt;, æ‰€ä»¥æŠŠ WhereIf() æ–¹æ³•æ”¹æˆ IEnumerable&lt;T&gt; çš„æ“´å……æ–¹æ³•ä»¥æ±‚æ›´å»£çš„é©ç”¨ç¯„åœ, æ²’æƒ³åˆ°ä¸€åˆ‡éƒ½ä¸ä¸€æ¨£äº†, è¦æ˜¯ç•¶æ™‚æ²’åŠæ™‚ç™¼ç¾å°±å¼•çˆ†äº†ä¸€å€‹æ•ˆèƒ½æ ¸å½ˆäº†. é›–ç„¶æ¨™é¡Œæ˜¯å¯« Entity Framework Core, ä½† IQueryable&lt;T&gt; æœ¬ä¾†å°±æ˜¯è¨­è¨ˆçµ¦â€è³‡æ–™æŸ¥è©¢â€çš„æƒ…å¢ƒä¾†èªª, å…¶ä»– ORM å…«ä¹ä¸é›¢åæœƒé‡åˆ°ä¸€æ¨£çš„ç¾è±¡. å•é¡Œæè¿°ä»¥ä¸‹é¢çš„ç¨‹å¼ç¢¼ç‚ºç¯„ä¾‹ä¾†èªªæ˜Ž: 123var adults = _dbContext.Set&lt;Person&gt;() // DbSet&lt;Person&gt; .Where(r =&gt; r.Age &gt;= 18) // Append condition, IQueryable&lt;Person&gt; .ToList(); // Query æˆ‘å€‘çŸ¥é“åœ¨ ToList() è¢«å‘¼å«å‰çš„è¡Œç‚ºéƒ½åªæ˜¯åœ¨çµ„åˆæŸ¥è©¢æ¢ä»¶, ä¸æœƒçœŸæ­£åŽ»æŸ¥è³‡æ–™, åŸºæ–¼é€™å€‹å‰æå¦‚ä¸€é–‹å§‹æè¿°æ“´å……ä¸€å€‹ IEnumerable&lt;T&gt; çš„æ“´å……æ–¹æ³• WhereIf(...) ä¾†æ–¹ä¾¿ä½¿ç”¨, å¦‚ä¸‹: 1234567891011121314151617public static class EnumerableExtensions&#123; public static IEnumerable&lt;T&gt; WhereIf&lt;T&gt;(this IEnumerable&lt;T&gt; query, Func&lt;T, bool&gt; predicate, bool shouldAppendWhere) &#123; if (shouldAppendWhere) &#123; return query.Where(predicate); &#125; return query; &#125;&#125;var adults = _dbContext.Set&lt;Person&gt;() .WhereIf(r =&gt; r.Gender == condition.Gender.Value, condition.Gender.HasValue) // Optional filter .Where(r =&gt; r.Age &gt;= 18) .ToList(); é›–ç„¶åŸ·è¡Œçµæžœæ²’éŒ¯, ä½†é€™æ¨£åšæœƒæœ‰å€‹å¾ˆåš´é‡çš„å•é¡Œ, ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªª, ç•¶ WhereIf(...) è¢«å‘¼å«æ™‚æœƒå¾žè³‡æ–™ä¾†æºæŸ¥è©¢è³‡æ–™, ä»¥ Oracle ä¾†èªªå°±æ˜¯åŸ·è¡Œäº† SELECT * FROM PERSON çš„æŸ¥è©¢å°‡ Person è³‡æ–™è¡¨çš„ æ‰€æœ‰è³‡æ–™ æœå°‹å‡ºä¾†å¾Œæ‰åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­åšå¾ŒçºŒçš„ç¯©é¸å’Œè™•ç†. ç‚ºä»€éº¼æœƒæœ‰é€™å€‹ç¾è±¡?å…¶å¯¦å¾ž IQeueryable&lt;T&gt; å’Œ IEnumerable&lt;T&gt; çš„ç”¨é€”èˆ‡å·®åˆ¥å¤§æ¦‚å°±èƒ½æŽ¨æ¸¬å‡ºæœƒæœ‰é€™æ¨£çš„çµæžœäº†, ä¸éŽå‡ºæ–¼å¥½å¥‡é‚„æ˜¯ç¨å¾®å¯¦é©—ä¸€ä¸‹çœ‹æœƒä¸æœƒæœ‰æ›´æ˜Žç¢ºçš„ç­”æ¡ˆ. å¯¦é©—ç¨‹å¼ç¢¼å¦‚ä¸‹:1234567891011121314151617181920212223242526272829303132333435363738public static IEnumerable&lt;T&gt; WhereIf&lt;T&gt;(this IEnumerable&lt;T&gt; query, Func&lt;T, bool&gt; predicate, bool shouldAppendWhere)&#123; if (shouldAppendWhere) &#123; return query.Where(predicate); &#125; return query;&#125;public class MyQueryable&lt;T&gt; : IQueryable&lt;T&gt;&#123; public Type ElementType =&gt; typeof(T); public Expression Expression =&gt; default; public IQueryProvider Provider =&gt; default; public IEnumerator&lt;T&gt; GetEnumerator() &#123; throw new NotImplementedException("a"); &#125; IEnumerator IEnumerable.GetEnumerator() &#123; throw new NotImplementedException("b"); &#125;&#125;IEnumerable&lt;int&gt; query1 = new MyQueryable&lt;int&gt;().WhereIf(r =&gt; r &gt; 10, true);IEnumerable&lt;int&gt; query2 = new MyQueryable&lt;int&gt;().WhereIf(r =&gt; r &gt; 10, false);"Correct here.".Dump();// NotImplementedException("a")query1.Dump();// NotImplementedException("b")query2.Dump(); ç¶“éŽå¯¦é©—, å¯ä»¥çœ‹åˆ°æœ‰åŠ å…¶ä»–æ¢ä»¶å’Œç›´æŽ¥è½‰åž‹çš„æƒ…å¢ƒæœƒåˆ†åˆ¥å‘¼å«åˆ°å…©å€‹ä¸åŒçš„ GetEnumerator() æ–¹æ³•, ç¿»äº†ä¸€ä¸‹ Entity Framework Core çš„åŽŸå§‹ç¢¼å¯ä»¥ç™¼ç¾ InternalDbSet ä¸­çš„å…©å€‹ GetEnumerator() æ–¹æ³•çš„å¯¦ä½œ æœ€å¾Œéƒ½æœƒå‘¼å«åˆ° CreateEntityQueryable() æ–¹æ³•ä¸”å›žå‚³ä¸€å€‹ EntityQueryable&lt;T&gt; åž‹åˆ¥çš„ç‰©ä»¶, æŽ¥è‘—å¾ž EntityQueryable ä¸­ç›¸é—œçš„æ–¹æ³• çš„å¯¦ä½œå¤§æ¦‚å°±å¯ä»¥æŽ¨æ¸¬åˆ°æœƒåŽ»åŸ·è¡ŒæŸ¥è©¢äº†. ä¹Ÿå°±æ˜¯èªª, åªè¦è§¸ç™¼ GetEnumerator() æ–¹æ³•çš„å‘¼å«, å°±æœƒå¼•ç™¼è³‡æ–™æŸ¥è©¢. é€™éƒ¨åˆ†é€™æ¨£æŽ¨æ¸¬æ˜¯æ¯”è¼ƒç²—ç³™çš„ä½œæ³•, åš´æ ¼ä¾†èªªæ‡‰è©²æ˜¯è¦æ‰¾åˆ°çœŸçš„åŽ»åŸ·è¡Œçš„ç¨‹å¼ç¢¼æ‰èƒ½è­‰å¯¦, ä½†å› ç‚ºå¯¦æ¸¬å·²ç¶“çŸ¥é“çµæžœäº†, åŠ ä¸Šæ‡¶å¾—åœ¨å®¶å»ºç«‹å®Œæ•´çš„ç’°å¢ƒè¿½è¹¤, æ‰€ä»¥å°±æ²’å …æŒè¦æ‰¾åˆ°æœ€åº•å±¤. è§£æ±ºæ–¹æ¡ˆæ–¹æ¡ˆä¸€ : åŒæ™‚æ“´å…… IQueryable&lt;T&gt; å’Œ IEnumerable&lt;T&gt;å¦‚ä¸‹ç¯„ä¾‹:123456789101112131415161718192021222324252627282930public static class QueryableExtensions&#123; public static IQueryable&lt;T&gt; WhereIf&lt;T&gt;(this IQueryable&lt;T&gt; query, Expression&lt;Func&lt;T, bool&gt;&gt; predicate, bool shouldAppendWhere) &#123; if (shouldAppendWhere) &#123; return query.Where(predicate); &#125; return query; &#125;&#125;public static class EnumerableExtensions&#123; public static IEnumerable&lt;T&gt; WhereIf&lt;T&gt;(this IEnumerable&lt;T&gt; query, Func&lt;T, bool&gt; predicate, bool shouldAppendWhere) &#123; if (shouldAppendWhere) &#123; return query.Where(predicate); &#125; return query; &#125;&#125;var adults = _dbContext.Set&lt;Person&gt;() .WhereIf(r =&gt; r.Gender == condition.Gender.Value, condition.Gender.HasValue) // Optional filter .Where(r =&gt; r.Age &gt;= 18) .ToList(); é›–ç„¶åŒæ™‚æ“´å…… IQueryable&lt;T&gt; å’Œ IEnumerable&lt;T&gt; å¯ä»¥è§£æ±ºå•é¡Œ, ä½†é€™æœ‰å¹¾å€‹ç¼ºé»ž: å› ç‚º DbSet&lt;T&gt; å¯¦ä½œäº† IQueryable&lt;T&gt;, è€Œ IQueryable&lt;T&gt; ç¹¼æ‰¿äº† IEnumerable&lt;T&gt;, æ‰€ä»¥ç·¨è­¯æ™‚å„ªå…ˆä½¿ç”¨ IQueryable&lt;T&gt; çš„æ“´å……æ–¹æ³•, é›–ç„¶ç¬¦åˆé æœŸ, ä½†å®Œå…¨ä¾è³´æ–¼ç·¨è­¯æ™‚çš„å„ªå…ˆé †åº, éžå¸¸éš±æ™¦. è€ƒæ…®åˆ°æ­é…é¸æ“‡æ€§å¼•æ•¸ (Optional Arguments) ä½¿ç”¨æ™‚, å¾ˆå®¹æ˜“åœ¨ç„¡æ„é–“å› ç‚ºä¸€é»žå°æ”¹å‹•è€Œå°Žè‡´ä½¿ç”¨äº† IEnumerable&lt;T&gt; çš„æ“´å……æ–¹æ³•è€Œæ²’ç™¼ç¾. è¬ä¸€ç¶­è­·éŽç¨‹å°‡ IQueryable&lt;T&gt; çš„æ“´å……æ–¹æ³•ç§»é™¤æˆ–é‡æ–°å‘½å, å‘¼å«ç«¯é‚„æ˜¯å¯ä»¥æ­£ç¢ºç·¨è­¯çš„, ä½†æœƒè®Šæˆå‘¼å«äº† IEnumerable&lt;T&gt; çš„æ“´å……æ–¹æ³•, è€Œä¸”å¾ˆé›£æ„è­˜åˆ°é€™å€‹å•é¡Œ. é€™æ˜¯å€‹æœ‰ç”¨ä¸”æ”¯æ´ç¯„åœå»£ä½†éœ€è¦è¬¹æ…Žç¶­è­·çš„è§£æ±ºæ–¹æ¡ˆ, é©åˆéžå¸¸åš´è¬¹çš„åœ˜éšŠ. äº‹å¯¦ä¸Š, dotnet runtime å°±æ˜¯åŒæ™‚åšäº† IEnumerable&lt;T&gt; ç‰ˆæœ¬çš„ Where() æ“´å……æ–¹æ³• å’Œ IQueryable&lt;T&gt; ç‰ˆæœ¬çš„ Where() æ“´å……æ–¹æ³• æ–¹æ¡ˆäºŒ : åªæ“´å…… IQueryable&lt;T&gt;å¦‚ä¸‹ç¯„ä¾‹:1234567891011121314151617public static class QueryableExtensions&#123; public static IQueryable&lt;T&gt; WhereIf&lt;T&gt;(this IQueryable&lt;T&gt; query, Expression&lt;Func&lt;T, bool&gt;&gt; predicate, bool shouldAppendWhere) &#123; if (shouldAppendWhere) &#123; return query.Where(predicate); &#125; return query; &#125;&#125;var adults = _dbContext.Set&lt;Person&gt;() .WhereIf(r =&gt; r.Gender == condition.Gender.Value, condition.Gender.HasValue) // Optional filter .Where(r =&gt; r.Age &gt;= 18) .ToList(); é€™æ¨£åšä¸å®¹æ˜“å‡ºéŒ¯, ä½†ä¹Ÿæœ‰ä¸€å€‹ç¼ºé»ž - å°æ–¼è¡ç”Ÿè‡ª IEnumerable&lt;T&gt; çš„åž‹åˆ¥ä¸å‹å–„. ä»¥ä¸‹é¢ç¯„ä¾‹ä¾†èªª, éœ€è¦é€éŽ AsQueryable() æ–¹æ³•è½‰åž‹å¾Œæ‰èƒ½ä½¿ç”¨.123456var dataSource = new List&lt;Person&gt;();var adults = dataSource .AsQueryable() .WhereIf(r =&gt; r.Gender == condition.Gender.Value, condition.Gender.HasValue) // Optional filter .Where(r =&gt; r.Age &gt;= 18) .ToList(); æ˜¯å€‹æ”¯æ´ç¯„åœæ¯”è¼ƒçª„, ä½†æ˜¯ç¶­è­·é¢¨éšªè¼ƒä½Žçš„åšæ³•, é©åˆç„¡æ³•ä¿è­‰è¬¹æ…Žç¶­è­·çš„å°ˆæ¡ˆ. çµè«–æ•´é«”ä¾†èªª, å¦‚æžœå¯èƒ½æœƒè¢«ä»»ä½•éœ€è¦ ORM çš„ç”¨æˆ¶ç«¯ç¨‹å¼å‘¼å«åˆ°, å„ªå…ˆé¿å…åš IEnumerable&lt;T&gt; çš„æ“´å……æ–¹æ³•, çœŸçš„éœ€è¦çš„è©±è¦è€ƒæ…®å¦‚æžœæœƒè¢« IQueryable&lt;T&gt; çš„è¡ç”Ÿé¡žåˆ¥å‘¼å«åˆ°å°±å¿…é ˆé€£åŒ IQueryable&lt;T&gt; çš„æ“´å……æ–¹æ³•ä¸€èµ·åš. é‚„å¥½åœ¨ç¢ºèª ORM ç”¢ç”Ÿçš„ SQL Script å…§å®¹æ™‚å°±å³æ™‚ç™¼ç¾, ä¸ç„¶ç­‰åˆ°ä¸Š production æ‰çˆ†ç™¼å°±çœŸçš„å¾ˆé›£æ‰¾åˆ°é€™éº¼éš±æ™¦çš„å•é¡Œä¾†æºäº†.]]></content>
      <categories>
        <category>C#</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[é ç«¯é€£ç·šæ™‚æ”¯æ´"éƒ¨ä»½å¤šèž¢å¹•"]]></title>
    <url>%2Fcontent%2F20220925-use-some-of-monitors-for-remote.html</url>
    <content type="text"><![CDATA[ä½¿ç”¨ Windows å…§å»ºçš„é ç«¯é€£ç·šå·¥å…· (Remote Desktop Connection) å¦‚æžœéœ€è¦æ”¯æ´é›™èž¢å¹•çš„è©±éœ€è¦åšä¸€äº›è¨­å®šï¼Œé€™äº›ç¶²è·¯ä¸Šè³‡æºå¾ˆå¤šæ²’ä»€éº¼å¥½èªªçš„ã€‚ ä½†æ˜¯å¦‚æžœæ˜¯æƒ³è¦åªä½¿ç”¨ä¸‰å€‹èž¢å¹•ä¸­çš„å…¶ä¸­å…©å€‹èž¢å¹•å‘¢? æ‰‹å‹•ç·¨è¼¯ .rdp æª”æ¡ˆRDP çš„åœ–å½¢åŒ–ä»‹é¢æ²’æœ‰æä¾›éƒ¨åˆ†å¤šèž¢å¹•çš„è¨­å®šï¼Œåªèƒ½å°‡ *.rdp æª”æ¡ˆç”¨æ–‡å­—ç·¨è¼¯å™¨æ‰“é–‹å¾Œç·¨è¼¯ã€‚ å¢žåŠ è¨­å®šå¦‚ä¸‹:12use multimon:i:1selectedmonitors:s:0,1 æ„æ€æ˜¯æ”¯æ´å¤šèž¢å¹•ï¼Œç„¶å¾Œå¥—ç”¨åˆ° 0ã€1 å…©å€‹èž¢å¹•ï¼Œä¸ç¢ºå®š 0ã€1 æ€Žéº¼ç·¨è™Ÿçš„ï¼Œä½†æ˜¯è¦ç”¨çš„æ™‚å€™è©¦ä¸€ä¸‹å°±å¥½ä¹Ÿå°±ä¸ä»”ç´°è¿½ç©¶äº†ã€‚ çµè«–å¾ˆç©ºè™›çš„ä¸€ç¯‡ï¼Œä½†æ˜¯ä¸æ˜¯å¤ªç†±é–€çš„å•é¡Œä¸æƒ³ä¹‹å¾Œéœ€è¦åˆè¦åˆ°è™•æ‰¾æ‰€ä»¥é‚„æ˜¯éš¨æ‰‹ç´€éŒ„ä¸€ä¸‹ã€‚ åƒè€ƒremote desktop connection on 2 out of 3 monitors]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨æœ¬æ©Ÿä¸Šå»ºç«‹ NuGet å„²å­˜åº«]]></title>
    <url>%2Fcontent%2F20220924-local-nuget-package-repository.html</url>
    <content type="text"><![CDATA[æœ€è¿‘çš„ä¸€å€‹å¤§å°ˆæ¡ˆå‰›å¥½æœ‰æ©Ÿæœƒé‡æ–°æ‰“é€ åŸºç¤Žå»ºè¨­ï¼Œæ–¼æ˜¯ä¾¿å°‡å¸¸ç”¨èˆ‡å„ç¨®æ“´å……åŠŸèƒ½åšæˆå¥—ä»¶ç™¼ä½ˆåˆ°å…§éƒ¨çš„ NuGet å„²å­˜åº«ï¼Œä½†æœ‰ä¸€å€‹å•é¡Œæ˜¯å› ç‚ºå¥—ä»¶ä¸Šå‚³å¾Œå°±ä¸æ‡‰è©²å†é‡æ–°ä½ˆç½²åŒä¸€å€‹ç‰ˆæœ¬ï¼Œå¦‚æžœæ–°çš„å¥—ä»¶é–‹ç™¼åˆæœŸæœ‰é »ç¹çš„è¨­è¨ˆè®Šæ›´æœƒç¶“å¸¸å¼•ç™¼ breaking changeï¼Œé€ æˆç‰ˆæœ¬è™Ÿå¢žåŠ çš„å¾ˆå¿«ï¼Œå³ä¾¿ä¸æ˜¯è¨­è¨ˆè®Šæ›´ï¼Œä¸€æœ‰å° bug æˆ–æ˜¯å°è®Šæ›´å°±æ€¥è‘—è·‘æµç¨‹ç™¼æ–°ç‰ˆä¹Ÿæ˜¯å¾ˆæµªè²»æ™‚é–“ã€‚ æ‰€ä»¥å°±æœ‰äº†ä¸€å€‹æƒ³æ³•ï¼Œå¦‚æžœèƒ½åœ¨æœ¬æ©Ÿä¸Šå»ºç«‹ NuGet å¥—ä»¶å„²å­˜åº«ï¼Œé€™æ¨£å°±èƒ½å…ˆåœ¨æœ¬æ©Ÿä¸Šè©¦ç”¨ç¢ºèªè¨­è¨ˆé©ç•¶ä¸”å“è³ªå¤ å¥½ï¼Œå†å°‡æ­£å¼ç‰ˆç™¼ä½ˆåˆ°çœŸæ­£çš„ NuGet å„²å­˜åº«ä¸Šã€‚ åœ¨æœ¬æ©Ÿä¸Šå»ºç«‹ NuGet å„²å­˜åº«å…¶å¯¦å¾ˆç°¡å–®ï¼Œç”¨ Visual Studio é–‹ç™¼çš„è©±å¹¾å€‹æ­¥é©Ÿå°±å¥½äº†: æ‰“é–‹ NuGet Package ç®¡ç†ä»‹é¢ ä¾ç…§ä¸‹åœ–æ­¥é©ŸæŒ‡å®šè³‡æ–™å¤¾ æœ€å¾Œåªè¦å°‡åŒ…å¥½çš„ *.nupkg æª”æ¡ˆæ”¾åˆ°è³‡æ–™å¤¾ä¸­ï¼Œå°±èƒ½å¾ž NuGet Package ç®¡ç†ä»‹é¢ä¸‹è¼‰äº†ã€‚ NuGet ä¸‹è¼‰å¾Œçš„å„²å­˜ä½ç½®å¦‚æžœå¾žæœ¬æ©Ÿé–‹ç™¼ï¼Œç‰ˆè™Ÿéƒ¨åˆ†å¯ä»¥å¾Œç¶´å€‹ -local-v1 (é€™éƒ¨åˆ†éš¨è®ŠåŠ å¾Œç¶´æ˜¯å› ç‚ºæ˜¯æœ¬æ©Ÿè‡¨æ™‚ç‰ˆä¸æœƒçœŸçš„ä¸Šç·šï¼Œæ­£å¼ç‰ˆè¦æœ‰åš´è¬¹çš„å®šç‰ˆè¦å‰‡)ï¼Œé€™æ¨£å°±å¯ä»¥é »ç¹ä¿®æ”¹ç›´åˆ°ç¢ºå®šè¦ç™¼è¡Œå¾Œå†ä¸Šç·šï¼Œä½†é€™æ¨£ç¼ºé»žå°±æ˜¯æœƒç•™ä¸€å¤§å †è‡¨æ™‚ç‰ˆçš„è³‡æ–™åœ¨æœ¬æ©Ÿä¸Šï¼Œè®“äººè¦ºå¾—å¾ˆç¤™çœ¼ã€‚ é€™æ™‚å€™å°±å¯ä»¥å¾ž %USERPROFILE%\.nuget\packages (æˆ‘é€™é‚Šå®Œæ•´è·¯å¾‘æ˜¯ C:\Users\{user}\.nuget\packages) ä¸­æ‰¾åˆ°ä¸‹è¼‰ä¾†çš„å¥—ä»¶ï¼Œå¯ä»¥é–‹ç™¼å®Œå¾Œé †æ‰‹æ¸…ä¸€ä¸‹è‡¨æ™‚ç‰ˆçš„è³‡æ–™ï¼Œå…å¾—ç•™ä¸€å †åžƒåœ¾ä½”ç©ºé–“ã€‚ å…¶å¯¦ä¸€é–‹å§‹æ˜¯æ¯å€‹è‡¨æ™‚ç‰ˆéƒ½æ˜¯ç”¨ä¸€æ¨£çš„ç‰ˆè™Ÿï¼Œç„¶å¾Œå†æ‰‹å‹•åˆ°ä¸‹è¼‰è³‡æ–™å¤¾ä¸­æ¸…æŽ‰èˆŠçš„é‡æ–°ä¸‹è¼‰ä¸€æ¬¡ï¼Œä½†æ˜¯ç•¢ç«Ÿä¸æ˜¯æ­£å¸¸çš„æ“ä½œæ–¹å¼ï¼Œè€Œä¸”å¸¸å¸¸é€™æ¨£åšä¹Ÿæ˜¯å¾ˆç¹ç‘£ï¼Œæ‰€ä»¥é‚„æ˜¯ç”¨ä¸åŒçš„ç‰ˆè™Ÿæ¯”è¼ƒå¥½ï¼Œç­‰æ­£å¼ç‰ˆè¦ä¸Šå‰å†åŽ»æ¸…åžƒåœ¾å°±å¥½äº†ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿèƒ½é¤Šæˆä¸é‡è¦†ç™¼è¡Œç›¸åŒç‰ˆæœ¬å¥—ä»¶çš„æ­£ç¢ºç¿’æ…£ã€‚]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¾å­—ä½ (grapheme) è™•ç†å­—ä¸² (2)]]></title>
    <url>%2Fcontent%2F20220828-grapheme-cluster-string-2.html</url>
    <content type="text"><![CDATA[å‰é™£å­åœ¨ ä¾å­—ä½ (grapheme) è™•ç†å­—ä¸² é€™ç¯‡æ–‡ç« ä¸­æœ‰ä»¥è¶Šå—æ–‡ç‚ºä¾‹æåˆ° grapheme çš„å•é¡Œï¼Œå¾Œä¾†è¦ºå¾— TextElementEnumerator æä¾›çš„æ–¹æ³•ä¸å¤ å¤šï¼Œæ‰€ä»¥åŸºæ–¼ä»–å¦å¤–å°è£äº†ä¸€å€‹ä»¿ String çš„é¡žåˆ¥ï¼ŒæŠ˜é¨°äº†å¹¾å¤©å¸¸ç”¨çš„éƒ½å¯«å¾—å·®ä¸å¤šäº†æ‰ç™¼ç¾ç¹žé è·¯åšäº†ä¸å°‘åŽŸæœ¬ string å°±æœ‰æä¾›çš„åŠŸèƒ½ã€‚ ä¸»è¦å•é¡Œä¸»è¦å•é¡Œæ˜¯å› ç‚º unicode çš„å¹¾ç¨®ä¸åŒçš„æ¨™æº–åŒ–æ ¼å¼ï¼Œå°Žè‡´å­—é¢ä¸Šä¸€æ¨£çš„å­—å…¶å¯¦æ˜¯ä¸åŒçš„å…§å®¹ï¼Œé€ æˆå­—ä¸²åœ¨æ¯”å°çš„æ™‚å€™ (== é‹ç®—å­) æœƒèªç‚ºé›™æ–¹æ˜¯ä¸åŒçš„å­—ã€‚ é—œæ–¼æ¨™æº–åŒ–æ ¼å¼å°±æ”¾é€£çµåœ¨é€™é‚Šå°±å¥½ï¼Œè¦çœ‹å†æ…¢æ…¢çœ‹: UNICODE NORMALIZATION FORMS Unicode Normalization æ–‡å­—æ¨™æº–åŒ– è§£æ±ºæ–¹æ¡ˆStringå…¶å¯¦ String æä¾›çš„ä¸å°‘æ–¹æ³•å°±æœ‰åŒ…å«åˆ°é€™å€‹å•é¡Œï¼Œé€šå¸¸é€éŽæ–¹æ³•ä¸­çš„ StringComparison æˆ– CultureInfo åƒæ•¸ä¾†åšã€‚ String.Normalize(...)é€™å€‹æ–¹æ³•å¯ä»¥å°‡å­—ä¸²è½‰ç‚ºç‰¹å®šçš„æ¨™æº–åŒ–æ ¼å¼ï¼Œè½‰æ›å¾Œå¯ä»¥ç›´æŽ¥æ¯”å°å­—ä¸²ä¸éœ€è¦è€ƒæ…®æ ¼å¼å•é¡Œ é¿å…ç”¨ String.Normalize(...) åšå­—ä¸²å–ä»£å¾Œè¼¸å‡ºï¼Œè½‰åŒ–å¾Œçš„å…§å®¹å’Œè¼¸å…¥å…§å®¹ä¸åŒé€™æ¨£åšå®¹æ˜“å‡ºæ„å¤–ï¼Œä¾‹å¦‚: é æœŸæ²’æœ‰è¦å–ä»£çš„å…§å®¹å»è¢«è½‰åŒ–æˆä¸åŒçš„æ ¼å¼å¾Œè¼¸å‡ºã€‚ ç”¨ TextElementEnumeratoré€™å°±å’Œä¹‹å‰é‚£ç¯‡ä¸€æ¨£äº†ã€‚ çµè«–å„ªå…ˆä½¿ç”¨ string æä¾›çš„æ–¹æ³•ï¼ŒåŒ…å« String.Normalize(...)ï¼Œå…©è€…éƒ½ä¸åˆç”¨æ™‚å†è€ƒæ…® TextElementEnumeratorï¼Œä¸è¦ä¸€é–‹å§‹å°±ç¹žé è·¯ã€‚ åƒè€ƒChar objects and Unicode characters UNICODE NORMALIZATION FORMS Unicode Normalization æ–‡å­—æ¨™æº–åŒ–]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ RoslynPad ä¸­ä½¿ç”¨ MeasureIt åšåŸºæº–æ¸¬è©¦ (benchmarking)]]></title>
    <url>%2Fcontent%2F20220818-use-measureit-in-roslynpad-for-benchmarking.html</url>
    <content type="text"><![CDATA[BenchmarkDotNet æ˜¯ä¸€å€‹å¾ˆç†±é–€çš„å·¥å…·å¯ä»¥ç”¨ä¾†ç°¡å–®çš„é‡æ¸¬èˆ‡æ¯”è¼ƒç¨‹å¼ç¢¼çš„æ•ˆèƒ½ï¼Œä½†æ˜¯æœ‰æ™‚å€™æˆ‘å€‘åªæ˜¯æƒ³è¦å¿«é€Ÿæ¸¬è©¦ä¸€æ®µç¨‹å¼ç¢¼çš„åŸ·è¡Œæ™‚é–“ï¼Œé€™æ™‚å€™é‚„è¦é–‹ IDE ä½¿ç”¨ BenchmarkDotNet å°±è¦ºå¾—æœ‰é»žåŽšé‡ (é™¤éž BenchmarkDotNet å°ˆæ¡ˆå·²ç¶“å»ºå¥½åœ¨æ–¹æ¡ˆä¸­å¯ä»¥ä¸€é‚Šé–‹ç™¼ä¸€é‚Šå¯¦é©—)ã€‚ é€™æ™‚å€™å°±æƒ³è¦åœ¨ RoslynPad æˆ– LinqPad ä¸­ä½¿ç”¨åŸºæº–æ¸¬è©¦å·¥å…·ï¼Œååå› ç‚º RoslynPad çš„é™åˆ¶è€Œç„¡æ³•æ”¯æ´ BenchmarkDotNetï¼Œæ‰€ä»¥åªèƒ½å¦å¤–æ‰¾ä¸€å€‹æ›¿ä»£æ–¹æ¡ˆ - MeasureItã€‚ ä½¿ç”¨æ–¹å¼ç¯„ä¾‹123456789101112131415161718192021222324252627282930313233#r &quot;nuget:MeasureIt.exe/0.2.2&quot;using PerformanceMeasurement;var cost = LinqPadUX.Measure.Action(new Action(() =&gt;&#123; string s = string.Empty; for (var i = 0; i &lt; 1000; i++) &#123; s += i.ToString(); &#125;&#125;)).Dump();var costComparison = LinqPadUX.Measure.NamedActions(new List&lt;NamedAction&gt;()&#123; new NamedAction(&quot;string&quot;, () =&gt; &#123; string s = string.Empty; for (var i = 0; i &lt; 1000; i++) &#123; s += i.ToString(); &#125; &#125;), new NamedAction(&quot;stringBuilder&quot;, () =&gt; &#123; var sb = new StringBuilder(); for (var i = 0; i &lt; 1000; i++) &#123; sb.Append(i.ToString()); &#125; var s = sb.ToString(); &#125;)&#125;).Dump(); çµè«–æ²’ä»€éº¼é›£åº¦ï¼Œä½†æ˜¯æ²’è¨˜ä¸€ä¸‹çš„è©±å¾ˆå¿«å°±å¿˜äº†ï¼Œå°¤å…¶é€™å€‹æ›¿ä»£æ–¹æ¡ˆä¸ç®—ç†±é–€ï¼Œæ²’æœ‰å¾ˆå¥½æ‰¾ã€‚ é€™å€‹å·¥å…·çš„åŠŸèƒ½æ¯”è¼ƒç²¾ç°¡ï¼Œå¦‚æžœçœŸçš„è¦è¤‡é›œçš„åˆ†æžé‚„æ˜¯ BenchmarkDotNet æ¯”è¼ƒè±å¯Œã€‚ åƒè€ƒSupport BenchmarkDotNet Run time costs of small operations in C#]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ Model Binding å¾Œè®€å– Request.Body çš„å…§å®¹]]></title>
    <url>%2Fcontent%2F20220626-read-form-body-after-model-binding.html</url>
    <content type="text"><![CDATA[ä¸€èˆ¬ä¾†èªªåœ¨ WebAPI çš„å°ˆæ¡ˆä¸­, æˆ‘å€‘æœƒåå¥½ä½¿ç”¨ Model Binding çš„æ©Ÿåˆ¶ä¾†ç¶å®šè«‹æ±‚å…§å®¹, ä½†æ˜¯ä¹‹å‰åœ¨ä¸€å€‹ç‰¹æ®Šéœ€æ±‚ä¸Šå»é‡åˆ°åœ¨ Model Binding å¾Œä»ç„¶è¦è®€å– Request.Body (åž‹åˆ¥æ˜¯ Stream) çš„å…§å®¹. è€Œå•é¡Œåœ¨æ–¼, Form Post çš„æƒ…å¢ƒä¸­, åœ¨Model Binding å¾Œ (åœ¨ Action ä¸­) è®€å–Request.Body æ™‚æœƒå¾—åˆ°ç©ºçš„å…§å®¹, ä½†æ˜¯è³‡æ–™é•·åº¦åˆæ˜¯æ­£ç¢ºçš„ (è€Œç¥žå¥‡çš„æ˜¯ JSON å’Œ XML æƒ…å¢ƒæ˜¯æ²’å•é¡Œçš„). é€™é‚Š Form Post, JSON å’Œ XML æƒ…å¢ƒæ˜¯ä¾ Content-Type é€™å€‹ Header ä¾†åˆ†è¾¨çš„. é€™å€‹éœ€æ±‚æ˜¯å‰›éœ€, å› ç‚ºé€™å€‹ API æä¾›çµ¦å¤–éƒ¨å» å•†å‘¼å«, æ˜¯ä¸å›ºå®šæ ¼å¼å…§å®¹çš„, æ‰€ä»¥ Body ä¸­æœ‰å¯èƒ½æ˜¯ Form, JSON ,XML, ç”šè‡³æ˜¯è‡ªå®šç¾©æ ¼å¼çš„, æ¯”èµ·å®¢è£½ Model Binding æ©Ÿåˆ¶, ç°¡å–®çš„è®€å– Request.Body å¾Œå†è§£æžæ˜¯æ¯”è¼ƒå®¹æ˜“ä¸Šæ‰‹çš„. è§£æ±ºæ–¹å¼é€™å€‹ç—‡ç‹€å’Œ Sream è®€å–å¾Œéœ€è¦â€å€’å¸¶â€ (rewind) æ‰èƒ½å†è®€å–çš„ç‰¹æ€§å¾ˆåƒ, ä½†æ˜¯åœ¨ Action ä¸­åˆç„¡æ³•ç›´æŽ¥å€’å¸¶, å‰›å¥½ä¹‹å‰æœ‰é‡éŽé¡žä¼¼çš„å•é¡Œ, å°è±¡ä¸­æ˜¯è¦é¡å¤–è¨­å®šæ‰èƒ½é–‹å•Ÿå€’å¸¶åŠŸèƒ½ (ä½†æˆ‘é‡‘é­šè…¦å¿˜äº†æ€Žéº¼åš). æ‰¾äº†å¾ˆä¹…æ²’çœ‹åˆ°å®Œå…¨ä¸€æ¨£çš„å•é¡Œ, å€’æ˜¯çœ‹åˆ°ä¸€ç¯‡ é¡žä¼¼çš„æƒ…å¢ƒ å€¼å¾—ä¸€è©¦, åªéœ€è¦ç°¡å–®çš„åœ¨ Startup.cs ä¸­å¦‚ä¸‹å•Ÿç”¨å°±å¥½: 1234567891011121314public void Configure(IApplicationBuilder app)&#123; // Must before UseEndpoints() called. app.Use(next =&gt; context =&gt; &#123; context.Request.EnableBuffering(); return next(context); &#125;); app.UseEndpoints(endpoints =&gt; &#123; endpoints.MapControllers(); &#125;);&#125; ä½†æœ‰é™åˆ¶: ä¸€å®šè¦å‡ºç¾åœ¨ UseEndpoints() è¢«å‘¼å«ä¹‹å‰, æŽ¨æ¸¬æ˜¯å› ç‚º Middleware çš„åŸ·è¡Œé †åºçš„ç·£æ•…. ä¸èƒ½åœ¨ Action ä¸­æ‰å‘¼å« EnableBuffering(), ä¹Ÿæ˜¯åˆç†, ç•¢ç«Ÿéƒ½åœ¨æ‰€æœ‰ Middleware å¾Œæ‰å‘¼å«, å°±ä¸ç¬¦åˆä¸Šä¸€å€‹é™åˆ¶äº†, ä½†å¯æƒœç›®å‰é‚„ä¸çŸ¥é“æ˜¯æ€Žæ¨£çš„é‹ä½œæ©Ÿåˆ¶è®“å€’å¸¶é€™éº¼æŒ‘å ´åˆè¨­å®š. çµè«–åŸºæœ¬ä¸Šèƒ½ç”¨ Model Binding å°±ç›¡é‡ç”¨, æ²’ç‰¹æ®Šæƒ…å¢ƒä¸éœ€è¦ç‰¹åˆ¥åŽ»è®€ Body Stream, è§£æžéº»ç…©è€Œä¸”ç›¸å°å®¹æ˜“éŒ¯. é€™è¦æ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°é€£é—œéµå­—éƒ½æ²’æœ‰ä¸çŸ¥é“æœƒå¡å¤šä¹…, é‚„å¥½ä¹‹å‰æœ‰å…ˆé‡éŽ Stream å€’å¸¶å’Œ Reqeut Rewind çš„æƒ…å¢ƒ, çœŸæ˜¯è¬å¤©è¬åœ°. åƒè€ƒIAsyncActionFilter, trying to log request body, but it is empty]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[é—œæ–¼ç‰©ä»¶å’Œé›†åˆåˆå§‹è¨­å®šå¼]]></title>
    <url>%2Fcontent%2F20220606-about-object-and-collection-initializers.html</url>
    <content type="text"><![CDATA[å¯« C# ä¹Ÿå¥½å¹¾å¹´äº†, å°æ–¼ç‰©ä»¶å’Œé›†åˆåˆå§‹è¨­å®šå¼çš„ä½¿ç”¨ä¹Ÿå¾ˆç¿’æ…£, ä¹ŸçŸ¥é“é‚£æ˜¯èªžæ³•ç³–, ä½†æ˜¯å‰é™£å­çœ‹åˆ°è‡ªè¨‚é¡žåˆ¥è¦å¥—ç”¨ç‰©ä»¶å’Œé›†åˆåˆå§‹è¨­å®šå¼æ™‚, æ‰ç™¼ç¾å…¶å¯¦æ²’æœ‰æƒ³åƒä¸­çš„ç†Ÿ, æ‰€ä»¥æƒ³ç¨å¾®å†æ•´ç†ä¸€ä¸‹ä¸€äº›ç´°ç¯€. é¦–å…ˆ, å…¶å¯¦å®˜æ–¹æ–‡ä»¶å·²ç¶“éžå¸¸å®Œæ•´çš„, å¦‚æžœçœ‹éŽå®˜æ–¹æ–‡ä»¶å…¶å¯¦é€™é‚Šå°±æ²’ä»€éº¼å¥½çœ‹çš„äº†. ä¹Ÿå› ç‚ºå®˜æ–¹æ–‡ä»¶å¾ˆå®Œæ•´, æ‰€ä»¥é€™é‚Šåªæœƒè¨˜ä¸€äº›å¹³å¸¸æ²’è¢«æ³¨æ„åˆ°çš„ç´°ç¯€. åˆå§‹è¨­å®šå¼çš„èªžæ³•ç³–Indexer éƒ¨åˆ†ä»¥ Dictionary ç‚ºä¾‹1234var x = new Dictionary&lt;string, string&gt;&#123; ["k"] = "v",&#125; ç·¨è­¯å¾Œçš„çµæžœæœƒæŽ¥è¿‘ä¸‹é¢çš„æ¨£å­, åŽ»å­˜å– Indexer.12var x = new Dictionary&lt;string, string&gt;();x["k"] = "v"; Collection éƒ¨åˆ†ä»¥ List ç‚ºä¾‹12345var x = new List&lt;string&gt;&#123; "a", "b",&#125; ç·¨è­¯å¾Œçš„çµæžœæœƒæŽ¥è¿‘ä¸‹é¢çš„æ¨£å­, åŽ»å­˜å– Add() æ–¹æ³•.123var x = new List&lt;string&gt;();x.Add("a");x.Add("b"); è‡ªå®šç¾©é¡žåˆ¥å¥—ç”¨åˆå§‹è¨­å®šå¼Indexer éƒ¨åˆ†å¦‚æ¨™é¡Œ, é‡é»žå°±æ˜¯è¦å¯¦ä½œå°æ‡‰çš„ indexer. æ‡¶å¾—è‡ªå·±æƒ³ Demo äº†, å°±å·ä¸€ä¸‹å®˜æ–¹çš„ç¯„ä¾‹ä¾†æ”¹:1234567891011// è‡ªå®šç¾©çš„ç‰©ä»¶èˆ‡ indexerpublic class Matrix&#123; private double[,] storage = new double[3, 3]; public double this[int row, int column] &#123; get =&gt; storage[row, column]; set =&gt; storage[row, column] = value; &#125;&#125; 123456789101112131415161718// ä½¿ç”¨var identity = new Matrix&#123; [0, 0] = 1.0, [0, 1] = 0.0, [0, 2] = 0.0, [1, 0] = 0.0, [1, 1] = 1.0, [1, 2] = 0.0, [2, 0] = 0.0, [2, 1] = 0.0, [2, 2] = 1.0,&#125;;// identity[0, 0] =&gt; 1// identity[0, 1] =&gt; 0 Collection éƒ¨åˆ†å…©å€‹é‡é»ž å¿…é ˆå¯¦ä½œ System.Collections.IEnumerable (æˆ–å…¶è¡ç”Ÿé¡žåˆ¥/ä»‹é¢) é€™éƒ¨åˆ†å€’ä¹Ÿä¸æ˜¯åˆå§‹è¨­å®šå¼æœƒç”¨åˆ°, åªæ˜¯ä¸å¯¦ä½œçš„è©±å‘¼å«æ™‚å°±ç„¡æ³•ä½¿ç”¨é›†åˆåˆå§‹è¨­å®šå¼. GetEnumerator() å…§å®¹åœ¨åˆå§‹è¨­å®šå¼ä¸æœƒè¢«å‘¼å«åˆ°, æ‰€ä»¥æ²’å¯¦ä½œä¹Ÿä¸æœƒå£ž, ä½†æ˜¯é‚„æ˜¯æ‡‰è©²è¦å¯¦ä½œ. å¿…é ˆæœ‰ Add æ–¹æ³• Add æ–¹æ³•åƒæ•¸å°æ‡‰çš„å°±æ˜¯åˆå§‹è¨­å®šå¼ä¸­åƒæ•¸çš„æ•¸é‡, ä¾‹å¦‚ {a, b, c} å°±æ˜¯å°æ‡‰å‘¼å«åˆ° Add(a, b, c) é€™å€‹å¤šè¼‰ 1234567891011121314151617181920// è‡ªå®šç¾©çš„ç‰©ä»¶public class NameCollection : IEnumerable&#123; private IList&lt;string&gt; _names = new List&lt;string&gt;(); public void Add(string lastName) &#123; _names.Add($"&#123;lastName&#125;"); &#125; public void Add(string fistName, string lastName) &#123; _names.Add($"&#123;fistName&#125; &#123;lastName&#125;"); &#125; public IEnumerator GetEnumerator() &#123; return _names.GetEnumerator(); &#125;&#125; 1234567891011121314// ä½¿ç”¨var fullNames = new NameCollection&#123; // Add("Smith") &#123;"Smith"&#125;, // Add("John", "Smith") &#123;"John", "Smith"&#125;,&#125;;// é€™é‚Šæœƒéœ€è¦ç”¨åˆ°å¯¦ä½œçš„ IEnumerable.GetEnumerator()foreach(var f in fullNames)&#123; var fullName = f.ToString();&#125; çµè«–å…¶å¯¦ä½¿ç”¨ä¸Šéƒ½å¾ˆç†Ÿäº†, ä½†ç¢°åˆ°è‡ªå®šç¾©é¡žåˆ¥è¦å¥—ç”¨åˆå§‹è¨­å®šå¼æ™‚, ä¸€æ™‚ä¹‹é–“æœƒæƒ³ä¸åˆ°æ€Žéº¼åš (å°¤å…¶æ™‚é›†åˆåˆå§‹è¨­å®šå¼), æ‰€ä»¥é€™é‚Šç´€éŒ„ä¸€ä¸‹æ€Žéº¼å¯¦ä½œ. åƒè€ƒObject and Collection Initializers Collection initializers in custom classes Collection Initializers with Parameter Arrays]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[XML åºåˆ—åŒ–æ™‚æœ‰æ¢ä»¶çš„å¿½ç•¥æ¬„ä½]]></title>
    <url>%2Fcontent%2F20220530-xml-serialization-conditional-ignore.html</url>
    <content type="text"><![CDATA[ä¹‹å‰é‡åˆ°éœ€è¦åœ¨ XML åºåˆ—åŒ–çš„éŽç¨‹ä¸­å¿½ç•¥å€¼ç‚ºç©ºå€¼æˆ–é è¨­å€¼çš„æ¬„ä½, æŸ¥äº†ä¸€ä¸‹æ‰ç™¼ç¾ä¸å¤ªå¥½æ‰¾è€Œä¸”åšæ³•æ²’æœ‰å¾ˆç›´è¦º. ä½œæ³•bool ShouldSerialize{PropertyName}å»ºç«‹å›žå‚³åž‹åˆ¥ç‚º bool çš„æ–¹æ³•, æ–¹æ³•åç¨±å¿…é ˆç‚º ShouldSerialize åŠ ä¸Šå±¬æ€§å. 1234567891011public class M&#123; public string S &#123; get; set; &#125; public int N &#123; get; set; &#125; // ShouldSerialize + S public bool ShouldSerializeS() &#123; return !string.IsNullOrEmpty(S); &#125;&#125; å”¯ç¨å±¬æ€§ {PropertytName}Specifiedå»ºç«‹å”¯ç¨å±¬æ€§, åç¨±å¿…é ˆç‚ºå±¬æ€§ååŠ ä¸Š Specified, æœ‰å¹¾å€‹ç´°ç¯€: ä¸ä¸€å®šè¦æ˜¯å”¯ç¨å±¬æ€§, æœ‰ setter ä¹Ÿå¯ä»¥, ä½†æ˜¯æ²’æ„ç¾©, ä¸è¦é€™æ¨£åš. Attribute System.Xml.Serialization.XmlIgnore ä¸æ˜¯å¿…è¦çš„ (å› ç‚ºå”¯ç¨), ä½†å»ºè­°è¦åŠ , é¿å…æœ‰äººåŠ äº† setter æˆ–å…¶ä»–å› ç´ è€Œå°Žè‡´ä»–è¢«åºåˆ—åŒ–, é–±è®€æ™‚ä¹Ÿå¤šä¸€å€‹æç¤ºæ•ˆæžœ. 1234567891011121314public class M&#123; public string S &#123; get; set; &#125; public int N &#123; get; set; &#125; [System.Xml.Serialization.XmlIgnore] public bool NSpecified &#123; get &#123; return N &gt; 0; &#125; &#125;&#125; å‘¼å«ç«¯èˆ‡ç¶œåˆåˆ†æžç°¡å–®çš„å‘¼å«ç«¯ç¯„ä¾‹.123456789101112public class Program&#123; public static void Main() &#123; var m = new M(); m.S = ""; XmlSerializer xs = new XmlSerializer(typeof(M)); StringWriter sw = new StringWriter(); xs.Serialize(sw, m); Console.WriteLine(sw.ToString()); &#125;&#125; å»ºè­°: å„ªå…ˆä½¿ç”¨ bool ShouldSerialize{PropertyName} æ–¹æ³•, ä¸»è¦åŽŸå› æ˜¯å› ç‚ºä»–åå­—æ¯”è¼ƒå¥½è¨˜ä¹Ÿæ¯”è¼ƒç›´è¦º, å¦å¤–ä¸€å€‹åšæ³•æ¯”è¼ƒéº»ç…©. å°‡å±¬æ€§å’Œæ¢ä»¶æ‹†é–‹æˆå€‹ç¨ç«‹çš„æª”æ¡ˆæ­é… partial class, ç¯„ä¾‹å¦‚ä¸‹: 12345678910111213141516&gt; // M.cs&gt; public partial class M&gt; &#123;&gt; public string S &#123; get; set; &#125;&gt; public int N &#123; get; set; &#125;&gt; &#125;&gt; &gt; // M.Ignore.cs&gt; public partial class M&gt; &#123;&gt; public bool ShouldSerializeS()&gt; &#123;&gt; return !string.IsNullOrEmpty(S);&gt; &#125;&gt; &#125;&gt; çµè«–æ‰¾åˆ°è§£æ³•çš„æ™‚å€™å…¶å¯¦å¾ˆé©šè¨, å› ç‚ºé€™ç¨®åšæ³•ç¶­è­·ä¸Šå…¶å¯¦æœƒæœ‰é»žå›°æ“¾, æƒ³æƒ³å¦‚æžœå±¬æ€§è¦æ”¹å, çµæžœé‚„è¦æœ‰æ„è­˜çš„åˆ»æ„æ‰¾å‡º ShouldSerialize{PropertyName} æˆ–æ˜¯ {PropertytName}Specified ä¾†ä¿®æ”¹, å°æ–¼ç¶­è­·å…¶å¯¦ä¸å¤ªå‹å–„, åªæ˜¯æ²’æœ‰æ‰¾åˆ°å…¶ä»–åšæ³•ä¹Ÿå°±å…ˆæ‹¿ä¾†ç”¨äº†. åƒè€ƒXml serialization - Hide null values How to exclude null properties when using XmlSerializer]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¾å­—ä½ (grapheme) è™•ç†å­—ä¸²]]></title>
    <url>%2Fcontent%2F20220528-grapheme-cluster-string.html</url>
    <content type="text"><![CDATA[ä»¥å‰åœ¨è™•ç†å­—ä¸²çš„æ™‚å€™, ä¸ç®¡æ˜¯åè½‰æˆ–æ˜¯å–å­—å…ƒéƒ½æ²’è€ƒæ…®åˆ°æœ‰äº›èªžè¨€çš„ä¸€å€‹å­—æ¯å¯èƒ½æ˜¯ç”±å¤šå€‹å­—çµ„æˆçš„, ç›´åˆ°é‡åˆ°å•é¡Œ. èˆ‰å€‹è¶Šå—æ–‡çš„ä¾‹å­, oÌ› æ˜¯ç”± o å’Œ Ì› (%cc%9b) çµ„æˆçš„, æ‰€ä»¥è™•ç†çš„æ™‚å€™å°±å®¹æ˜“æœ‰é æ–™å¤–çš„çµæžœ, ä»¥å­—ä¸²åè½‰ä¾†èªª, oÌ›a åè½‰å¾Œè®Šæˆ aÌ›o é—œæ–¼ Grapheme èˆ‡ç›¸é—œé€™éƒ¨åˆ†æ²’æœ‰ä»”ç´°ç ”ç©¶, ä½†æ˜¯ç¶²è·¯è³‡æºå¾ˆå¤šå¯ä»¥éœ€è¦æ™‚çŸ¥é“ç´°ç¯€æ™‚å†æŸ¥è©¢. Whatâ€™s the difference between a character, a code point, a glyph and a grapheme? Glossary of Unicode Terms: ç›¸é—œé—œéµå­— Abstract Character / Character / Glyph / Grapheme ä½¿ç”¨ TextElementEnumerator è™•ç†å­—ä¸²ä½¿ç”¨ TextElementEnumerator å°±èƒ½æ­£ç¢ºçš„å°‡ oÌ›a åè½‰æˆ oÌ›a äº†. 123456789101112using System.Globalization;public string ReverseGraphemeClusters(string s)&#123; TextElementEnumerator enumerator = StringInfo.GetTextElementEnumerator(s); StringBuilder sb = new StringBuilder(); while (enumerator.MoveNext()) &#123; sb.Insert(0, enumerator.GetTextElement()); &#125; return sb.ToString();&#125; çµè«–å°±æ˜¯å€‹æ²’é‡åˆ°ä¸æœƒæƒ³åˆ°çš„å•é¡Œ, è™•ç†æ–¹å¼ä¹Ÿå¾ˆç°¡å–®, åªæ˜¯èƒŒå¾Œç´°ç¯€è¦çœ‹å¾ˆå¤šæ–‡ä»¶æ‰èƒ½äº†è§£å¾ˆéº»ç…©æ‰€ä»¥ä¹¾è„†ç´€éŒ„ä¸€ä¸‹å‚™æŸ¥. åƒè€ƒWhatâ€™s the difference between a character, a code point, a glyph and a grapheme?Glossary of Unicode TermsCorrectly reversing a stringC# grapheme]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Flatten JSON]]></title>
    <url>%2Fcontent%2F20211114-flatten-json.html</url>
    <content type="text"><![CDATA[å¹¾å¹´å‰å› ç‚ºéœ€è¦å°‡â€ä¸å›ºå®šæ ¼å¼ä¸”ä¸å¯é æœŸâ€çš„ JSON å­—ä¸²è½‰æ›æˆ Dictionary&lt;strin, string&gt; è€Œåšäº†æ“´å……æ–¹æ³•, ä½†å¾Œä¾†ç™¼ç¾å¯¦ä½œå¾—å¤ªè¤‡é›œäº†.æ‰€ä»¥æƒ³è¨˜éŒ„ä¸€ä¸‹æ¯”è¼ƒç°¡å–®çš„åšæ³•. æ­é… Newtonsoft.Jsonä¸€é–‹å§‹çš„æ€è·¯æ˜¯å°‡å­—ä¸²è½‰æ›æˆ JObject å¾Œå†è¿´åœˆæ‰€æœ‰çš„æ¬„ä½, æ ¹æ“šé‚£äº›æ¬„ä½æ˜¯ Object / Aarray / Value æ­é…éžè¿´æŠŠæ•´å€‹ JSON å­—ä¸²è½‰æ›æˆ Dictionary&lt;strin, string&gt;, é›–ç„¶éžè¿´æœ‰é»žè²»ç¥žä½†æ˜¯æ•´é«”ä¹Ÿå°±å››äº”åè¡Œç¨‹å¼ç¢¼, å¯«å®Œè¦ºå¾—å¾ˆæ»¿æ„. æ²’æƒ³åˆ°æœ€è¿‘ç™¼ç¾äº†é€™ä¸€ç¯‡å›žç­”çš„ç²¾å¦™è§£æ³•, æ‰ç™¼ç¾ä¹‹å‰çš„ä½œæ³•ç°¡ç›´æ˜¯åœŸæ³•ç…‰é‹¼, æ‰€ä»¥ç¨å¾®æ”¹äº†ä¸€ä¸‹. é€£çµä¸­çš„ Code ä¸æ”¯æ´ç¬¬ä¸€å±¤æ˜¯é™£åˆ—çš„ JSON, ä¾‹å¦‚: [{&quot;key&quot;, &quot;a&quot;}, {&quot;key&quot;, &quot;b&quot;}], æ‰€ä»¥éœ€è¦æ”¹éŽ. 12345678public static class JContainerExtensions&#123; public static Dictionary&lt;string, string&gt; Flatten(this JContainer jContainer) &#123; IEnumerable&lt;JToken&gt; jTokens = jContainer.Descendants().Where(p =&gt; p.Count() == 0); return jTokens.ToDictionary(jToken =&gt; jToken.Path, jToken =&gt; jToken.ToString()); &#125;&#125; ä¸åˆ°åè¡Œè€Œä¸”åˆç°¡å–®æ˜Žçž­, å‘¼å«ç«¯ä½¿ç”¨ä¸Šä¹Ÿå¾ˆå®¹æ˜“:12var jContainer = JToken.Parse(testData) as JContainer;var flattenJContainer = jContainer?.Flatten(); JToken.Parse(testData) as JContainer é€™ä¸€è¡Œæ˜¯æˆç«‹çš„, æœƒæˆç«‹æ˜¯å› ç‚º JToken.Parse(testData) çš„çµæžœå¯èƒ½æ˜¯ JObject / JArray / JValue, é™¤äº† JValue å¤–éƒ½ç¹¼æ‰¿äº† JContainer, æ‰€ä»¥è½‰åž‹ä¸Šä¸æœƒæœ‰å•é¡Œ, è€Œ JValue æ˜¯æ²’æœ‰ key çš„ç´”å€¼ (ä¾‹å¦‚: JToken val = JToken.Parse(&quot;abc&quot;);), æœ¬ä¾†å°±ä¸é©åˆå‡ºç¾åœ¨è¦è½‰æ›æˆ Dictionary&lt;string, string&gt; çš„æƒ…å¢ƒ. æ­é… Sysetem.Text.Jsoné€™å€‹æ˜¯å…§å»ºçš„ Json è™•ç†å·¥å…·, ä¸éŽåŠŸèƒ½æ²’æœ‰ Newtonsoft.Json é‚£éº¼å¤š, æ²’æ‰¾åˆ°æ¯”è¼ƒç°¡å–®çš„åšæ³•æ‰€ä»¥åªå¥½é‚„æ˜¯ç”¨éžè¿´, åœ¨å¯¦ä½œä¸Šæœƒéº»ç…©å¾ˆå¤š. å…ˆä¾†é»žæ“´å……æ–¹æ³•: 1234567891011121314151617181920212223242526272829303132333435public static class JsonDocumentExtensions&#123; public static Dictionary&lt;string, string&gt; Flatten(this JsonDocument document) &#123; var result = new Dictionary&lt;string, string&gt;(); FlattenElement(string.Empty, document.RootElement, result); return result; &#125; private static void FlattenElement(string key, JsonElement element, Dictionary&lt;string, string&gt; result) &#123; switch (element.ValueKind) &#123; case JsonValueKind.Object: foreach (var pty in element.EnumerateObject()) &#123; string nextKey = string.IsNullOrEmpty(key) ? pty.Name : $"&#123;key&#125;.&#123;pty.Name&#125;"; FlattenElement(nextKey, pty.Value, result); &#125;; break; case JsonValueKind.Array: int i = 0; foreach (var arrayItem in element.EnumerateArray()) &#123; string nextKey = $"&#123;key&#125;[&#123;i&#125;]"; FlattenElement(nextKey, arrayItem, result); i++; &#125; break; default: result.Add(key.ToString(), element.ToString()); break; &#125; &#125;&#125; å‘¼å«ç«¯æ˜¯é€™æ¨£:1var flattenJsonDocument = JsonDocument.Parse(testData).Flatten(); çµè«–ç”¨äº† Newtonsoft.Json çµæžœå› ç‚ºæ²’ç™¼ç¾å¥—ä»¶å·²ç¶“æä¾›çš„åŠŸèƒ½è€Œè‡ªå·±åœŸæ³•ç…‰é‹¼çœŸçš„æ²’æ•ˆçŽ‡åˆå®¹æ˜“éŒ¯, ç®—æ˜¯è¢«ä»¥å‰çš„è‡ªå·±é›·åˆ°. å¦å¤–ç‚ºäº†æ–¹ä¾¿é©—è­‰, æœ‰ç¯„ä¾‹å°ˆæ¡ˆåœ¨é€™è£¡. åƒè€ƒC# flattening json structure]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[.NET Core ä¸­å–®ä¸€ä»‹é¢å¤šå¯¦ä½œæ­é…ä¾è³´æ³¨å…¥çš„å¹¾ç¨®æ–¹å¼]]></title>
    <url>%2Fcontent%2F20211031-netcore-inject-multiple-implementation.html</url>
    <content type="text"><![CDATA[åœ¨ .NET Core ä¸­æ³¨å…¥å¤šå€‹å¯¦ä½œæœ‰å¹¾ç¨®æ–¹å¼ï¼Œå„è‡ªæœ‰ä¸åŒçš„å„ªç¼ºé»žèˆ‡è©¦ç”¨æƒ…å¢ƒï¼Œç›¸é—œç¯„ä¾‹ç¨‹å¼ç¢¼æœƒæ”¾åœ¨ é€™å€‹ GitHub å°ˆæ¡ˆ ä¸Šã€‚ Implementation FactoryMicrosoft.Extensions.DependencyInjection.ServiceCollectionServiceExtensions æä¾›çš„å¤šè¼‰ï¼Œä»¥ AddScoped ç‚ºä¾‹ï¼špublic static IServiceCollection AddScoped&lt;TService&gt;(this IServiceCollection services, Func&lt;IServiceProvider, TService&gt; implementationFactory) where TService : class ç¬¬äºŒå€‹åƒæ•¸æä¾›ä¸€å€‹å·¥å» æ–¹æ³•ä¾†æ±ºå®šè¦ä½¿ç”¨å“ªç¨®å¯¦ä½œã€‚ å„ªé»ž éžå¸¸ç°¡å–®ã€‚ ç¼ºé»žèˆ‡é™åˆ¶ åªé©ç”¨æ–¼åœ¨æ³¨å…¥æ™‚å°±çŸ¥é“è¦ç”¨ä»€éº¼è¦å‰‡æ±ºå®šä½¿ç”¨å“ªå€‹å¯¦ä½œã€‚ å½ˆæ€§ä½Žï¼Œé›–ç„¶ç°¡å–®ä½†æ˜¯é©ç”¨æƒ…å¢ƒç‹¹çª„ã€‚ æ³¨å…¥ IEnumerableè¨»å†Šå¤šå€‹å¯¦ä½œï¼Œä½¿ç”¨æ™‚æ³¨å…¥ IEnumerable&lt;I&gt; å¾Œå†æ±ºå®šè¦ä½¿ç”¨å“ªå€‹å¯¦ä½œï¼Œå¯ä»¥æ­é…ä¸€å€‹æ¬„ä½ç”¨ä¾†æ¨™ç¤ºè©²å¯¦ä½œçš„åå­— (è¦ç”¨é¡žåˆ¥åç¨±ä¾†æ¨™ç¤ºä¹Ÿå¯ä»¥)ã€‚ è¨»å†Šæœå‹™ï¼š1234567public void ConfigureServices(IServiceCollection services)&#123; services.AddControllers(); services.AddSingleton&lt;IFoo, Foo1&gt;(); services.AddSingleton&lt;IFoo, Foo2&gt;();&#125; æ³¨å…¥èˆ‡ä½¿ç”¨ï¼š12345678910111213141516171819202122[ApiController][Route("[controller]")]public class DemoController : ControllerBase&#123; private IEnumerable&lt;IFoo&gt; _allFoo; public DemoController(IEnumerable&lt;IFoo&gt; allFoo) &#123; _allFoo = allFoo; &#125; [HttpGet] public ActionResult&lt;string&gt; Get(string name) &#123; var sb = new StringBuilder(); var foo = _allFoo.FirstOrDefault(r =&gt; r.Name == name); sb.Append(foo?.Hi()); return Ok(sb.ToString()); &#125;&#125; å„ªé»ž ç°¡å–®ã€‚ å½ˆæ€§é«˜ã€‚ ç¼ºé»žèˆ‡é™åˆ¶ å› ç‚ºæ˜¯æ³¨å…¥æ‰€æœ‰çš„å¯¦ä½œå¾Œå†æŒ‘å‡ºè¦ä½¿ç”¨çš„é‚£ä¸€å€‹ï¼Œå…¶ä»–çš„éƒ½ç”¨ä¸åˆ°ï¼Œæœƒæœ‰æµªè²»è³‡æºçš„ç–‘æ…®ï¼Œæ‰€ä»¥é€šå¸¸æ­é… AddSingleton ä½¿ç”¨ã€‚ æ¯æ¬¡æœå°‹ ( _allFoo.FirstOrDefault(r =&gt; r.Name == name) )çš„æ™‚é–“è¤‡é›œåº¦éƒ½æ˜¯ O(n)ï¼Œéœ€è¦å¤šæ¬¡æœå°‹æ™‚é€™å€‹ç¼ºé»žæœƒæ›´æ˜Žé¡¯ã€‚ Dictionaryè¨»å†Šæˆä¸€å€‹ Dictionary æˆ–é¡žä¼¼çš„ç‰©ä»¶ã€‚ è¨»å†Šæœå‹™ï¼š123456789101112public void ConfigureServices(IServiceCollection services)&#123; services.AddControllers(); services.AddScoped&lt;IBar, Bar1&gt;(); services.AddScoped&lt;IBar, Bar2&gt;(); services.AddScoped&lt;IReadOnlyDictionary&lt;string, IBar&gt;&gt;(provider =&gt; &#123; var allBar = provider.GetService&lt;IEnumerable&lt;IBar&gt;&gt;(); return allBar.ToDictionary(bar =&gt; bar.Name, bar =&gt; bar); &#125;);&#125; æ³¨å…¥èˆ‡ä½¿ç”¨ï¼š1234567891011121314151617181920212223[ApiController][Route("[controller]")]public class DemoController : ControllerBase&#123; private IReadOnlyDictionary&lt;string, IBar&gt; _allBar; public DemoController(IReadOnlyDictionary&lt;string, IBar&gt; allBar) &#123; _allBar = allBar; &#125; [HttpGet] public ActionResult&lt;string&gt; Get(string name) &#123; var sb = new StringBuilder(); // bar _allBar.TryGetValue(name, out IBar bar); sb.Append(bar?.Hello()); return Ok(sb.ToString()); &#125;&#125; å„ªé»ž ç°¡å–®ã€‚ å½ˆæ€§é«˜ã€‚ å¯æ“´å……æ€§é«˜ï¼Œå¦‚æžœæ˜¯ä½œç‚ºä¸€å€‹å¥—ä»¶ï¼Œå³ä½¿æ²’æä¾›é©åˆçš„å¯¦ä½œï¼Œä½¿ç”¨è€…ä»ç„¶å¯ä»¥è‡ªå·±å¯¦ä½œ IBar å¾Œæ³¨å…¥ã€‚ åªæœ‰ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ™‚å€™å°‡ IEnumerable&lt;T&gt; è½‰æˆ Dictionary æ™‚æ¯”è¼ƒè€—æ™‚ï¼Œä¹‹å¾Œæ¯æ¬¡å–ç”¨çš„æ™‚é–“è¤‡é›œåº¦éƒ½æ˜¯ O(1)ï¼Œåœ¨ç”Ÿå‘½é€±æœŸç¯„åœå…§å¤šæ¬¡å–ç”¨çš„æ•ˆèƒ½å„ªæ–¼ IEnumerable&lt;T&gt;ã€‚ ç¼ºé»žèˆ‡é™åˆ¶ æ²’æœ‰é‚£éº¼ç›´è¦ºï¼Œå°æ–¼ä½¿ç”¨è€…ä¾†èªªè¦è¨˜å¾—æ³¨å…¥æ™‚è¦æ³¨å…¥ç‚º IReadOnlyDictionary&lt;string, IBar&gt;ã€‚ é€éŽå¦ä¸€å€‹é¡žåˆ¥ä¾†è½‰æŽ¥ (æ©‹æŽ¥æ¨¡å¼)é€™ç¨®åšæ³•çš„æ¦‚å¿µåœ¨æ–¼æä¾›ä¸€å€‹æ©‹æŽ¥ç”¨çš„é¡žåˆ¥ä¾†ä½¿ç”¨é‚£äº›å¯¦ä½œã€‚ è¨»å†Šæœå‹™ï¼š12345678public void ConfigureServices(IServiceCollection services)&#123; services.AddControllers(); services.AddScoped&lt;IBaz, Baz1&gt;(); services.AddScoped&lt;IBaz, Baz2&gt;(); services.AddScoped&lt;IBazBridge, BazBridge&gt;();&#125; æ³¨å…¥èˆ‡ä½¿ç”¨ï¼š12345678910111213141516171819202122[ApiController][Route("[controller]")]public class DemoController : ControllerBase&#123; private IBazBridge _bazBridge; public DemoController(IBazBridge bazBridge) &#123; _bazBridge = bazBridge; &#125; [HttpGet] public ActionResult&lt;string&gt; Get(string name) &#123; var sb = new StringBuilder(); // baz sb.Append(_bazBridge.Hey(name)); return Ok(sb.ToString()); &#125;&#125; Bridge ç›¸é—œé¡žåˆ¥ï¼š123456789101112131415161718192021public interface IBazBridge&#123; string Hey(string name);&#125;internal class BazBridge : IBazBridge&#123; private IReadOnlyDictionary&lt;string, IBaz&gt; _allBazDictionary; public BazBridge(IEnumerable&lt;IBaz&gt; allBaz) &#123; _allBazDictionary = allBaz.ToDictionary(baz =&gt; baz.Name, baz =&gt; baz); &#125; public string Hey(string name) &#123; _allBazDictionary.TryGetValue(name, out IBaz baz); return baz?.Hey(); &#125;&#125; å¦‚æžœæœ‰å¤šå€‹æƒ…å¢ƒè¦ä½¿ç”¨ Bridgeï¼Œå¯ä»¥å°‡å»ºæ§‹å­ä¸­è½‰æ› IEnumerable&lt;T&gt; ç‚º Dictionary çš„éƒ¨åˆ†æŠ½æˆ BridgeBaseï¼Œæä¾›çµ¦æ‰€æœ‰ Bridge ç¹¼æ‰¿ã€‚ å„ªé»ž å½ˆæ€§æ¥µé«˜ï¼ŒBrige ä¸­ç”šè‡³å¯ä»¥åšå„ç¨®è½‰æŽ¥èˆ‡è®ŠåŒ–ã€‚ å¯æ“´å……æ€§é«˜ï¼Œå¦‚æžœæ˜¯ä½œç‚ºä¸€å€‹å¥—ä»¶ï¼Œå³ä½¿æ²’æä¾›é©åˆçš„å¯¦ä½œï¼Œä½¿ç”¨è€…ä»ç„¶å¯ä»¥è‡ªå·±å¯¦ä½œ IBaz å¾Œæ³¨å…¥ã€‚ åªæœ‰ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ™‚å€™å°‡ IEnumerable&lt;T&gt; è½‰æˆ Dictionary æ™‚æ¯”è¼ƒè€—æ™‚ï¼Œä¹‹å¾Œæ¯æ¬¡å–ç”¨çš„æ™‚é–“è¤‡é›œåº¦éƒ½æ˜¯ O(1)ï¼Œåœ¨ç”Ÿå‘½é€±æœŸç¯„åœå…§å¤šæ¬¡å–ç”¨çš„æ•ˆèƒ½å„ªæ–¼ IEnumerable&lt;T&gt;ã€‚ ç›¸è¼ƒæ–¼ä¹‹å‰çš„æ³¨å…¥ Dictionary çš„è§£æ³•ï¼Œé€™ç¨®é«˜å½ˆæ€§/æ“´å……æ€§çš„ä½œæ³•æ›´é©åˆæ”¾åœ¨å¥—ä»¶ä¸­ï¼Œé€™ç¨®è¨­è¨ˆç›¸ä¼¼æ–¼ HttpClient èˆ‡ IHttpClientFactory ä¹‹é–“çš„é—œä¿‚ï¼Œæ‰€ä»¥ç›¸å°æ–¼ä¹‹å‰ Dictionary çš„è§£æ³•ä¾†èªªï¼Œä½¿ç”¨ä¸Šä¸ç›´è¦ºçš„å•é¡Œç›¸å°ä½Žäº†ä¸€äº›ã€‚ ç¼ºé»žèˆ‡é™åˆ¶ è¤‡é›œå¾ˆå¤šã€‚ å¤šå€‹ä»‹é¢éœ€è¦å¥—ç”¨æ™‚æœƒéœ€è¦å¾ˆå¤šçµ„ Bridgeã€‚ è¨»å†Šè¼ƒä¸å‹å–„ï¼Œservices.AddScoped&lt;IBazBridge, BazBridge&gt;(); é€™é‚Šä½¿ç”¨è€…è¦èªè­˜å…·é«”å¯¦ä½œ BazBridgeã€‚ é€éŽå¦ä¸€å€‹é¡žåˆ¥ä¾†ç®¡ç† (Provider)é€™ç¨®åšæ³•çš„æ¦‚å¿µåœ¨æ–¼æä¾›ä¸€å€‹ç®¡ç†ç”¨çš„é¡žåˆ¥ä¾†æä¾›é‚£äº›å¯¦ä½œã€‚ è¨»å†Šæœå‹™ï¼š12345678910111213141516171819202122232425262728293031323334public void ConfigureServices(IServiceCollection services)&#123; services.AddControllers(); services.AddScoped&lt;IQux, Qux1&gt;(); services.AddScoped&lt;IQux, Qux2&gt;(); services.AddScoped&lt;IProvider&lt;IQux&gt;, Provider&lt;IQux&gt;&gt;();&#125;, ``æ³¨å…¥èˆ‡ä½¿ç”¨ï¼š ``` csharp[ApiController][Route("[controller]")]public class DemoController : ControllerBase&#123; private IProvider&lt;IQux&gt; _quxProvider; public DemoController(IProvider&lt;IQux&gt; quxProvider) &#123; _quxProvider = quxProvider; &#125; [HttpGet] public ActionResult&lt;string&gt; Get(string name) &#123; var sb = new StringBuilder(); // baz sb.Append(_quxProvider.Get(name).Yo()); return Ok(sb.ToString()); &#125;&#125; Provider ç›¸é—œé¡žåˆ¥ï¼š1234567891011121314151617181920212223public interface IProvider&lt;T&gt; where T : INameable&#123; T Get(string name);&#125;public class Provider&lt;T&gt; : IProvider&lt;T&gt; where T : INameable&#123; private IReadOnlyDictionary&lt;string, T&gt; _dictionary; public Provider(IEnumerable&lt;T&gt; nameable) &#123; _dictionary = nameable.ToDictionary(n =&gt; n.Name, n =&gt; n); &#125; public T Get(string name) &#123; _dictionary.TryGetValue(name, out T imp); return imp; &#125;&#125; å„ªé»ž æœ‰å¹¾ä¹Žç­‰åŒ Bridge è§£æ³•çš„å„ªé»ž (é™¤äº†å½ˆæ€§ç•¥ä½Ž)ã€‚ æ³›ç”¨æ€§æ¥µé«˜ï¼Œå¯é‡è¤‡å¥—ç”¨åœ¨ä»»ä½•å–®ä»‹é¢å¤šå¯¦ä½œçš„æƒ…å¢ƒã€‚ ç¼ºé»žèˆ‡é™åˆ¶ å› ç‚ºä¸éœ€è¦å¯¦ä½œå„ç¨® Bridgeï¼Œå½ˆæ€§è¼ƒ Bridge è§£æ³•ä½Žä¸€é»žã€‚ è¨»å†Šè¼ƒä¸å‹å–„ï¼Œservices.AddScoped&lt;IProvider&lt;IQux&gt;, Provider&lt;IQux&gt;&gt;(); é€™é‚Šä½¿ç”¨è€…è¦èªè­˜å…·é«”å¯¦ä½œ Provider&lt;T&gt;ï¼Œä¸”å…©å±¤æ³›åž‹åƒæ•¸æ¯”è¼ƒä¸å¥½é–±è®€ã€‚ ç¶œåˆä»¥ä¸Šæœ€ä½³åŒ–ä½¿ç”¨è€…é«”é©—é€™æ˜¯æˆ‘ç”¨åœ¨ä¸€å€‹å¥—ä»¶ - MoreNet.DependencyInjection ä¸Šçš„ä½œæ³•ï¼Œä»‹ç´¹ç›´æŽ¥çœ‹ GitHubã€‚ å„ªé»ž æ³›ç”¨æ€§æ¥µé«˜ï¼Œå¯é‡è¤‡å¥—ç”¨åœ¨ä»»ä½•å–®ä»‹é¢å¤šå¯¦ä½œçš„æƒ…å¢ƒã€‚ è¨»å†Šç°¡æ˜“ï¼Œå°ä½¿ç”¨è€…æ¯”è¼ƒå‹å–„ã€‚ ç¼ºé»žèˆ‡é™åˆ¶ å¯¦ä½œå¾ˆè¤‡é›œã€‚ çµè«–æ–¹æ³•å¾ˆå¤šç¨®ï¼Œå¤§è‡´å¯ä»¥åˆ†ç‚ºå…©å€‹é¢å‘ æ³¨å…¥å…¨éƒ¨å¾Œå†æŒ‘é¸ã€‚ æä¾›ç®¡ç†ç”¨çš„é¡žåˆ¥ (ä¸è«–æ˜¯å·¥å» /æ©‹æŽ¥æˆ–æ˜¯å…¶ä»–æ¨¡å¼)ã€‚ ä¸Šé¢çš„ç¯„ä¾‹åªæ˜¯ç‚ºäº†å±•ç¤ºé€™å…©å€‹å¤§æ–¹å‘ï¼Œå¯¦éš›é‹ç”¨æ™‚éœ€è¦è¦–æƒ…å¢ƒè®ŠåŒ–èª¿æ•´ï¼Œä¾‹å¦‚é€™ç¯‡æ–‡ç« æåˆ°å¹¾ç¨®åšæ³•ï¼Œéƒ½å’Œä¸Šé¢ç¯„ä¾‹ä¸å¤ªä¸€æ¨£ä½†å¤§æ–¹å‘æ˜¯ä¸€è‡´çš„ã€‚ åƒè€ƒService registration methods .NET6 Dependency Injection â€” One Interface, Multiple Implementations]]></content>
      <categories>
        <category>C#</category>
        <category>.NET Core</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åŸºæ–¼ ASP.NET Core WebAPI è®€å– Request / Response Body]]></title>
    <url>%2Fcontent%2F20210626-aspnetcore-webapi-read-body.html</url>
    <content type="text"><![CDATA[ä¹‹å‰åœ¨ WebAPI å®‰å…¨çš„å–å¾— Request Body é€™ç¯‡æ–‡ç« æœ‰æåˆ°è®€å– Request Body çš„æ–¹å¼, Response çš„éƒ¨åˆ†å…¶å¯¦å¤§åŒå°ç•°, ä¸”åœ¨ ASP.NET Core ä¸­ä¹Ÿæ˜¯ç›¸åŒé‚è¼¯(å³ä½¿å¯¦ä½œå¯èƒ½ä¸åŒ), ä½†æœ‰å€‹ä¸åŒçš„åœ°æ–¹æ˜¯ ASP.NET Core ä¸­çš„ request body é è¨­æ˜¯è®€å®Œç„¡æ³•å›žæ²çš„(ä¹Ÿå°±æ˜¯è®€å®Œå¾ŒæŒ‡æ¨™æœƒåœ¨ stream æœ€å¾Œé¢, ç„¡æ³•é‡è¤‡è®€å–), ä¸” response body æ˜¯å”¯å¯« (WriteOnly) çš„, æ‰€ä»¥ç„¡æ³•è®€å–, å°±éœ€è¦ä¸€é»žå°æŠ€å·§. ç¨‹å¼ç¢¼é€™é‚Šç›´æŽ¥å¯¦ä½œåœ¨ Middleware ç‚ºä¾‹:12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public class RequestResponseMiddleware&#123; private readonly RequestDelegate _next; public RequestResponseMiddleware(RequestDelegate next) &#123; _next = next; &#125; public async Task InvokeAsync(HttpContext httpContext) &#123; #region Request part var request = httpContext.Request; // é‡è¦, æ‰èƒ½å…è¨±å›žæ² (request.Body.Seek(0, SeekOrigin.Begin)) request.EnableBuffering(); using var requestReader = new StreamReader(request.Body, leaveOpen: true); var body = await requestReader.ReadToEndAsync(); request.Body.Seek(0, SeekOrigin.Begin); Debug.WriteLine(body); #endregion var response = httpContext.Response; var originalStream = response.Body; using (var readableBodyStream = new MemoryStream()) &#123; response.Body = readableBodyStream; await _next(httpContext); response.Body.Seek(0, SeekOrigin.Begin); using var responseReader = new StreamReader(response.Body, leaveOpen: true); var responseBody = await responseReader.ReadToEndAsync(); Debug.WriteLine(responseBody); response.Body.Seek(0, SeekOrigin.Begin); await readableBodyStream.CopyToAsync(originalStream); // å³ä½¿æ²’æœ‰æ›å›žåŽŸæœ¬çš„ç‰©ä»¶, å¾—åˆ°çš„å›žå‚³ä»ç„¶ä¸æœƒæœ‰éŒ¯, çŒœæ¸¬æ˜¯å›žå‚³çš„å…§å®¹æ˜¯ç›´æŽ¥åƒè€ƒ response.Body æ‰€æŒ‡çš„ç‰©ä»¶, // å› æ­¤ response.Body è¢«æ›æŽ‰ä¸æœƒå½±éŸ¿çµæžœ(åè€Œä¸Šé¢çš„ stream copy æ‰æ˜¯å¿…è¦çš„), ä½†ç‚ºäº†å®Œæ•´é‚„æ˜¯æœƒæŠŠå®ƒæ›å›žä¾†. response.Body = originalStream; &#125; #region Response part #endregion &#125;&#125; ä¸Šé¢ä¾†èªª, Request éƒ¨åˆ†å°± request.EnableBuffering() æœ€é‡è¦, ä¸ç„¶è®€å®Œå›žç„¡æ³•å›žæ², Response çš„è©± await readableBodyStream.CopyToAsync(originalStream) å’Œ response.Body = originalStream é€™å…©è¡Œç®—æ˜¯æ¯”è¼ƒç‰¹åˆ¥çš„, å¦‚è¨»è§£ä¸­æ‰€è¿°. çµè«–ç´°ç¯€å¾ˆå¤šå¾ˆé›£è§£é‡‹, åªå¥½è²¼ code è§£æ±º, å¸Œæœ›ä¸æœƒä»¥å¾Œè‡ªå·±çœ‹ä¸æ‡‚â€¦]]></content>
      <categories>
        <category>C#</category>
        <category>.NET Core</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ Friend Assembly]]></title>
    <url>%2Fcontent%2F20210606-use-friend-assembly.html</url>
    <content type="text"><![CDATA[å¦‚æžœçµ„ä»¶ A æ˜¯çµ„ä»¶ B çš„ Friend Assembly, å‰‡åœ¨çµ„ä»¶ A ä¸­èƒ½å­˜å–åˆ¥çš„çµ„ä»¶å…§çš„ internal é¡žåˆ¥æˆ–æˆå“¡, æ›´å¤šç´°ç¯€åœ¨å®˜æ–¹ä»‹ç´¹. ç”¨æ³•åŠ ä¸Šä¸€è¡Œ [assembly: InternalsVisibleTo(&quot;AssemblyName&quot;)] å°±å¥½, å»ºè­°æ”¾åœ¨ Properties è³‡æ–™å¤¾ä¸‹çš„ AssemblyInfo.cs æª”æ¡ˆä¸­. ä½¿ç”¨æƒ…å¢ƒç›®å‰æœ‰æƒ³åˆ°é©åˆçš„æƒ…å¢ƒæ˜¯ è·¨çµ„ä»¶çš„å…§éƒ¨ API: æ‹†åˆ†æˆå¥½å¹¾å€‹çµ„ä»¶çµ„åˆæˆä¸€å€‹å®Œæ•´ç”¢å“, å¸Œæœ›çµ¦åœ¨é€™å€‹ç”¢å“ä¸­è®“ç‰¹å®šçµ„ä»¶èƒ½è·¨çµ„ä»¶å­˜å–, ä½†åˆä¸å¸Œæœ›ç”¨ plubic . æ¸¬è©¦ç›®çš„: å› ç‚ºæ¸¬è©¦çš„ç›®çš„, éœ€è¦é–‹æ”¾çµ¦æ¸¬è©¦å°ˆæ¡ˆå­˜å–. çµè«–ä½¿ç”¨ä¸Šå¾ˆç°¡å–®, ä½†æ˜¯æ¯”è¼ƒéœ€è¦æƒ³çš„æ˜¯è©¦ç”¨åœ¨ç”šéº¼æƒ…å¢ƒ, ç›®å‰ä¹Ÿå°±ç‚ºäº†çµ¦æ¸¬è©¦å°ˆæ¡ˆå­˜å–è€Œä½¿ç”¨æœ‰ç”¨åˆ°è€Œå·². åƒè€ƒFriend assemblies]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å‚³éžä¾è³´ (transitive dependency)]]></title>
    <url>%2Fcontent%2F20210523-transitive-dependency.html</url>
    <content type="text"><![CDATA[ç‚ºäº†é™ä½Žå¤šå€‹å°ˆæ¡ˆé–“çš„è¤‡é›œåº¦, æˆ‘å€‘é€šå¸¸æœƒè¬¹æ…Žçš„æŽ§åˆ¶å°ˆæ¡ˆä¹‹é–“çš„ä¾è³´, ä½†åœ¨æœ€è¿‘æ–°é–‹æ¡ˆçš„ .NET Core ä¸€ç³»åˆ—çš„æ–°å°ˆæ¡ˆä¸­ç™¼ç¾å‚³éžä¾è³´æœƒè®“å°ˆæ¡ˆä¹‹é–“ç”¢ç”Ÿé æœŸå¤–çš„ä¾è³´. å‚³éžä¾è³´ (transitive dependency) æŒ‡çš„æ˜¯, ç•¶ A å°ˆæ¡ˆä¾è³´ B å°ˆæ¡ˆ, è€Œ B å°ˆæ¡ˆä¾è³´ C å°ˆæ¡ˆæ™‚, A å°ˆæ¡ˆæœƒå‚³éžä¾è³´ C å°ˆæ¡ˆ (å³åœ¨ A å°ˆæ¡ˆä¸­èƒ½å­˜å– C å°ˆæ¡ˆçš„å…¬é–‹æˆå“¡), ç”¨ä¸‹é¢çš„åœ–ç•¶ç¯„ä¾‹èªªæ˜Ž å°ˆæ¡ˆé–“çš„å‚³éžä¾è³´å°±ä¸Šåœ–çš„ä¾‹å­, ç¾åœ¨ä¸‰å±¤éƒ½æ˜¯æˆ‘å€‘è‡ªå·±å»ºç«‹çš„å°ˆæ¡ˆ, WebAPI ä¾è³´ Service, è€Œ Service ä¾è³´ Data Access, æœ¬ä¾†ä¸å¸Œæœ›èƒ½å¾ž WebAPI ä¸­ç›´æŽ¥å­˜å–åˆ° Data Access, ä½†å»å› ç‚ºå‚³éžä¾è³´è€Œå¤±ç®—. ç¾åœ¨ç›´æŽ¥ä¾è³´çš„é—œä¿‚æ˜¯é€™æ¨£çš„: WebAPI (project) â€“&gt; Service (project) â€“&gt; Data Access (project) è§£æ±ºæ–¹å¼æ˜¯è¦åœ¨ WebAPI å°ˆæ¡ˆçš„ csproj æª”æ¡ˆä¸­å°‡å‚³éžä¾è³´é—œé–‰, å¦‚ä¸‹:12345&lt;Project&gt; &lt;PropertyGroup&gt; &lt;DisableTransitiveProjectReferences&gt;true&lt;/DisableTransitiveProjectReferences&gt; &lt;/PropertyGroup&gt;&lt;/Project&gt; å°ˆæ¡ˆé–“å’Œå¥—ä»¶çš„å‚³éžä¾è³´é€™å€‹æƒ…å¢ƒçš„ç›´æŽ¥ä¾è³´çš„é—œä¿‚æ˜¯é€™æ¨£çš„, å‡è¨­ Data Access æ˜¯ä¸€å€‹å¥—ä»¶ (å°±å« DataAccess å¥½äº†), Service é€éŽ NuGet å®‰è£ä¸¦ä½¿ç”¨ä»– WebAPI (project) â€“&gt; Service (project) â€“&gt; Data Access (Package) é€™æ™‚å€™ &lt;DisableTransitiveProjectReferences&gt; æ˜¯æ²’æœ‰ç”¨çš„, è§£æ±ºæ–¹å¼å°±è®Šæˆè¦åœ¨ Service å°ˆæ¡ˆçš„ csproj æª”æ¡ˆä¸­ ç”¨ &lt;PrivateAssets&gt; æŽ’é™¤, å¦‚ä¸‹123&lt;PackageReference Include="DataAccess" Version="1.1.0"&gt; &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;&lt;/PackageReference&gt; é—œæ–¼ &lt;PackageReference&gt; æ›´ç´°ç·»çš„è¨­å®šå¯ä»¥çœ‹é€™è£¡å®˜æ–¹ç›¸é—œçš„ä»‹ç´¹. å¥—ä»¶é–“çš„å‚³éžä¾è³´æœ€å¾Œä¸€ç¨®æƒ…æ³, å¥—ä»¶ä¹‹é–“çš„å‚³éžä¾è³´, ç¾åœ¨ Service ä¹Ÿæ˜¯å€‹å¥—ä»¶, ä½†ä»–ä¾è³´ Data Access WebAPI (project) â€“&gt; Service (Package) â€“&gt; Data Access (Package) å…¶å¯¦é€™å€‹è·Ÿä¸Šå€‹æƒ…å¢ƒæ˜¯ä¸€æ¨£çš„, å°±æ˜¯åœ¨ Service ä¸­åŠ ä¸Š PrivateAssets, ä½†å¦‚æžœå€‘æ˜¯ç«™åœ¨ WebAPI å°ˆæ¡ˆé–‹ç™¼è€…è€Œä¸æ˜¯å¥—ä»¶ (æœ¬ä¾‹ä¸­çš„ Service) é–‹ç™¼è€…çš„è§’åº¦, å°±ç›®å‰æ‰€çŸ¥æ˜¯ç„¡èƒ½ç‚ºåŠ›, åªèƒ½æœŸå¾…å¾Œé¢ç¶­è­·çš„äººä¸è¦èª¤ç”¨. çœŸå¯¦æƒ…å¢ƒç¾å¯¦ä¸­é‡åˆ°çš„æƒ…å¢ƒæ˜¯é€™æ¨£çš„, æŸé …ä»»å‹™ä¸­è¦ç”¨åˆ°ä¸€å€‹å…¬å¸å…§éƒ¨çš„å¥—ä»¶, è€Œé€™å€‹å¥—ä»¶ä¾è³´äº†ä¸€å€‹ JSON çš„åºåˆ—åŒ–å¥—ä»¶ Jil, é‚£å•é¡Œåœ¨æ–¼ Visual Studio çš„æç¤ºåŠŸèƒ½å¯èƒ½æœƒå¼•å°Žé–‹ç™¼è€…ä½¿ç”¨ Jil æä¾›çš„é¡žåˆ¥, ä½†æˆ‘å€‘å°ˆæ¡ˆå…§éƒ¨å…¶å¯¦æ˜¯ç”¨ Json.NET, å¦‚æžœç¶­è­·çš„äººä¸å°å¿ƒå°±è·Ÿè‘— Visual Studio çš„æç¤ºç”¨äº†, å°±è®Šæˆä¸€å€‹åŠŸèƒ½ç”¨å…©ç¨®å¥—ä»¶è™•ç†è€Œå®¹æ˜“äº‚. å¦å¤–ä¸€å€‹ç–‘æ…®æ˜¯, å°±ç®—æˆ‘å€‘çœŸçš„ä¹Ÿæ˜¯ç”¨ Jil, å¦‚æžœæœ‰å¤©æˆ‘å€‘ç§»é™¤å°é€™å€‹å…§éƒ¨å¥—ä»¶çš„ä¾è³´, æˆ–æ˜¯æ›´ç‰ˆå¾Œå…§éƒ¨å¥—ä»¶ä¸ä½¿ç”¨ Jil äº†, é‚£å°±æœƒè®“æˆ‘å€‘å› ç‚ºå‡ç‰ˆä¸€å€‹å¥—ä»¶è€Œé€ æˆå¦ä¸€å€‹å¥—ä»¶çš„ä½¿ç”¨å•é¡Œ, é›–ç„¶ä¸é›£è§£æ±º, ä½†å¤šå€‹ç–‘æ…®ç¸½ä¸æ˜¯å¥½äº‹. é‚„æœ‰ç¬¬ä¸‰å€‹ç–‘æ…®æœ€éº»ç…©, ä»Šå¤©å¦‚æžœä½¿ç”¨ A å’Œ B å…©å€‹å¥—ä»¶, è€Œä»–å€‘åˆ†åˆ¥ä¾è³´ä¸åŒç‰ˆæœ¬çš„ Jil çš„æ™‚å€™å°±å¾ˆç³Ÿäº†, ç¨å¾®ç”¨ç°¡å–®æƒ…å¢ƒå¯¦æ¸¬ä¸€ä¸‹æ˜¯æœƒä½¿ç”¨é«˜ç‰ˆçš„ Jil, é€™æ„å‘³è‘—, ç•¶ä½ ä¾è³´ A å¥—ä»¶ä¸¦é€éŽå‚³éžä¾è³´ä½¿ç”¨ Jil æ™‚, å¯èƒ½æœƒå› ç‚ºå¾Œä¾†ä¾è³´ B å¥—ä»¶è€Œè®“ Jil è¢«å‡ç‰ˆ.è€Œ A å¥—ä»¶åœ¨åŸ·è¡ŒéšŽæ®µå…¶å¯¦æ˜¯å‘¼å«åˆ°è¢«å‡ç‰ˆçš„ Jil, é€™æœƒä½¿å¾— A å¥—ä»¶çš„åŸ·è¡Œçµæžœå¯èƒ½è¢«æ”¹è®Šæˆ–å› ç‚ºæ–°ç‰ˆ Jil çš„ breaking changes è€Œåœ¨åŸ·è¡ŒéšŽæ®µæ‹‹å‡ºä¾‹å¤–. ç¶œåˆä»¥ä¸Šç–‘æ…®, å¯ä»¥è€ƒæ…®ä¸è¦é€éŽå‚³éžä¾è³´è€Œæ˜¯ç›´æŽ¥ä¾è³´è©²å¥—ä»¶, é€™æ¨£ç‰ˆæœ¬è¡çªæ™‚åœ¨å®‰è£å¥—ä»¶éŽç¨‹ æœ‰ æ©Ÿ æœƒ èƒ½ç™¼ç¾. æ˜¯çš„, åªæ˜¯æœ‰æ©Ÿæœƒèƒ½ç™¼ç¾, å¦‚æžœå°ˆæ¡ˆç›´æŽ¥ä¾è³´é«˜ç‰ˆæœ¬, å‚³éžä¾è³´ä½Žç‰ˆæœ¬, æ˜¯ä¸æœƒè­¦ç¤ºçš„, é€™ç¨®æƒ…å¢ƒä¸‹æœ€å¾Œé‚„æ˜¯æœƒä½¿ç”¨é«˜ç‰ˆæœ¬çš„å¥—ä»¶, ä¸Šé¢çš„ç–‘æ…®é‚„æ˜¯ç„¡æ³•ç²å¾—è§£æ±º. å¥—ä»¶ç‰ˆæœ¬è¡çªçš„å•é¡Œåœ¨ å¥—ä»¶ç›¸ä¾æ€§å•é¡Œ é€™é‚Šå·²ç¶“é‡éŽ, è€Œä¸”é€™é‚„æ˜¯ç›´æŽ¥ä¾è³´çš„é‚„ç®—å¥½æŽŒæ¡, å¦‚æžœæ˜¯é€éŽå‚³éžä¾è³´ä½¿ç”¨çš„æŽŒæ¡ä¸Šå°±å›°é›£äº†. æˆ‘åœ¨ GitHub ä¸Šæœ‰æ”¾ä¸€å€‹å°ˆæ¡ˆä¾†å±•ç¤ºé€™äº›ç–‘æ…®. å…¶ä»–å¯èƒ½çš„åšæ³•ä¸»è¦æ˜¯åƒè€ƒé€™ç¯‡ NuGet &gt; Dependencies. é™å®šå¥—ä»¶ç‰ˆæœ¬ç¯„åœå¦‚ç¯„ä¾‹:12345&lt;!-- Accepts 1.0 up to 1.x, but not 2.0 and higher. --&gt;&lt;PackageReference Include=&quot;ExamplePackage&quot; Version=&quot;[1.0,2.0)&quot; /&gt;&lt;!-- Accepts exactly 1.0. --&gt;&lt;PackageReference Include=&quot;ExamplePackage&quot; Version=&quot;[1.0]&quot; /&gt; é€™å€‹æƒ³æ³•æ˜¯é™å®šå¥—ä»¶ç‰ˆæœ¬è®“ç‰ˆè™Ÿè¡çªæ™‚ç›´æŽ¥å¤±æ•—, ä½†æ˜¯é€™æ¨£å¯èƒ½æœƒå°Žè‡´å¤šå€‹å¥—ä»¶å¾ˆé›£ä¸€èµ·é‹ä½œ, è€Œä¸”å®˜æ–¹ä¸å»ºè­°. ç”¨ä¸€å€‹ç¨ç«‹å°ˆæ¡ˆç®¡ç†å¥—ä»¶ä¾è³´é€™å€‹ä¹‹å‰æœ‰å¯¦é©—éŽ, å°±æ˜¯é–‹ä¸€å€‹ Shared å°ˆæ¡ˆ, ä»–æœƒè¢«å¾ˆå¤šå°ˆæ¡ˆä¾è³´, è€Œå¥—ä»¶ä¾è³´éƒ½åœ¨ Shared å°ˆæ¡ˆå…§ç®¡ç†å†è®“ä¾è³´ä»–çš„å…¶ä»–å°ˆæ¡ˆå€‘éƒ½èƒ½ä½¿ç”¨ä¸€è‡´çš„å¥—ä»¶çµ„, ä½†æ˜¯å‰¯ä½œç”¨æ˜¯å…¶ä»–å°ˆæ¡ˆå¯èƒ½æœƒå­˜å–åˆ°è¨­è¨ˆä¸Šä¸å…è¨±å­˜å–çš„å¥—ä»¶, ä»¥ä¸‹é¢ç‚ºä¾‹: WebAPI (project) â€“&gt; Service (project) â€“&gt; Data Access (project) â€“&gt; Shared (Project)Service (project) â€“&gt; Shared (Project)WebAPI (project) â€“&gt; Shared (Project) å¦‚ä¸Šçš„å¤šå±¤å¼è¨­è¨ˆ, ä¸” Shared (Project) â€“&gt; Entity Framework Core (Package), é€™æ™‚å€™å¾ˆå®¹æ˜“æœ‰äººè·³éŽä¸­é–“å¹¾å±¤ç›´æŽ¥å¾ž WebAPI å±¤ç”¨ Entity Framwork Core å­˜å–è³‡æ–™åº«, æ‰€ä»¥éœ€è¦ä¾ç…§çœŸå¯¦æƒ…å¢ƒåŽ»éƒ¨åˆ†é™ç¸®å‚³éžä¾è³´, æ¯”è¼ƒéº»ç…©. çµè«–æŽ¥ä¸‹ä¾†å¯èƒ½æœƒåšä¸€äº›å…§éƒ¨å¥—ä»¶é¡žçš„å°ˆæ¡ˆ, é‚„æ˜¯è¦ç¨å¾®æ³¨æ„ä¸€ä¸‹å‚³éžä¾è³´çš„å•é¡Œ, é¿å…è®“ä½¿ç”¨è€…ä¾è³´åˆ°æ²’å¿…è¦ä¾è³´çš„å¥—ä»¶å¼•ç™¼ç¶­è­·ä¸Šçš„å›°æ“¾. è€Œåœ¨ä½¿ç”¨å¥—ä»¶æ™‚ä¹Ÿæ‡‰è©²è¦æ›´è¬¹æ…Ž, ä»¥ç”¨æœ€å°‘é‡çš„å¤šåŠŸèƒ½å¥—ä»¶è§£æ±ºæœ€å¤šçš„å•é¡Œ, ä¸ç„¶å¼•ç™¼çš„å•é¡Œéƒ½æ˜¯å¾ˆé›£ç™¼ç¾çš„, breaking changes é€ æˆåŸ·è¡ŒéšŽæ®µæ‰æ‹‹ä¾‹å¤–å·²ç¶“ä¸æ˜¯å¥½ç¾è±¡äº†, è¬ä¸€å•é¡Œæ˜¯å¾—åˆ°éŒ¯èª¤çš„çµæžœè€Œéžæ‹‹éŒ¯é‚£çœŸçš„æœƒå“­å“­. åƒè€ƒTransitive project references (ProjectReference): é€™ç¯‡å¾ˆå®Œæ•´ Controlling dependency assets) NuGet &gt; Dependencies]]></content>
      <categories>
        <category>C#</category>
        <category>.NET Core</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Encoding.UTF8 vs new UTF8Encoding() å’Œ xml åºåˆ—åŒ–çš„å¯èƒ½å•é¡Œ]]></title>
    <url>%2Fcontent%2F20210510-encoding-utf8-vs-new-utf8encoding-about-preamble.html</url>
    <content type="text"><![CDATA[Encoding.UTF8 å’Œ new UTF8Encoding() æ‰€å»ºç«‹çš„ç‰©ä»¶å…§å®¹æ˜¯æ¥µå…¶ç›¸ä¼¼çš„, ç”šè‡³æœ‰äº›å•ç­”ç¶²ç«™æ˜¯èªªå®Œå…¨ä¸€æ¨£, ä½†å¯¦éš›ä¸Šæœ‰å€‹å°å°ä¸åŒçš„åœ°æ–¹, é›–ç„¶å¤šæ•¸æ™‚å€™ä¸æœƒé€ æˆå½±éŸ¿, ä½†å‰é™£å­åœ¨å¯« xml åºåˆ—åŒ–çš„æ¸¬è©¦çš„æ™‚å€™å°±å‡ºç¾çµæžœä¸åŒçš„æƒ…å¢ƒ, æ‰€ä»¥ç¨å¾®ç´€éŒ„ä¸€ä¸‹. å•é¡Œé»žæˆ‘å€‘ç”¨ä¸‹é¢çš„ç¯„ä¾‹ä¾†åšå¯¦é©— (ç¤ºç¯„ç”¨çš„, å¿½ç•¥ clean code çš„è¦æ±‚), ç¯„ä¾‹æ˜¯åŸºæ–¼ .Net Core 3.1. 12345678910111213141516171819202122232425262728public class FakeClass&#123; public string FakeString &#123; get; set; &#125; = "A";&#125;class Program&#123; static void Main(string[] args) &#123; var serializer = new XmlSerializer(typeof(FakeClass)); var obj = new FakeClass(); var xmlWriterSettings = new XmlWriterSettings() &#123; Encoding = Encoding.UTF8 &#125;; var b = Serialize(serializer, xmlWriterSettings, obj); var xmlWriterSettings2 = new XmlWriterSettings() &#123; Encoding = new UTF8Encoding() &#125;; var b2 = Serialize(serializer, xmlWriterSettings2, obj); &#125; static byte[] Serialize&lt;T&gt;(XmlSerializer serializer, XmlWriterSettings xmlWriterSettings, T obj) &#123; var ms = new MemoryStream(); using (var xmlWriter = XmlWriter.Create(ms, xmlWriterSettings)) &#123; serializer.Serialize(xmlWriter, obj); return ms.ToArray(); &#125; &#125;&#125; å¾žä¸Šé¢çš„ç¯„ä¾‹å¯ä»¥ç™¼ç¾, b å’Œ b2 çš„å…§å®¹æ˜¯ä¸ä¸€æ¨£çš„, å…¶ä¸­ b (ä½¿ç”¨Encoding.UTF8) çš„æœ€å‰é¢å¤šäº† BOM (ä¸‰å€‹ bytes, å…§å®¹å°±æ˜¯ Encoding.UTF8.GetPreamble()), é›–ç„¶çœ‹èµ·ä¾†æ²’æœ‰å•é¡Œ, ä½†æ˜¯å¦‚åŒ XmlSerializer çš„åºåˆ—åŒ–/ååºåˆ—åŒ– èˆ‡ BOM é€™ä¸€ç¯‡æåˆ°çš„, å¦‚æžœåˆä½œå°è±¡ç„¡æ³•ååºåˆ—åŒ–å« BOM çš„ xml æ™‚, åœ¨è³‡æ–™äº¤æ›éŽç¨‹å°±æœƒæœ‰å¾ˆå¤šé˜»ç¤™, ä¸”å« BOM çš„ XML åœ¨æ–‡å­—ç·¨è¼¯å™¨ä¸Šæ˜¯ç„¡æ³•ç”¨è‚‰çœ¼çœ‹å‡ºä¾†çš„ (é™¤éžæœ‰ç‰¹åˆ¥è¨­å®šé¡¯ç¤ºç‰¹æ®Šå­—å…ƒ). å¦å¤–ä¸€ä»¶æœ‰è¶£çš„äº‹, åªè¦ bytes å…§å®¹ä¸€æ¨£, å…©ç¨®æ–¹å¼è½‰æˆå­—ä¸²å¾—åˆ°çš„å…§å®¹æ˜¯ç›¸åŒçš„, äº¦å³ Encoding.UTF8.GetString(b) == new UTF8Encoding().GetString(b) ä¸” Encoding.UTF8.GetString(b2) == new UTF8Encoding().GetString(b2). ç›¸é—œå…§å®¹ä¹‹å‰é‚£ç¯‡æéŽ, é€™ç¯‡ä¸»è¦æ˜¯è¦ç¨å¾®å°‡ç¯„åœç¸®å°åˆ° Encoding.UTF8 å’Œ new UTF8Encoding() ä¸å®Œå…¨ä¸€æ¨£ é€™ä»¶äº‹ä¸Š. çœ‹çœ‹åŽŸå§‹ç¢¼.Net Coreé‚£æ—¢ç„¶å¾žåŸ·è¡ŒçµæžœçŸ¥é“é€™å…©è€…ä¸åŒ, é‚£å°±ä»¤äººå¥½å¥‡é€™å…©è€…çš„å·®åˆ¥åˆ°åº•æœ‰å¤šå¤§äº†, é€™æ™‚å€™å°±éœ€è¦çœ‹çœ‹åŽŸå§‹ç¢¼é•·æ€Žæ¨£äº†. å…ˆå¾ž Encoding.UTF8 é–‹å§‹, å¾ž .NET Source Browser å¾€ä¸‹è¿½è¹¤, å¯ä»¥ç™¼ç¾æœ€å¾Œä½¿ç”¨çš„æ˜¯å‘¼å« UTF8Encoding(bool encoderShouldEmitUTF8Identifier) é€™å€‹å»ºæ§‹å­, åƒæ•¸å¸¶çš„æ˜¯ true, å¦‚ä¸‹:12345public UTF8Encoding(bool encoderShouldEmitUTF8Identifier) : this()&#123; _emitUTF8Identifier = encoderShouldEmitUTF8Identifier;&#125; ç„¶å¾Œæ˜¯ new UTF8Encoding(), .NET Source Browser å¾€ä¸‹è¿½è¹¤, å¯ä»¥ç™¼ç¾å‘¼å«çš„æ˜¯ UTF8Encoding() é€™å€‹å»ºæ§‹å­, å¦‚ä¸‹:1234public UTF8Encoding() : base(UTF8_CODEPAGE)&#123;&#125; å¯ä»¥çœ‹åˆ°é€™å…©å€‹æƒ…å¢ƒåªå·®åˆ¥æœƒä¸æœƒå°‡ _emitUTF8Identifier è¨­ç‚º true è€Œå·². .Net Frameworkåœ¨ .Net Framework ä¸Šæ›´ç°¡å–®, å¦‚ä¸‹å…©æ®µå°æ¯”ä¸€ç›®çž­ç„¶Encoding.UTF8 å°æ¯” new UTF8Encoding(). çµè«–é€™å€‹å·®åˆ¥å¾ˆéš±è«±, è€Œä¸”ä½¿ç”¨èµ·ä¾†é›–ç„¶å¤§å¤šæƒ…å¢ƒéƒ½æ²’å•é¡Œ, ä½†é‡åˆ°å•é¡Œæ™‚å®¹æ˜“å¡ä½å¾ˆä¹…æ‰¾ä¸åˆ°ä¸»å› , å°¤å…¶æ˜¯è·Ÿå¤–éƒ¨å» å•†äº¤äº’éŽç¨‹é‡åˆ°é€™ç¨®å•é¡ŒçœŸçš„è¦é å¤§é‡æºé€šåŠ ä¸€é»žé€šéˆèƒ½åŠ›æ‰èƒ½æ‰¾åˆ°. å¦å¤–å¦‚æžœæ²’çœ‹éŒ¯çš„è©±, UTF ç³»åˆ—çš„åªæœ‰ UTF8 æœƒæœ‰é€™å€‹å°å·®ç•°, UTF7 å’Œ UTF32 ä½¿ç”¨ Encoding.UTF7 / Encoding.UTF32 éƒ½å„è‡ªå’Œç›´æŽ¥é€éŽ UTF7Encoding / UTF32Encoding ç„¡åƒæ•¸å»ºæ§‹å­å¾—åˆ°çš„å¯¦ä¾‹ (instance) æ˜¯ä¸€æ¨£çš„. åƒè€ƒ.NET Source Browser]]></content>
      <categories>
        <category>C#</category>
        <category>.NET Core</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è·¨çµ„ä»¶åå°„çš„æ³¨æ„äº‹é …]]></title>
    <url>%2Fcontent%2F20200802-cross-assembly-reflection.html</url>
    <content type="text"><![CDATA[å•é¡Œçš„èµ·æºåœ¨æ–¼æŸæ¬¡æ¬é·ç¨‹å¼ç¢¼çš„æ™‚å€™, é›–ç„¶çœ‹èµ·ä¾†åªæ˜¯å°‡ä¸€å€‹æ–¹æ³•ç§»å‹•åˆ°åˆ¥çš„å°ˆæ¡ˆ, å»ä¸å°å¿ƒè®“ä¸€å€‹æœ‰ä½¿ç”¨åå°„çš„æ–¹æ³•åœ¨åŸ·è¡ŒéšŽæ®µæ‹‹éŒ¯, é›–ç„¶æŸ¥æ˜Žå¾Œç™¼ç¾ä¸æ˜¯å¤ªåˆé‘½çš„å•é¡Œ, ä½†å»æ˜¯å®¹æ˜“ä¸å°å¿ƒå‡ºéŒ¯çš„, æ‰€ä»¥ç¨å¾®ç´€éŒ„ä¸€ä¸‹. å•é¡Œé»žç•¶æ™‚çš„æƒ…æ³æ˜¯æœ‰å…©å€‹å°ˆæ¡ˆ, å‡è¨­æ˜¯ LogicLayer å’Œ Shared, è¦å°‡ä¸€å€‹ Create(string typeName) æ–¹æ³•å¾žåŽŸæœ¬çš„ LogicLayer å°ˆæ¡ˆæ¬åˆ° Shared ä¸­, è®“é€™å€‹å…±ç”¨çš„å·¥å…·æ–¹æ³•èƒ½å»ºç«‹åœ¨æ­£ç¢ºçš„å°ˆæ¡ˆä¸Š, æ–¹æ³•å¦‚ä¸‹: 123456// T must be base type of typeNamepublic static T Create&lt;T&gt;(string typeName)&#123; var type = Type.GetType(typeName); return (T)Activator.CreateInstance(type);&#125; å‘¼å«ç«¯å‰‡æ˜¯é€™æ¨£å‘¼å«çš„: 12var typeName = "LogicLayer.DerivedModel";var type = Create&lt;BaseModel&gt;(typeName); Create&lt;T&gt;(string typeName) æ–¹æ³•æ²’æœ‰é€™éº¼å–®ç´”, ç¯„ä¾‹åªæ˜¯ç‚ºäº†æè¿°å•é¡Œ, è€Œ â€œLogicLayer.DerivedModelâ€ æ˜¯å­˜åœ¨è³‡æ–™åº«ä¸­çš„è³‡æ–™, è¢«å–å‡ºä¾†å¾Œåšç‚ºå¼•æ•¸ä»£å…¥ Create&lt;T&gt;(string typeName) æ–¹æ³•ä¸­. ç•¶æ™‚è¦ºå¾—å°±åªæ˜¯å°‡æ–¹æ³•åŽŸå°ä¸å‹•çš„æ¬åŽ» Shared å°ˆæ¡ˆä¸­, ç·¨è­¯å’Œå–®å…ƒæ¸¬è©¦éƒ½æœ‰éŽä¹Ÿå°±ä¸æ‡‰è©²å‡ºä»€éº¼å•é¡Œ, æ²’æƒ³å»åœ¨åŸ·è¡ŒéšŽæ®µå»å‡ºç¾ Exception. åŽŸå› èˆ‡è§£æ±ºæ–¹å¼ä¸»è¦æ˜¯å› ç‚º typeName ä¸¦ä¸æ˜¯ç›®å‰çµ„ä»¶ Shared ä¸­çš„é¡žåˆ¥, æ‰€ä»¥ Type.GetType(typeName) æœƒå›žå‚³ null, å°Žè‡´æŽ¥ä¸‹ä¾†çš„ NullReferenceException. ç”±æ–¼é€™å€‹ Create&lt;T&gt;(string typeName) æ–¹æ³•å¿…é ˆåœ¨ Shared å°ˆæ¡ˆæ‰åˆç†, ä¸èƒ½å› ç‚ºé€™æ¨£ä¸æ¬ ; è€Œå¦‚æžœä½¿ç”¨å®Œæ•´çš„çµ„ä»¶é™å®šåç¨± (assembly-qualified name), åƒé€™å€‹æ¨£å­ LogicLayer.DerivedModel, LogicLayer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null ä¹Ÿä¸é©ç•¶, å› ç‚ºé€™å€‹å€¼æ˜¯å­˜åœ¨è³‡æ–™åº«ä¸­çš„, åœ¨ç›¸å®¹èˆŠè³‡æ–™çš„é™åˆ¶ä¸‹ä¸èƒ½é€™æ¨£åš. æœ€å¾Œæ˜¯æŠŠ Create&lt;T&gt;(string typeName) æ”¹æˆ Create&lt;T&gt;(Type type), ç”±å‘¼å«ç«¯å–å¾— Type å¾Œå†å‚³å…¥, ç”±æ–¼ç›®å‰ç³»çµ±çš„å‰ææ˜¯ typeName å¿…å®šå±¬æ–¼ LogicLayer å°ˆæ¡ˆä¸­çš„é¡žåˆ¥, æ‰€ä»¥é€™æ¨£åšæ˜¯åˆç†çš„. çµè«–å…¶å¯¦æ˜¯ä½Žç´šéŒ¯èª¤, å› ç‚ºé€™å€‹æ–¹æ³•å…¶å¯¦æ˜¯æœ‰åšå–®å…ƒæ¸¬è©¦çš„, ä½†æ˜¯æ¸¬è³‡ (typeName) ç”¨äº†å®Œæ•´çš„çµ„ä»¶é™å®šåç¨±, è·Ÿè³‡æ–™åº«çš„çœŸå¯¦è³‡æ–™æ ¼å¼ä¸ä¸€æ¨£, æ‰€ä»¥æ¸¬äº†ä¹Ÿæ˜¯ç™½æ¸¬æ‰æœƒæ‹–åˆ°åŸ·è¡ŒéšŽæ®µæ‰ç™¼ç¾éŒ¯èª¤. å¦å¤–é¡Œå¤–è©±å°±æ˜¯, æŠŠé¡žåˆ¥åç¨± (type name) å­˜åœ¨è³‡æ–™åº«å¾Œå†æ‹¿å‡ºä¾†åå°„, å°±æˆ‘ç›®å‰çš„è§€é»žæ˜¯å¾ˆä¸å¥½çš„è¡Œç‚º, å› ç‚ºé€™æ¨£å­æœƒè®“è³‡æ–™åº«çš„è³‡æ–™æœ¬èº«è·Ÿæ‡‰ç”¨ç¨‹å¼çš„èªžè¨€ç‰¹æ€§ç”¢ç”Ÿä¾è³´, åˆ¥èªªæ‡‰ç”¨ç¨‹å¼æ›èªžè¨€çš„æ™‚å€™é€™å€‹è³‡æ–™å°±ä¸èƒ½ç”¨äº† (æˆ–æ˜¯éœ€è¦ç¶“éŽè½‰æ›æ‰èƒ½ç”¨) , å°±ç®—åªè¦é¡žåˆ¥æ”¹åéƒ½èƒ½è®“èˆŠè³‡æ–™ç›´æŽ¥é€ æˆåœ¨åŸ·è¡ŒéšŽæ®µå‡ºéŒ¯, è®Šæˆé¡žåˆ¥çš„å‘½åèˆ‡è³‡æ–™åº«è³‡æ–™é€™å…©å€‹å…«ç«¿å­æ‰“ä¸è‘—çš„äº‹æƒ…ç”¢ç”Ÿä¾è³´, æé«˜ç¶­è­·çš„é¢¨éšªèˆ‡æˆæœ¬. ä¸åªæ˜¯é¡žåˆ¥åç¨±èˆ‡åå°„, æ‡‰è©²è¦é¿å…è·Ÿç¨‹å¼èªžè¨€æˆ–æ¡†æž¶åŸ·è¡Œæœ‰é—œçš„è³‡æ–™é€²è³‡æ–™åº«é€²è€Œç”¢ç”Ÿä¾è³´, å°±ç®—ç‰¹æ®Šæƒ…å¢ƒä¹Ÿæ‡‰è©²ç‰¹åˆ¥æ‹¿å‡ºä¾†å°ˆé–€è¨Žè«–å¾Œé¢çš„ç¶­è­·é¢¨éšªä»¥åŠæ˜¯å¦æœ‰é©åˆçš„æ›¿ä»£æ–¹æ¡ˆ.]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[NUnit ä¸­ä¸€æ¬¡æ€§åˆå§‹åŒ–çš„æ¶µè“‹ç¯„åœ]]></title>
    <url>%2Fcontent%2F20200606-nunit-one-time-setup-level.html</url>
    <content type="text"><![CDATA[ä¸€èˆ¬ä¾†èªªå¥—ä»¶çš„ä½¿ç”¨æ–¹å¼æ²’ä»€éº¼å¥½å¯«çš„, ä½†æ˜¯ä½¿ç”¨ NUnit çš„ OneTimeSetUp æ™‚, ç©¶ç«Ÿæ˜¯åœ¨å¤šå¤§çš„ç¯„åœåšä¸€æ¬¡æ€§çš„è¡Œç‚ºæœƒæ ¹æ“šé€™å€‹ç‰¹æ€§ (Attribute) çš„ä½¿ç”¨ä½ç½®è€Œä¸åŒ, é€™éƒ¨åˆ†æ–‡ä»¶æ˜¯æ”¾åœ¨ SetUpFixture Attribute ä¸€ç¯€ èªªæ˜Ž, ä¸éŽæ²’æœ‰æ‰€æœ‰æƒ…å¢ƒçš„ç¯„ä¾‹ç¨‹å¼, æ‰€ä»¥åšäº†ä¸€äº›å¯¦é©—ä¾†ç°¡å–®ç´€éŒ„ä¸€ä¸‹æ›´ç´°ç¯€çš„éƒ¨åˆ†. ä½¿ç”¨æ–¹å¼èˆ‡ç¯„åœOneTimeSetUp æ ¹æ“šæ‰€ä½¿ç”¨çš„ä½ç½®ä¸åŒ, æ¶µè“‹çš„ç¯„åœæœƒä¸åŒ, ä¸»è¦æœ‰ä¸‰ç¨®: é¡žåˆ¥å±¤ç´š :è©²é¡žåˆ¥ä¸‹åŠ ä¸Š OneTimeSetUp ç‰¹æ€§çš„æ–¹æ³•åªæœƒåŸ·è¡Œä¸€æ¬¡. å‘½åç©ºé–“å±¤ç´š :è©²å‘½åç©ºé–“ä¸‹åŠ ä¸Š OneTimeSetUp ç‰¹æ€§çš„æ–¹æ³•åªæœƒåŸ·è¡Œä¸€æ¬¡, ä¸”è©²é¡žåˆ¥ä¸Šéœ€è¦åŠ  SetUpFixture ç‰¹æ€§, åŒ…å«å­å‘½åç©ºé–“, ä¾‹å¦‚å‘½åç©ºé–“ NS ä¸‹çš„ OneTimeSetUp åœ¨ NS å’Œ NS.Sub å‘½åç©ºé–“ç¸½å…±åªæœƒåŸ·è¡Œä¸€æ¬¡. çµ„ä»¶å±¤ç´š :è‹¥ä¸åœ¨ä»»ä½•å‘½åç©ºé–“ä¸‹, å‰‡åŠ ä¸Š OneTimeSetUp ç‰¹æ€§çš„æ–¹æ³•åœ¨æ•´å€‹çµ„ä»¶ä¸­åªæœƒåŸ·è¡Œä¸€æ¬¡, è€Œè©²é¡žåˆ¥ä¸Šä¹Ÿéœ€è¦åŠ  SetUpFixture ç‰¹æ€§. ç¯„ä¾‹ç¨‹å¼ç¢¼123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107using NUnit.Framework;using System.Diagnostics;[SetUpFixture]public class OneTimeSetupClass&#123; [OneTimeSetUp] public void OneTimeSetupMethod() &#123; Debug.Print($"-- Assembly wide one-time setup."); &#125;&#125;namespace NS&#123; [SetUpFixture] public class OneTimeSetupClass &#123; [OneTimeSetUp] public void OneTimeSetupMethod() &#123; Debug.Print($"-- Namespace wide one-time setup."); &#125; &#125; [TestFixture] public class TestClass1 &#123; [OneTimeSetUp] public void OneTimeSetupMethod() &#123; Debug.Print($"-- Class wide one-time setup."); &#125; [Test] public void TestMethod1() &#123; Debug.Print($"Executeing NS.TestClass1.TestMethod1()"); &#125; [Test] public void TestMethod2() &#123; Debug.Print($"Executeing NS.TestClass1.TestMethod2()"); &#125; &#125; [TestFixture] public class TestClass2 &#123; [OneTimeSetUp] public void OneTimeSetupMethod() &#123; Debug.Print($"-- Class level one-time setup 2."); &#125; [Test] public void TestMethod1() &#123; Debug.Print($"Executeing NS.TestClass2.TestMethod1()"); &#125; [Test] public void TestMethod2() &#123; Debug.Print($"Executeing NS.TestClass2.TestMethod2()"); &#125; &#125;&#125;namespace NS.Sub&#123; [TestFixture] public class TestClass1 &#123; [Test] public void TestMethod1() &#123; Debug.Print($"Executeing NS.Sub.TestClass1.TestMethod1()"); &#125; [Test] public void TestMethod2() &#123; Debug.Print($"Executeing NS.Sub.TestClass1.TestMethod2()"); &#125; &#125;&#125;namespace NotNS&#123; [TestFixture] public class TestClass1 &#123; [Test] public void TestMethod1() &#123; Debug.Print($"Executeing NotNS.TestClass1.TestMethod1()"); &#125; [Test] public void TestMethod2() &#123; Debug.Print($"Executeing NotNS.TestClass1.TestMethod2()"); &#125; &#125;&#125; ä»¥ä¸Šæ˜¯ç¤ºç¯„ç¨‹å¼ç¢¼, å¯ä»¥å¾žä¸‹æ–¹çš„è¼¸å‡ºè¨Šæ¯ä¸­çœ‹å‡ºä¸€æ¬¡æ€§è¡Œç‚ºçš„ç¯„åœ:123456789101112-- Assembly wide one-time setup.Executeing NotNS.TestClass1.TestMethod1()Executeing NotNS.TestClass1.TestMethod2()-- Namespace wide one-time setup.Executeing NS.Sub.TestClass1.TestMethod1()Executeing NS.Sub.TestClass1.TestMethod2()-- Class wide one-time setup.Executeing NS.TestClass1.TestMethod1()Executeing NS.TestClass1.TestMethod2()-- Class level one-time setup 2.Executeing NS.TestClass2.TestMethod1()Executeing NS.TestClass2.TestMethod2() çµè«–å› ç‚º OneTimeSetUp æ˜¯æ ¹æ“šæ‰€ä½¿ç”¨çš„ä½ç½®ä¸åŒè€Œæœ‰ä¸åŒçš„æ¶µè“‹ç¯„åœ, æ‰€ä»¥ä¸€é–‹å§‹æœ‰é»žä¸ç¢ºå®šæ€Žéº¼ç”¨, å°±ç¨å¾®å¯«ä¸€ä¸‹ç°¡å–®çš„ç­†è¨˜ç´€éŒ„ä¸€ä¸‹. åƒè€ƒSetUpFixture Attribute]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ Aggregate Services æ”¶æ–‚ä¾è³´æ³¨å…¥çš„ç‰©ä»¶]]></title>
    <url>%2Fcontent%2F20200403-dependency-injection-aggregate-services.html</url>
    <content type="text"><![CDATA[é€™ç¯‡æ˜¯ç‚ºäº†ç´€éŒ„ä¾è³´æ³¨å…¥æ™‚, åˆ©ç”¨å»ºæ§‹å­æ³¨å…¥çš„æƒ…å¢ƒä¸‹, ç•¶æ³¨å…¥åˆ°æœ‰ç¹¼æ‰¿é—œä¿‚çš„é¡žåˆ¥æ™‚æ‰€å¼•ç™¼çš„ç¶­è­·ä¸Šçš„å›°æ“¾èˆ‡è§£æ±ºæ–¹æ¡ˆ. å•é¡ŒèƒŒæ™¯è€ƒæ…®ä¸‹é¢çš„ç¨‹å¼ç¢¼ 1234567891011121314151617181920public class BaseServcie&#123; private IFooDAO _fooDAO; public BaseServcie(IFooDAO fooDAO) &#123; _fooDAO = fooDAO; &#125;&#125;public class DerivedService : BaseServcie&#123; private IBarDAO _barDAO; public DerivedService(IFooDAO fooDAO, IBarDAO barDAO) : base(fooDAO) &#123; _barDAO = barDAO; &#125;&#125; ç”±æ–¼é€™å€‹æƒ…å¢ƒä¸‹, çˆ¶é¡žåˆ¥ (åŸºåº•é¡žåˆ¥) åªæœ‰ä¸€å€‹æœ‰åƒæ•¸çš„å»ºæ§‹å­, æ‰€ä»¥ä¸æœƒå¾žç·¨è­¯å™¨å–å¾—å…¬é–‹ç„¡åƒæ•¸å»ºæ§‹å­ (è¨»1) , è€Œå­é¡žåˆ¥ (è¡ç”Ÿé¡žåˆ¥) çš„å»ºæ§‹å­å¿…é ˆæ˜Žç¢ºæŒ‡å®šæ‰€è¦ä½¿ç”¨çš„çˆ¶é¡žåˆ¥çš„å»ºæ§‹å­. è¨»1:Unless the class is static, classes without constructors are given a public parameterless constructor by the C# compiler in order to enable class instantiation é€™æ¨£çš„å•é¡Œåœ¨æ–¼, ç•¶çˆ¶é¡žåˆ¥çš„å»ºæ§‹å­åƒæ•¸æ•¸é‡æ”¹è®Šæ™‚, æ‰€æœ‰å­é¡žåˆ¥çš„å»ºæ§‹å­è¦åŒæ™‚ä¿®æ”¹, å¦‚æžœå­é¡žåˆ¥å¾ˆå¤šçš„è©±, å¿…ç„¶æœƒé€ æˆç¶­è­·ä¸Šçš„å›°æ“¾. ç›´è¦ºä¸Šç•¶ç„¶å¯ä»¥æ”¹ç”¨å…¶ä»–æ³¨å…¥æ–¹å¼, ä¾‹å¦‚ç›´æŽ¥å¾ž DI å¥—ä»¶æä¾›çš„ service provider åŽ»å–å¾—å¯¦é«”, ä½†é€™æ¨£æœƒæœ‰æ¯”è¼ƒé›£åšå–®å…ƒæ¸¬è©¦çš„ç¼ºé»ž, ä¸æ˜¯å„ªå…ˆé¸é …. Aggregate Serviceè¦é¿å…é€™æ¨£çš„å•é¡Œçš„åˆ‡å…¥é»žå°±æ˜¯ è®“çˆ¶é¡žåˆ¥çš„åƒæ•¸æ•¸é‡å›ºå®šä¸€å€‹å°±å¥½, ä¹Ÿå°±æ˜¯ Aggregate Service çš„æ¦‚å¿µ, é€™æ¨£å­ä¸ç®¡ä¹‹å¾Œè¦æ€Žéº¼æ”¹å‹•çˆ¶é¡žåˆ¥æ‰€ä¾è³´çš„ç‰©ä»¶æ•¸é‡, ä¸è«–æ˜¯çˆ¶é¡žåˆ¥é‚„æ˜¯å»£å¤§çš„å­é¡žåˆ¥å€‘éƒ½ä¸éœ€è¦ä¿®æ”¹ä»»ä½•å»ºæ§‹å­çš„åƒæ•¸åˆ—. é€šç”¨ä½œæ³•å¦‚ä¸‹ç¨‹å¼ç¢¼: 12345678910111213141516171819202122232425262728public class BaseServcie&#123; private IFooDAO _fooDAO; public BaseServcie(AggregateBaseServiceDAO aggregateDAO) &#123; _fooDAO = aggregateDAO.FooDAO; &#125;&#125;public class DerivedService : BaseServcie&#123; private IBarDAO _barDAO; public DerivedService(AggregateBaseServiceDAO aggregateDAO, IBarDAO barDAO) : base(aggregateDAO) &#123; _barDAO = barDAO; &#125;&#125;public class AggregateBaseServiceDAO&#123; public AggregateBaseServiceDAO(IFooDAO _fooDAO) &#123; FooDAO = _fooDAO; &#125; public IFooDAO FooDAO &#123; get; &#125;&#125; IFooDAO æ”¶ç´é€² AggregateBaseServiceDAO æˆç‚ºä¸€å€‹å±¬æ€§, å°±ç®—ä¹‹å¾Œ BaseServcie éœ€è¦å¢žåŠ å…¶ä»–çš„ä¾è³´, BaseServcie å’Œ DerivedService çš„å»ºæ§‹å­ä¹Ÿéƒ½ä¸æœƒå—åˆ°å½±éŸ¿.é€™å€‹é€šç”¨åšæ³•ä¹Ÿä¸æ˜¯ä»€éº¼ç‰¹åˆ¥çš„æ¦‚å¿µ, å°±æ˜¯åœ¨å»ºæ§‹å­æ³¨å…¥çš„åŸºç¤Žä¸‹åŠ ä¸Šä¸€é»žè®ŠåŒ–è€Œå·², ç†è«–ä¸Šä¹Ÿä¸æœƒå—é™æ–¼ä½¿ç”¨å“ªä¸€å€‹ DI å¥—ä»¶. å¦‚æžœæ²’å¿…è¦çš„è©±, ä¸ä¸€å®šè¦å¤šæ–°å¢žä¸€å€‹ä»‹é¢ IAggregateBaseServiceDAO ä¾†è®“ AggregateBaseServiceDAO å¯¦ä½œ. Autofac çš„ RegisterAggregateServiceAutofac æä¾›äº†æ¯”è¼ƒæ–¹ä¾¿çš„ç”¨æ³•, Aggregate Service ç°¡åŒ–æˆå¦‚ä¸‹é¢é€™æ¨£, ä½†æ˜¯ Aggregate Service å¿…é ˆæ˜¯ä»‹é¢, ä¸”é™¤äº† Autofac æœ¬èº«å¤–éœ€è¦å®‰è£å¦å¤–ä¸€å€‹å¥—ä»¶ Autofac.Extras.AggregateService. 1234public interface IAggregateBaseServiceDAO&#123; IFooDAO FooDAO &#123; get; &#125;&#125; å¦å¤–, è¨»å†Šçš„æ™‚å€™è¦æ”¹ç”¨ RegisterAggregateService æ–¹æ³•å¦‚ä¸‹:1builder.RegisterAggregateService&lt;IAggregateBaseServiceDAO&gt;(); é€™é‚Šå¯ä»¥çœ‹åˆ° Autofac ç°¡åŒ–äº† Aggregate Service å…§éƒ¨çš„å»ºæ§‹å­æ³¨å…¥çš„éƒ¨åˆ†, è®“ä½¿ç”¨çš„æ™‚å€™ä¸æœƒè¦ºå¾—ç‚ºäº†å°è£é€™äº›ç‰©ä»¶è€Œéœ€è¦å¤šåšå¾ˆå¤šäº‹, é™åˆ¶ Aggregate Service å¿…é ˆæ˜¯ä»‹é¢ä¸”ä¸éœ€è¦å¯¦ä½œé¡žåˆ¥, æŸç¨®ç¨‹åº¦ä¸Šä¹Ÿæœ‰æš—ç¤ºå¾Œé¢ç¶­è­·è€…ä¸è¦åŽ»èª¤ç”¨å®ƒçš„æ•ˆæžœ, æ¯”èµ·å‰é¢ä»‹ç´¹çš„é€šç”¨åž‹ Aggregate Service ä¾†èªªå„ªé»žæ›´å¤š. çµè«–ç¸½é«”ä¾†èªª, å¦‚æžœç”¨ Autofac ä¸”å¤šå®‰è£ä¸€å€‹å¥—ä»¶ Autofac.Extras.AggregateService ä¸æœƒé€ æˆå›°æ“¾çš„è©±, ç”¨ Autofac çš„ä½œæ³•æœƒæ¯”è¼ƒæ¼‚äº®ä¸€é»ž. ä½†å¦‚æžœ DI å¥—ä»¶æ²’æœ‰ç›¸é—œåŠŸèƒ½çš„è©±, ç”¨é€šç”¨çš„ä½œæ³•ä¹Ÿæ˜¯å¾ˆä¸éŒ¯çš„. åƒè€ƒAutofac Aggregate Services]]></content>
      <categories>
        <category>C#</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¥—ä»¶ç›¸ä¾æ€§å•é¡Œ]]></title>
    <url>%2Fcontent%2F20200301-dependent-assembly-issue.html</url>
    <content type="text"><![CDATA[é€™å€‹å•é¡Œæ¯”è¼ƒè¤‡é›œ, ä¸€é–‹å§‹å¼•ç™¼å•é¡Œçš„æƒ…å¢ƒæ˜¯ A å°ˆæ¡ˆä¾è³´ B å°ˆæ¡ˆ, ä¸”é›™æ–¹éƒ½ä¾è³´åŒä¸€å€‹å¥—ä»¶, ä½†å»æ˜¯ä¸åŒç‰ˆæœ¬çš„å¥—ä»¶ ç”±æ–¼æƒ…å¢ƒæ¯”è¼ƒè¤‡é›œ, æ‰€ä»¥æˆ‘é–‹äº†ä¸€å€‹ç¯„ä¾‹å°ˆæ¡ˆ DependentAssemblyIssue ä¾†åšç¤ºç¯„, å…§æ–‡æœƒä¾ç…§æƒ…å¢ƒä¾†æè¿°è™•ç†æ–¹å¼ä»¥åŠæ‰€é€ æˆçš„å¾Œéºç—‡. åˆå§‹å¯é‹ä½œçš„æƒ…å¢ƒä»¥ç¯„ä¾‹å°ˆæ¡ˆä¸­, ç¬¬ä¸€å€‹ commit 1c5d263 ç‚ºä¾‹, ä¾è³´é—œä¿‚å¦‚ä¸‹: Client.MVC ä¾è³´ Library Client.MVC ä¾è³´ Newtonsoft.Json 6.0.1 ç‰ˆ Library ä¾è³´ Newtonsoft.Json 6.0.1 ç‰ˆ å…¶ä¸­åœ¨ Client.MVC å°ˆæ¡ˆçš„ Global.asax.cs ä¸­å‘¼å« Library å°ˆæ¡ˆçš„éœæ…‹æ–¹æ³• Worker.Do() å¦‚ä¸‹:123456789protected void Application_Start()&#123; AreaRegistration.RegisterAllAreas(); FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters); RouteConfig.RegisterRoutes(RouteTable.Routes); BundleConfig.RegisterBundles(BundleTable.Bundles); Worker.Do();&#125; Worker.Do() æœƒåœ¨ Client.MVC é–‹å•Ÿå¾Œåœ¨ Visual Studio çš„ Output è¦–çª—å°ä¸€è¡Œ log, å¯ä»¥æ­£å¸¸é‹ä½œ. å‡ç‰ˆ Library ä¾è³´çš„ Newtonsoft.Json å¼•ç™¼éŒ¯èª¤æŽ¥ä¸‹ä¾†æˆ‘å€‘å‡è¨­ç¶­è­· Library å°ˆæ¡ˆçš„å°çµ„å°‡ Newtonsoft.Json çš„ç‰ˆæœ¬å‡ç´šåˆ° 8.0.1 (commit 89d3eb9), é€™æ™‚å€™ Client.MVC é‚„æ˜¯ä¾è³´ 6.0.1 ç‰ˆ, è€Œç•¶å…¶å‘¼å« Worker.Do() æ™‚, å°±æœƒæ‹‹å‡ºä¾‹å¤–1System.IO.FileLoadException: &apos;Could not load file or assembly &apos;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&apos; or one of its dependencies. The located assembly&apos;s manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)&apos; é€™æ˜¯å› ç‚º Client.MVC åœ¨ç·¨è­¯æœŸé–“æ ¹æ“š Web.config ä¸­çš„è¨­å®šå°‡å°ç‰ˆæœ¬ 0.0.0.0 åˆ° 6.0.0.0 (oldVersion) çš„åƒè€ƒå°Žå‘ 6.0.0 (newVersion) ä½†æ˜¯ Library å°ˆæ¡ˆä¾è³´çš„æ˜¯ 8 ç‰ˆçš„é—œä¿‚.1234&lt;dependentAssembly&gt; &lt;assemblyIdentity name="Newtonsoft.Json" publicKeyToken="30ad4fe6b2a6aeed" /&gt; &lt;bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" /&gt;&lt;/dependentAssembly&gt; è§£æ±ºæ–¹å¼è§£æ±ºæ–¹å¼æœ‰å…©å€‹æ–¹å‘, ä½†æ˜¯éƒ½æœ‰ç›¸å°çš„å‰¯ä½œç”¨. ä¿®æ”¹ oldVersionå°‡ bindingRedirect çš„å±¬æ€§ oldVersion æ”¹æˆ 0.0.0.0-8.0.0.0, å°‡ 8 ç‰ˆä»¥ä¸‹çš„ Newtonsoft.Json ä¾è³´ç¹«çµåˆ° 6 ç‰ˆ, å¦‚ commit b827286 æˆ–ä¸‹æ–¹æ‰€ç¤º.1&lt;bindingRedirect oldVersion="0.0.0.0-8.0.0.0" newVersion="6.0.0.0" /&gt; ä½†æ˜¯é€™æœƒæœ‰å€‹åš´é‡çš„å‰¯ä½œç”¨, ç”±æ–¼ç·¨è­¯å‡ºä¾†å¾Œæ˜¯ä½¿ç”¨ 6 ç‰ˆçš„å¥—ä»¶, ç•¶ Library å°ˆæ¡ˆä¸­å‘¼å«äº† 8 ç‰ˆçš„å¥—ä»¶çš„æ–° API æ™‚, æœƒç™¼ç”Ÿç·¨è­¯æ™‚æœŸç”šè‡³å–®å…ƒæ¸¬è©¦éƒ½æ²’å•é¡Œ, ä½†æ˜¯å»åœ¨ Client.MVC çš„åŸ·è¡ŒéšŽæ®µç™¼ç”ŸéŒ¯èª¤, å¦‚ commit 2cc0617 æ‰€ç¤º. å¦ä¸€å€‹æ›´é›£é™¤éŒ¯çš„æƒ…å¢ƒçš„æ˜¯, ç•¶æ‰€ä½¿ç”¨çš„ API æŽ¥å£æ²’æœ‰æ”¹è®Š, ä½†æ˜¯æ”¹è®Šäº†å¯¦ä½œç´°ç¯€å°Žè‡´æ–°èˆŠç‰ˆæœ¬åŸ·è¡Œçµæžœä¸åŒçš„æ™‚å€™, å¯èƒ½é€£éŒ¯èª¤è¨Šæ¯éƒ½æ²’æœ‰å°±æ›´é›£é™¤éŒ¯äº†(é€™éƒ¨åˆ†æ²’æ‰¾åˆ°é©åˆå±•ç¤ºèˆ‡é©—è­‰çš„ API, åªæ˜¯æŽ¨æ¸¬). åŒæ™‚å‡ç‰ˆ Client.MVC ä¾è³´çš„ Newtonsoft.Jsoné€™å°±åƒ commit 4ec7c50 é€™æ¨£, ç›´æŽ¥å°‡ Client.MVC æ‰€ä¾è³´çš„å¥—ä»¶ç‰ˆæœ¬å‡åˆ°è·Ÿ Library ç›¸åŒç‰ˆæœ¬, å¦å¤– bindingRedirect ä¹Ÿè¦ä¿®æ”¹å¦‚ä¸‹.1&lt;bindingRedirect oldVersion="0.0.0.0-8.0.0.0" newVersion="8.0.0.0" /&gt; ä½†é€™ä¹Ÿæ„å‘³äº† Library æ‰€ä¾è³´çš„å¥—ä»¶ç‰ˆæœ¬æ›´æ”¹æ™‚, Client.MVC ä¹Ÿéœ€è¦ä¿®æ”¹ç›¸æ‡‰çš„å¥—ä»¶ç‰ˆæœ¬, é€™åœ¨ç¶­è­·ä¸Šæ˜¯å¾ˆå®¹æ˜“å¿½ç•¥çš„ç´°ç¯€, è€Œå¦‚æžœ Library å’Œ Client.MVC æ˜¯å…©å€‹ä¸åŒçš„å°çµ„ç¶­è­·çš„æ™‚å€™, é€™å€‹å•é¡Œå°±æ›´å®¹æ˜“å»¶å¾Œç™¼ç¾äº†. é™¤äº†ç¶­è­·ä¸æ–¹ä¾¿çš„å•é¡Œå¤–, Client.MVC ä¿®æ”¹ç›¸æ‡‰çš„å¥—ä»¶ç‰ˆæœ¬ä¹Ÿå°±æ„å‘³è‘—ä»–ç›´æŽ¥ä½¿ç”¨è©²å¥—ä»¶çš„ç¨‹å¼ç¢¼éƒ½éœ€è¦é‡æ–°æ¸¬è©¦, é¿å…æ–°ç‰ˆæœ¬çš„ API èˆ‡èˆŠç‰ˆæœ¬é‹ä½œçµæžœä¸åŒ. çµè«–é€™å€‹å•é¡Œç™¼ç”Ÿçš„æ™‚å€™å…¶å¯¦èŠ±äº†ä¸å°‘æ™‚é–“åŽ»æ‰¾, å› ç‚ºå°æ–¼ Client.MVC ä¾†èªªæ˜¯æ˜Žæ˜Žä»€éº¼éƒ½æ²’åšä½†ä»–å°±å£žäº†, Web.config ä¸­çš„è¨­å®šæ˜¯ä¸€é–‹å§‹å¼•å…¥å¥—ä»¶æ™‚å°±è‡ªå‹•åŠ å¥½çš„, æ‰€ä»¥ä¹Ÿæ²’æœ‰æƒ³åˆ°æœ‰é€™ä¸€æ®µ. äº‹å¾Œå…¶å¯¦æœ‰æƒ³éŽæ€Žéº¼åœ¨æœªä¾†é é˜²é€™é¡žçš„å•é¡Œ, ç›®å‰ä¾†èªªé‚„æ²’æƒ³åˆ°å¦‚ä½•ç°¡å–®åˆæ¼‚äº®çš„å®Œå…¨é¿é–‹é€™å€‹å•é¡Œ, ä¸€å€‹æƒ³æ³•å°±æ˜¯ç›¡é‡é¿å…é€™æ¨£çš„ä¾è³´é—œä¿‚, å¾žç°¡åŒ–å°ˆæ¡ˆèˆ‡å¥—ä»¶çš„ä¾è³´é€™å€‹è§’åº¦å¯ä»¥æœ‰ä¸€å®šç¨‹åº¦çš„æ•ˆæžœ, ä½†ç„¡æ³•å®Œå…¨é¿å…, å› ç‚ºå¾žç¾å¯¦å°ˆæ¡ˆä¾†çœ‹å°±çœŸçš„å…©å€‹å°ˆæ¡ˆéƒ½è¦ç›´æŽ¥ä¾è³´ Newtonsoft.Json, è€Œç‰¹åˆ¥å¹« Newtonsoft.Json åšä¸€å±¤éš”é›¢å±¤è®“å…©å€‹å°ˆæ¡ˆä¾è³´ä¹Ÿæ˜¯ä¸€ç¨®æ–¹å¼, ä½†å¦‚æžœé¡žæŽ¨åˆ°æ¯å€‹å¥—ä»¶éƒ½è¦åšå…¬ç”¨çš„éš”é›¢å±¤é‚£æ”¹å‹•å°±æ¯”è¼ƒå¤§äº†. åƒè€ƒRedirecting Assembly Versions Understanding a csproj assembly reference]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[é€éŽ Jenkins é–‹é—œ dotnet core æ‡‰ç”¨ç¨‹å¼]]></title>
    <url>%2Fcontent%2F20200120-dotnet-command-by-jenkins.html</url>
    <content type="text"><![CDATA[å‰é™£å­åšäº†ä¸€å€‹ dotnet core çš„æ–°å°ˆæ¡ˆ, ä¸Šç·šå‰éœ€è¦å…ˆè·Ÿ Jenkins ä½ˆç½²æµç¨‹æ•´åˆ, æœ¬ä¾†å¾ˆå–®ç´”çš„æƒ³èªªç”¨ dotnet MyCore.dll æŒ‡ä»¤é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼, è‡³æ–¼åœæ­¢çš„æ™‚å€™å°±æš´åŠ›ç”¨ kill æŒ‡ä»¤ä¾†é—œé–‰ (ç•¶ç„¶é€™ç¨®æš´åŠ›è§£åªæ˜¯åœ¨å¯¦é©—éšŽæ®µç”¨ä¾†å»ºç«‹ä¿¡å¿ƒçš„, æŽ¥ä¸‹ä¾†é‚„æ˜¯è¦æ‰¾çœ‹æœ‰æ²’æœ‰å…¶ä»–æ›´å¥½çš„åšæ³•). æ²’æƒ³åˆ°é€£ä¿¡å¿ƒéƒ½å»ºç«‹ä¸èµ·ä¾†, é€éŽ Jenkin ç”¨ kill æŒ‡ä»¤æ™‚, æœƒå‡ºç¾éŒ¯èª¤ (æ²’æœ‰æŠŠéŒ¯èª¤ç´°ç¯€è¨˜éŒ„ä¸‹ä¾†, åæ­£ç”¨ kill ä¹Ÿå¤ªæš´åŠ›, çµ‚ç©¶é‚„æ˜¯è¦æ›å€‹æ–¹æ³•çš„, æ‰€ä»¥å°±æžœæ–·æ”¾æ£„åŽ»æ‰¾å°‹æ–°æ–¹æ³•äº†). ä½¿ç”¨ dotnet æŒ‡ä»¤æ–¹ä¾¿æ­¸æ–¹ä¾¿, ä½†å¦‚åŒä¸€é–‹å§‹èªªçš„, è·Ÿ Jenkins æ•´åˆçš„æ™‚å€™æœƒæœ‰å•é¡Œ, é€™è£¡å°±æ˜¯é †ä¾¿ç´€éŒ„ä¸€ä¸‹æŒ‡ä»¤è€Œå·², æ²’ä»€éº¼ç‰¹åˆ¥çš„. é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼dotnet MyCore.dll &gt; /dev/null 2&gt;&amp;1 &amp; åœæ­¢æ‡‰ç”¨ç¨‹å¼kill -9 11905 11905 æ˜¯ pid ç”¨ systemctl æŒ‡ä»¤ç®¡ç†å»ºç«‹æœå‹™æ–°å¢ž MyCore.servicevim /etc/systemd/system/MyCore.service ç·¨è¼¯å…§å®¹ 12345678910[Unit]Description=This is MyCore[Service]WorkingDirectory=/usr/dotnet/MyCore/ExecStart=/usr/bin/dotnet /usr/dotnet/MyCore/MyCore.dllEnvironment=ASPNETCORE_ENVIRONMENT=Development[Install]WantedBy=multi-user.target é€™è£¡è¦æ³¨æ„çš„æ˜¯ç’°å¢ƒè®Šæ•¸è¦è¨­å®šåœ¨æœå‹™æª”è£¡é¢æ‰æœ‰æ•ˆ. ä¸Šé¢æœå‹™æª”çš„ç¯„ä¾‹åªæ˜¯æ¥µç°¡ç‰ˆ, èƒ½å‹•è€Œå·², å®˜æ–¹ç¯„ä¾‹åƒè€ƒé€™è£¡ å•Ÿç”¨ç”¨ systemctl é–‹é—œæ‡‰ç”¨ç¨‹å¼. 12systemctl start MyCore systemctl stop MyCore çµè«–å¦‚æžœæœƒç”¨ linux çš„è©±å…¶å¯¦ä¸ç”¨ç‰¹åˆ¥ç´€éŒ„, åªè¦çŸ¥é“ç”¨ systemctl å–ä»£ dotnet ä¾†é–‹é—œæ‡‰ç”¨ç¨‹å¼å°±å¥½, ä½†æ˜¯æˆ‘å¾ˆä¸æœƒç”¨ linux, æ‰€ä»¥é‚„æ˜¯è¦å‚™å¿˜ä¸€ä¸‹, å…å¾—ä¸‹æ¬¡é‡åˆ°ä¸€æ¨£çš„å•é¡Œè¦ google é€£é—œéµå­—éƒ½ä¸æœƒä¸‹. åƒè€ƒManage Kestrel process with systemdHost ASP.NET Core on Linux with NginxHow to run ASP.NET Core as a service on Linux (RHEL)]]></content>
      <categories>
        <category>C#</category>
        <category>.NET Core</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è¿½è¹¤èˆ‡åçµ„è­¯ C# ç¨‹å¼ç¢¼]]></title>
    <url>%2Fcontent%2F20191229-trace-csharp-source-code.html</url>
    <content type="text"><![CDATA[åœ¨é–‹ç™¼ C# ç¨‹å¼æˆ–æ˜¯å­¸ç¿’éŽç¨‹, æœƒç”¨åˆ°è¨±å¤šä¸æ˜¯ç”±æˆ‘å€‘é–‹ç™¼çš„æ¡†æž¶æˆ–å¥—ä»¶, å¾ˆå¤šæ™‚å€™æœƒéœ€è¦çŸ¥é“å…§éƒ¨çš„é‹ä½œæ–¹å¼, é€™ç¯‡ç´€éŒ„å¹¾å€‹æ–¹å¼ä¾†è®“æˆ‘å€‘èƒ½çŸ¥é“å¥—ä»¶å…§éƒ¨ç©¶ç«Ÿåšäº†ä»€éº¼. å®˜æ–¹åŽŸå§‹ç¢¼æœ€æº–ç¢ºçš„æ–¹å¼, ç›´æŽ¥çœ‹å®˜æ–¹æä¾›çš„åŽŸå§‹ç¢¼, å¯èƒ½å­˜æ”¾åœ¨ GitHub æˆ–å…¶ä»–å„²å­˜åº«, ä¸€èˆ¬å°åž‹ç¬¬ä¸‰æ–¹å¥—ä»¶æ‡‰è©²éƒ½èƒ½å¿«é€Ÿäº†è§£, ä½†æ˜¯å¦‚æžœè¦çœ‹çš„æ˜¯ .NET Framework æˆ–æ˜¯è¶…å¤§åž‹å¥—ä»¶æ™‚, å°±æœƒæ¯”è¼ƒè²»ç¥ž, è€Œä¸”ä¹Ÿç„¡æ³•æœŸå¾…æ‰€æœ‰å¥—ä»¶éƒ½æœ‰é–‹æº. å¦å¤– .NET Framework å’Œ .NET Core éƒ½æœ‰åŽŸå§‹ç¢¼æŸ¥è©¢ç¶²ç«™, å¯ä»¥å¿«é€Ÿæ‰¾åˆ°åŽŸå§‹ç¢¼çš„å¯¦ä½œå…§å®¹. .NET Framework Reference Source .NET Core Source Browser Visual Studio 2019ç›´æŽ¥å…§å»ºåœ¨ Visual Studio ä¸­, GoToDefinition (F12) é€²å…¥å°±å¯ä»¥çœ‹åˆ°, è¨­å®šæ–¹å¼ä¹Ÿå¾ˆç°¡å–®:Tools &gt; Options &gt; Text Editor &gt; C# &gt; Advanced &gt; enable navigation to decompiled sources (experimental) ä½†æ˜¯é€™å€‹åŠŸèƒ½åœ¨ .NET Core çš„å°ˆæ¡ˆä¸Šç„¡æ³•åçµ„è­¯å‡ºæ­£ç¢ºå…§å®¹, é¸é …ä¸Šä¹Ÿæ¨™æ˜Ž experimental. å…¶ä»–å·¥å…·ILSpyç¬¬ä¸‰æ–¹åçµ„è­¯å·¥å…·å¾ˆå¤š, å…¶ä¸­æˆ‘æœ€æŽ¨è–¦çš„æ˜¯ ILSpy, å¯åœ¨ Extensions &gt; Manage Extensions è£¡é¢æ‰¾åˆ°ä¸¦å®‰è£, èƒ½åœ¨ Visual Studio ç›´æŽ¥æŒ‰å³éµé–‹å•Ÿ ILSpy éžå¸¸æ–¹ä¾¿. é–‹å•Ÿå¾Œä¹Ÿå¯ä»¥é¸æ“‡ C# ç‰ˆæœ¬ å¦å¤–ä¹Ÿå¯ä»¥é¸æ“‡ C# è·Ÿ IL åŒæ™‚é¡¯ç¤º, å¯ä»¥å°ç…§è‘—çœ‹, äº†è§£ä¸åŒå¯«æ³•ç·¨è­¯å¾Œæ˜¯ä¸æ˜¯ä¸€æ¨£çš„å…§å®¹, çœ‹ä¸æ‡‚ IL Code ä¹Ÿæ²’é—œä¿‚, æ»‘é¼ ç§»éŽåŽ»é‚„æœƒå‡ºç¾èªªæ˜Žæ¡†, é»žæ“Šå¾Œæœƒé–‹å•Ÿç€è¦½å™¨å°Žé åˆ° msdn, é€™éƒ¨åˆ†åœ¨å¯¦é©—å­¸ç¿’çš„éŽç¨‹å¾ˆå¥½ç”¨. dotPeek å’Œ JustDecompileæ¯”èµ· ILSpy ä»‹é¢å¥½çœ‹å¾ˆå¤š, å¾ˆå¤šæ–¹ä¾¿çš„åŠŸèƒ½, å¦‚æžœæ˜¯è¦ä»”ç´°çœ‹ç¨‹å¼æµç¨‹çš„è©±, é€™å…©è€…æ›´é©åˆ. çµè«–åçµ„è­¯å·¥å…·æ‰€ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼ä¸ä¸€å®šè·ŸåŽŸæœ¬çš„å…§å®¹ä¸€æ¨£, å¦‚æžœçœŸçš„è¦ç ”ç©¶å¯¦ä½œæ–¹å¼ç­‰ç´°ç¯€çš„è©±, é‚„æ˜¯ç›´æŽ¥çœ‹é–‹æºçš„ç¨‹å¼ç¢¼å…§å®¹æ¯”è¼ƒæº–ç¢º. åƒè€ƒILSpydotPeekJustDecompile]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Json.NET ååºåˆ—åŒ–æ•¸å­—æ™‚, å°¾æ•¸ 0 å¯èƒ½è¢«æ¨æ£„]]></title>
    <url>%2Fcontent%2F20191126-json-net-trailing-zero-number-problem.html</url>
    <content type="text"><![CDATA[ç”¨ Json.NET ä¾†å°‡ JSON å­—ä¸²ååºåˆ—åŒ–æˆç‰©ä»¶æ˜¯å¾ˆå…¸åž‹çš„åšæ³•, ä»¥å‰ä¹Ÿæ²’å‡ºéŽä»€éº¼å•é¡Œ, ä½†åœ¨æŸäº›ä½¿ç”¨æ–¹å¼ä¸‹, æœƒå‡ºç¾æ•¸å­—çš„å°¾æ•¸ 0 è¢«ç§»é™¤çš„ç‹€æ³, ä¾‹å¦‚: 10.00 æœƒè¢«è½‰æˆ 10, è€Œ 10.10 æœƒè¢«è½‰æˆ 10.1. é›–ç„¶é€™å€‹çµæžœä¹çœ‹ä¹‹ä¸‹æ²’ä»€éº¼å½±éŸ¿, ä½†å¦‚æžœè³‡æ–™æ˜¯åœ¨è·Ÿç¬¬ä¸‰æ–¹ API ä»‹æŽ¥æ™‚, ç°½ç«  (sign) æ‰€éœ€è¦çš„æ¬„ä½æ™‚, å°±æœƒç›´æŽ¥å°Žè‡´ç°½ç« æª¢æ ¸éŒ¯èª¤. æ­£å¸¸æƒ…å¢ƒä»¥æˆ‘ä¹‹å‰ç¿’æ…£å°‡ JSON å­—ä¸²ååºåˆ—åŒ–æˆ Model çš„ç”¨æ³•ä¾†èªª, æ˜¯ä¸æœƒæœ‰é€™å€‹å•é¡Œçš„, å¦‚ä¸‹. 12345678910111213public class Data&#123; [JsonProperty("money")] public string Money &#123; get; set; &#125;&#125;static void Main(string[] args)&#123; string jsonString = "&#123;\"money\":10.10&#125;"; var data = JsonConvert.DeserializeObject&lt;Data&gt;(jsonString); // output: 10.10 Console.WriteLine(data.Money);&#125; å‡ºå•é¡Œçš„æƒ…å¢ƒå•é¡Œæè¿°å¦‚æžœæˆ‘å€‘çš„ API æŽ¥å—å¤§é‡ä¾†è‡ªå¤–éƒ¨çš„å‘¼å«, ä¸” JSON çš„æ¬„ä½åç¨±èˆ‡çµæ§‹ä¸å›ºå®š, æˆ‘å€‘å¯èƒ½ä¸å¸Œæœ›å»ºç«‹å¤§é‡çš„ Model ä¾†ååºåˆ—åŒ–, é‚£ç¨‹å¼ç¢¼å¯èƒ½æœƒè®Šæˆä¸‹é¢é€™æ¨£: 1234string jsonString = "&#123;\"money\":10.10&#125;";var data = JObject.Parse(jsonString);// output: 10.1Console.WriteLine(data.GetValue("money")); ä¸åªæ˜¯ç›´æŽ¥ç”¨ JObject å–å€¼çš„æƒ…å¢ƒ, è¦æŠŠ JSON å­—ä¸²è½‰æˆä¸€å€‹ Dictionary æˆ–é¡žä¼¼æƒ…å¢ƒæ™‚, éƒ½æœƒç¢°åˆ°é€™å€‹å•é¡Œ. è§£æ±ºæ–¹å¼é›–ç„¶è¤‡é›œå¾ˆå¤š, ä½†ç”¨åœ¨è§£æžä¸å›ºå®šçµæ§‹çš„ JSON å­—ä¸² (jsonString) ä¸¦å–å‡ºç‰¹å®šæ¬„ä½æˆ–æ‰€æœ‰æ¬„ä½æ™‚å¾ˆæ–¹ä¾¿, ä¸”è¦å–å‡ºçš„æ¬„ä½åç¨±å¯åšç‚ºåƒæ•¸ä¹Ÿæ”¯æ´å·¢ç‹€çš„çµæ§‹(åªè¦ç¬¦åˆ JSONPath expression çš„è¦å‰‡). 12345678910string jsonString = "&#123;\"money\":10.10&#125;";using (var sr = new StringReader(jsonString))using (var jr = new JsonTextReader(sr))&#123; jr.FloatParseHandling = FloatParseHandling.Decimal; var jsonContent = JToken.ReadFrom(jr); var target = jsonContent.SelectToken("money"); // output: 10.10 Console.WriteLine(target);&#125; çµè«–ä¸€èˆ¬æƒ…å¢ƒä¸‹, ååºåˆ—åŒ–é‚„æ˜¯å»ºè­°ç›¡é‡è½‰æ›æˆ Model, å¾ŒçºŒæœƒå¥½æ“ä½œå¾ˆå¤š, ä¸”å¯ä»¥æ¸›å°‘ç”¨ JObject ç­‰æ–¹å¼æ“ä½œé€ æˆåŸ·è¡ŒéšŽæ®µå®¹æ˜“å‡ºéŒ¯çš„ç–‘æ…®. ä½†åœ¨ç¾å¯¦å°ˆæ¡ˆä¸­, æ¢ä»¶ç¸½æ˜¯æ¯”è¼ƒè¤‡é›œ, é‚„è¦è€ƒæ…®åŽŸæœ¬ç³»çµ±çš„è¨­è¨ˆèˆ‡ç¾æ³, æ‰€ä»¥é‚„æ˜¯å¯èƒ½æœƒé‡åˆ°ä¸é©åˆååºåˆ—åŒ–æˆç‰¹å®š Model çš„æƒ…å¢ƒ, å°±éœ€è¦éˆæ´»è®ŠåŒ–äº†.]]></content>
      <categories>
        <category>C#</category>
        <category>Packages</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸ä¾è³´ DDEX provider ä½¿ç”¨ Entity Framework æ“ä½œ SQLite]]></title>
    <url>%2Fcontent%2F20191017-manually-use-sqlite-with-ef.html</url>
    <content type="text"><![CDATA[åœ¨ä¹‹å‰çš„æ–‡ç«  åœ¨ vs2017 ä¸­ä½¿ç”¨ Entity Framework æ“ä½œ SQLite ä½¿ç”¨æ–¹å¼é›–ç„¶æ–¹ä¾¿, ä½†æ˜¯ç›¸å°çš„éžå¸¸ä¾è³´å·¥å…·, æ‰€ä»¥é€™ç¯‡ç”¨ä¾†è¨˜éŒ„ç”¨ç›¡é‡å°‘çš„å·¥å…·ä¾†ä½¿ç”¨ Entity Framework æ“ä½œ SQLite. å¥—ä»¶èˆ‡å·¥å…·å®‰è£ä¸åŒæ–¼ä¹‹å‰, é€™æ¬¡åªéœ€è¦ å®‰è£ NuGet å¥—ä»¶ System.Data.SqliteSystem.Data.Sqlite æœƒä¸€ä½µå®‰è£ä¾è³´çš„å¥—ä»¶èˆ‡ Entity Framework æœ¬èº«. è¨­å®š App.configApp.config ä¸­ä¸»è¦æœ‰ä¸‰å€‹éƒ¨åˆ†è¦è¨­å®š, æœ‰äº›åœ¨å®‰è£ System.Data.Sqlite èˆ‡ Entity Framework æ™‚æœƒæœ‰é è¨­çš„å…§å®¹, é è¨­å…§å®¹å¯èƒ½éœ€è¦èª¿æ•´, å¯é‹ä½œçš„ç‰ˆæœ¬å¦‚ä¸‹: &lt;providers&gt; å€å¡Šé€™å€‹å€å¡Šåœ¨ &lt;entityFramework&gt;&lt;/entityFramework&gt; ä¸­, å®‰è£å®Œ Entity Framework æœƒè‡ªå‹•ç”Ÿæˆä¸€çµ„ç¯„æœ¬, ä¿®æ”¹å¾Œåªç•™å¿…è¦çš„.123&lt;providers&gt; &lt;provider invariantName="SQLiteProvider" type="System.Data.SQLite.EF6.SQLiteProviderServices, System.Data.SQLite.EF6" /&gt;&lt;/providers&gt; &lt;system.data&gt; å€å¡Šé€™å€‹å€å¡Šåœ¨ &lt;configuration&gt;&lt;/configuration&gt; ä¸­.12345&lt;system.data&gt; &lt;DbProviderFactories&gt; &lt;add name="SQLite Data Provider" invariant="SQLiteProvider" description=".NET Framework Data Provider for SQLite" type="System.Data.SQLite.SQLiteFactory, System.Data.SQLite" /&gt; &lt;/DbProviderFactories&gt;&lt;/system.data&gt; &lt;connectionStrings&gt; å€å¡Šé€™å€‹å€å¡Šåœ¨ &lt;configuration&gt;&lt;/configuration&gt; ä¸­, è·Ÿ &lt;system.data&gt; åŒä¸€å±¤. 123&lt;connectionStrings&gt; &lt;add name="NorthwindConnection" providerName="SQLiteProvider" connectionString="data source=C:\Users\Ron\Desktop\SqliteDemo\SqliteDemo\Northwind.sqlite"/&gt;&lt;/connectionStrings&gt; èªªæ˜Žç›¸è¼ƒæ–¼ä¹‹å‰é€éŽå·¥å…·ç”¢ç”Ÿçš„å…§å®¹, é€™é‚Šæ‰‹å‹•èª¿æ•´å¾Œç°¡çŸ­å¾ˆå¤š, è¦æ³¨æ„çš„å¤§æ¦‚å°±æ˜¯ providerName, invariant å’Œ invariantName è¦å°å¾—èµ·ä¾†, connectionString å¯«å¥½å°±å¥½. æ–°å¢ž Modelä»¥åŒ—é¢¨è³‡æ–™åº«ä¸­çš„ Category è¡¨ç‚ºä¾‹, æ–°å¢žä¸€å€‹ç›¸æ‡‰çš„ Model å¦‚ä¸‹:123456public partial class Category&#123; public long Id &#123; get; set; &#125; public string CategoryName &#123; get; set; &#125; public string Description &#123; get; set; &#125;&#125; æ–°å¢ž NorthwindContextç¹¼æ‰¿ DbContext ä¸¦è¦†å¯« OnModelCreating(DbModelBuilder) æ–¹æ³•, è¨­å®šè³‡æ–™è¡¨è·Ÿ Model çš„å°æ‡‰, ä¸¦å¢žåŠ ç›¸æ‡‰çš„ DbSet&lt;T&gt;. 12345678910111213public partial class NorthwindContext : DbContext&#123; public NorthwindContext() : base("name=NorthwindConnection") &#123; &#125; protected override void OnModelCreating(DbModelBuilder modelBuilder) &#123; modelBuilder.Entity&lt;Category&gt;().ToTable("Category"); base.OnModelCreating(modelBuilder); &#125; public virtual DbSet&lt;Category&gt; Categories &#123; get; set; &#125;&#125; DbContext çš„éƒ¨åˆ†å°±æˆ‘ç›®å‰ç†è§£æ˜¯ UnitOfWork Pattern çš„å¯¦ä½œ, è€Œ DbSet&lt;T&gt; å‰‡åƒæ˜¯ Generic Repository. å¯«æ®µç¨‹å¼ç”¨ç”¨çœ‹123456789101112131415class Program&#123; static void Main(string[] args) &#123; using (var context = new NorthwindContext()) &#123; var categories = context.Categories.ToList(); foreach (var category in categories) &#123; Console.WriteLine($"&#123;category.CategoryName&#125;: &#123;category.Description&#125;"); &#125; &#125; Console.ReadLine(); &#125;&#125; çµè«–ç”¨é€™ç¨®æ–¹å¼ä¾†å„ªé»žå°±æ˜¯å½ˆæ€§, æ¸›å°‘é–‹ç™¼å·¥å…·çš„ç›¸å®¹æ€§çš„å•é¡Œ, å¦ä¸€æ–¹é¢, å¯¦ä½œéŽç¨‹èƒ½æ›´æ¸…æ¥šæ¯å€‹ç’°ç¯€çš„è§’è‰², å³ä½¿ä¸å®Œå…¨äº†è§£ç´°ç¯€ä¹Ÿèƒ½é¿å…éŽåº¦ä¾è³´å·¥å…·è‡ªå‹•ç”¢ç”Ÿç¨‹å¼ç¢¼è€Œå¿˜è¨˜è¦åŽ»äº†è§£å…§å®¹. ç¼ºé»žä¹Ÿæ˜¯é¡¯è€Œæ˜“è¦‹çš„, è³‡æ–™åº«æ¬„ä½è®Šå‹•å¾Œéƒ½éœ€è¦æ‰‹å‹•ç¶­è­· Model å’Œ NorthwindContext, æ²’æœ‰å·¥å…·å¹«å¿™åŒæ­¥, ç¶­è­·æˆæœ¬é«˜. ç¸½çµä¾†èªª, ç”¨åœ¨ç”¢å“é–‹ç™¼ä¸Šå¤ªè€—æ™‚é–“æœ‰é»žä¸å¯¦éš›, ä½†ä½œç‚ºå·¥å…·é™åˆ¶ä¸‹çš„æ–¹æ¡ˆæˆ–æ˜¯å­¸ç¿’ç”¨é€”é‚„æ˜¯å¾ˆé©åˆçš„.]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ vs2017 ä¸­ä½¿ç”¨ Entity Framework æ“ä½œ SQLite]]></title>
    <url>%2Fcontent%2F20190907-use-sqlite-with-ef-and-vs2017.html</url>
    <content type="text"><![CDATA[æœ‰æ™‚å€™åšä¸€äº›å¯¦é©—çš„æ™‚å€™æœƒéœ€è¦ç”¨åˆ°è³‡æ–™åº«, ä½†æ˜¯ç‚ºäº†å¯¦é©—ç‰¹åˆ¥æž¶ä¸€å€‹ SQL Server çš„ç’°å¢ƒå¯¦åœ¨æ˜¯å¾ˆéº»ç…©, é›»è…¦é‡çŒæˆ–æ˜¯è™›æ“¬æ©Ÿé‡è£çš„æ™‚å€™é‡å»ºä¹Ÿéº»ç…©, æ‰€ä»¥å°±æŠŠè…¦ç­‹å‹•åˆ° SQLite ä¸Šäº†, ä¸éŽæ“ä½œä¸Šæ²’æœ‰æƒ³åƒä¸­çš„ç°¡å–®å‘¢. å› ç‚ºæ˜¯ç‚ºäº†å»ºæ§‹å¯¦é©—ç”¨çš„è³‡æ–™åº«, ä¸å¸Œæœ›èŠ±å¤ªå¤šæ™‚é–“, å¸Œæœ›èƒ½ç›¡å¯èƒ½æ–¹ä¾¿çš„å°‡è³‡æ–™å­˜å–å±¤å»ºèµ·ä¾†, æ‰€ä»¥æŽ¡ç”¨è³‡æ–™åº«å„ªå…ˆ (database first) çš„æ–¹å¼ä¾†å»ºç«‹ ADO.NET Entity Data Model (*.edmx). å¥—ä»¶èˆ‡å·¥å…·å®‰è£System.Data.SQLite DDEX provider ä¸æ”¯æ´ Visual Studio 2017, æ‰€ä»¥éœ€è¦å€ŸåŠ©å…¶ä»–å¥—ä»¶çš„å¹«å¿™, SqlCeToolbox æä¾›å¥—ä»¶æ”¯æ´èˆ‡å®‰è£æ•™å­¸, å…§å®¹å¾ˆå®Œæ•´, æ‰€ä»¥é€™é‚Šåªç¨å¾®åˆ—ä¸€ä¸‹æ­¥é©Ÿ. å®‰è£ SqlCeToolbox å®‰è£ SQLite åˆ° GACé€™é‚Šè¦æ³¨æ„åªèƒ½å®‰è£ç‰¹å®šç‰ˆæœ¬æ‰è¡Œ, ç‰¹å®šç‰ˆæœ¬æœƒæœ‰ä¸‹é¢çš„æ¨™è¨» (ç²—é«”æ”¾å¤§æ‡‰è©²ä¸é›£æ‰¾), æˆ‘æ˜¯å®‰è£ Setups for 32-bit Windows (.NET Framework 4.6) é€™å€‹ç‰ˆæœ¬. This is the only setup package that is capable of installing the design-time components for Visual Studio 2015. å®‰è£ NuGet å¥—ä»¶ System.Data.SqliteSystem.Data.Sqlite æœƒä¸€ä½µå®‰è£ä¾è³´çš„å¥—ä»¶èˆ‡ Entity Framework æœ¬èº«. æ–°å¢ž ADO.NET Entity Data Model (*.edmx) é€™äº›æ­¥é©Ÿæœ‰äº›åœ°æ–¹è¦ç¨å¾®æ³¨æ„ä¸€ä¸‹ NorthwindContext æœƒæˆç‚º App.config ä¸­ connectionStrings é€™ä¸€æ®µçš„é è¨­åå­—, å¦‚ä¸‹: App.config 123&lt;connectionStrings&gt; &lt;add name="NorthwindContext" connectionString="metadata=res://*/DataAccess.Northwind.csdl|res://*/DataAccess.Northwind.ssdl|res://*/DataAccess.Northwind.msl;provider=System.Data.SQLite.EF6;provider connection string=&amp;quot;data source=C:\Users\Ron\Desktop\SqliteDemo\SqliteDemo\Northwind.sqlite;version=3&amp;quot;" providerName="System.Data.EntityClient" /&gt;&lt;/connectionStrings&gt; Northwind.Context.cs 123456789public partial class NorthwindContext : DbContext&#123; public NorthwindContext() : base("name=NorthwindContext") &#123; &#125; // skip...&#125; Model Namespace ä¸€æ¬„çš„å€¼ â€œNorthwindâ€ æœƒåœ¨ Northwind.edmx ä¸­ç”¨ä¾†ä½œç‚ºå‘½åç©ºé–“, å–å€‹åˆç†çš„åå­—å°±å¥½. å¯«æ®µç¨‹å¼ç”¨ç”¨çœ‹12345678910111213141516class Program&#123; static void Main(string[] args) &#123; using (var context = new NorthwindContext()) &#123; var categories = context.Categories.ToList(); foreach (var category in categories) &#123; Console.WriteLine($"&#123;category.CategoryName&#125;: &#123;category.Description&#125;"); &#125; &#125; Console.ReadLine(); &#125;&#125; æ²’æ„å¤–çš„è©±, æœƒæ‹‹å‡º Exception, é è¨­åœ¨ App.config ä¸­å¡«å…¥çš„è¨­å®šæ˜¯éœ€è¦ä¸€äº›èª¿æ•´çš„. èª¿æ•´ App.configèª¿æ•´èª¿æ•´ä¸€ä¸‹ App.config ä¸­,DbProviderFactories1234&lt;DbProviderFactories&gt; &lt;remove invariant="System.Data.SQLite.EF6" /&gt; &lt;add name="SQLite Data Provider" invariant="System.Data.SQLite.EF6" description=".NET Framework Data Provider for SQLite" type="System.Data.SQLite.SQLiteFactory, System.Data.SQLite" /&gt;&lt;/DbProviderFactories&gt; App.config ç›¸é—œå…§å®¹ç¯€éŒ„:1234567891011121314151617181920&lt;entityFramework&gt; &lt;defaultConnectionFactory type="System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework"&gt; &lt;parameters&gt; &lt;parameter value="mssqllocaldb" /&gt; &lt;/parameters&gt; &lt;/defaultConnectionFactory&gt; &lt;providers&gt; &lt;provider invariantName="System.Data.SqlClient" type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" /&gt; &lt;provider invariantName="System.Data.SQLite.EF6" type="System.Data.SQLite.EF6.SQLiteProviderServices, System.Data.SQLite.EF6" /&gt; &lt;/providers&gt;&lt;/entityFramework&gt;&lt;system.data&gt; &lt;DbProviderFactories&gt; &lt;remove invariant="System.Data.SQLite.EF6" /&gt; &lt;add name="SQLite Data Provider" invariant="System.Data.SQLite.EF6" description=".NET Framework Data Provider for SQLite" type="System.Data.SQLite.SQLiteFactory, System.Data.SQLite" /&gt; &lt;/DbProviderFactories&gt;&lt;/system.data&gt;&lt;connectionStrings&gt; &lt;add name="NorthwindContext" connectionString="metadata=res://*/DataAccess.Northwind.csdl|res://*/DataAccess.Northwind.ssdl|res://*/DataAccess.Northwind.msl;provider=System.Data.SQLite.EF6;provider connection string=&amp;quot;data source=C:\Users\Ron\Desktop\SqliteDemo\SqliteDemo\Northwind.sqlite;version=3&amp;quot;" providerName="System.Data.EntityClient" /&gt;&lt;/connectionStrings&gt; &lt;provider invariantName=&quot;System.Data.SQLite.EF6&quot;&gt; ä¸­ invariantName æœƒè¢«ä»¥ä¸‹å¹¾å€‹åœ°æ–¹åƒè€ƒ, è¦æ›åå­—çš„è©±å››å€‹åœ°æ–¹éƒ½è¦æ›, ä¸ç„¶åŸ·è¡ŒéšŽæ®µæœƒæ‹‹ä¾‹å¤– &lt;DbProviderFactories&gt; ä¸‹çš„ &lt;add&gt; çš„å±¬æ€§ invariant &lt;connectionStrings&gt; ä¸‹çš„ &lt;add&gt; çš„å±¬æ€§ connectionString å…§çš„ provider Northwind.edmx ä¸­ &lt;Schema&gt; çš„å±¬æ€§ Provider çµè«–é€™ç¨®åšæ³•å°æ–¼å¿«é€Ÿé–‹ç™¼æ‡‰ç”¨ä¾†èªªå¾ˆé©åˆ, ç•¢ç«Ÿå·¥å…·å·²ç¶“å¹«å¿™ç”¢å‡ºå¤§éƒ¨åˆ†çš„è¨­å®šèˆ‡ç¨‹å¼ç¢¼. ä½†ä¹Ÿç”±æ–¼å¾ˆå¤šå…§å®¹æ˜¯è‡ªå‹•ç”¢ç”Ÿçš„, æ‰€ä»¥å¦‚æžœæ²’æœ‰ç‰¹åˆ¥åŽ»ç ”ç©¶, æœƒä¸çŸ¥é“ç©¶ç«Ÿè‡ªå‹•ç”¢ç”Ÿäº†ä»€éº¼è¨­å®šèˆ‡ç¨‹å¼, ä¸çŸ¥é“ç›¸é—œç´°ç¯€ä¿®æ”¹èµ·ä¾†å°±å®¹æ˜“å‡ºéŒ¯, è€Œä¸”è‡ªå‹•ç”¢ç”Ÿ *.edmx é‚„è¦çœ‹æ‰€ç”¨ç‰ˆæœ¬çš„ visual stuio æœ‰æ²’æœ‰æ”¯æ´, å¦‚æžœç”¨åˆ°ä¸æ”¯æ´çš„ç‰ˆæœ¬å°±æœƒè®Šå¾—å¾ˆéº»ç…©. åƒè€ƒEF6 workflow with SQLite DDEX providerSQLiteSQLite EntityFramework 6 Tutorialnorthwind-SQLite3]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ WebAPI ä¸­è™•ç† multipart/form-data è³‡æ–™]]></title>
    <url>%2Fcontent%2F20190826-handle-multipart-formdata-by-webapi.html</url>
    <content type="text"><![CDATA[åœ¨è·Ÿå¤–éƒ¨å» å•†ä»‹æŽ¥çš„éŽç¨‹ç™¼ç¾å°‘æ•¸å» å•†åœ¨ç™¼é€åˆ°æˆ‘å€‘çš„ WebAPI çš„ request æ˜¯ multipart/form-data çš„, ä»¥å‰èˆŠçš„è€å°ˆæ¡ˆä¸­è¦è™•ç†é€™ç¨®è³‡æ–™é‚„è¦é€éŽç¬¬ä¸‰æ–¹å¥—ä»¶, å¾Œä¾†åœ¨é·ç§»åˆ° .NET çš„éŽç¨‹ä¸­ç™¼ç¾,ç”¨ .NET è™•ç†é€™é¡žåž‹çš„è³‡æ–™æ˜¯å¯ä»¥ä¸ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶çš„, æ‰€ä»¥ç´€éŒ„ä¸€ä¸‹ç¢°åˆ°çš„å¹¾ç¨®æƒ…å¢ƒçš„è™•ç†æ–¹å¼. é€™é‚Šé™¤äº†ç”¨ MultipartFormDataContent å’Œ HttpClient ä¾†æ¨¡æ“¬å®¢æˆ¶ç«¯å‘¼å«æˆ‘å€‘çš„ WebAPI ä¹‹å¤–, ä¹Ÿæœƒç”¨ postman æ¨¡æ“¬ (æ¯”è¼ƒæ–¹ä¾¿ä¸ç”¨å¯«ç¨‹å¼), è€Œç”¨ postman æ¨¡æ“¬è¦æ³¨æ„ä¸è¦é¡å¤–å°‡ content-type è¨­æˆ multipart/form-data, ç†ç”±é€™ç¯‡è¨Žè«–çš„å›žæ‡‰ä¸­æœ‰æåˆ°. åŒ…å« FileNameå®¢æˆ¶ç«¯å‘¼å« API çš„ç¨‹å¼ç¢¼ç´„ç•¥å¦‚ä¸‹:12345678using (var content = new MultipartFormDataContent())&#123; content.Add(new StringContent("key1"), "value1", "file1.txt"); content.Add(new StringContent("key2"), "value2", "file2.txt"); var req = new HttpClient(); req.PostAsync("http://localhost:50640/api/multipart", content).Wait();&#125; ç”¨ postman æ¨¡æ“¬çš„è©±æœƒæ˜¯é€™æ¨£: è€Œ body çš„å…§å®¹å¦‚ä¸‹:1234567891011--29874ecd-2a56-406a-a2c0-18eff0d3ae85Content-Type: text/plain; charset=utf-8Content-Disposition: form-data; name=value1; filename=file1.txt; filename*=utf-8&apos;&apos;file1.txtkey1--29874ecd-2a56-406a-a2c0-18eff0d3ae85Content-Type: text/plain; charset=utf-8Content-Disposition: form-data; name=value2; filename=file2.txt; filename*=utf-8&apos;&apos;file2.txtkey2--29874ecd-2a56-406a-a2c0-18eff0d3ae85-- å¾ž ApiController.Request å–å¾—è³‡æ–™é€™å€‹æƒ…å¢ƒä¸‹ ApiController.Request.Content.IsMimeMultipartContent() æœƒå›žå‚³ true, å¯ç”¨é€™å€‹æ–¹æ³•ä¾†ä½œç‚ºåˆ¤æ–·åŸºæº–. 12345678910111213141516171819private async void GetMultipartFromHttpRequestMessage()&#123; Debug.WriteLine("===== Get from HttpRequestMessage (multipart) ====="); var multi = await Request.Content.ReadAsMultipartAsync(); Debug.WriteLine("===== Get from file ====="); foreach (var content in multi.Contents) &#123; string key = content.Headers.ContentDisposition.Name; string value = string.Empty; using (Stream s = content.ReadAsStreamAsync().Result) using (StreamReader sr = new StreamReader(s)) &#123; s.Seek(0, SeekOrigin.Begin); value = sr.ReadToEnd(); Debug.WriteLine($"key: &#123;key&#125;, value: &#123;value&#125;"); &#125; &#125;&#125; ä¸å« filenameå®¢æˆ¶ç«¯å‘¼å« API çš„ç¨‹å¼ç¢¼ç´„ç•¥å¦‚ä¸‹, å·®åˆ¥åœ¨æ–¼ contnet.Add(...) æ²’æœ‰å¸¶ç¬¬ä¸‰å€‹åƒæ•¸:12345678using (var content = new MultipartFormDataContent())&#123; content.Add(new StringContent("key1"), "value1"); content.Add(new StringContent("key2"), "value2"); var req = new HttpClient(); req.PostAsync("http://localhost:50640/api/multipart", content).Wait();&#125; ç”¨ postman æ¨¡æ“¬çš„è©±æœƒæ˜¯é€™æ¨£, å·®åˆ¥åœ¨ä¸æ˜¯ç”¨æª”æ¡ˆä¸Šå‚³: è€Œ body çš„å…§å®¹å¦‚ä¸‹:1234567891011--9b753acb-2b3a-4214-bfc4-47b25799436fContent-Type: text/plain; charset=utf-8Content-Disposition: form-data; name=value1key1--9b753acb-2b3a-4214-bfc4-47b25799436fContent-Type: text/plain; charset=utf-8Content-Disposition: form-data; name=value2key2--9b753acb-2b3a-4214-bfc4-47b25799436f-- é›–ç„¶è·Ÿä¸Šä¸€å€‹ä¾‹å­æ¯”èµ·ä¾†, ä¼¼ä¹Žåªå°‘äº† Content-Disposition ä¸­çš„ filename ä¸€æ®µ, ä½†é€™æœƒè®“æˆ‘å€‘åœ¨å–è³‡æ–™ä¸Šè®Šå¾—æ›´æ–¹ä¾¿. å¾ž ApiController.Request å–å¾—è³‡æ–™åœ¨ä¸å« filename çš„æƒ…å¢ƒä¸‹, ApiController.Request.Content.IsMimeMultipartContent() ä¾ç„¶æœƒæ˜¯ true, æ‰€ä»¥ä¸Šä¸€å€‹æƒ…å¢ƒçš„è§£æ³•ä¾ç„¶é©ç”¨. å¾ž HttpContext.Current.Request å–å¾—è³‡æ–™åœ¨ä¸å« filename çš„æƒ…å¢ƒä¸‹, æ“ä½œä¸Šå¯ä»¥è¦–åŒä¸€èˆ¬çš„ form post ä¾†å–å¾—è³‡æ–™, ä¸ç”¨åšé¡å¤–çš„è™•ç†, å¦‚ä¸‹:12345678910private void GetFormFromHttpRequest()&#123; Debug.WriteLine("===== Get from HttpRequestMessage (form) ====="); var formData = HttpContext.Current.Request.Form; foreach (var key in formData.AllKeys) &#123; string value = formData[key]; Debug.WriteLine($"key: &#123;key&#125;, value: &#123;value&#125;"); &#125;&#125; æœ‰è¶£çš„åœ°æ–¹æ˜¯é›–ç„¶æ“ä½œä¸Šè·Ÿä¸€èˆ¬ form post ä¸€æ¨£, ä½†æ˜¯å¦‚æžœè©¦åœ–é€éŽ ApiController.Request.Content.ReadAsFormDataAsync() å–å¾—è³‡æ–™æ˜¯æœƒæ‹‹å‡ºä¾‹å¤–, ä¸”ApiController.Request.Content.IsFormData() çš„å›žå‚³å€¼æ˜¯ false. çµè«–ç›®å‰å› ç‚ºç¢ºå®šåˆä½œå» å•†ä½¿ç”¨ multipart/form-data çš„æƒ…å¢ƒéƒ½ä¸æœƒå¸¶ filename, æ‰€ä»¥æ˜¯è¦–åŒä¸€èˆ¬ form post ç›´æŽ¥å¾žHttpContext.Current.Request ä¸­å–å¾—è³‡æ–™, çœåŽ»é¡å¤–çš„åˆ¤æ–·è·Ÿè™•ç†. ä½†åš´æ ¼ä¾†èªª, ä¸ç®¡æ˜¯ä¸æ˜¯æœ‰ filename é€™æ®µ, éƒ½æ‡‰è©²ç”¨ ApiController.Request.Content.ReadAsMultipartAsync() ä¾†è™•ç†æ¯”è¼ƒæ°ç•¶, ç›®å‰çš„åšæ³•æ¯”è¼ƒåƒæ˜¯å› ç‚ºå‰›å¥½å¯ä»¥ç›¸å®¹åˆå¯ä»¥çœäº‹, å°±é€™æ¨£ç”¨äº†. åƒè€ƒ24503961How to get string representation of a MultipartFormDataContent]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[.NET core æ¸¬è©¦å°ˆæ¡ˆç‰ˆæœ¬ä¸ç¬¦]]></title>
    <url>%2Fcontent%2F20190622-dotnetcore-testproject-cs1705.html</url>
    <content type="text"><![CDATA[å‰é™£å­çš„æ–°å°ˆæ¡ˆç”¨çš„æ˜¯ .NET core 2.1, åœ¨åŠ æ¸¬è©¦å°ˆæ¡ˆçš„æ™‚å€™ç™¼ç¾æ¸¬è©¦å°ˆæ¡ˆç·¨è­¯ç„¡æ³•é€šéŽ, æ‹‹å‡ºé¡žä¼¼æ–¼ç‰ˆæœ¬è¡çª/ç‰ˆæœ¬éŒ¯èª¤ä¹‹é¡žçš„éŒ¯èª¤ (éŒ¯èª¤ç¢¼å¿˜äº†, ä¸çŸ¥é“æ˜¯ä¸æ˜¯ CS1705), ç¶“éŽæª¢æŸ¥å¾Œç™¼ç¾ç”¢å“å°ˆæ¡ˆå’Œæ¸¬è©¦å°ˆæ¡ˆçš„ç›¸é—œçµ„ä»¶ç‰ˆæœ¬éƒ½ä¸€æ¨£, ä¸€æ™‚é–“é‚„çœŸçš„æ‰¾ä¸åˆ°æ–¹å‘. ä¸éŽå¾ˆå¿«çš„å°±é è°·æ­Œå¤§ç¥žæ‰¾åˆ°äº†ç­”æ¡ˆ, é›–ç„¶ä¸€èˆ¬ä¾†èªªé€™éº¼å®¹æ˜“æ‰¾åˆ°çš„ç­”æ¡ˆå¯¦åœ¨ä¸ç”¨è¨˜, åˆé‡åˆ°å°±å†æ‰¾å°±å¥½, ä¸éŽé€™å€‹æƒ…å¢ƒæ¯”è¼ƒç‰¹æ®Š, è¬ä¸€å†é‡åˆ°æ²’ä¸‹å¥½é—œéµå­—èªªä¸å®šå°±æ‰¾ä¸åˆ°äº†, æƒ³æƒ³é‚„æ˜¯é€Ÿè¨˜ä¸€ä¸‹å¥½äº†. è§£æ³•ç¸½ä¹‹å°±æ˜¯æ‰‹å‹•ç·¨è¼¯ csproj æª”, åœ¨ ItemGroup è£¡é¢åŠ ä¸Šä¸€æ®µå¼•ç”¨å¦‚ä¸‹1&lt;PackageReference Include=&quot;Microsoft.AspNetCore.App&quot; /&gt; çµè«–è§£æ±ºé€™å€‹å•é¡Œæˆ‘è‡ªå·±æ˜¯å®Œå…¨æ²’åˆ†æžä»€éº¼, å°±å®Œå…¨æ˜¯å‰›å¥½æ‰¾åˆ°ç›¸é—œçš„æ–‡ç« , è€Œä¸”æ­£å¥½å‘½ä¸­å•é¡Œä¸€ä¸‹å°±è§£æ±ºäº†, ç¥žå¥‡çš„æ˜¯, äº‹å¾Œè¦åœ¨å®¶è£¡é‡ç¾å•é¡Œéƒ½ç„¡æ³•é‡ç¾, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰¹æ®Šæ¢ä»¶æ‰æœƒè§¸ç™¼é€™å€‹å•é¡Œ, å°±é€™æ¨£ç•™ä¸‹ä¸€å€‹è¬Žâ€¦ åƒè€ƒ[UnitTest] ASP.NET Core 2.2 æ¸¬è©¦å°ˆæ¡ˆä¸­çš„ç‰ˆæœ¬è¡çªVersion conflicts in test project depending on a Microsoft.AspNetCore.App project]]></content>
      <categories>
        <category>C#</category>
        <category>.NET Core</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨å»ºæ§‹å­ä¸­å–å¾— WebAPI çš„ request å…§å®¹]]></title>
    <url>%2Fcontent%2F20190526-get-request-in-constructor-of-derived-ApiController.html</url>
    <content type="text"><![CDATA[äº‹æƒ…æ˜¯é€™æ¨£çš„, æœ‰ä¸€å¤©æˆ‘éœ€è¦åœ¨æŸå€‹å…±ç”¨çš„ BaseApiController ä¸­å–å¾— request ä¸­çš„å…§å®¹ä¸¦åšä¸€äº›æ“ä½œ, æ‰€ä»¥å¯«ä¸‹äº†åƒæ˜¯é€™æ¨£çš„å…§å®¹, ç„¶å¾Œ ä»–å°±æ­»æŽ‰äº† å°±å‡ºç¾ NullReferenceException äº†. 123456789public class BaseApiController : ApiController&#123; public BaseApiController() &#123; var request = Request; // do someting from request, ex: read headers var myHeader = request.Headers.GetValues("MyHeader"); &#125;&#125; æ”¹ç”¨ HttpContext.Current.Requestç™¼ç”Ÿé€™å€‹å•é¡Œå…¶å¯¦ä¸€é–‹å§‹æœ‰é»žé©šè¨, ç•¢ç«Ÿä»¥å‰åœ¨ Action ä¸­æ“ä½œ ApiController.Request éƒ½éžå¸¸é †åˆ©, æŽ¥è‘—å¾ˆå¿«çš„åœ¨ç¶²è·¯ä¸ŠæŸ¥åˆ°äº†ä¸€å€‹ç›¸åŒçš„æå•, è¡¨ç¤ºæ”¹ç”¨ HttpContext.Current.Request å°±å¥½äº†, ç„¶å¾Œå•é¡Œå°±è§£æ±ºäº†. æ ¹æ“šè¨Žè«–ä¸²çš„èªªæ³•, ApiController.Request ä¸èƒ½åœ¨å»ºæ§‹å­ä¸­ä½¿ç”¨, å› ç‚ºåœ¨é€™å€‹éšŽæ®µä»–é‚„æ²’è¢«åˆå§‹åŒ–, æ‰€ä»¥å¿…ç„¶æ˜¯ null. å…©è€…æœ‰ä»€éº¼å·®åˆ¥?æŽ¥è‘—è©¦è‘—äº†è§£ä¸€ä¸‹ HttpContext.Current.Request å’Œ ApiController.Request ä¹‹é–“çš„å·®åˆ¥. é¦–å…ˆå¯ä»¥ç™¼ç¾ ApiController.Request å›žå‚³äº†ä¸€å€‹ HttpRequestMessage ç‰©ä»¶, ä¸”é€™å€‹å±¬æ€§æ˜¯å¯è®€å¯«çš„, è€Œ HttpContext.Current.Request å›žå‚³çš„æ˜¯ HttpRequest ç‰©ä»¶, ä½†é€™å€‹å±¬æ€§æ˜¯å”¯è®€çš„, å¦å¤–å¾žä¸‹é¢çš„åŽŸå§‹ç¢¼å¯ä»¥çœ‹åˆ° HttpRequestMessage æ˜¯å›žå‚³ ControllerContext.Request ä¸”å¾€ä¸Šå¯ä»¥è¿½æœ”åˆ° ActionContext, ç”±æ­¤â€æŽ¨æ¸¬â€ ApiController.Request æ¯”è¼ƒé©åˆåœ¨ Action ä¸­ä½¿ç”¨. æŽ¨æ¸¬è·Ÿæ¡†æž¶çš„ç”Ÿå‘½é€±æœŸèˆ‡ç›¸é—œæˆå“¡çš„åˆå§‹åŒ–æ™‚é–“æœ‰é—œ, ä½†è¦é©—è­‰çš„è©±è¦åŽ»çˆ¬ code, ç›®å‰æ²’é€™å€‹éœ€è¦å°±å…ˆå·æ‡¶ä¸€ä¸‹äº†, è‡³æ–¼ HttpRequest å’Œ HttpRequestMessage çš„å·®åˆ¥åœ¨ HttpRequest vs HttpRequestMessage vs HttpRequestBase é€™ç¯‡æ–‡ç« æœ‰ç¨å¾®æåˆ°, ä¸éŽæ²’è¬›å¾—å¤ªæ·±å…¥. 1234567891011121314151617181920212223242526272829303132333435// copy from https://github.com/aspnet/AspNetWebStack/blob/master/src/System.Web.Http/ApiController.cspublic HttpRequestMessage Request&#123; get &#123; return ControllerContext.Request; &#125; set &#123; if (value == null) &#123; throw Error.PropertyNull(); &#125; HttpRequestContext contextOnRequest = value.GetRequestContext(); HttpRequestContext contextOnController = RequestContext; if (contextOnRequest != null &amp;&amp; contextOnRequest != contextOnController) &#123; // Prevent unit testers from setting conflicting requests contexts. throw new InvalidOperationException(SRResources.RequestContextConflict); &#125; ControllerContext.Request = value; value.SetRequestContext(contextOnController); RequestBackedHttpRequestContext requestBackedContext = contextOnController as RequestBackedHttpRequestContext; if (requestBackedContext != null) &#123; requestBackedContext.Request = value; &#125; &#125;&#125; çµè«–æœƒç¢°åˆ°é€™å€‹å¤§æ¦‚å°±æ˜¯å°æ–¼ç›¸ä¼¼çš„æˆå“¡ä¹‹é–“çš„å·®ç•°èˆ‡ç”Ÿå‘½é€±æœŸä¸äº†è§£, å¯èƒ½è¦æ‰¾å€‹æ™‚é–“å¥½å¥½äº†è§£ä¸€ä¸‹äº†. ä¸éŽä¸çŸ¥é“é€™å€‹ //TODO æœƒæ‹–å¤šä¹…å°±æ˜¯. åƒè€ƒRequest is always null in web api?HttpRequest vs HttpRequestMessage vs HttpRequestBase]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[RSA åŠ è§£å¯†èˆ‡ç°½å]]></title>
    <url>%2Fcontent%2F20190518-rsa-by-dotnet.html</url>
    <content type="text"><![CDATA[.NET æä¾›çš„ RSACryptoServiceProvider ç”¨ä¾†åš RSA åŠ è§£å¯†èˆ‡é©—ç°½éžå¸¸æ–¹ä¾¿, ç›¸é—œçš„ç¶²è·¯è³‡æºä¹Ÿå¾ˆå¤š, æœ¬ä¾†æ˜¯æ²’ä»€éº¼å¥½å¯«çš„ç•¢ç«Ÿéš¨ä¾¿ google ä¸€ä¸‹éƒ½æœ‰, ä½†æ˜¯æœ€è¿‘ç™¼ç¾ä¸çŸ¥é“ç‚ºä»€éº¼ç”¨ä¸€æ¬¡æŸ¥ä¸€æ¬¡ç„¶å¾Œå¿˜ä¸€æ¬¡, æƒ³æƒ³é‚„æ˜¯ç¨å¾®ç´€éŒ„ä¸€ä¸‹ç”¨æ³•æ–¹ä¾¿ä»¥å¾Œé€ŸæŸ¥å¥½äº†. åŠ è§£å¯†ä½¿ç”¨ XML æ ¼å¼çš„å…¬ç§é‘°æ²’ä»€éº¼ç‰¹åˆ¥çš„, å°±æ˜¯ç”¨ RSACryptoServiceProvider åŠ è§£å¯†. 123456789101112131415161718192021public string RSAEncryptFromXMLKey(string publicKey, string plaintext)&#123; RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(); rsa.FromXmlString(publicKey); var plaintextBytes = Encoding.UTF8.GetBytes(plaintext); var ciphertextBytes = rsa.Encrypt(plaintextBytes, false); var ciphertext = Convert.ToBase64String(ciphertextBytes); return ciphertext;&#125;public string RSADecryptFromXMLKey(string privateKey, string ciphertext)&#123; RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(); rsa.FromXmlString(privateKey); var ciphertextBytes = Convert.FromBase64String(ciphertext); var plaintextBytes = rsa.Decrypt(ciphertextBytes, false); var plaintext = Encoding.UTF8.GetString(plaintextBytes); return plaintext;&#125; è¼‰å…¥ pfx æª”123456789101112131415161718192021public string RSAEncryptFromPFX(string plaintext)&#123; X509Certificate2 certificate = new X509Certificate2("path/to/certificate.pfx", "password"); var rsa = (RSACryptoServiceProvider)certificate.PublicKey.Key; var plaintextBytes = Encoding.UTF8.GetBytes(plaintext); var ciphertextBytes = rsa.Encrypt(plaintextBytes, false); var ciphertext = Convert.ToBase64String(ciphertextBytes); return ciphertext;&#125;public string RSADecryptFromPFX(string ciphertext)&#123; X509Certificate2 certificate = new X509Certificate2("path/to/certificate.pfx", "password"); var rsa = (RSACryptoServiceProvider)certificate.PrivateKey; var ciphertextBytes = Convert.FromBase64String(ciphertext); var plaintextBytes = rsa.Decrypt(ciphertextBytes, false); var plaintext = Encoding.UTF8.GetString(plaintextBytes); return plaintext;&#125; è¨»: æ–¹ä¾¿ç¤ºç¯„æ‰€ä»¥æŠŠä¸€äº›åƒæ•¸èˆ‡ç‰©ä»¶éƒ½å¯«æ­»åœ¨æ–¹æ³•ä¸­, å¯¦å‹™ä¸Šè©²æŠ½åƒæ•¸æˆ–æ˜¯æŠ½é›¢å‡º X509Certificate2 çš„æ“ä½œç­‰éƒ½è¦å†è€ƒæ…® ç°½åèˆ‡é©—ç°½ä½¿ç”¨ XML æ ¼å¼çš„å…¬ç§é‘°123456789101112131415161718192021public string RSASignFromXMLKey(string privateKey, string plaintext)&#123; RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(); rsa.FromXmlString(privateKey); var plaintextBytes = Encoding.UTF8.GetBytes(plaintext); var signBytes = rsa.SignData(plaintextBytes, new SHA1CryptoServiceProvider()); var sign = Convert.ToBase64String(signBytes); return sign;&#125;public bool RSAVerifyFromXMLKey(string publicKey, string sign, string data)&#123; RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(); rsa.FromXmlString(publicKey); var signBytes = Convert.FromBase64String(sign); var dataBytes = Encoding.UTF8.GetBytes(data); bool isValid = rsa.VerifyData(dataBytes, new SHA1CryptoServiceProvider(), signBytes); return isValid;&#125; é€™ä¹Ÿæ²’ä»€éº¼é›£çš„, ä¸éŽ VerifyData é€™å€‹æ–¹æ³•ç¬¬ä¸€å€‹åƒæ•¸æ˜¯æ˜Žæ–‡, ç¬¬ä¸‰å€‹åƒæ•¸æ˜¯ç°½åå¾Œçš„å¯†æ–‡æ¯”è¼ƒå®¹æ˜“å¼„å. å¦å¤–ä¸€å€‹æœ‰è¶£çš„åœ°æ–¹æ˜¯ VerifyData çš„ç¬¬äºŒå€‹åƒæ•¸å’Œ SignData çš„ç¬¬äºŒå€‹åƒæ•¸åž‹åˆ¥æ˜¯ object, é€™æ„å‘³è‘—ä»–å¯ä»¥æŽ¥å—ä»»æ„åž‹åˆ¥çš„è¼¸å…¥, ä¾‹å¦‚: new SHA1CryptoServiceProvider() æˆ– &quot;sha1&quot;(ä¸åˆ†å¤§å°å¯«çš„å­—ä¸²), åœ¨ä½¿ç”¨ä¸Šæˆ‘æœƒå‚¾å‘åœ¨å°è£ wrapper æ™‚åˆ»æ„é™ç¸®å€‹åƒæ•¸çš„çš„åž‹åˆ¥, å¦å‰‡å‘¼å«ç«¯æœƒå¾ˆé›£é æœŸå‚³å…¥çš„å€¼æ˜¯ä¸æ˜¯æ­£ç¢ºçš„, ä¾‹å¦‚ä»¥ä¸Šä¾‹ç‚ºå»¶ä¼¸, ä¸‹é¢çš„æ¯ä¸€è¡Œç¨‹å¼ç¢¼å¦‚æžœæ²’ç¶“éŽå¯¦æ¸¬å¾ˆé“é‹ä½œçµæžœæ˜¯å¦ä¸€æ¨£(è€Œäº‹å¯¦ä¸Šçµæžœæ˜¯ä¸€æ¨£çš„). 12345678910var signBytes = rsa.SignData(plaintextBytes, "sha1");var signBytes = rsa.SignData(plaintextBytes, "SHA1");var signBytes = rsa.SignData(plaintextBytes, "SHa1");var signBytes = rsa.SignData(plaintextBytes, SHA1.Create());var signBytes = rsa.SignData(plaintextBytes, new SHA1Managed());var signBytes = rsa.SignData(plaintextBytes, new SHA1CryptoServiceProvider());var signBytes = rsa.SignData(plaintextBytes, new SHA1Cng());var signBytes = rsa.SignData(plaintextBytes, typeof(SHA1));var signBytes = rsa.SignData(plaintextBytes, typeof(SHA1Managed));// etc... è¼‰å…¥ pfx æª”ç”¨ç§é‘°ç°½åæ™‚è¼‰å…¥ pfx æ“‹çš„æ–¹å¼è·ŸåŠ è§£å¯†æ™‚ä¸€æ¨£, ç°½åèˆ‡é©—ç°½çš„ç›¸é—œæ–¹æ³•éƒ½è·Ÿä¸Šä¾‹ä¸€æ¨£, å°±ä¸é‡è¤‡è²¼ç¨‹å¼ç¢¼äº†. çµè«–ç›®å‰åªçŸ¥é“ XML æ ¼å¼çš„å…¬ç§é‘°å’Œ PFX æ ¼å¼çš„æ†‘è­‰æ“‹åœ¨ .NET ä¸‹æ˜¯æœ€æ–¹ä¾¿æ“ä½œçš„, å¦‚æžœé‚„è¦è®€å–è‡ªå…¶ä»–æ ¼å¼çš„æª”æ¡ˆæˆ–å…¬ç§é‘°å…§å®¹(ä¾‹å¦‚ PEM), å¤§å¤šè¦é å…¶ä»–å¥—ä»¶æ‰æ¯”è¼ƒå¥½åš, ä¾‹å¦‚: Bouncy Castle. åƒè€ƒ]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# èªžè¨€ç‰¹æ€§æ›´æ–° - C# 6]]></title>
    <url>%2Fcontent%2F20190322-csharp-language-specification-6.html</url>
    <content type="text"><![CDATA[C# çš„ç‰ˆæœ¬æœ€è¿‘å¹¾å¹´æ›´æ–°çš„è¶Šä¾†è¶Šé »ç¹, é›–ç„¶å®˜æ–¹æœ‰æä¾›ç‰ˆæœ¬æ­·ç¨‹ä»¥åŠå„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§, ä½†æ˜¯é‚„æ˜¯æƒ³æ•´ç†èµ·ä¾†, åœ¨å®˜æ–¹æä¾›çš„èªžè¨€ç‰¹æ€§èªªæ˜Žå¤–å¤šä¸€é»žæ€è€ƒä¸¦ç´€éŒ„è‡ªå·±ä½¿ç”¨ä¸Šçš„æƒ³æ³•. æœ¬ç¯‡æ˜¯ C# 6.0 C# 6å”¯è®€å±¬æ€§ (Read-only auto-properties)Read-only auto-properties 1public string Name &#123; get; &#125; é›–ç„¶èˆŠç‰ˆå¯ä»¥ç”¨ public string Name { get; private set; } æœ€å¤§é™åº¦çš„é™ç¸®å¯«å…¥æ¬Š, ä½†ä»ç„¶ä¸æ˜¯å”¯è®€(åªå…è¨±åœ¨å»ºæ§‹å­ä¸­æ”¹è®Šå±¬æ€§å€¼), ç¡¬è¦æ‹†æˆç§æœ‰å”¯è®€æ¬„ä½ (private readonly fieldName) å’Œ getter æ–¹æ³•çš„çµ„åˆåˆå¤±åŽ»äº†è‡ªå‹•å¯¦ä½œå±¬æ€§çš„å„ªé»ž, é›£å…å¯æƒœ. é€™å€‹ç‰¹æ€§è®“æˆ‘å€‘èƒ½æ›´ç²¾ç´°çš„æŽ§åˆ¶å±¬æ€§çš„å­˜å–ç¯„åœ, ç”¨åœ¨éœ€è¦åš´è¬¹çš„æŽ§åˆ¶å±¬æ€§çš„å­˜å–ç¯„åœçš„æ™‚å€™å¾ˆå¥½ç”¨. å±¬æ€§åˆå§‹åŒ–å™¨ (Auto-property initializers)Auto-property initializers 1public string Name &#123; get; set; &#125; = "Ron"; æ¥µç›¸ä¼¼æ–¼èˆŠç‰ˆåœ¨å»ºæ§‹å­ä¸­åˆå§‹åŒ–å±¬æ€§çš„åšæ³•, èˆŠç‰ˆåšæ³•åœ¨å»ºæ§‹å­ä¸­åˆå§‹åŒ–å±¬æ€§çš„åšæ³•åœ¨å±¬æ€§å¾ˆå¤šæ™‚, æŽ’ç‰ˆä¸Šæœƒå½±éŸ¿å¯è®€æ€§.é€™å€‹ç‰¹æ€§èƒ½è®“å±¬æ€§åˆå§‹åŒ–æ›´ç‚ºç°¡æ½”, æ›´å®¹æ˜“é¿å…èˆŠçš„åšæ³•çš„æ½›åœ¨å•é¡Œ. æœƒèªªâ€æ¥µç›¸ä¼¼â€å¾žå»ºæ§‹å­åˆå§‹åŒ–å±¬æ€§ä»£è¡¨é‚„æ˜¯æœ‰ä¸€é»žå·®ç•°çš„ èˆŠçš„åšæ³•: å¾žå»ºæ§‹å­åˆå§‹åŒ–å±¬æ€§å…¶å¯¦æ˜¯é è¨­å‘¼å« setter æ–¹æ³•, å¦‚æžœæ²’æœ‰ setter æ–¹æ³•å‰‡ç›´æŽ¥æ“ä½œè‡ªå‹•ç”¢ç”Ÿçš„æ¬„ä½ (ä½†èˆŠç‰ˆä¸æ”¯æ´å”¯è®€å±¬æ€§) æ–°ç‰¹æ€§: ç›´æŽ¥æ“ä½œè‡ªå‹•ç”¢ç”Ÿçš„æ¬„ä½, ä¸ç®¡æœ‰æ²’æœ‰ setter æ–¹æ³• ä»¥ä¸Šçµè«–æ˜¯é€éŽ Msiler å¥—ä»¶ç”¢ç”Ÿ IL ç¢¼å¾Œè§€å¯Ÿçš„çµæžœ å…·æœ‰é‹ç®—å¼ä¸»é«”çš„å‡½å¼æˆå“¡ (Expression-bodied function members)Expression-bodied function members è®“åªæœ‰å–®ä¸€é‹ç®—å¼çš„æ–¹æ³•æˆ–å”¯è®€å±¬æ€§å¯ä»¥ç”¨è¼ƒçŸ­çš„ç¨‹å¼ç¢¼å®Œæˆ. é€™å€‹ç‰¹æ€§æˆ‘å¹³å¸¸å…¶å¯¦ä¸å¤ªç”¨, å› ç‚ºä¸‹é¢é€™ä¸‰è¡Œçš„é•·ç›¸å¤ªç›¸ä¼¼äº†, åœ¨é–±è®€ä¸Šæ¯”è¼ƒå®¹æ˜“é€ æˆæ··æ·†, ä¸”å¦‚æžœä¸å°å¿ƒç”¨éŒ¯é›–ç„¶ä¸æœƒé€ æˆç·¨è­¯éŒ¯èª¤, ä½†å«æ„å»æœƒå®Œå…¨ä¸åŒ, è€Œå¢žåŠ çš„æ–¹ä¾¿æ€§çµ¦æˆ‘çš„æ„Ÿå—ä¸æ˜¯å¾ˆå¼·çƒˆ.123public string FirstName =&gt; "Ron";private string _lastName = "Sun";public string GetFullName() =&gt; $"&#123;FirstName&#125; &#123;_lastName&#125;"; ä¸å°å¿ƒæ‰‹æ»‘ç”¨éŒ¯çš„ç¯„ä¾‹å¦‚ä¸‹, çœ‹èµ·ä¾†å¾ˆè©­ç•°, ä½†ä¾ç„¶èƒ½æ­£å¸¸é‹ä½œ:12345678910// "=&gt;" è®Šæˆ "=" å¾žå”¯è®€å±¬æ€§è®Šæˆæ¬„ä½// FirstName ç¾åœ¨çœ‹èµ·ä¾†åƒå…¬é–‹æ¬„ä½, æ˜¯ç§æœ‰æ¬„ä½å¯«éŒ¯è®Šå…¬é–‹äº†? // é‚„æ˜¯æ‡‰è©²æ˜¯å”¯è®€å±¬æ€§, åªæ˜¯ä¸å°å¿ƒå°‘äº†ä¸€å€‹ "&gt;"?public string FirstName = "Ron";// "=" è®Šæˆ "=&gt;" å¾žæ¬„ä½è®Šæˆå”¯è®€å±¬æ€§private string _lastName =&gt; "Sun";// å°‘äº† "()" å¾žæ–¹æ³•è®Šæˆå”¯è®€å±¬æ€§public string GetFullName =&gt; $"&#123;FirstName&#125; &#123;_lastName&#125;"; å…¶å¯¦å¦‚æžœå°ˆæ¡ˆæœ‰è‰¯å¥½çš„ç¨‹å¼ç¢¼è¦ç¯„, å¾žå‘½ååŸºæœ¬ä¸Šå°±å¯ä»¥åˆ†è¾¨å‡ºé€™å€‹æˆå“¡æ‡‰è©²è¦æ˜¯æ¬„ä½, å±¬æ€§é‚„æ˜¯æ–¹æ³•, åŠ ä¸Šå·¥ç¨‹å¸«å¦‚æžœå¤ è¬¹æ…Ž, ä¸Šé¢çš„å¤±èª¤æ‡‰è©²ä¸æœƒç™¼ç”Ÿ, ä½†å‡è¨­å°ˆæ¡ˆæ²’æœ‰è‰¯å¥½çš„è¦ç¯„åˆåŠ ä¸Šæ‰‹æ»‘æ‰“éŒ¯çš„ç‹€æ³, å¾Œé¢ç¶­è­·çš„äººå°±å¯èƒ½æœƒå¾ˆæ··äº‚. é€™ä¸æ˜¯èªªé€™å€‹ç‰¹æ€§ä¸å¥½, å¦‚æžœå°åœ˜éšŠæˆå“¡çš„åš´è¬¹åº¦èˆ‡åŸºç¤Žæœ‰ä¿¡å¿ƒ, ç”¨é€™å€‹ç‰¹æ€§ä¹Ÿæ˜¯å¾ˆä¸éŒ¯çš„. using staticusing static 12345678910111213141516171819202122using static ConsoleApp1.Person;class Program&#123; static void Main(string[] args) &#123; var nestedPerson = new NestedPerson(); var fullName = GetFullName(); &#125;&#125;public class Person&#123; public static string GetFullName() &#123; return "Ron Sun"; &#125; public class NestedPerson &#123; public string Name &#123; get; set; &#125; = "Ron"; &#125;&#125; ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªª, èˆŠçš„åšæ³•å¦‚æžœè¦åˆå§‹åŒ– NestedModel è¦å¯«æˆ new Model.NestedModel, å‘¼å«éœæ…‹æ–¹æ³• GetFullName() è¦å¯«æˆ Model.GetFullName() é€™å€‹ç‰¹æ€§æˆ‘æ¯”è¼ƒä¸å–œæ­¡, ä¸»è¦æ˜¯å·¢ç‹€é¡žåˆ¥è·Ÿéœæ…‹æ–¹æ³•é€™æ¨£ä½¿ç”¨æˆ–å‘¼å«çš„è©±, å¤–è§€ä¸Šè·Ÿä¸€èˆ¬é¡žåˆ¥æˆ–è©²é¡žåˆ¥å…§çš„æ–¹æ³•å‘¼å«ä¸€æ¨£, é–±è®€æ™‚å¦‚æžœæ²’æœ‰é€²åŽ»é¡žåˆ¥æˆ–æ–¹æ³•ä¸­çœ‹, é›£ä»¥åˆ†è¾¨ä»–ç©¶ç«Ÿæ˜¯ä¸æ˜¯è©²é¡žåˆ¥å…§éƒ¨çš„æ–¹æ³•. Null æ¢ä»¶é‹ç®—å­ (Null-conditional operators)Null-conditional operators 12345string name = person?.Name;string nameWithDefault = person?.Name ?? "John";var company = person?.Team?.Company;int? age = dictionary?["Ron"];int ageWithDefault = dictionary?["Ron"] ?? -1; ç”¨ä¾†çœä¸‹ç©ºå€¼åˆ¤æ–·, è¦å–å¾—ç‰©ä»¶ä¸­çš„å±¬æ€§å€¼çš„æ™‚å€™å¾ˆå¥½ç”¨, ä¹Ÿå¯ä»¥ç”¨åœ¨éœ€è¦å­˜å–é™£åˆ—æˆ–æ˜¯ç´¢å¼•å­(indexer) çš„æƒ…å¢ƒ. é€™å€‹ç‰¹æ€§ç¥žå¥½ç”¨, æ­é… ?? æ›´ç¥ž, å¯ä»¥ç¸®çŸ­éžå¸¸å¤šç©ºå€¼åˆ¤æ–·çš„ç¨‹å¼ç¢¼, å°¤å…¶æ˜¯åƒ model.Nested.Property é€™ç¨®å·¢ç‹€çš„å­˜å–æ›´æ˜Žé¡¯, å°±ä¸Šé¢çš„ç¯„ä¾‹ä¾†èªª, èˆŠçš„åšæ³•å°±æ˜Žé¡¯å†—é•·, å¦‚ä¸‹é¢æ¯”è¼ƒ: 123456789101112131415161718192021222324// string name = person?.Name;string name = null;if(person != null)&#123; name = person.Name;&#125;// string nameWithDefault = person?.Name ?? "John";string nameWithDefault = "John";if(person != null)&#123; nameWithDefault = person.Name;&#125;// Company company = person?.Team?.Company;Company company = null;if(person != null &amp;&amp; person.Team != null)&#123; company = person.Team.Company;&#125;// int? age = dictionary?["Ron"];// int ageWithDefault = dictionary?["Ron"] ?? -1;// ...ä¾æ­¤é¡žæŽ¨ èˆŠçš„åšæ³•çš„ç¯„ä¾‹é‚„æ˜¯ç‚ºäº†é¿å…å·¢ç‹€ if-else è€Œç°¡åŒ–éŽçš„, å¦‚æžœæ˜¯ç›´è¦ºå¼çš„ if-else ä¸€å±¤å±¤ç§‘ä¸‹åŽ», å·®ç•°å°±æ›´æ˜Žé¡¯äº†. å­—ä¸²æ’è£œ (String interpolation)String interpolation 1public string FullName =&gt; $"&#123;FirstName&#125; &#123;LastName&#125;"; ç¥žå¥½ç”¨, çœŸå¿ƒä¸é¨™, é€™å€‹ç¯„ä¾‹çœ‹èµ·ä¾†å¯èƒ½æ²’æœ‰æ„Ÿè¦º, æœƒè¦ºå¾—ç”¨ string.Format() åšä¹Ÿä¸éŒ¯å•Š, ä½†æƒ…å¢ƒå¤ è¤‡é›œçš„è©±ç„¡ç–‘æ˜¯æµ·æ”¾æœ€å¤å…¸çš„å­—ä¸²ç›¸åŠ , ä¹Ÿé¿å…äº† string.Format() é‡åˆ°å¤§é‡åƒæ•¸çš„æ™‚å€™å®¹æ˜“æŽ’éŒ¯é †åºçš„å•é¡Œ, å¦‚æžœæœ‰ç”¨éŽçµ„éŽ SOAP ç”¨çš„ XML å…§å®¹çš„è©±, å°±èƒ½æ˜Žé¡¯æ„Ÿå—åˆ°å®ƒçš„å¨åŠ›äº†. å¦å¤–, æ­é… @ ä½¿ç”¨, æ•ˆæžœæ›´å¥½. é€™å€‹ç‰¹æ€§é‚„æœ‰æœ‰å¾ˆå¤šé€²éšŽç”¨æ³•, å®˜æ–¹è³‡æºå¦‚ä¸‹: Use string interpolation to construct formatted strings $ - string interpolation (C# Reference) String interpolation in C# ä¾‹å¤–ç‹€æ³ç¯©é¸æ¢ä»¶ (Exception filters)Exception filters é€™å€‹ç‰¹æ€§é‚„æ²’æ©Ÿæœƒç”¨åˆ°, ä¸éŽç›®å‰çœ‹èµ·ä¾†æœ‰å…©å€‹å¥½è™•: è®“ Catch å€å¡Šçš„æƒ…å¢ƒæ›´ç²¾ç´°, æ¸›å°‘ Catch å€å¡Šå…§çš„æ¢ä»¶åˆ¤æ–·. æ””æˆªä¾‹å¤–å‰å¤šäº†ä¸€å€‹æ©Ÿåˆ¶å¯ä»¥åˆ¤æ–·çœŸçš„è¦æ””æˆªé€™å€‹ä¾‹å¤–æˆ–æ˜¯è®“ä»–ç¹¼çºŒå¾€å¤–æ‹‹, å¯ä»¥é¿å…æŽ‰æœ‰æ¢ä»¶é‡æ‹‹ä¾‹å¤–æ‰€é€ æˆçš„ StackTrace è¢«æ”¹è®Šçš„å•é¡Œ, é‡æ‹‹ä¾‹å¤–ç”¢ç”Ÿçš„å•é¡Œä¹‹å‰å¯«éŽä¸€ç¯‡ æ­£ç¢ºé‡æ‹‹ä¾‹å¤–. nameof é‹ç®—å¼ (The nameof expression)The nameof expression 12345678// output: MethodConsole.WriteLine(nameof(Class1.Method));// output: PropertyConsole.WriteLine(nameof(Class1.Property));// output: PropertyConsole.WriteLine(nameof(Class1.NestedClass.Property)); å¥½æ±è¥¿, é€™å€‹ç‰¹æ€§æ¯”è¼ƒåå¯ç¶­è­·æ€§çš„å„ªåŒ–, å¾ˆåœ¨æ„å¯ç¶­è­·æ€§çš„å·¥ç¨‹å¸«æœƒå¾ˆæ„›ç”¨. éœ€è¦åœ¨å­—ä¸²ä¸­æ”¾åž‹åˆ¥åç¨±, æ–¹æ³•åç¨±, æ¬„ä½åç¨±, å±¬æ€§åç¨±ç­‰ç­‰çš„æƒ…å¢ƒæ™‚, èˆŠæ–¹æ³•éƒ½æ˜¯ç›´æŽ¥å¯«æ­»å­—ä¸², é€™æ¨£æœƒå°Žè‡´é‡æ–°å‘½åçš„æ™‚å€™ visual studio æœƒå°‡é€™äº›å­—ä¸²å¿½ç•¥æŽ‰, è€èˆŠå°ˆæ¡ˆçš„ log ä¸­å°±å¾ˆå¸¸å‡ºç¾èˆ‡å¯¦éš›ä¸å»åˆçš„æ–¹æ³•åç¨±. å¦å¤–ä¸€å€‹æƒ…å¢ƒæ˜¯åå°„, å¦‚æžœå°ˆæ¡ˆä¸­æœ‰ç”¨åå°„å­˜å–ç‰¹å®šæˆå“¡æˆ–å‘¼å«æ–¹æ³•, åœ¨é‡æ–°å‘½åçš„æ™‚å€™å¾€å¾€æœƒè¢«å¿½ç•¥, ååé€™ç¨®æƒ…å¢ƒåªèƒ½ç­‰åˆ°åŸ·è¡ŒéšŽæ®µæ‰æœƒè¢«ç™¼ç¾, å°Žè‡´é‡æ–°å‘½åé¢¨éšªæé«˜, ä½†ä½¿ç”¨ nameof ä¹‹å¾Œ, å¯ä»¥é¿å…é€™é¡žå•é¡Œ, é‡æ–°å‘½åæ™‚ä¹Ÿå¯ä»¥æ›´å®‰å¿ƒ. Catch å’Œ Finally å€å¡Šä¸­çš„ AwaitAwait in Catch and Finally blocks Initialize associative collections using indexersInitialize associative collections using indexers 12345var dic = new Dictionary&lt;string, string&gt;()&#123; ["key1"] = "value1", ["key2"] = "value2",&#125;; èˆŠçš„å¯«æ³•æ˜¯å¦‚ä¸‹é¢é€™æ¨£.12345var dic = new Dictionary&lt;string, string&gt;()&#123; &#123; "key1", "value1" &#125;, &#123; "key2", "value2" &#125;&#125;; æ©â€¦ä¹çœ‹ä¹‹ä¸‹å°±æ˜¯ç”¨æ›å€‹åˆå§‹åŒ–çš„èªžæ³•, ä½†å…§éƒ¨é‹ä½œå»æ˜¯ä¸ä¸€æ¨£çš„, è®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹åŽ»â€¦ é€éŽå·¥å…·çœ‹äº†ä¸€ä¸‹ç·¨è­¯å‡ºä¾†çš„ IL ç¢¼ç™¼ç¾å…©è€…å¯¦éš›çš„é‹ä½œä¸¦ä¸åŒ, èˆŠçš„åšæ³•å‘¼å«çš„æ˜¯ Add(System.String,System.String) æ–¹æ³•, è€Œ C# 6 çš„èªžæ³•å‘¼å«çš„æ˜¯ set_Item(System.String,System.String), è€Œé€™æ¨£çš„å·®åˆ¥æœƒåœ¨æŸäº›æƒ…å¢ƒä¸‹ä½¿å¾—é‹ä½œçµæžœä¸åŒ.12345678910111213141516171819202122// var dic = new Dictionary&lt;string, string&gt;()// &#123;// &#123; &quot;key1&quot;, &quot;value1&quot; &#125;// &#125;;IL_002B newobj System.Void System.Collections.Generic.Dictionary`2&lt;System.String,System.String&gt;::.ctor()IL_0030 dupIL_0031 ldstr &quot;key1&quot;IL_0036 ldstr &quot;value1&quot;IL_003B callvirt System.Void System.Collections.Generic.Dictionary`2&lt;System.String,System.String&gt;::Add(System.String,System.String)IL_0040 nopIL_0041 stloc.0// var dic2 = new Dictionary&lt;string, string&gt;()// &#123;// [&quot;key1&quot;] = &quot;value1&quot;// &#125;;IL_0042 newobj System.Void System.Collections.Generic.Dictionary`2&lt;System.String,System.String&gt;::.ctor()IL_0047 dupIL_0048 ldstr &quot;key1&quot;IL_004D ldstr &quot;value1&quot;IL_0052 callvirt System.Void System.Collections.Generic.Dictionary`2&lt;System.String,System.String&gt;::set_Item(System.String,System.String)IL_0057 nopIL_0058 stloc.1 æ ¹æ“šå®˜æ–¹èªªæ˜Ž, æ–°çš„èªžæ³•æ˜¯å€‹ â€œIndex Initializersâ€, æ­é… New Ways to Initialize Collections in C# 6 é€™ç¯‡å¤§ç¥žæ–‡ç« ä¸­çš„æè¿°: There is one caution. The new initializer syntax calls the indexer method to add items to the collection. That same indexer method replaces items as well as adding items. å¯ä»¥ç™¼ç¾æ–°çš„å¯«æ³•ç”±æ–¼æ˜¯ç›´æŽ¥æ“ä½œ indexer, æ‰€ä»¥ç•¶ç´¢å¼• (key) é‡è¤‡çš„æ™‚å€™æœƒç›´æŽ¥å°‡å€¼è¦†è“‹, ä¸åŒæ–¼èˆŠç‰ˆåšæ³•çš„æ‹‹å‡ºä¾‹å¤–, å¯ä»¥ç”±ä¸‹é¢å…©æ®µç¨‹å¼ç¢¼ä¾†æ¯”è¼ƒå…©è€…å·®ç•°123456789101112131415// throw an exception because of duplicate keyvar dic = new Dictionary&lt;string, string&gt;()&#123; &#123; "k", "v1" &#125;, &#123; "k", "v2" &#125;&#125;;Console.WriteLine(dic["k"]);var dic2 = new Dictionary&lt;string, string&gt;()&#123; ["k"] = "v1", ["k"] = "v2",&#125;;// the value should be "v2" because the second value of key "k" replace first oneConsole.WriteLine(dic2["k"]); Extension Add methods in collection initializersExtension Add methods in collection initializers é€™å€‹åˆéœ€è¦å¤§ç¥žæ–‡ç« æ•‘æ´äº†. ç¸½ä¹‹å°±æ˜¯è®“ä¸‹æ–¹èªžæ³•é è¨­å‘¼å«å¦å¤–å¯«çš„æ“´å……æ–¹æ³• Add ä½¿å¾—åˆå§‹åŒ–èƒ½åœ¨èªžæ„ä¸Šæ›´ç‚ºé †æš¢.12345var myCollection = new MyStringCollection()&#123; "Ron", "Sun"&#125; Improved overload resolutionImproved overload resolution Deterministic compiler outputDeterministic compiler output çµè«–æœ¬ä¾†ä»¥ç‚ºå° C# ç‰¹æ€§å·²ç¶“ç®—ç†Ÿäº†, æ²’æƒ³åˆ°é‚„æ˜¯æœ‰ä¸å°‘å¹³å¸¸æ²’ç”¨åˆ°å°±ä»¥ç‚ºä»–ä¸å­˜æˆ–æ˜¯ä¸€ç›´æœ‰éŒ¯èª¤ç†è§£çš„ç‰¹æ€§, çœ‹ä¾†è¦æ‰¾å€‹æ™‚é–“ä¸€å€‹ä¸€å€‹ä»”ç´°çœ‹çœ‹äº†. åƒè€ƒNew Ways to Initialize Collections in C# 6Whatâ€™s New in C# 6]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Web API å›žå‚³è³‡æ–™çš„æ–¹å¼]]></title>
    <url>%2Fcontent%2F20190317-webapi-response-data-format.html</url>
    <content type="text"><![CDATA[é€™ç¯‡æ˜¯è¦ç¨å¾®è¨˜ä¸€ä¸‹ Web API å›žå‚³è³‡æ–™çš„å¹¾ç¨®æ–¹å¼èˆ‡æ ¼å¼, æœƒæƒ³è¦è¨˜é€™ä¸€ç¯‡æ˜¯å› ç‚ºä»¥å‰ç¢°éŽçš„ Web API å°ˆæ¡ˆéƒ½æœ‰çµ±ä¸€çš„å›žå‚³ (response) æ ¼å¼, ä½†æ˜¯æœ€è¿‘ç¢°åˆ°ä¸€äº›å°ˆæ¡ˆçš„ Web API åœ¨å›žå‚³è³‡æ–™æ™‚æ˜¯æ²’æœ‰è¦ç¯„çš„, ä¾‹å¦‚ç›´æŽ¥å°± return true, æ‰€ä»¥å°±ç¨å¾®æ•´ç†ä¸€ä¸‹å›žå‚³è³‡æ–™çš„å¹¾ç¨®æ–¹å¼èˆ‡å„ªç¼ºé»ž. ç›´æŽ¥å›žå‚³ç‰©ä»¶é€™å€‹å°±æ˜¯ä¸Šé¢èªªçš„, ç›´æŽ¥åƒ return anyObject é€™æ¨£å›žå‚³, å¦‚ä¸‹é¢çš„ç¨‹å¼ç¢¼ 1234567891011121314151617181920212223242526public bool Get()&#123; return true;&#125;public DemoModel Get()&#123; var data = new DemoModel() &#123; Name = "Ron", Age = 18 &#125;; return data;&#125;public Dictionary&lt;string,string&gt; Get()&#123; var data = new Dictionary&lt;string, string&gt;() &#123; ["Name"] = "Ron", ["Age"] = "18" &#125;; return data;&#125; å„ªç¼ºé»žå„ªé»ž ç°¡å–®ç›´è¦ºåˆæ–¹ä¾¿ ç¼ºé»ž å‡Œäº‚ä¸çµ±ä¸€, å›žå‚³çš„è³‡æ–™å¯èƒ½å‡ºç¾åŽŸç”Ÿåž‹åˆ¥, model æˆ–æ˜¯å…¶ä»–å„ç¨®åž‹åˆ¥ åªå›žå‚³è³‡æ–™, æ²’æœ‰ä»»ä½•ç‹€æ…‹é¡žçš„æ¬„ä½èˆ‡ http status, ç•¶ client ç«¯æ”¶åˆ°ç©ºç‰©ä»¶æˆ–ä¾‹å¤–æ™‚é›£ä»¥åˆ¤æ–·å•é¡Œ å¾ŒæœŸéœ€è¦åŠ ç‹€æ…‹æ™‚å¾ˆéº»ç…©, ä¾‹å¦‚æ¯æ”¯ API å„è‡ªåŠ ç‹€æ…‹æ¬„ä½å®¹æ˜“äº‚, å¦‚æžœè¦æŠ½å…±ç”¨é‚„è¦è€ƒæ…®è³‡æ–™çš„çµæ§‹æˆ–éšŽå±¤è¢«æ”¹è®Šå°å®¢æˆ¶ç«¯çš„å½±éŸ¿ ä½¿ç”¨æ™‚æ©Ÿé€™ç¨®åšæ³•é©åˆç”¨åœ¨ ç°¡å–®çš„å°å°ˆæ¡ˆ, è¤‡é›œåº¦å°å°±æ²’å¤ªå¤§å½±éŸ¿ Web API åªæä¾›å…§éƒ¨ä½¿ç”¨, client è·Ÿ API æ˜¯åŒä¸€çµ„äººé–‹ç™¼çš„, ç‹€æ…‹é¡žæ¬„ä½çš„å¿…è¦æ€§ä¸å¤§ å¥—ç”¨å…±ç”¨å›žå‚³ç‰©ä»¶èˆ‡ç‹€æ…‹åŒæ™‚è€ƒæ…®å›žå‚³è³‡æ–™, http status èˆ‡ä¾‹å¤–å…§å®¹ä¸‰ç¨®æƒ…æ³, å¦‚ä¸‹ IHttpActionResult æ˜¯ Web API 2 çš„æ–¹å¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public class ResponseModel&lt;T&gt;&#123; public string Code &#123; get; set; &#125; = "0000"; public string Message &#123; get; set; &#125; = "Success"; public T Data &#123; get; set; &#125;&#125;// Web APIpublic HttpResponseMessage Get(bool isError)&#123; var responseModel = new ResponseModel&lt;DemoModel&gt;(); if (isError) &#123; responseModel.Code = "0001"; responseModel.Message = "Prameter 'isError' should be false."; var response = Request.CreateResponse(HttpStatusCode.BadRequest, responseModel); throw new HttpResponseException(response); &#125; responseModel.Data = new DemoModel() &#123; Name = "Ron", Age = 18 &#125;; return Request.CreateResponse(HttpStatusCode.OK, responseModel);&#125;// Web API 2public IHttpActionResult Get(bool isError)&#123; var responseModel = new ResponseModel&lt;DemoModel&gt;(); if (isError) &#123; responseModel.Code = "0001"; responseModel.Message = "Prameter 'isError' should be false."; return Content(HttpStatusCode.BadRequest, responseModel); &#125; responseModel.Data = new DemoModel() &#123; Name = "Ron", Age = 18 &#125;; return Ok(responseModel);&#125; ç‰¹åˆ¥çš„ HttpResponseExceptionä¸Šé¢ä¾‹å­ä¸­, HttpResponseException æ˜¯ä¸€å€‹å¾ˆç‰¹åˆ¥çš„ä¾‹å¤–, é€™å€‹ä¾‹å¤–ä¸æœƒè¢« ExceptionFilterAttribute, ExceptionHandler æˆ–æ˜¯ ExceptionLogger æ‰€æ””æˆª, æ‰€ä»¥åœ¨ service å±¤ä¸­ä½¿ç”¨ HttpResponseException æ˜¯ä¸€å€‹å¾ˆå¥½çš„é¸é …, æ—¢èƒ½ç›´æŽ¥è¿”å›ž http status å’Œå…§å®¹, åˆä¸æœƒè¢«å…¨åŸŸä¾‹å¤–è™•ç†æ©Ÿåˆ¶æ””æˆª, åƒæ˜¯é€™æ¨£ throw new HttpResponseException(response). é †å¸¶ä¸€æ, ExceptionHandler å’Œ ExceptionLogger æ˜¯å¯¦æ¸¬çš„æ™‚å€™æ‰ç™¼ç¾æœƒå¿½ç•¥ HttpResponseException, å®˜æ–¹æ–‡ä»¶åªæåˆ° ActionFilterAttribute çš„éƒ¨åˆ†, ç¯€éŒ„å¦‚ä¸‹: An exception filter is executed when a controller method throws any unhandled exception that is not an HttpResponseException exception. The HttpResponseException type is a special case, because it is designed specifically for returning an HTTP response. å„ªç¼ºé»žå„ªé»ž æ˜Žç¢ºå›žå‚³ http status, å° client ç«¯ä¾†èªªé‡åˆ°å•é¡Œå®¹æ˜“é‡æ¸…æ–¹å‘ ç´°éƒ¨ç‹€æ…‹ç¢¼ (Code) èˆ‡è¨Šæ¯ (Message) æ–¹ä¾¿ client ç«¯å°æŽ¥èˆ‡ä½¿ç”¨ ç¼ºé»ž æ¯”è¼ƒéº»ç…©, éœ€è¦èŠ±æ™‚é–“äº†è§£ä¸¦é¸æ“‡é©åˆçš„ http status, ä¹Ÿéœ€è¦å®šç¾©ç´°éƒ¨ç‹€æ…‹ç¢¼ (Code) èˆ‡è¨Šæ¯ (Message) å…±ç”¨å›žå‚³ç‰©ä»¶çš„å¹¾ç¨®è¨­è¨ˆå›žå‚³ç‰©ä»¶çš„å…±ç”¨éƒ¨åˆ†è¦æ€Žéº¼è¨­è¨ˆä¹Ÿæ˜¯æœ‰å¹¾ç¨®æ–¹å¼ æ³›åž‹ç‰ˆåŒ…ä¸€å±¤ ResponseModel&lt;T&gt;, å¯ä»¥ç›´æŽ¥å¥—ç”¨åˆ°æ‰€æœ‰éœ€è¦å›žå‚³ç‰©ä»¶çš„ API ä¸Š, ä½†æ˜¯å› ç‚ºå¤šåŒ…äº†ä¸€å±¤, åºåˆ—åŒ–çš„çµæžœæœƒå¤šä¸€å±¤, å¦‚æžœå¥—ç”¨åœ¨èˆŠçš„ API ä¸Šæœƒä½¿å¾—å›žå‚³è³‡æ–™çš„éšŽå±¤è¢«æ”¹è®Š, æœƒå½±éŸ¿æ‰€æœ‰ client ç«¯. 12345678public class ResponseModel&lt;T&gt;&#123; public string Code &#123; get; set; &#125; = "0000"; public string Message &#123; get; set; &#125; = "Success"; public T Data &#123; get; set; &#125;&#125; ä¸ç”¨æ³›åž‹æ²’æœ‰æ³›åž‹, ResponseModel è®“å…¶ä»–è¦å›žå‚³çš„ model ç¹¼æ‰¿æˆ–åŒ…å«, å¦‚æžœå¥—ç”¨åœ¨èˆŠçš„ API ä¸Š, åœ¨åºåˆ—åŒ–å¾Œåªæœƒå¢žåŠ æ¬„ä½, ä¸æœƒæ”¹è®ŠèˆŠæœ‰æ¬„ä½çš„éšŽå±¤, å°ç¾å­˜ API çš„æ“´å±•å¾ˆå‹å–„, ä½†æ˜¯ç›¸å°æ–¼æ³›åž‹ç‰ˆæ¯”è¼ƒä¸å¥½ç”¨, å› ç‚ºå³ä½¿åªæ˜¯è¦å›žå‚³ä¸€å€‹åŸºæœ¬åž‹åˆ¥(bool / string) ä¹Ÿéœ€è¦å»ºç«‹ model. 123456public class ResponseModel&#123; public string Code &#123; get; set; &#125; = "0000"; public string Message &#123; get; set; &#125; = "Success";&#125; å›žå‚³ç‰©ä»¶åž‹åˆ¥æœ‰å…©ç¨®ä½¿ç”¨ ResponseModel çš„æ–¹æ³•, ç¹¼æ‰¿æˆ–åŒ…å«, åºåˆ—åŒ–çµæžœä¸åŒ, è¦–æƒ…å¢ƒæˆ–åœ˜éšŠå…±è­˜ä½¿ç”¨. 1234567891011121314151617// ç¹¼æ‰¿public class DemoModel : ResponseModel&#123; public string Name &#123; get; set; &#125; public int Age &#123; get; set; &#125;&#125;// åŒ…å«public class DemoModel&#123; public string Name &#123; get; set; &#125; public int Age &#123; get; set; &#125; public ResponseModel Error &#123;get; set; &#125;&#125; ä½¿ç”¨æ™‚æ©Ÿé€™ç¨®åšæ³•é©åˆç”¨åœ¨ é‚è¼¯è¤‡é›œæˆ–æ˜¯æœ‰å„ç¨®é©—è­‰ç‹€æ…‹èˆ‡çµæžœçš„ API éœ€è¦å°å¤–é–‹æ”¾çš„ API (è·¨éƒ¨é–€ / å…¬é–‹ API) çµè«–é›–ç„¶ç¨å¾®æ•´ç†ä¸€ä¸‹å¹¾ç¨®åšæ³•èˆ‡é©ç”¨æƒ…å¢ƒ, ä¸éŽå¯¦éš›é‹ç”¨ä¸å¤ªæœƒç…§æŠ„, é‚„æ˜¯è¦è¦–æƒ…æ³åšç´°éƒ¨çš„èª¿æ•´, å°±è·Ÿè¨­è¨ˆæ¨¡å¼åœ¨ä½¿ç”¨çš„æ™‚å€™å¸¸å¸¸éœ€è¦é…åˆå°ˆæ¡ˆéœ€æ±‚è®Šå½¢éŽä¸€æ¨£. åƒè€ƒBest practice to return errors in ASP.NET Web APIException Handling in ASP.NET Web API]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Web API ä¸­çš„å…¨åŸŸéŒ¯èª¤è™•ç†]]></title>
    <url>%2Fcontent%2F20190308-global-exception-handle-in-webapi.html</url>
    <content type="text"><![CDATA[åœ¨ Web API ä¸­, ä¾‹å¤–è™•ç†æ˜¯ä¸€å®šæœƒé‡åˆ°çš„å•é¡Œ, ä»¥å‰å¸¸å¸¸è¦‹åˆ°ä¸€äº›å°ˆæ¡ˆç‚ºäº†æ€•å‡ºç¾ unhandled exception å°±åœ°æ¯¯å¼çš„å°‡æ‰€æœ‰æ–¹æ³•éƒ½åŠ ä¸Š try-catch, ä½†æ˜¯é€™æ¨£ä½¿ç”¨ try-catch æœƒæœ‰å¾ˆå¤§çš„å‰¯ä½œç”¨, ä¸€ä¾†ç„¡å·®åˆ¥çš„åƒæŽ‰æ‰€æœ‰ä¾‹å¤–æœƒå°Žè‡´ç¨‹å¼ä¸æ˜“é™¤éŒ¯, äºŒä¾†åˆ°è™•æ•£å¸ƒçš„ try-catch å’Œç›¸é—œçš„ log åœ¨ç¶­è­·ä¸Šçš„æˆæœ¬ä¹Ÿå¾ˆé«˜, å°¤å…¶æ˜¯å¤§åž‹å°ˆæ¡ˆæ›´æ˜¯æ˜Žé¡¯, ç¬¬ä¸‰ä¹Ÿæœƒä½¿å¾—å•†å‹™é‚è¼¯è·Ÿé€™äº›ä¾‹å¤–è™•ç†æ··é›œåœ¨ä¸€èµ· (try-catch ä¸æ˜¯ä¸èƒ½ç”¨, ä½†æ˜¯ä»–æ˜¯æœ‰ä½¿ç”¨æ™‚æ©Ÿçš„). è€Œ ASP.NET Web API 2 ä¸­å…¶å¯¦æä¾›äº†å¾ˆå¤šç¨®å…¨åŸŸçš„ä¾‹å¤–è™•ç†æ–¹å¼, ä¾‹å¦‚: ExceptionFilterAttribute, ExceptionLogger, ExceptionHandler, èƒ½å°‡æ””æˆªæœªè™•ç†çš„ä¾‹å¤–çš„ä»»å‹™æŠ½é›¢å‡ºä¾†, è®“æˆ‘å€‘é–‹ç™¼æ™‚èƒ½æ›´å°ˆæ³¨åœ¨é‡è¦çš„å•†å‹™é‚è¼¯ä¸Š, é€™ç¯‡ä¸»è¦ç´€éŒ„ä¸€ä¸‹é€™ä¸‰ç¨®å…¨åŸŸä¾‹å¤–è™•ç†çš„æ–¹å¼èˆ‡å·®åˆ¥. ExceptionFilterAttribute åœ¨ WebApi 2 ä¸­çš„ FilterAttribute ä»‹ç´¹èˆ‡æ‡‰ç”¨ é€™ç¯‡æ–‡ç« ä¸­å·²ç¶“æœ‰æåˆ° FilterAttribute çš„ç”¨æ³•, ä½†æ˜¯ ExceptionFilterAttribute ä»–åœ¨æ•´å€‹ Web API çš„ç”Ÿå‘½é€±æœŸä¸­æ˜¯æ¯”è¼ƒå¾Œé¢çš„, æ‰€ä»¥æŸäº›éšŽæ®µæ‰€å¼•ç™¼çš„ä¾‹å¤–ä»–ç„¡æ³•æ•æ‰åˆ°, å®˜æ–¹ä¹Ÿæ˜Žç¢ºæŒ‡å‡ºäº†é€™å€‹ç‰¹æ€§, ç¯€éŒ„å¦‚ä¸‹: Some unhandled exceptions can be processed via exception filters, but there area number of cases that exception filters canâ€™t handle. For example: Exceptions thrown from controller constructors. Exceptions thrown from message handlers. Exceptions thrown during routing. Exceptions thrown during response content serialization. We want to provide a simple, consistent way to log and handle (where possible)these exceptions. ExceptionFilterAttribute æ˜¯å€‹ä¸éŒ¯çš„é¸é …, ä½†å—é™æ–¼ç”Ÿå‘½é€±æœŸ, æ‰€ä»¥æ””æˆªçš„ç¯„åœæ²’é‚£éº¼å»£. ExceptionLogger / ExceptionHandlerExceptionLogger å’Œ ExceptionHandler èƒ½æ””æˆª ExceptionFilterAttribute æ‰€æ””æˆªä¸åˆ°çš„ä¾‹å¤–, ä¸‹é¢åˆ†åˆ¥æ˜¯ ExceptionLogger å’Œ ExceptionHandler çš„å¯¦ä½œæ–¹å¼. å¯¦ä½œæ–¹å¼1234567891011121314151617public class DemoExceptionHandler : ExceptionHandler&#123; public override void Handle(ExceptionHandlerContext context) &#123; Debug.WriteLine("======== DemoExceptionHandler ======="); context.Result = new InternalServerErrorResult(context.Request); &#125;&#125;public class DemoExceptionLogger : ExceptionLogger&#123; public override void Log(ExceptionLoggerContext context) &#123; Debug.WriteLine("======== DemoExceptionLogger ======="); &#125;&#125; å¯¦ä½œå¾Œè¦åœ¨ WebApiConfig.cs ä¸­è¨»å†Š. 123456789101112public static class WebApiConfig&#123; public static void Register(HttpConfiguration config) &#123; // skip... config.Services.Replace(typeof(IExceptionHandler), new DemoExceptionHandler() config.Services.Add(typeof(IExceptionLogger), new DemoExceptionLogger());); // skip... &#125;&#125; å¦å¤–æœ‰å¹¾å€‹è¦æ³¨æ„çš„é»ž: ExceptionHandler åªèƒ½æœ‰ä¸€å€‹, æ‰€ä»¥å‘¼å« config.Services.Replace() ExceptionLogger å¯ä»¥æœ‰å¤šå€‹, æ‰€ä»¥å‘¼å« config.Services.Add(), å­˜åœ¨å¤šå€‹ ExceptionLogger æ™‚, å…ˆåŠ å…¥çš„å…ˆåŸ·è¡Œ ExceptionLogger æœƒæ¯” ExceptionHandler å…ˆåŸ·è¡Œ ExceptionLogger ä¹Ÿå¯ä»¥å‘¼å« config.Services.Replace(), ä¸ç®¡ä¹‹å‰åŠ äº†å¹¾å€‹ ExceptionLogger, config.Services.Replace() æœƒå°‡å…¨éƒ¨éƒ½å–ä»£æˆä¸€å€‹, æ‰€ä»¥ä»–ä¸æ˜¯æ›æŽ‰æŸä¸€å€‹è€Œå·² å·®ç•°ExceptionLogger æ˜¯ç”¨æ–¼ç´€éŒ„æ””æˆªåˆ°çš„ä¾‹å¤–, ExceptionHandler æ˜¯ç”¨æ–¼æ””æˆªåˆ°éŒ¯èª¤å¾Œçš„è™•ç†, æ‰€ä»¥ ExceptionHandlerContext ä¸­å¤šäº†ä¸€å€‹ public IHttpActionResult Result { get; set; } å±¬æ€§, è®“æˆ‘å€‘å¯ä»¥æ±ºå®šæ””æˆªåˆ°éŒ¯èª¤å¾Œè¦å›žå‚³ä»€éº¼çµ¦å®¢æˆ¶ç«¯, é€™åœ¨ä¸Šé¢ç¨‹å¼ç¢¼ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºå·®ç•°. å¦‚æžœåŒæ™‚è¦ç´€éŒ„æ””æˆªåˆ°çš„éŒ¯èª¤ä¸¦å›žå‚³ç‰¹å®šå…§å®¹çµ¦å®¢æˆ¶ç«¯, ç›®å‰æˆ‘æ˜¯åªç”¨ ExceptionHandler è™•ç†, æ²’æœ‰åŒæ™‚å¯¦ä½œ ExceptionLogger å’Œ ExceptionHandler. çµè«–ä»¥å‰éƒ½åªç”¨ ExceptionFilterAttribute ä¾†æ””æˆªéŒ¯èª¤, ä¹Ÿæ²’æœ‰ç‰¹åˆ¥åŽ»æ‰¾å…¶ä»–åšæ³•, å‰›å¥½è·Ÿåˆ¥äººèŠå¤©æ™‚æœ‰æåˆ°å…¨åŸŸä¾‹å¤–è™•ç†è·Ÿç”Ÿå‘½é€±æœŸçš„è©±é¡Œæ‰è¢«æé†’æœ‰é€™å€‹å·®åˆ¥, æ„å¤–è³ºåˆ°ä¸€å€‹ä¹‹å‰éƒ½ä¸çŸ¥é“çš„å¥½æ±è¥¿. åƒè€ƒGlobal Error Handling in ASP.NET Web API 2Exception Handling in ASP.NET Web API]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ•´åˆ DocFx å’Œ Visual Studio ä¸¦ä½ˆç½²ä¸Š GitHub Pages]]></title>
    <url>%2Fcontent%2F20190124-docfx-with-visual-studio-on-github-pages.html</url>
    <content type="text"><![CDATA[DocFx æ˜¯ä¸€å€‹å¾ˆæ–¹ä¾¿çš„å°ˆæ¡ˆæ–‡ä»¶è£½ä½œå·¥å…·, èƒ½å°‡ XML æ–‡ä»¶è¨»è§£è½‰æ›æˆéœæ…‹ç¶²é , ä¹Ÿå¯ä»¥è½‰åŒ–å…¶ä»–å¦å¤–å¯«çš„ Markdown æ ¼å¼çš„æ–‡ä»¶, é€™ç¯‡ä¸»è¦çš„ç›®çš„æ˜¯ç´€éŒ„å¦‚ä½•å°‡ DocFx èˆ‡ Visual Studio æ•´åˆ, åœ¨ç·¨è­¯å¾Œç”¢å‡ºå°ˆæ¡ˆæ–‡ä»¶ä¸¦ä½ˆç½²åˆ° GitHub Pages. é †ä¾¿æä¸€ä¸‹, é©ç”¨æƒ…å¢ƒæ˜¯åœ¨ visual stuiod ä¸Šé–‹ç™¼ .NET å°ˆæ¡ˆ, ä¸¦ä¸”å¸Œæœ›èƒ½çµ±ä¸€ç®¡ç†, å…¶ä»–æƒ…å¢ƒä¸ä¸€å®šé©åˆé€™æ¨£æ•´åˆ. å¦‚ä½•å»ºç«‹å»ºç«‹å·¥å…·å°ˆæ¡ˆå»ºä¸€å€‹ç¨ç«‹çš„å·¥å…·å°ˆæ¡ˆç”¨ä¾†æ”¾ DocFx éœ€è¦çš„å¥—ä»¶, åˆ»æ„è·Ÿç”¢å“å°ˆæ¡ˆåˆ†é–‹çš„ç›®çš„æ˜¯å¸Œæœ›æ–‡ä»¶å»ºç«‹å·¥å…·èˆ‡ç”¢å“ç¨‹å¼ç¢¼ä¸è¦æ··åœ¨åŒä¸€å€‹å°ˆæ¡ˆ, å¦å¤–é€™å€‹å·¥å…·å°ˆæ¡ˆä¸å«ç¨‹å¼ç¢¼ä½†è¦æ˜¯å¯ä»¥åœ¨ visual studio ä¸­ç·¨è­¯çš„, æ‰€ä»¥é¸ç”¨ Class Library. å°ˆæ¡ˆçµæ§‹èˆ‡ Demo ç¨‹å¼ç¢¼å¦‚ä¸‹åœ– (TryDocFx.DocFx æ˜¯å·¥å…·å°ˆæ¡ˆ, è€Œ TryDocFx.ClassLib æ˜¯ç”¢å“å°ˆæ¡ˆ): ç”±æ–¼ç›®æ¨™æ˜¯èƒ½ç°¡å–®ä½ˆç½²æ–‡ä»¶åˆ° GitHub Pages ä¸Š, æ‰€ä»¥é€™é‚Šæ˜¯ç”¨ docs è³‡æ–™å¤¾ä¾†åšç‚º GitHub Pages çš„æ ¹ç›®éŒ„, è€Œä¸æ˜¯ gh-pages åˆ†æ”¯, ä¹Ÿå› æ­¤è³‡æ–™å¤¾çµæ§‹æ˜¯å¦‚ä¸‹é¢æ‰€ç¤º: 12345TryDocFx |---- docs |---- src |---- TryDocFx.ClassLib |---- TryDocFx.DocFx å®‰è£ docfx.consoleå¾ž Nuget ä¸­æ‰¾åˆ° docfx.console ä¸¦å®‰è£åœ¨ä¸Šä¸€æ­¥å»ºç«‹å¥½çš„å·¥å…·å°ˆæ¡ˆ (TryDocFx.DocFx) ä¸­, å®‰è£å®Œå¾Œ, æœƒè‡ªå‹•åœ¨å·¥å…·å°ˆæ¡ˆä¸­å»ºç«‹å¿…è¦çš„æª”æ¡ˆ, å¦‚ä¸‹åœ–: ä¿®æ”¹è¨­å®šè¨­å®šæª”æ˜¯ docfx.json, å®˜æ–¹æ–‡ä»¶æœ‰æä¾›é€™å€‹è¨­å®šæª”çš„èªªæ˜Ž, ä»¥æœ¬ä¾‹ä¾†èªªéœ€è¦ä¿®æ”¹å¹¾å€‹åœ°æ–¹. å› ç‚ºç”¢å“ç¨‹å¼ç¢¼ä¸åœ¨ç›®å‰å°ˆæ¡ˆä¸­, æ‰€ä»¥éœ€è¦éœ€è¦æŒ‡å®šç”¢å“ç¨‹å¼ç¢¼ä¾†æº: &quot;src&quot;: &quot;../TryDocFx.ClassLib&quot;. å¥—ä»¶é è¨­æœƒæŠŠéœæ…‹ç¶²é æ”¾åœ¨ç›®å‰å°ˆæ¡ˆçš„ _site è³‡æ–™å¤¾ä¸‹, å› ç‚ºæˆ‘å€‘è¦ä½ˆç½²åˆ° GitHub Pages ä¸Š, æ‰€ä»¥éœ€è¦ä¿®æ”¹è¼¸å‡ºè·¯å¾‘: &quot;dest&quot;: &quot;../../docs&quot;. exclude çš„éƒ¨åˆ†, ç”±æ–¼æœ¬ä¾‹è¼¸å‡ºè·¯å¾‘å’Œå·¥å…·å°ˆæ¡ˆæ˜¯åˆ†é–‹çš„, æ‰€ä»¥å¯ä»¥å¾ž exclude è¨­å®šä¸­å°‡ &quot;_site/**&quot; æ‹¿æŽ‰. å…¶å¯¦æ•´å€‹è¨­å®šæª”æ‡‰è©²å¯ä»¥æ›´ç°¡æ½”, ä¾‹å¦‚èªªåœ¨æœ¬æ–‡çš„æƒ…å¢ƒä¸­ exclude ç¯€é»žå¯èƒ½æ˜¯å¯ä»¥ç§»é™¤çš„, ä¸éŽç´°ç¯€è¦ä¸€ä¸€ç ”ç©¶å¤ªèŠ±æ™‚é–“äº†, å¦‚æžœä¹‹å¾Œå·¥ä½œä¸Šæœ‰ç”¨åˆ°å†ä¾†è©³ç´°äº†è§£è¨­å®šæª”çš„å®Œæ•´å…§å®¹å§. ä¿®æ”¹å¾Œç¯„ä¾‹å¦‚ä¸‹:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&#123; "metadata": [ &#123; "src": [ &#123; "files": [ "*.csproj" ], "cwd": ".", "exclude": [ "**/obj/**", "**/bin/**" ], "src": "../TryDocFx.ClassLib" &#125; ], "dest": "obj/api" &#125; ], "build": &#123; "content": [ &#123; "files": [ "api/**.yml" ], "cwd": "obj" &#125;, &#123; "files": [ "api/*.md", "articles/**.md", "toc.yml", "*.md" ], "exclude": [ "obj/**" ] &#125; ], "resource": [ &#123; "files": [ "images/**" ], "exclude": [ "obj/**" ] &#125; ], "overwrite": [ &#123; "files": [ "apidoc/**.md" ], "exclude": [ "obj/**" ] &#125; ], "dest": "../../docs", "template": [ "default" ] &#125;&#125; ç·¨è­¯å°ˆæ¡ˆæ”¹å¥½è¨­å®šå¾Œ, åªè¦åœ¨ visual studio ä¸­ç·¨è­¯ TryDocFx.DocFx é€™å€‹å·¥å…·å°ˆæ¡ˆ, ä»–å°±æœƒæ ¹æ“šè¨­å®šå°‡ç”¢å“å°ˆæ¡ˆçš„ XML æ–‡ä»¶è¨»è§£è½‰æ›æˆéœæ…‹ç¶²é ä¸¦è¼¸å‡ºåˆ°è¨­å®šçš„è¼¸å‡ºè·¯å¾‘ä¸­ (../../docs).æœ€å¾Œåªè¦è¨­å®šå¥½ GitHub Pages ä¸¦å°‡å°ˆæ¡ˆå…¨éƒ¨æŽ¨ä¸Š GitHub å°±å®Œæˆäº†. çµè«–å¯ä»¥å°‡ C# ä¸­çš„ XML æ–‡ä»¶è¨»è§£è‡ªå‹•è½‰æ›æˆæ–‡ä»¶çš„æ–¹å¼å¾ˆå¤š, ä¸éŽå¦‚æžœè¦åŒæ™‚èƒ½æ•´åˆ visual studio åˆèƒ½åŒ…å«è‡ªå·±å¯«çš„ Markdown æ–‡ä»¶, é‚„å¾—æ–¹ä¾¿ä½ˆç½²çš„è©±, DocFx æ˜¯ä¸éŒ¯çš„é¸æ“‡. è€Œå¾žè¨­å®šæª”çš„çµæ§‹èˆ‡å…§å®¹ä¸é›£çœ‹å‡º, ä»–çš„åŠŸèƒ½æ‡‰è©²æ›´å¼·å¤§, ä¸éŽé€™å°±ç­‰ä¹‹å¾Œé‡åˆ°è¤‡é›œçš„æƒ…å¢ƒæ™‚åœ¨ä¾†ä»”ç´°ç ”ç©¶äº†. åƒè€ƒDocFx]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å°‡ Stopwatch å°è£æˆå°å·¥å…·]]></title>
    <url>%2Fcontent%2F20190112-stopwatch-util.html</url>
    <content type="text"><![CDATA[Stopwatch ç¶“å¸¸è¢«ç”¨ä¾†è§€å¯Ÿç¨‹å¼çš„é‹è¡Œæ™‚é–“, åœ¨é–‹ç™¼éšŽæ®µèƒ½å”åŠ©æˆ‘å€‘æŠ“å‡ºä¸€äº›æ•ˆèƒ½çš„å•é¡Œ, ä¸éŽä»–çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ä¸æ˜¯å¾ˆæ¼‚äº®, åœ¨ç¨‹å¼ç¢¼ä¸­æ’å…¥ä¸€å † Stopwatch æœƒå¹²æ“¾é–‹ç™¼æˆ–æ˜¯ä¸å°å¿ƒæ²’ç§»é™¤è€Œ commit ä¸Šç‰ˆæŽ§ä¹Ÿä¸å¥½. å¦ä¸€æ–¹é¢, å¦‚æžœæœ‰éœ€è¦ç”¨ä»–ä¾†è§€å¯Ÿ production ç’°å¢ƒçš„é‹ä½œæ•ˆèƒ½çš„æ™‚å€™, é€™äº›ç©¿æ’åœ¨ä¸»è¦ç¨‹å¼ç¢¼ä¸­çš„ Stopwatch å°±æ›´åŠ å¹²æ“¾äº†, æ‰€ä»¥æ‰¾äº†å…©å€‹æ–¹æ³•ä¾†å°‡ Stopwatch å°è£æˆå°å·¥å…·. Actioné€™å€‹æ–¹å¼æ˜¯å°‡ä¸»è¦é‚è¼¯ action() ä»¥åŠç´€éŒ„é‹è¡Œæ™‚é–“çš„æ–¹æ³• report(ticks) åšç‚º Action å‚³é€²å·¥å…·ä¸­åŸ·è¡Œ, ä¸¦åœ¨åŸ·è¡Œå‰å¾ŒåŠ ä¸Š Stopwatch è¨ˆç®—é‹è¡Œæ™‚é–“å¾Œå‘¼å«ç´€éŒ„é‹è¡Œæ™‚é–“çš„æ–¹æ³• report(ticks). å…¶ä¸­ç¬¬äºŒå€‹åƒæ•¸ report(ticks) æœƒå­˜åœ¨ä¸»è¦æ˜¯å‡è¨­å‘¼å«ç«¯å°æ–¼å›žå‚³åŸ·è¡Œæ™‚é–“çš„æ‰€åšçš„è™•ç†ä¸åŒ, å¦‚æžœè¦ºå¾—å…©å€‹ Action åƒæ•¸éŽæ–¼è¤‡é›œ, å¯ä»¥æŠŠç¬¬äºŒå€‹åƒæ•¸æ”¹æˆé¸æ“‡æ€§åƒæ•¸, æ²’å‚³å…¥çš„è©±å°±åŸ·è¡Œé è¨­çš„è¡Œç‚ºå°±å¥½, æˆ–è€…ç›®å‰ç³»çµ±æ²’é€™å€‹éœ€æ±‚çš„è©±, ä¹Ÿå¯ä»¥ä¸éœ€è¦ç¬¬äºŒå€‹åƒæ•¸. ç¯„ä¾‹å¦‚ä¸‹: 1234567891011121314public class StopwatchReporter&#123; public static void Execute(Action action, Action&lt;long&gt; report) &#123; var stopwatch = Stopwatch.StartNew(); action(); stopwatch.Stop(); var excusionTicks = stopwatch.ElapsedTicks; report(excusionTicks); &#125;&#125; é€™æ¨£å°è£éžå¸¸ç°¡å–®æ˜“æ‡‚, ä½¿ç”¨ä¸Šä¹Ÿé‚„ç®—æ–¹ä¾¿, å¯ä»¥è¼•æ˜“çš„å°‡ä¸»è¦é‚è¼¯èˆ‡æ•ˆèƒ½ç›£æŽ§åˆ†é–‹, å¦‚ä¸‹:123456789StopwatchReporter.Execute( () =&gt; &#123; // Do anything here &#125;, ticks =&gt; &#123; // Logging excusion time or something else here &#125;); å¯¦ä½œ IDisposableä¸Šä¸€å€‹æ–¹æ³•å”¯ä¸€çš„å°ç¼ºé»žå°±æ˜¯é‚„æ˜¯éœ€è¦å°‡ä¸»è¦æµç¨‹åŒ…é€² Action è£¡é¢, é›–ç„¶ C# æä¾›çš„èªžæ³•ç³–å·²ç¶“å¤§å¹…æé«˜å¯è®€æ€§äº†, ä¸éŽé‚„æ˜¯æœ‰å…¶ä»–æ–¹æ³•èƒ½è®“å‘¼å«ç«¯çœ‹èµ·ä¾†æ›´ç°¡æ½”. 123456789101112131415161718192021222324public class StopwatchReporter : IDisposable&#123; private string _name; private Stopwatch _stopwatch; public StopwatchReporter(string name) &#123; _name = name; _stopwatch = new Stopwatch(); _stopwatch.Start(); &#125; public void Dispose() &#123; _stopwatch.Stop(); var excusionTime = _stopwatch.ElapsedMilliseconds; // logging here Debug.WriteLine($"&#123;_name&#125; excusion time: &#123;excusionTime&#125; ms"); _name = null; _stopwatch = null; &#125;&#125; é€™ç¨®åšæ³•æœ€å¤§çš„å„ªé»žå°±æ˜¯å‘¼å«ç«¯æ¥µè‡´ç°¡æ½”, å¦‚ä¸‹:1234using (new StopwatchReporter("something"))&#123; //Do anything here...&#125; ä½†å…¶å¯¦é€™ç¨®åšæ³•ç¼ºé»žæ¯”è¼ƒå¤š, ä¸€ä¾†æ˜¯å¯¦ä½œè¤‡é›œåº¦æé«˜å¾ˆå¤š, ä¸”åœ¨æˆ‘æ‰€åƒè€ƒçš„æ–‡ç« ä¸‹é¢çš„å›žè¦†ä¸­æœ‰æåˆ°, ç‚ºäº†é€™å€‹ä¾¿åˆ©æ€§è€Œè®“ç¨‹å¼ç¢¼åœ¨é‡‹æ”¾è³‡æºç”¨çš„æ–¹æ³•ä¸­åŽ»æ“ä½œè³‡æº, ä¸‹é¢ç¯€éŒ„è‡ªè©²å‰‡å›žè¦†: You implement IDisposable when you are managing resources. Implementing it communicates to other developers that youâ€™re doing dealing with memory usage, and implies that you SHOULD call Dispose as soon as reasonably possible. Using it as syntactic sugar confuses that message. Patterns and interfaces communicate intent. Using a pattern because you like the way it reads while ignoring what the interface intends creates cluttered code. å…¶å¯¦æˆ‘å€‹äººæ˜¯æ»¿èªåŒé€™å‰‡å›žè¦†çš„, é›–ç„¶å°æ–¼å‘¼å«ç«¯ä¾†èªªä¸¦ä¸éœ€è¦çŸ¥é“å¯¦ä½œç´°ç¯€, ä½†å°±è¨­è¨ˆçš„è§’åº¦ä¾†çœ‹, çš„ç¢ºæ˜¯åœ¨ä¸€å€‹é‡‹æ”¾è³‡æºçš„ Dispose() æ–¹æ³•ä¸­åšäº†æ„æƒ³ä¸åˆ°çš„è¡Œç‚º, å¦‚æžœæ˜¯å–®ç´”æŠŠ Stopwatch åœæ­¢ä¸¦é‡‹æ”¾å€’æ˜¯é‚„å¥½, ä½†æ˜¯å¦‚æžœè¦ç´€éŒ„æ™‚é–“å°±å¯èƒ½æœƒä¾è³´å…¶ä»–çµ„ä»¶, ç•¶è¤‡é›œåº¦ä¸€æé«˜, é€™å€‹åšæ³•çš„ç¼ºé»žå°±æœƒæ›´æ˜Žé¡¯. çµè«–å…©ç¨®åšæ³•è¦é¸çš„è©±, æˆ‘æœƒé¸ç¬¬ä¸€ç¨®ç”¨ Action çš„ä½œæ³•, æ¯”è¼ƒåˆç†å¥½æ‡‚ä¸”å‘¼å«æ–¹å¼ä¹Ÿå¤ æ•´æ½”. ä½†ç¸½é«”ä¾†èªª, ç›®å‰ç‚ºæ­¢å°æ–¼ç‰¹åˆ¥å°è£é€™éº¼ä¸€å€‹å·¥å…·æˆ‘é‚„æ˜¯è¦ºå¾—æœ‰é»žé›žè‚‹, åªæ˜¯èªªå¦‚æžœçœŸçš„å¾ˆå¿…è¦åœ¨çœŸå¯¦çš„ production ç’°å¢ƒç›£æŽ§çš„è©±ä¹Ÿæ˜¯ä¸€ç¨®å¯è¡Œæ–¹æ¡ˆ, å°±å…ˆè¨˜èµ·ä¾†å‚™å¿˜, æžä¸å¥½å“ªå¤©çœŸçš„æœƒç”¨ä¸Š. åƒè€ƒExact time measurement for performance testingCode Tip: Simpler Performance Timer Logging in C#]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æŒ‡ç¤ºè©ž(#if) å’Œ ConditionalAttribute]]></title>
    <url>%2Fcontent%2F20190111-if-directive-and-conditional.html</url>
    <content type="text"><![CDATA[æœ‰æ™‚å€™æˆ‘å€‘æœƒéœ€è¦ç”¨åˆ° C# çš„å‰ç½®è™•ç†å™¨æŒ‡ç¤ºè©ž(Preprocessor Directives) ä¸­çš„ #if ç­‰ç›¸é—œæŒ‡ç¤ºè©ž, æœ€å¸¸è¦‹çš„å°±æ˜¯ç”¨ä¾†å€åˆ† Debug å’Œ Release çš„ç·¨è­¯æ¨¡å¼. ä¹Ÿæœ‰å¦å¤–ä¸€ç¨®æ–¹å¼ (ConditionalAttribute) å¯ä»¥é”åˆ°é¡žä¼¼çš„æ•ˆæžœ, ä½†å…©ç¨®æ–¹å¼çš„é‹ä½œæ©Ÿåˆ¶æ˜¯ä¸ä¸€æ¨£çš„. é€™é¡žåž‹çš„æ¢ä»¶ç·¨è­¯æœ€å¸¸ç”¨åœ¨ç’°å¢ƒå€åˆ†, è€Œä¸ç®¡ç”¨ #if é‚„æ˜¯ ConditionalAttribute, éƒ½è¦å®šç¾©å°ˆæ¡ˆåœ¨å„ç¨®æ¨¡å¼ä¸‹çš„ compilation symbol, è¦æ³¨æ„çš„æ˜¯é€™éƒ¨åˆ†æ˜¯å¤§å°å¯«æ•æ„Ÿ, é›–ç„¶ç”¨å°å¯«ä¸æœƒæœ‰å•é¡Œ, ä½†ä¸€èˆ¬ä¾†èªªæ˜¯ç”¨å…¨å¤§å¯«, ä¾‹å¦‚: DEBUG. è¨­å®šæ–¹å¼å¦‚ä¸‹: #if, #elif, #elseé‹ä½œæ–¹å¼è¢« #if, #elif åŒ…èµ·ä¾†çš„å€é–“ä¸ç¬¦åˆå®šç¾©çš„ compilation symbol æ™‚, ç·¨è­¯æ™‚æœƒç›´æŽ¥ç•¥éŽå€é–“å…§çš„ç¨‹å¼ç¢¼, ä¹Ÿå°±æ˜¯èªªä¸æœƒè¢«ç·¨è­¯, ä»¥ä¸‹é¢ç¨‹å¼ç¢¼èˆ‡ IL ç‚ºä¾‹ 12345678910public void Caller()&#123;#if DEBUG Console.WriteLine("DEBUG: IfDirective Executed");#elif RELEASE Console.WriteLine("RELEASE: IfDirective: Executed");#else Console.WriteLine("IfDirective Executed");#endif&#125; 12345IL_0000 nopIL_0001 ldstr &quot;DEBUG: IfDirective Executed&quot;IL_0006 call System.Void System.Console::WriteLine(System.String)IL_000B nopIL_000C ret é€éŽå·¥å…·, æˆ‘å€‘å¯ä»¥çœ‹åˆ°åœ¨ DEBUG ä¸‹ç·¨è­¯, åªå‰© DEBUG å€å¡Šçš„ç¨‹å¼ç¢¼. å„ªç¼ºé»žé€™æ¨£é›–ç„¶ä¸éœ€è¦çš„ç¨‹å¼ç¢¼ä¸æœƒè¢«ç·¨è­¯, ä½†æ˜¯å¾žä½¿ç”¨æ–¹å¼çœ‹ä¾†, å¦‚æžœä¸å°å¿ƒä½¿ç”¨çš„è©±å¾ˆå®¹æ˜“è®“ç¨‹å¼ç¢¼è®Šå¾—å¾ˆé«’äº‚, åˆ°è™•éƒ½æ˜¯ #if, #elif å’Œ #else. è€Œå¾žå¦å¤–ä¸€å€‹è§’åº¦çœ‹, å› ç‚ºä¸æ»¿è¶³æ¢ä»¶çš„å€å¡Šä¸æœƒè¢«ç·¨è­¯, æ‰€ä»¥å¾ˆå¤š visual studio æä¾›çš„åŠŸèƒ½éƒ½æœƒç„¡æ³•ä½¿ç”¨, ç¶­è­·ä¸Šå¾ˆå®¹æ˜“é€ æˆå›°æ“¾, ä¾‹å¦‚åœ¨ DEBUG ä¸‹å°‡ä¸€å€‹æ–¹æ³•é‡æ–°å‘½å, çµæžœé€™å€‹æ–¹æ³•åœ¨ RELEASE å€é–“æœ‰è¢«å‘¼å«åˆ°, å»ä¸æœƒè¢«ä¿®æ”¹åˆ°, ç•¶åˆ‡æ›åˆ° RELEASE çš„æ™‚å€™å°±ç„¡æ³•é€šéŽç·¨è­¯, åˆä¾‹å¦‚å°‹æ‰¾æ‰€æœ‰å¼•ç”¨ (Find All References) çš„åŠŸèƒ½ä¹Ÿæ˜¯ä¸€æ¨£. ConditionalAttributeé‹ä½œæ–¹å¼ç•¶ä¸ç¬¦åˆ ConditionalAttribute æ‰€å¥—ç”¨çš„ compilation symbol æ™‚, ç·¨è­¯å¾Œæœƒå¿½ç•¥å‘¼å«ç«¯çš„å‘¼å«, ä½†æ˜¯ä¿ç•™è¢«å‘¼å«éƒ¨åˆ†çš„ç¨‹å¼ç¢¼, ä»¥ä¸‹é¢ç¨‹å¼ç¢¼èˆ‡ IL ç‚ºä¾‹ 1234567891011121314151617public void Caller()&#123; DebugConditional(); RELEASEConditional();&#125;[Conditional("DEBUG")]public void DebugConditional()&#123; Console.WriteLine("DEBUG: Conditional Executed");&#125;[Conditional("RELEASE")]public void RELEASEConditional()&#123; Console.WriteLine("RELEASE: Conditional Executed");&#125; 1234567891011121314151617181920// Selected method: LazyGuy.Demo.CallerIL_0000 nopIL_0001 ldarg.0IL_0002 call System.Void LazyGuy.Demo::DebugConditional()IL_0007 nopIL_0008 ret// Selected method: LazyGuy.Demo.DebugConditionalIL_0000 nopIL_0001 ldstr &quot;DEBUG: Conditional Executed&quot;IL_0006 call System.Void System.Console::WriteLine(System.String)IL_000B nopIL_000C ret// Selected method: LazyGuy.Demo.RELEASEConditionalIL_0000 nopIL_0001 ldstr &quot;RELEASE: Conditional Executed&quot;IL_0006 call System.Void System.Console::WriteLine(System.String)IL_000B nopIL_000C ret é€éŽå·¥å…·, æˆ‘å€‘å¯ä»¥çœ‹åˆ°åœ¨ DEBUG ä¸‹ç·¨è­¯, å‘¼å«ç«¯çš„å‘¼å«åªå‰© DebugConditional(), è€Œ RELEASEConditional() é€™å€‹æ–¹æ³•é‚„æ˜¯æœƒè¢«ç·¨è­¯, åªæ˜¯æ²’è¢«å‘¼å«. å„ªç¼ºé»žConditionalAttribute æœ‰å¾ˆå¤šä½¿ç”¨é™åˆ¶ åªèƒ½åŠ åœ¨ void method ä»¥åŠ attribute class ä¸Š ä¸èƒ½åŠ åœ¨å¯¦ä½œä»‹é¢çš„æ–¹æ³•ä¸Š ä¸èƒ½åŠ åœ¨ override æ–¹æ³•ä¸Š é€™å€‹æ–¹æ³•é›–ç„¶é™åˆ¶å¾ˆå¤š, ä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šå¥½è™•å¦‚ä¸‹: é¦–å…ˆ, å› ç‚º ConditionalAttribute åªèƒ½åŠ åœ¨ void method ä»¥åŠ attribute class ä¸Š, æ‰€ä»¥è®Šç›¸å¼·åˆ¶æˆ‘å€‘å°‡é€™äº›ç¨‹å¼ç¢¼æŠ½å‡ºæˆç¨ç«‹çš„æ–¹æ³•, é¿å… #if æœƒç”¢ç”Ÿçš„å‰¯ä½œç”¨. å³ä½¿å°‡ #if ä¸­çš„ç¨‹å¼ç¢¼æŠ½å‡ºæˆç¨ç«‹æ–¹æ³•, ä½†å› ç‚ºç·¨è­¯æ™‚ä¸¦ä¸æœƒç§»é™¤å‘¼å«ç«¯çš„å‘¼å«, æ‰€ä»¥æœƒè®Šæˆå‘¼å«ä¸€å€‹ç©ºæ–¹æ³•, ä¹Ÿä¸æ˜¯å¤ªå¥½, åä¹‹ ConditionalAttribute å°±ä¸æœƒæœ‰é€™å€‹å•é¡Œ. ç¬¬äºŒ, ä»–ä¹Ÿä¸æœƒæœ‰ #if åœ¨ä½¿ç”¨ visual studio çš„è¼”åŠ©åŠŸèƒ½æ™‚çš„å•é¡Œ. çµè«–å¦‚æžœå°±é€™å…©å€‹ä¾†æ¯”è¼ƒ, ä½¿ç”¨ ConditionalAtrribute å–ä»£ #if æœƒæ¯”è¼ƒå¥½, å¦‚æžœå› ç‚º ConditionalAtrribute çš„é™åˆ¶è€Œç„¡æ³•ä½¿ç”¨, æœ€å¾Œå†æ”¹ç”¨ #if.ä¸éŽé€™ç¨®éœ€è¦ä¾ç…§ç’°å¢ƒåˆ‡æ›é‚è¼¯çš„æƒ…å¢ƒ, æˆ‘æœƒå„ªå…ˆå¾€ config æˆ–å¾Œè‡ºè¨­å®šçš„æ–¹å‘æ€è€ƒ, é™¤éžç”¨è¨­å®šé‚„æ˜¯è™•ç†çš„ä¸å¤ å¥½, æ‰æœƒå¾€ ConditionalAtrribute çš„æ–¹å‘æƒ³. åƒè€ƒC# : Conditional Attribute and #if DirectiveIf Youâ€™re Using â€œ#if DEBUGâ€, Youâ€™re Doing it Wrong#if (C# Reference)Conditional (C# Programming Guide))#if DEBUG vs. Conditional(â€œDEBUGâ€)]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å°‡ RSA é‡‘é‘°è½‰æˆ XML æ ¼å¼çš„å°‘è¦‹å•é¡Œ]]></title>
    <url>%2Fcontent%2F20190105-bouncycastle-rsa-key-with-leading-zero-to-xml.html</url>
    <content type="text"><![CDATA[.NET å…§å»ºçš„ RSA åŠ è§£å¯†ç›¸é—œå…ƒä»¶å¯ä»¥ç”¨è®€å–æ†‘è­‰æª”æˆ–æ˜¯ XML æ ¼å¼çš„é‡‘é‘°çš„æ–¹å¼ä¾†åˆå§‹åŒ–, ä¹‹å‰çš„å°ˆæ¡ˆéƒ½æ˜¯ç”¨è®€å– XML çš„æ–¹å¼ä¾†æ“ä½œ, è®“ç®¡ç†è€…èƒ½å¤ æ–¹ä¾¿çš„å¾žå¾Œå°ä¾†ç®¡ç†é‡‘é‘°. è€Œåœ¨ PEM æª”ä¸­, é‡‘é‘°çš„æ ¼å¼æ˜¯ base64 å­—ä¸², é€™ç”¨ JAVA æ˜¯å¯ä»¥æ­£å¸¸è®€å–çš„, ä½†å»ä¸æ˜¯ .NET æŽ¥å—çš„ XML æ ¼å¼, å› æ­¤ç”¨äº†ä¸€å€‹ç¬¬ä¸‰æ–¹å¥—ä»¶ Bouncy Castle ä¾†å¹«å¿™è½‰æ›, ä½†æ˜¯åœ¨ä¸€å€‹å°‘è¦‹çš„æƒ…å¢ƒä¸‹ (å…¶å¯¦ä¹Ÿæ²’æœ‰å¤šå°‘è¦‹, æˆ‘ç”¨ OpenSSL éš¨æ©Ÿç”Ÿ 500 çµ„, å°±æœ‰ 10 çµ„è§¸ç™¼), è½‰æ›å‡ºä¾†çš„ XML æ˜¯éŒ¯èª¤çš„, ä¸”åªæœ‰ç§é‘°æœ‰ç™¼ç”ŸéŽ. å•é¡Œå¦‚æžœæœ‰åœ¨ç¶²è·¯ä¸Šæ‰¾éŽé‡‘é‘°è½‰æ›çš„æ–¹å¼çš„è©±, æ‡‰è©²ä¸é›£æ‰¾åˆ°ä¸‹é¢æ®µè½‰æ›ç§é‘°çš„ç¨‹å¼ç¢¼, é€éŽ RSAPrivateKeyJava2DotNet(string privateKey) æ–¹æ³•ä¾†å°‡ base64 æ ¼å¼çš„ç§é‘°è½‰æ›æˆ XML æ ¼å¼. 12345678910111213141516171819202122232425public string SignDataByPrivateKey(string data, string key)&#123; string xmlData = RSAPrivateKeyJava2DotNet(key); RSACryptoServiceProvider privateKey = new RSACryptoServiceProvider(); privateKey.FromXmlString(xmlData); var signBytes = privateKey.SignData(Encoding.UTF8.GetBytes(data), "sha1"); return Convert.ToBase64String(signBytes);&#125;public string RSAPrivateKeyJava2DotNet(string privateKey)&#123; RsaPrivateCrtKeyParameters privateKeyParam = (RsaPrivateCrtKeyParameters)PrivateKeyFactory.CreateKey(Convert.FromBase64String(privateKey)); return string.Format( "&lt;RSAKeyValue&gt;&lt;Modulus&gt;&#123;0&#125;&lt;/Modulus&gt;&lt;Exponent&gt;&#123;1&#125;&lt;/Exponent&gt;&lt;P&gt;&#123;2&#125;&lt;/P&gt;&lt;Q&gt;&#123;3&#125;&lt;/Q&gt;&lt;DP&gt;&#123;4&#125;&lt;/DP&gt;&lt;DQ&gt;&#123;5&#125;&lt;/DQ&gt;&lt;InverseQ&gt;&#123;6&#125;&lt;/InverseQ&gt;&lt;D&gt;&#123;7&#125;&lt;/D&gt;&lt;/RSAKeyValue&gt;", Convert.ToBase64String(privateKeyParam.Modulus.ToByteArrayUnsigned()), Convert.ToBase64String(privateKeyParam.PublicExponent.ToByteArrayUnsigned()), Convert.ToBase64String(privateKeyParam.P.ToByteArrayUnsigned()), Convert.ToBase64String(privateKeyParam.Q.ToByteArrayUnsigned()), Convert.ToBase64String(privateKeyParam.DP.ToByteArrayUnsigned()), Convert.ToBase64String(privateKeyParam.DQ.ToByteArrayUnsigned()), Convert.ToBase64String(privateKeyParam.QInv.ToByteArrayUnsigned()), Convert.ToBase64String(privateKeyParam.Exponent.ToByteArrayUnsigned()) );&#125; é€™æ®µç¨‹å¼ç¢¼ä¸€èˆ¬æƒ…å¢ƒä¸‹æ²’æœ‰å•é¡Œ, ä½†æ˜¯å¦‚æžœç”¨ä¸‹é¢çš„æ¸¬è©¦ç§é‘°ä¾†è©¦, å°±æœƒåœ¨ privateKey.FromXmlString(xmlData); é€™ä¸€è¡Œæ‹‹å‡º CryptographicException ä¸”éŒ¯èª¤è³‡è¨Šåªæœ‰çŸ­çŸ­çš„ â€œBad Data.\r\nâ€. Private Key :MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAOEZbmixVVPO6Z96 sGqb8G3gBOgBuLc6o673GyxLZPXPk6VaBF+2LJ+WnIbuYu3iDE2pR1SHeA09BCyz YJnJTYl77vqzRqyzf9lWHGJDkwpEnftlDfeIc5ICfWpu3bHuBuzmtIfqrErCbaJJ 3HkhOsuJ3oL8dAYQN5RTt66IpSn9AgMBAAECgYBEOuotj7sWeTx1W8IHvpbFJ0c1 b/gmif69dSdmaMAEhlPxpfR3cofaI9P0TmPsST2DeNEnPRzVnm4agpDAbLU0ana1 I8pfjRq3xrlTJkDjWKOyaFF2afo2y1pyIFsm1G5wVEFwKWSNUo/1Jy61H4snYxMk /SCZqAYxO3S12jAFHQJBAP6Cv1MV8HcBMuDgyl9Obq/tU6r9zrGOmR1bWBA61DVw jcWgMSpo8dkBAs0Hd5SfWNNzUIVH2gryAcy5Skyq8mMCQQDiaqBM2nCLfQ3EaLzy e1tYZCuZYiZl60OX9nS9FNLFwSI6sFsy/+aGg1ivSVHvXpi9N1oaNgvSI13z9DT0 B/AfAkAArfqyzxkwSCmJnjAMJxp2j8ysZTcbFEVmZasLiAyvA9jtEStwcI1Mxgrq 3z07gV1sWx9466MyakkE8e233LD/AkEA244n+b6NCkZu1jn2l3CVaIZiXO93areT qUV9eGk75jXdemnPVgoeQewWUIvZ3zOtCzcksWwdVF2lWs5Bly4nYwJBAK+niJt3 7jWf13muppL1aRN/i1otm3yNZuNGhrCZ/nEfehhBtege3IHn337fuyLhlXMc37OY k1iKRpcW8kn4LFQ= åŽŸå› ç•¶åˆä¹Ÿæ˜¯æ‰¾äº†å¾ˆä¹…, æœ€å¾Œç™¼ç¾ privateKeyParam.DP.ToByteArrayUnsigned() ä¸­çš„ DP åªæœ‰ 63 bytes, å°‘äº†ä¸€å€‹ä½å…ƒçµ„, è€Œé€ æˆé€™å€‹ç¾è±¡çš„åŽŸå› æ˜¯å› ç‚º privateKeyParam.DP æ˜¯æ•¸å€¼åž‹æ…‹, Org.BouncyCastle.Math.BigInteger åœ¨åˆå§‹åŒ–çš„æ™‚å€™, è·³éŽäº†é–‹é ­çš„æ‰€æœ‰ 0, è€Œä¸”é€™å€‹å•é¡Œåœ¨ DP , DQ , Exponent , QInv é€™å››æ®µä¸Šé¢éƒ½æœƒç™¼ç”Ÿ. æ ¹æ“šå®˜æ–¹JIRA ä¸Šçš„å–®å­ BMA-92 å¯ä»¥çœ‹å‡ºæ˜¯åœ¨ Org.BouncyCastle.Math.BigInteger åˆå§‹åŒ–éŽç¨‹é€ æˆçš„, å¾žåŽŸå§‹ç¢¼ä¸­çœ‹èµ·ä¾†ä¹Ÿå¾ˆåˆç†(ä¸éŽæˆ‘åªæ˜¯çœ‹çœ‹åŽŸå§‹ç¢¼æŽ¨æ¸¬çš„, æ²’æœ‰ç›´æŽ¥æ‹‰ä¸‹ä¾†é©—è­‰, ä¸ä¿è­‰çœŸçš„æ˜¯):å¾ž public BigInteger(byte[] bytes) : this(bytes, 0, bytes.Length)=&gt; public BigInteger(byte[] bytes, int offset, int length)=&gt; private static int[] MakeMagnitude(byte[] bytes, int offset, int length)ä¸­çš„ firstSignificant é€™å€‹ flag ä»¥ç¬¬ä¸€å€‹éž 0 ä½ç½®ç‚ºèµ·é»ž è€Œç”¨é€™å€‹ç™¼ç¾ä¾†æŽ¨è«–, ä¹Ÿå¯ä»¥ç†è§£ç‚ºä»€éº¼å…¬é‘°ä¸æœƒæœ‰é€™å•é¡Œ, å› ç‚ºå…¬é‘°åªæœ‰ Modulus å’Œ Exponent é€™å…©æ®µ. è§£æ±ºæ–¹å¼å…¶å¯¦é€™å€‹è½‰æ›éŽç¨‹ Bouncy Castle æœ‰æä¾›æ›´ç°¡ä¾¿çš„æ–¹å¼, ä¸éœ€è¦è‡ªå·±ä¸², å°‡ RSAPrivateKeyJava2DotNet(string privateKey) æ”¹æˆåƒä¸‹é¢é€™æ¨£(å…¬é‘°çš„éƒ¨åˆ†ä¹Ÿä¸€ä½µæ”¹äº†): 1234567891011private static string RSAPrivateKeyJava2DotNet(string privateKey)&#123; RsaPrivateCrtKeyParameters privateKeyParam = (RsaPrivateCrtKeyParameters)PrivateKeyFactory.CreateKey(Convert.FromBase64String(privateKey)); return DotNetUtilities.ToRSA(privateKeyParam).ToXmlString(true);&#125;public static string RSAPublicKeyJava2DotNet(string publicKey)&#123; RsaKeyParameters publicKeyParam = (RsaKeyParameters)PublicKeyFactory.CreateKey(Convert.FromBase64String(publicKey)); return DotNetUtilities.ToRSA(publicKeyParam).ToXmlString(false);&#125; å¦‚æžœæœ‰è¿½é€²åŽ»åŽŸå§‹ç¢¼çœ‹å¯ä»¥ç™¼ç¾, ä»–åœ¨è¦è½‰æ›æˆ XML å­—ä¸²å‰, å°‡é–‹é ­æœ‰ 0 è¢«å¿½ç•¥çš„éƒ¨åˆ†å†è£œå›žä¾†, å¯¦æ¸¬å¾Œä¹Ÿç¢ºå¯¦å¯ä»¥é¿å…åŽŸæœ¬çš„å•é¡Œ, ä»–çš„ call stack æœ‰é»žé•·, é€™è£¡ç›´æŽ¥åˆ—å‡ºæœ€é—œéµçš„åœ°æ–¹å¦‚ä¸‹, å°±æ˜¯ ConvertRSAParametersField é€™å€‹æ–¹æ³•æ‰é¿å…æŽ‰é€™å€‹å•é¡Œçš„: 12345678910111213141516171819202122232425262728public static RSAParameters ToRSAParameters(RsaPrivateKeyStructure privKey)&#123; RSAParameters rp = new RSAParameters(); rp.Modulus = privKey.Modulus.ToByteArrayUnsigned(); rp.Exponent = privKey.PublicExponent.ToByteArrayUnsigned(); rp.P = privKey.Prime1.ToByteArrayUnsigned(); rp.Q = privKey.Prime2.ToByteArrayUnsigned(); rp.D = ConvertRSAParametersField(privKey.PrivateExponent, rp.Modulus.Length); rp.DP = ConvertRSAParametersField(privKey.Exponent1, rp.P.Length); rp.DQ = ConvertRSAParametersField(privKey.Exponent2, rp.Q.Length); rp.InverseQ = ConvertRSAParametersField(privKey.Coefficient, rp.Q.Length); return rp;&#125;private static byte[] ConvertRSAParametersField(BigInteger n, int size)&#123; byte[] bs = n.ToByteArrayUnsigned(); if (bs.Length == size) return bs; if (bs.Length &gt; size) throw new ArgumentException("Specified size too small", "size"); byte[] padded = new byte[size]; Array.Copy(bs, 0, padded, size - bs.Length, bs.Length); return padded;&#125; æ¡ˆå¤–æ¡ˆ - å¥—ä»¶ç‰ˆæœ¬ä½†æ˜¯ä½†æ˜¯ä½†æ˜¯ å‰›å‰›çš„è§£æ±ºæ–¹å¼åªåœ¨ 1.8.0 ä¹‹å¾Œæ‰æœ‰æ•ˆ, 1.7.x ä»¥å‰çš„ç‰ˆæœ¬å³ä½¿é€™æ¨£ä½¿ç”¨é‚„æ˜¯æœƒå‡ºéŒ¯. é€™éƒ¨åˆ†å¾žä¸Šé¢æœ‰å‡ºç¾éŽä¸€å€‹ JIRA çš„åˆ—è¡¨å°±å¯ä»¥çœ‹åˆ°é€™å€‹å•é¡Œæ˜¯ 1.8.0 æ‰ä¿®å¾©çš„, ä½†æ˜¯ GitHub çš„æ™‚å€™å·²ç¶“æ˜¯ 1.8.0 ç‰ˆäº†, æ‰€ä»¥å¦‚æžœçœŸçš„æƒ³æ¯”å°èˆŠç‰ˆçš„åŽŸå§‹ç¢¼çš„è©±, å°±è¦åŽ»å®˜ç¶²è€ƒå¤äº†. çµè«–å…¶å¯¦å¦‚æžœç›´æŽ¥è®€æ†‘è­‰æª”, å°±ä¸æœƒæœ‰é€™å€‹å•é¡Œ, ä½†æ˜¯å°ˆæ¡ˆç‰¹æ€§çš„é—œä¿‚, é€™å€‹é‡‘é‘°æœƒå¸¸å¸¸æ–°å¢žæˆ–æ›´æ–°, ç‚ºäº†ä¸è¦æ¯æ¬¡å¢žåŠ æˆ–ä¿®æ”¹éƒ½è¦é‡æ–°ä½ˆç½², åªèƒ½èŠ±æ™‚é–“ä¸‹åŽ»æ‰¾åŽŸå› è·Ÿè§£æ³•äº†. ç•¶æ™‚é‡åˆ°é€™å€‹å•é¡Œçš„æ™‚å€™çœŸçš„æ˜¯å¾ˆé›£éŽ, å› ç‚ºéŒ¯èª¤è¨Šæ¯è¶…ç´šå°‘, æƒ³æ‰¾ google éƒ½ä¸çŸ¥é“é—œéµå­—æ€Žéº¼ä¸‹, é‚„å¥½å¼„äº†å…©ä¸‰å¤©ä¹‹å¾Œæ„å¤–ç™¼ç¾è³‡æ–™é•·åº¦ä¸å°æ‰æœ‰çªç ´å£, é€™å€‹å°ˆæ¡ˆä¸­åŠ è§£å¯†çš„éƒ¨åˆ†æ˜¯å­˜åœ¨å¥½å¹¾å¹´çš„å…±ç”¨æ–¹æ³•, ä¸€ç›´æ²’äººé‡åˆ°éŽé€™å€‹æƒ…å¢ƒ, æ—¢ç„¶è¢«æˆ‘è¸©åˆ°äº†ä¹Ÿç®—æ˜¯å¾—åˆ°ä¸€å€‹é›£å¾—çš„ç¶“é©—å§. å¦å¤–, æ—¢ç„¶å¥—ä»¶æœ‰å°è£å¥½é€™éº¼æ–¹ä¾¿çš„æ–¹æ³•, ä¹‹å¾Œæœ‰éœ€è¦å¯«é¡žä¼¼çš„æ–¹æ³•æ™‚, å°±ä¸ç”¨å†ç”¨ä»¥å‰æµå‚³çš„é‚£ç¨®æ–¹å¼äº†, ç›´æŽ¥ç”¨è§£æ³•ä¸­çš„åšæ³•å°±å¥½, é€™ä¹Ÿæ˜¯åœ¨ç¶²è·¯ä¸Šæœå°‹è§£æ±ºæ–¹æ¡ˆçš„æ™‚å€™è¦æ³¨æ„çš„, å¤šæ‰¾å¹¾ç¨®è§£æ±ºæ–¹æ¡ˆæ¯”è¼ƒéŽå†æ±ºå®š, æœƒæ›´æœ‰æ©Ÿæœƒæ‰¾åˆ°æ¯”è¼ƒé©åˆçš„è§£æ±ºæ–¹æ¡ˆ. åƒè€ƒRSA Key Formats - Key File EncodingC#å’ŒJAVAçš„RSAå¯†é’¥ã€å…¬é’¥è½¬æ¢JIRA of Bouncy Castle]]></content>
      <categories>
        <category>C#</category>
        <category>Packages</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[SymmetricAlgorithm ä¸­ Key å’Œ KeySize çš„ä¾è³´é€ æˆçš„å°‘è¦‹å•é¡Œ]]></title>
    <url>%2Fcontent%2F20181230-interaction-between-key-and-keysize-in-symmetric-algorithm.html</url>
    <content type="text"><![CDATA[ä¹‹å‰åœ¨å¯« AES åŠ è§£å¯†ç”¨çš„å·¥å…·æ–¹æ³•çš„æ™‚å€™, æ„å¤–ç™¼ç¾æŸå€‹ç‰¹æ®Šçš„æƒ…å¢ƒ, æœƒå°Žè‡´è§£å¯†æ™‚å› ç‚ºæ²’æœ‰ Key è€Œæ‹‹å‡ºä¾‹å¤– (ä½† Key ç¢ºå¯¦æœ‰è¨­å®š). å•é¡Œè§£æžé¦–å…ˆè¦ä¾†çœ‹ä¸€ä¸‹ç¤ºæ„çš„ç¨‹å¼ç¢¼ 12345678910// Main logicvar aes = new AesCryptoServiceProvider()&#123; Mode = CipherMode.ECB, Key = GenerateKey(128), KeySize = 128,&#125;string ciphertext = "jYCA05v0hL52/wT5WEJitQ==";string plaintext = aes.Decrypt(ciphertext); 12345678910111213141516// extension method for decryptpublic static string Decrypt(this SymmetricAlgorithm symmetric, string ciphertext)&#123; string plaintext = string.Empty; MemoryStream ms = new MemoryStream(); using (CryptoStream cs = new CryptoStream(ms, symmetric.CreateDecryptor(), CryptoStreamMode.Write)) &#123; var ciphertextBytes = Convert.FromBase64String(ciphertext); cs.Write(ciphertextBytes, 0, ciphertextBytes.Length); cs.FlushFinalBlock(); plaintext = Encoding.UTF8.GetString(ms.ToArray()); &#125; return plaintext;&#125; æŽ¥è‘—ä¾†åˆ†æžä¸€ä¸‹éŒ¯èª¤å…§å®¹éŒ¯èª¤è¨Šæ¯: System.Security.Cryptography.CryptographicException: â€˜Decrypting a value requires that a key be set on the algorithm object.â€™å †ç–Šè¿½è¹¤æœ€å¾Œä¸€è¡Œ:at System.Security.Cryptography.AesCryptoServiceProvider.CreateDecryptor() é€™çœ‹èµ·ä¾†åƒæ˜¯ Key ä¸å­˜åœ¨, ä½†æˆ‘å€‘ç¢ºå¯¦æœ‰æŒ‡å®š Key, è€Œç”¨ä¸­æ–·é»žé€²åŽ» symmetric.CreateDecryptor() é€™ä¸€è¡Œçš„ symmetric ä¸­å»ç™¼ç¾ Key çš„å€¼å·²ç¶“ä¸æ˜¯ä¸€é–‹å§‹æŒ‡å®šçš„å€¼äº†. å•é¡Œé»žèªªæ˜Žç¸½ä¹‹æ˜¯è€—äº†ä¸€é»žæ™‚é–“åœ¨æŽ’é™¤å•é¡Œ, æœ€å¾Œç™¼ç¾æ˜¯ KeySize = 128 é€™ä¸€è¡Œå°Žè‡´çš„, å› ç‚ºè¨­å®š KeySize é€™ä»¶äº‹æœ¬èº«æœƒä½¿å¾— Key è¢«é‡‹æ”¾æŽ‰. é€™å€‹ç¾è±¡è¦çœ‹å®˜æ–¹çš„åŽŸå§‹ç¢¼æ‰èƒ½çŸ¥é“, å¾ž AesCryptoServiceProvider.cs ä¸­å¯ä»¥çœ‹åˆ° KeySize çš„ setter æœƒå°‡ä¸€é–‹å§‹è¨­å®šçš„ Key é‡‹æ”¾æŽ‰, å°Žè‡´ AesCryptoServiceProvider.CreateDecryptor() åŸ·è¡Œæ™‚ç™¼ç¾ m_key æ²’æœ‰å€¼è€Œæ‹‹éŒ¯. å†æ›´é€²ä¸€æ­¥åŽ»çœ‹çˆ¶é¡žåˆ¥ä¸­ SymmetricAlgorithm ä¸­çš„ KeySize å°±å¯ä»¥ç™¼ç¾, å…¶å¯¦ä¸åª AES, æ•´å€‹ SymmetricAlgorithm çš„è¡ç”Ÿé¡žåˆ¥éƒ½æœƒåœ¨ KeySize çš„ setter ä¸­æ¸…æŽ‰ç¾æœ‰çš„ Key (é™¤éžæœ‰èª°ç‰¹åˆ¥å°‡é€™æ®µé‚è¼¯è¦†å¯«æŽ‰). çµè«–ç›¸é—œçš„ç¨‹å¼ç¢¼æƒ³çœ‹å¯ä»¥åŽ»ä¸Šé¢é‚£äº›é€£çµè£¡é¢æ·±å…¥äº†è§£, ç¸½ä¹‹ Key å’Œ KeySize ä¹‹é–“æ˜¯æœ‰ä¾è³´çš„, æŒ‡å®š Key ä¹‹å‰å¦‚æžœå…ˆæŒ‡å®š KeySize æ²’æœ‰æ„ç¾©, å› ç‚ºæŒ‡å®š Key çš„æ™‚å€™, KeySize ä¹Ÿæœƒè¢«æ”¹è®Š, æ‰€ä»¥ä¸‹é¢ç¯„ä¾‹æœ€å¾Œçš„ KeySize æ˜¯ 256 è€Œä¸æ˜¯ 128. 123456new AesCryptoServiceProvider()&#123; Mode = CipherMode.ECB, KeySize = 128, Key = GenerateKey(256),&#125; åŒç†, å¦‚æžœæŒ‡å®šäº† Key, å°±ä¸å¯ä»¥åœ¨å¾Œé¢å†æŒ‡å®š KeySize, ä¸ç„¶åŽŸæœ¬æŒ‡å®šçš„ Key æœƒè¢«æ¸…æŽ‰, ä¹Ÿå°±æ˜¯æœ¬æ–‡é‡åˆ°çš„å•é¡Œ. éœ€è¦æŒ‡å®š KeySize çš„æ™‚æ©Ÿæ˜¯, åŠ å¯†æ™‚è¦æŒ‡å®š Key çš„é•·åº¦ä¸”ä¸æƒ³è‡ªå·±ç”¢ç”Ÿ Key, ä¾‹å¦‚ 12345new AesCryptoServiceProvider()&#123; Mode = CipherMode.ECB, KeySize = 128&#125; ç›¸é—œå•é¡Œ, ç¶²è·¯ä¸Šä¹Ÿæœ‰äººè¨Žè«–, é™„åœ¨ä¸‹æ–¹åƒè€ƒä¸­ å…¶å¯¦é€™æ¨£æƒ³èµ·ä¾†ä¹Ÿåˆç†, Key çš„å€¼æœ¬èº«å°±å¯ä»¥ç®—å‡º KeySize, å¦‚æžœ KeySize è¢«æŒ‡å®šæ™‚æ²’æœ‰æ¸…æŽ‰èˆŠçš„ Key, é‚£å°±æœƒå¯èƒ½ç™¼ç”Ÿ Key çš„å¯¦éš›é•·åº¦è·Ÿ KeySize ç´€éŒ„çš„é•·åº¦ä¸ä¸€æ¨£çš„å•é¡Œ. ç„¶å¾Œ Reference Source å’Œ Source Browser - .net core çœŸçš„æ˜¯ç¥žç‰©, å¾ˆå¤šæ™‚å€™èƒ½é é€™å…©å€‹æ±è¥¿äº†è§£ç´°éƒ¨çš„é‹ä½œèˆ‡å•é¡Œç™¼ç”Ÿçš„å…·é«”åŽŸå› . åƒè€ƒRijndaelManaged - What does setting KeySize property do?]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[XSD çš„ä½¿ç”¨èˆ‡æ‡‰ç”¨]]></title>
    <url>%2Fcontent%2F20181225-use-xml-schema-definition.html</url>
    <content type="text"><![CDATA[XSD çš„æ–‡ç« å¾ˆæ—©ä¹‹å‰å°±å¯«éŽ, ä½†æ˜¯ç•¶æ™‚å‰›é–‹å§‹å¯«éƒ¨è½æ ¼, æ‰€ä»¥é›–ç„¶å¯«äº†ä¸‰ç¯‡ä½†å…§å®¹æ²’æœ‰ç·¨æŽ’åˆå¾ˆäº‚, å› æ­¤æœ€è¿‘æƒ³èªªç¨å¾®é‡å¯«ä¸€ä¸‹, ç•™ä¸‹é‡é»žå°±å¥½. å‰è¨€XSD å…¨åç‚º XML Schema Definition, ç”¨ä¾†å®šç¾©ä¸¦é©—è­‰ä¸€å€‹ XML æ–‡ä»¶çš„æ ¼å¼, é™¤æ­¤ä¹‹å¤–ä»–å°æˆ‘å€‘åœ¨ Visual Studio ä¸­ç·¨å¯« XML çš„æ™‚å€™èƒ½æä¾›å¾ˆå¤§çš„å¹«åŠ©å¦‚ä¸‹: åœ¨ Visual Studio ä¸­æª¢æŸ¥ XML çš„æ ¼å¼èˆ‡å…§å®¹æ˜¯å¦ç¬¦åˆå®šç¾©. åœ¨ Visual Studio ä¸­ä½¿ç”¨è‡ªå‹•æç¤º (Intellisence) çš„åŠŸèƒ½ä¾†æç¤ºæˆ‘å€‘è©²æ€Žéº¼å¯«. ç§»åˆ°è‡ªå‹•æç¤ºçš„é¸é …ä¸Šé‚„æœƒé¡¯ç¤ºé€™å€‹é¸é …çš„è¨»è§£(ç•¶ç„¶è¦å…ˆå®šç¾©åœ¨ XSD ä¸­), æ»‘é¼ ç§»éŽåˆ°ä¸Šé¢ä¹Ÿæœƒè·³å‡ºè¨»è§£, å°±åƒå¹³å¸¸é–‹ç™¼åœ¨å‘¼å« API æœƒæœ‰çš„è‡ªå‹•æç¤ºå’Œè¨»è§£æç¤ºä¸€æ¨£. å› æ­¤ç•¶ä¸€å€‹å°ˆæ¡ˆéœ€è¦ä¾è³´å¤§é‡çš„ XML è¨­å®šæª”åŽ»è¨­å®šæˆ–æ˜¯è¨­å®šæª”æœ¬èº«æ¯”è¼ƒè¤‡é›œçš„æ™‚å€™, å®šç¾©ä¸€ä»½å®Œæ•´çš„ XSD èƒ½è®“è¨­å®šæª”åœ¨ç·¨å¯«æ™‚èƒ½æœ‰æ›´å……è¶³çš„æç¤º, ä¸ç”¨ä¸€ç›´èŠ±æ™‚é–“åŽ»ç¿»è¨­å®šèªªæ˜Ž, ä¹Ÿå¯ä»¥é¿å…èŠ±æ™‚é–“åŽ»æŠ“å› æ‰‹èª¤é€ æˆçš„bug. æœ¬æ–‡æœƒç”¨ä¹‹å‰ç‚ºè‡ªè¨‚ StyleCop çš„è¦å‰‡éœ€å¯«çš„ XML æ‰€åšçš„ XSD - SourceAnalyzer.xsd ä¾†åšç¯„ä¾‹. å»ºç«‹ä¸€å€‹æ–°çš„ XSD æª”åœ¨ Visual Studio ä¸­é–‹å•Ÿä¸€å€‹å°ˆæ¡ˆ, ä¸¦åŠ å…¥ä¸€å€‹ XML Schema æª”æ¡ˆ, é è¨­å…§å®¹å¦‚ä¸‹ 123456789&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;xs:schema id="XMLSchema1" targetNamespace="http://tempuri.org/XMLSchema1.xsd" elementFormDefault="qualified" xmlns="http://tempuri.org/XMLSchema1.xsd" xmlns:mstns="http://tempuri.org/XMLSchema1.xsd" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;&lt;/xs:schema&gt; å…¶ä¸­çš„å¹¾å€‹å±¬æ€§èªªæ˜Žå¦‚ä¸‹: targetNamespace: ç›®å‰æ–‡ä»¶å‘½åç©ºé–“. elementFormDefault: é¸å¡«, qualified æˆ– unqualified, é è¨­æ˜¯unqualified, å»ºè­°ç”¨ qualified. xmlns / xmlns:mstns / xmlns:xs: å„ç¨®å¼•ç”¨çš„ XSD èˆ‡å‘½åç©ºé–“, å…¶ä¸­ http://www.w3.org/2001/XMLSchema å°±æ˜¯ç”¨ä¾†å®šç¾©xsdçš„xsd schema, é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼åœ¨ visual studio ä¸­ç·¨å¯« xsd æ™‚èƒ½æœ‰è‡ªå‹•æç¤ºèˆ‡é©—è­‰. é›–ç„¶é è¨­çš„å‘½åç©ºé–“çœ‹èµ·ä¾†æ˜¯ä¸€å€‹ URL, ä½†å¯¦éš›ä¸Šå‘½åç©ºé–“åªæ˜¯ç”¨ä¾†åšè­˜åˆ¥ç”¨çš„, ä¸¦éžå¿…è¦æ˜¯ URL, ç”¨ URL çš„å¥½è™•æ˜¯å¯ä»¥æç¤ºä½¿ç”¨è€…é€£ä¸Šè©²ç¶²ç«™å¾—åˆ°æ›´è©³ç´°çš„èªªæ˜Ž, å¦‚ä¸‹é¢ç¯„ä¾‹. URL æ‡‰è©²æ˜¯æ”¾å°ˆæ¡ˆçš„ GitHub Pages é€£çµæ¯”è¼ƒå¥½, ä¸éŽé€™å€‹å°ˆæ¡ˆæˆ‘æ²’æœ‰å»º GitHub Pages æ‰€ä»¥å°±ç›´æŽ¥æ”¾ GitHub å°ˆæ¡ˆçš„é€£çµäº†. 1234567&lt;xs:schema id=&quot;SourceAnalyzer&quot; targetNamespace=&quot;https://github.com/ronsun/ExtendedStyleCopRules&quot; elementFormDefault=&quot;qualified&quot; xmlns:this=&quot;https://github.com/ronsun/ExtendedStyleCopRules&quot; xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;&lt;/xs:schema&gt; å¥—ç”¨åˆ° XML ä¸Šå¦‚ä½•å¥—ç”¨XSD å¯«å¥½å¾Œ, åœ¨ Visual Studio ä¸­é»žé¸ XML &gt; Schemas å¯ä»¥çœ‹åˆ°é€™å€‹ XSD å·²ç¶“è¢«è‡ªå‹•å¥—ç”¨äº†, æŽ¥è‘—å»ºç«‹ä¸€å€‹æ–°çš„ XML æª”ä¸¦æŒ‡å®š xmlns ç‚ºå‰›å‰›å»ºç«‹çš„ XSD çš„ targetNamespace å°±å¯ä»¥å¥—ç”¨åˆ°è©² XML æª”ä¸Šäº†. 123456789101112&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;SourceAnalyzer Name="Extend Naming Rules" xmlns="https://github.com/ronsun/ExtendedStyleCopRules"&gt; &lt;Description&gt; Extended naming rules. &lt;/Description&gt; &lt;Rules&gt; &lt;Rule Name="PrivateFieldNamesMustStartWithUnderscore" CheckId="EA1301"&gt; &lt;Context&gt;Private filed name must start with Underscore&lt;/Context&gt; &lt;Description&gt;Validates that names of private field must start with an underscore.&lt;/Description&gt; &lt;/Rule&gt; &lt;/Rules&gt;&lt;/SourceAnalyzer&gt; è‡ªå‹•æç¤º (Intellisence) èˆ‡æª¢æŸ¥å¥—ç”¨ä¸Šä¹‹å¾Œå°±å¯ä»¥æœ‰è‡ªå‹•æç¤ºèˆ‡æª¢æŸ¥åŠŸèƒ½. ä¸åˆè¦å‰‡æ™‚æœƒæœ‰è­¦ç¤ºä¸åˆè¦å‰‡æ™‚, å³å´å·è»¸æœƒæœ‰ä¸€å€‹æ·¡è—è‰²å°é»ž, è¼¸å…¥çš„æ–‡å­—æœ¬èº«ä¸‹é¢ä¹Ÿæœƒæœ‰ä¸€æ¢æ·¡è—è‰²æ¯›æ¯›èŸ², æ»‘é¼ ç§»éŽåŽ»å¯ä»¥çœ‹åˆ°è©³ç´°çš„è­¦å‘Šæè¿°, ä¸”åœ¨ Error List åœ°æ–¹ä¹Ÿæœƒæœ‰è­¦å‘Š, éžå¸¸æ–¹ä¾¿. è‡ªå‹•æç¤ºåŠŸèƒ½é¸åˆ°æç¤ºçš„é¸é …æ™‚, æœƒå½ˆå‡ºé å…ˆåœ¨ XSD ä¸­å¯«å¥½çš„è¨»è§£. æ»‘é¼ ç§»éŽæ–‡å­—æ™‚, æœƒå½ˆå‡ºé å…ˆåœ¨ XSD ä¸­å¯«å¥½çš„è¨»è§£. åœ¨ç¨‹å¼ç¢¼ä¸­å¥—ç”¨æª¢æŸ¥è¦å‰‡é›–ç„¶ Visual Studio æœƒé¡¯ç¤ºè­¦å‘Š, ä½†ç¸½æœ‰äº›æ™‚å€™æœ‰äººæœƒè‡ªå‹•å¿½ç•¥è­¦å‘Š, ç„¡æ³•ææ—©ç™¼ç¾éŒ¯èª¤, é€™æ™‚å€™é‚„å¯ä»¥åœ¨ç¨‹å¼ä¸­æª¢æŸ¥, åœ¨æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ™‚, ç›´æŽ¥å‘¼å«é©—è­‰æ–¹æ³•, å¦‚æžœæœ‰é•åå°±ç›´æŽ¥æ‹‹ä¾‹å¤–, åšç‚ºæœ€å¾Œä¸€é“é˜²ç·š. ä½†å…¶å¯¦æˆ‘æ˜¯è¦ºå¾—é€™ä¸€æ®µç¨‹å¼ç¢¼æ²’å¿…è¦, æ‡‰è©²æ˜¯è¦åƒè€ƒ Warning çš„è³‡è¨Š, ä¸¦ç›¡å¯èƒ½ä¸è¦è®“ Warning å­˜åœ¨è€Œä¸æ˜¯å¿½ç•¥å®ƒæ‰æ˜¯æ¯”è¼ƒåš´è¬¹çš„åšæ³•. å¤§è‡´çš„ç¨‹å¼ç¢¼å¦‚ä¸‹, é‚è¼¯ä¸Šå°±æ˜¯è¼‰å…¥ XSD èˆ‡ç›¸é—œçš„ XML, æŽ¥è‘—é€éŽ XDocument.Validate(...) æ–¹æ³•ä¾†é©—è­‰. 1234567891011121314151617181920212223public static void CheckXML()&#123; var currentAssembly = Assembly.GetExecutingAssembly(); XmlSchemaSet schemas = new XmlSchemaSet(); Stream xsdStream = currentAssembly.GetManifestResourceStream("ronsun.github.io.lab.SourceAnalyzer.xsd"); using (var reader = XmlReader.Create(xsdStream)) &#123; schemas.Add("https://github.com/ronsun/ExtendedStyleCopRules", reader); &#125; using (Stream xmlStream = currentAssembly.GetManifestResourceStream("ronsun.github.io.lab.ExtendedNamingRules.xml")) &#123; XDocument.Load(xmlStream).Validate(schemas, (sender, e) =&gt; &#123; // Actions for validate results if (e.Severity == XmlSeverityType.Error) &#123; throw new Exception(e.Message); &#125; &#125;); &#125;&#125; å­¸ç¿’è³‡æºXSD ç›¸é—œçš„å­¸ç¿’è³‡æºå¦‚ä¸‹:tutorials pointw3schools (en)w3schools (zh-cn) çµè«–å…¶å¯¦ XSD ä¸ç®—å¾ˆå¸¸ç”¨çš„åŠŸèƒ½, æœ‰äº›å¤§åž‹å°ˆæ¡ˆéœ€è¦çš„ XML ä¹Ÿä¸ä¸€å®šæœ‰ XSD, åœ¨å¯«è¨­å®šæª”çš„æ™‚å€™å°±åªèƒ½ä¾è³´æ–‡ä»¶è·Ÿè¨˜æ†¶åŠ›, ä½†å¦‚æžœæ™‚é–“å…è¨±, æˆ‘é‚„æ˜¯è´Šæˆè£œä¸Š XSD æ–‡ä»¶çš„, ä¸€æ–¹é¢å¯ä»¥è®“å¾Œé¢çš„äººä¸Šæ‰‹æ¯”è¼ƒå®¹æ˜“, å¦ä¸€æ–¹é¢ XSD æœ¬èº«ä¹Ÿæ‰®æ¼”è‘—æ–‡ä»¶çš„è§’è‰²äº†, å°±æ¯”è¼ƒä¸éœ€è¦å¦å¤–åŽ»ç¶­è­·æ–‡ä»¶ä¾†èªªæ˜Ž XML æ‡‰è©²æ€Žéº¼å¯«. ä¸éŽ, XSD æœ¬èº«åšç‚ºæ–‡ä»¶å¯è®€æ€§ä¸å¥½, ä¹‹å‰æˆ‘ä¹Ÿ fork å‡ºä¸€å€‹é–‹æºå°ˆæ¡ˆ xs3p åšäº†ä¸€äº›ä¿®æ”¹, å¯ä»¥å°‡ XSD å‚³æ›æˆ html æ–‡ä»¶, ç´°ç¯€ä¹Ÿæ›¾ç¶“å¯«éŽä¸€ç¯‡æ–‡ç«  åˆ©ç”¨xs3på°‡xsdè½‰æ›æˆæ–‡ä»¶ è¨˜éŒ„. åƒè€ƒHow to: Validate Using XSD (LINQ to XML) (C#)]]></content>
      <categories>
        <category>XML</category>
        <category>XSD</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Vsual Studio ä¸­çš„å·¥ä½œæ¸…å–®(Task List)]]></title>
    <url>%2Fcontent%2F20181213-use-task-list-in-visual-studio.html</url>
    <content type="text"><![CDATA[åœ¨é–‹ç™¼çš„éŽç¨‹, å¸¸å¸¸æœ‰ä¸€äº›éœ€è¦æ”¹é€²ä½†ç¾éšŽæ®µæ²’æ™‚é–“åšçš„éƒ¨åˆ†, æˆ‘å€‘åœ¨ä¸Šé¢åŠ ä¸Šä¸€å€‹ // TODO: çš„è¨»è§£ä¾†æ¨™è¨», ç”šè‡³ä¾ç…§ç‰¹æ€§çš„ä¸åŒæœƒç”¨ä¸ä¸€æ¨£çš„èªžå½™(Token)ä¾†æ¨™è¨», ä¾‹å¦‚: // BadSmell: ç­‰ç­‰, Visual Studio å·²ç¶“æœ‰å…§å»ºå¹¾å€‹å¸¸ç”¨èªžå½™, é™¤äº†é€™äº›å…§å»ºèªžå½™å¤–æˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªå·±æ–°å¢žåœ˜éšŠå…§éƒ¨ä½¿ç”¨çš„èªžå½™. å¦ä¸€æ–¹é¢, é€™äº›å·¥ä½œæ¸…å–®æ…¢æ…¢ç´¯ç©å¾Œå°±æœƒè®Šå¾—ä¸å¥½ç®¡ç†, é€™éƒ¨åˆ†ä¹Ÿå¯ä»¥é€šéŽ Visual Studio æä¾›çš„ç›¸é—œåŠŸèƒ½ä¾†å”åŠ©æˆ‘å€‘ç®¡ç†. èªžå½™(Token)çš„ç¨®é¡žVisual Studio å…§å»ºå¹¾ç¨®èªžå½™èˆ‡å»ºè­°ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ TODO: æœªå¯¦ä½œçš„åŠŸèƒ½. HACK: ç‚ºäº†è§£æ±ºç·Šæ€¥å•é¡Œè€Œå¯«çš„ç¨‹å¼, ä½†ä¸æ˜¯å€‹é©ç•¶çš„åšæ³•, ä¾‹å¦‚å¯«æ­»ä¸€äº›è®Šæ•¸æˆ–åƒæ•¸çš„æ•¸å€¼å…ˆæ‡‰æ€¥, ä½†é€™å€‹æ•¸å€¼ä¸æ‡‰è©²æ˜¯å¯«æ­»çš„. UNDONE: ç‚ºäº†è§£æ±ºçŸ­æœŸå•é¡Œè€Œç§»é™¤æˆ–è¨»è§£æŽ‰ç¨‹å¼ç¢¼, æˆ–æ˜¯éœ€è¦åˆ‡æ›ä¸¦è§€å¯Ÿå…©å€‹ä¸åŒçš„åšæ³•å“ªç¨®æ¯”è¼ƒå¥½. UnresolvedMergeConflict: æŸä¸€å°æ®µç¨‹å¼ç¢¼å–®ç¨é‹ä½œè‰¯å¥½, ä½†æ”¾åˆ°æ•´å€‹å°ˆæ¡ˆä¸­é‹ä½œæœƒæœ‰å•é¡Œ, éœ€è¦ debug æ‰¾å‡ºå•é¡Œ. UnresolvedMergeConflict çš„æƒ…å¢ƒçœ‹èµ·ä¾†æ¯”è¼ƒåƒå–®å…ƒæ¸¬è©¦éƒ½èƒ½éŽ, ä½†æ˜¯æ•´å€‹æµç¨‹æ¸¬ä¸‹ä¾†æœ‰å•é¡Œ, å¯èƒ½æ˜¯è·Ÿä¾è³´ç‰©ä»¶çš„äº’å‹•ä¸æ­£ç¢º, æˆ–æ˜¯æ˜¯ä¾è³´åº¦å¤ªé«˜, å°Žè‡´å¾ˆå®¹æ˜“è¢«æµç¨‹æˆ–æ˜¯ä¾è³´ç‰©ä»¶å½±éŸ¿ä»–çš„æ­£ç¢ºæ€§. é›–ç„¶èªªæ•™å­¸æ˜¯é€™æ¨£å»ºè­°, ä¸éŽåœ˜éšŠå¦‚æžœæœ‰å…¶ä»–å…±è­˜çš„è©±å…¶å¯¦å°±å¤§å®¶èªªå¥½å°±å¥½, å¦å¤–, é€™äº›èªžå½™æ˜¯ä¸åˆ†å¤§å°å¯«çš„, æ‰€ä»¥ TODO å’Œ ToDo æ˜¯ä¸€æ¨£çš„, ä½†é‚„æ˜¯è·Ÿè‘—åœ˜éšŠç¿’æ…£, ç›¡é‡ä¸€è‡´æ¯”è¼ƒå¥½. å·¥ä½œæ¸…å–®è¦–çª— (Task List Explorer)æˆ‘å€‘å¯ä»¥é»žé¸ View &gt; Task List ä¾†æ‰“é–‹å·¥ä½œæ¸…å–®è¦–çª—, å·¥ä½œæ¸…å–®è¦–çª—ä¸­å¯ä»¥æœ‰ç¯©é¸å™¨æˆ–æ˜¯é—œéµå­—æœå°‹å¯ä»¥ç”¨, å¾ˆæ–¹ä¾¿, ä¸éœ€è¦ç”¨å…¨åŸŸæœå°‹ä¹‹é¡žçš„æ–¹å¼æ‰¾é—œéµå­—. è‡ªå®šç¾©èªžå½™æˆ‘å€‘å¯ä»¥åœ¨ Tools &gt; Options ä¸­çš„ Task List é ç±¤ä¸­å¢žåŠ è‡ªå®šç¾©çš„èªžå½™, ä¾‹å¦‚æˆ‘å€‘è¦åŠ å…¥ä¸€å€‹èªžå½™å«åš BadSmell, ç”¨ä¾†è¡¨ç¤ºç¨‹å¼ç¢¼ä¸­çš„å£žå‘³é“, æ–¹ä¾¿ä¹‹å¾Œé‡æ§‹æˆ–æ•´ç†. å¯ä»¥åœ¨ Task List ä¸­æ”¹èªžå½™çš„å„ªå…ˆæ¬Š(Piority), ä½†ç„¡æ³•æ”¹å, æƒ³è¦æ”¹ååªèƒ½åŠ ä¸Šæ–°çš„å†åˆªæŽ‰èˆŠçš„. çµè«–é€™ç¯‡ä¹Ÿæ²’ä»€éº¼ç‰¹åˆ¥é›£çš„, ä¸»è¦æ˜¯å°æ–¼å…§å»ºèªžå½™çš„ä½¿ç”¨æ™‚æ©Ÿè·Ÿç›®çš„æ²’æ‰¾åˆ°å¤ªå¤šèªªæ˜Ž, å‰›å¥½æœ‰ä¸€æœ¬æ›¸æœ‰æåˆ°, å°±ç¨å¾®è¨˜ä¸€ä¸‹, è€Œä¸”è‡ªå·±å¹³å¸¸å¾ˆå°‘ç”¨é€™å€‹åŠŸèƒ½å®¹æ˜“å¿˜, å°±é †ä¾¿å‚™å¿˜ä¸€ä¸‹, ç„¶å¾Œå†é †ä¾¿è©¦è©¦ä¸€ä¸‹ç”¨èž¢å¹•éŒ„å½±è½‰ GIF æª”ä¾†èªªæ˜Žæ“ä½œæµç¨‹çš„æ•ˆæžœ. åƒè€ƒMastering Web Development with Microsoft Visual Studio 2005 (P.45-P.46)]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è‡ªè¨‚ StyleCop è¦å‰‡èˆ‡æ¸¬è©¦æ–¹å¼]]></title>
    <url>%2Fcontent%2F20181208-custom-stylecop-rules-and-testing.html</url>
    <content type="text"><![CDATA[å¾ˆå¤š .NET é–‹ç™¼äººå“¡å°æ–¼ StyleCop æ‡‰è©²æ˜¯ä¸é™Œç”Ÿ, å®ƒèƒ½æœ‰æ•ˆåœ°å”åŠ©æˆ‘å€‘è®“ç¨‹å¼ç¢¼çš„é¢¨æ ¼ä¿æŒä¸€è‡´, é è¨­çš„è¦å‰‡å…¶å¯¦å·²ç¶“è¶³å¤ äº†, ä½†æœ‰äº›åœ˜éšŠå¯èƒ½æœ‰è‡ªå·²çš„ç‰¹æ®Šç·¨ç¢¼è¦ç¯„, é€™äº›ç·¨ç¢¼è¦ç¯„ç”šè‡³æ˜¯è·Ÿé è¨­çš„è¦å‰‡æ˜¯è¡çªçš„, é€™æ™‚å€™å°±éœ€è¦è‡ªå·±å¯«è¦å‰‡ä¾†å¥—ç”¨. é€™ç¯‡ä¸»è¦æ˜¯é‡å°è‡ªè¨‚è¦å‰‡å¯èƒ½æœƒé¢è‡¨çš„å•é¡Œæ‰€è¨˜éŒ„çš„, å°¤å…¶æ˜¯è¦æ€Žéº¼æ¸¬è©¦é€™äº›è¦å‰‡æ²’å¯«éŒ¯, æ‰€ä»¥å°æ–¼ä¸€äº› google å°±å¯ä»¥å¾ˆå®¹æ˜“æ‰¾åˆ°çš„éƒ¨åˆ†åªæœƒç°¡å–®å¸¶éŽ, å¦å¤–ç”±æ–¼ StyleCop ä¹Ÿæ»¿å¤§çš„, æ‰€ä»¥æœ‰äº›å¤ªç´°çš„è¨­å®šæˆ–æ˜¯å…§éƒ¨é‹ä½œé€™ç¯‡ä¹Ÿä¸æ‰“ç®—æ·±å…¥æŽ¢ç´¢, ç­‰ä¹‹å¾Œæœ‰éœ€è¦æˆ–æ˜¯æœ‰èˆˆè¶£å†æ ¹æ“šå„å€‹ä¸»é¡Œæˆ–é¢å‘ä¾†å°ˆé¡ŒæŽ¢è¨Ž. å®‰è£ StyleCopå®‰è£ StyleCop çš„æ–¹å¼éš¨ä¾¿å•ä¸€ä¸‹ google å¤§å¸«å°±æœ‰å¾ˆå¤šæ•™å­¸äº†, å¯ä»¥å¾ž NuGet æ‰¾åˆ° StyleCop.Analyzers è£åœ¨å„è‡ªå°ˆæ¡ˆä¸Šä¹Ÿå¯ä»¥å¾ž Tools &gt; Extensions and Updates æ‰¾åˆ° StyleCop è£åˆ°æœ¬æ©Ÿé›»è…¦ä¸Š, æˆ‘æœƒæ¯”è¼ƒæŽ¨è–¦å¾ž Extensions and Updates è£¡é¢è£, å› ç‚ºåªæœ‰éœ€è¦è£ä¸€å€‹ StyleCop æ“´å……å…ƒä»¶å°±èƒ½å¤ å¥—ç”¨åˆ°æ‰€æœ‰çš„å°ˆæ¡ˆä¸Š, å„å°ˆæ¡ˆåªéœ€è¦ç·¨è¼¯å„è‡ªçš„è¨­å®šæª”å°±å¯ä»¥äº†, éžå¸¸æ–¹ä¾¿. å®‰è£å¾Œçš„ç›®éŒ„åœ¨ C:\Users\{username}\AppData\Local\Microsoft\VisualStudio\{version}\Extensions\{key} ä¸­, å…¶ä¸­ username æ˜¯æœ¬æ©Ÿä½¿ç”¨è€…ç™»å…¥çš„åç¨±, version æ˜¯ visual studio çš„ç‰ˆæœ¬è™Ÿ, key æ˜¯éš¨æ©Ÿç”¢ç”Ÿçš„, å¦‚æžœå®‰è£å¾ˆå¤šæ“´å……å…ƒä»¶çš„è©±è¦ä¸€å€‹å€‹é»žé€²åŽ»æ‰¾ä¸€ä¸‹æ‰çŸ¥é“å“ªå€‹æ˜¯ StyleCop çš„. ä½¿ç”¨ StyleCopéƒ½æ˜¯ visual studio ä¸Šé¢é»žä¸€é»žå°±å¥½çš„, æ•™å­¸è³‡æºä¹Ÿæ¥µå¤š, åŸºæœ¬çš„ä½¿ç”¨å°±ä¸å¤šèªªäº†. ç·¨è¼¯ StyleCop è¨­å®šæª”ç·¨è¼¯ StyleCop è¨­å®šæª”çš„æ–¹å¼ä¸€èˆ¬åªè¦å¾ž visual studio ä¸Šé–‹å•Ÿåœ–å½¢ä»‹é¢å°±å¯ä»¥ç·¨è¼¯å°ˆæ¡ˆè¦ç”¨çš„è¨­å®šäº†, å¦å¤–ä¸€ç¨®æ–¹å¼æ˜¯ä½¿ç”¨ StyleCop çš„å®‰è£ç›®éŒ„ (å¦‚ä¸Šä¸€æ®µæ‰€èªªçš„ä½ç½®) ä¸­çš„ StyleCop.SettingsEditor.exe ä¾†ç·¨è¼¯, é›™æ“Šè¨­å®šæª”æˆ–æ˜¯ç”¨å‘½ä»¤æç¤ºå­—å…ƒä¸‹ StyleCop.SettingsEditor.exe Settings.StyleCop æŒ‡ä»¤å°±å¯ä»¥, å…¶ä¸­ Settings.StyleCop æ˜¯è¨­å®šæª”çš„è·¯å¾‘, é€™å€‹å·¥å…·æ˜¯ç”¨ä¾†ç·¨è¼¯è¨­å®šæª”çš„, æ‰€ä»¥ä¸èƒ½å»ºç«‹ä¸€å€‹æ–°çš„è¨­å®šæª”, è¦ç·¨è¼¯çš„è¨­å®šæª”ä¹Ÿå¿…é ˆæ˜¯ç¬¦åˆè¦å®šçš„æ ¼å¼, ä¸ç„¶è®€å–æœƒéŒ¯èª¤. æ¯”èµ·åœ¨ visual studio ä¸­é–‹å•Ÿåœ–å½¢ä»‹é¢ç·¨è¼¯è¨­å®šæª”, ç”¨å·¥å…·ç·¨è¼¯é›–ç„¶çœ‹èµ·ä¾†ä¸å¯¦ç”¨, ä½†æ˜¯åœ¨éœ€è¦è£½ä½œå¾ˆå¤šä»½ä¸åŒè¨­å®šæª”çš„æ™‚å€™å»å¾ˆé©åˆ (ä¾‹å¦‚è¦æ¸¬è©¦è‡ªè¨‚è¦å‰‡çš„é©—è­‰çµæžœæ™‚), é€™éƒ¨åˆ†å¾Œé¢æœƒèªª. å¦‚æžœè¦ºå¾— StyleCop.SettingsEditor.exe ä¸èƒ½å»ºç«‹ä¸€å€‹æ–°çš„è¨­å®šæª”å¾ˆä¸æ–¹ä¾¿, å¯ä»¥æŠŠåŽŸå§‹ç¢¼ fork å‡ºä¾†, è‡ªå·±æ”¹é€ æˆé©ç”¨çš„å°å·¥å…·. è‡ªè¨‚è¦å‰‡è‡ªè¨‚è¦å‰‡çš„éƒ¨åˆ†æ­¥é©Ÿé‚„ä¸å°‘, è€Œä¸”å¾ˆå¤šæƒ…æ³ä¸‹åšéŒ¯ä¹Ÿä¸æœƒè·³éŒ¯èª¤è¨Šæ¯, æ‰€ä»¥èŠ±äº†ä¸å°‘æ™‚é–“åœ¨ try and error ä¸Š, æˆ‘åœ¨ GitHub ä¸Šé¢æœ‰æ”¾äº†ä¸€å€‹ç°¡å–®çš„è‡ªè¨‚è¦å‰‡çš„å°ˆæ¡ˆ - ExtendedStyleCopRules, é€™ä¸€æ®µçš„èªªæ˜Žæœƒä»¥é€™å€‹å°ˆæ¡ˆçš„å…§å®¹ç•¶ä½œç¯„ä¾‹. ä¾è³´çµ„ä»¶æœ‰å¹¾å€‹éœ€è¦ä¾è³´çš„çµ„ä»¶ StyleCop StyleCop.CSharp ä¾è³´çš„çµ„ä»¶å¯ä»¥é¸æ“‡å¾ž NuGet è£, ä¹Ÿå¯ä»¥ç›´æŽ¥ä¾è³´åˆ°å‰é¢å¾ž Extensions and Updates è£å¥½çš„ StyleCop çš„å®‰è£ç›®éŒ„ä¸‹, é€™é‚Šæ˜¯å»ºè­°ç›´æŽ¥å¾ž NuGet è£, å› ç‚º StyleCop æ“´å……å…ƒä»¶çš„å®‰è£è³‡æ–™å¤¾åç¨±æ˜¯éš¨æ©Ÿçš„, æ›å°é›»è…¦å°±æ‰¾ä¸åˆ°å¼•ç”¨äº†, å¾ˆé›£ç®¡ç†. å¦å¤–é€™é‚Šè¦æ³¨æ„ä¸€ä¸‹, ä¾è³´çš„çµ„ä»¶å¦‚æžœæ˜¯å¾ž NuGet æŠ“çš„, å¿…é ˆè·Ÿå¾ž Extensions and Updates ä¸Šå®‰è£çš„ StyleCop ç‰ˆè™Ÿä¸€è‡´, ä¾‹å¦‚: å¦‚æžœæˆ‘å¾ž Extensions ä¸Šå®‰è£ StyleCop 6.0, é–‹ç™¼è‡ªè¨‚è¦å‰‡æ™‚ä¾è³´çš„æ˜¯å¾ž NuGet ä¸Šé¢å®‰è£çš„ StyleCop, é€™æ¨£ç·¨è­¯å‡ºä¾†çš„çµ„ä»¶ç„¡æ³•è®“ StyleCop æ­£ç¢ºè¼‰å…¥. è¦å‰‡è¨­å®šæª”è¦è®“ StyleCop èƒ½å¤ å°‡è‡ªå®šè¦å‰‡çš„ç›¸é—œè¨­å®šæ”¾åœ¨è¨­å®šé é¢, éœ€è¦ä¸€å€‹ xml æ ¼å¼çš„è¨­å®šæª”, ä¸¦å°‡é€™å€‹æª”æ¡ˆå±¬æ€§è¨­å®šç‚ºç·¨è­¯æˆ Embedded Resource, é€™é‚Šä»¥ ExtendedNamingRules.xml ä»¥åŠä¸€å¼µè¨­å®šæˆªåœ–ç‚ºä¾‹. 123456789101112&lt;?xml version="1.0" encoding="utf-8" ?&gt; &lt;SourceAnalyzer Name="Extend Naming Rules" xmlns="https://github.com/ronsun/ExtendedStyleCopRules"&gt; &lt;Description&gt; Extended naming rules. &lt;/Description&gt; &lt;Rules&gt; &lt;Rule Name="PrivateFieldNamesMustStartWithUnderscore" CheckId="EA1301"&gt; &lt;Context&gt;Private filed name must start with Underscore&lt;/Context&gt; &lt;Description&gt;Validates that names of private field must start with an underscore.&lt;/Description&gt; &lt;/Rule&gt; &lt;/Rules&gt;&lt;/SourceAnalyzer&gt; xmlns=&quot;....&quot; : éžå¿…è¦, åªæ˜¯æ²’æœ‰è‡ªå‹•æç¤º (IntelliSense) è¦å¯«é€™äº› XML å¤ªé›£éŽäº†, æ‰€ä»¥è‡ªå·±åˆ»äº†ä¸€å€‹ SourceAnalyzer.xsd ä¾†å¼•ç”¨. Name=&quot;Extend Naming Rules&quot; : é€™å€‹ SourceAnalyzer çš„åå­—, æœƒé¡¯ç¤ºåœ¨åœ–ä¸­ A é»ž. &lt;Description&gt;Extended naming rules.&lt;/Description&gt; : é€™å€‹ SourceAnalyzer çš„æè¿°, é»žæ“Šåœ–ä¸­ A é»žæ™‚æœƒé¡¯ç¤ºåœ¨åœ–ä¸­ C é»žçš„ä½ç½®. Name=&quot;PrivateFieldNamesMustStartWithUnderscore&quot; : è¦å‰‡åå­—, é¡¯ç¤ºåœ¨åœ–ä¸­ B é»ž, å¿…é ˆæ˜¯å¤§å¯«å­—æ¯é–‹é ­. CheckId=&quot;EA1301&quot; : è¦å‰‡ä»£è™Ÿ, åœ–ä¸­ B é»ž, ä¹Ÿæ˜¯é•åè¦å‰‡æ™‚é¡¯ç¤ºåœ¨çµæžœè¦–çª—ä¸­çš„ä»£è™Ÿ, å¿…é ˆæ˜¯å…©å€‹å¤§å¯«å­—æ¯åŠ å››å€‹æ•¸å­—. &lt;Context&gt;.....&lt;/Context&gt; : æç¤ºè¨Šæ¯, é•åè¦å‰‡æ™‚é¡¯ç¤ºåœ¨çµæžœè¦–çª—ä¸­çš„è¨Šæ¯ä¹‹ä¸€. &lt;Description&gt;Validates that names...&lt;/Description&gt; : è¦å‰‡æè¿°, é»žæ“Šåœ–ä¸­ B é»žæ™‚æœƒé¡¯ç¤ºåœ¨åœ–ä¸­ C é»žçš„ä½ç½®. å…¶å¯¦é€™å€‹ XML å¯ä»¥å¾ˆè¤‡é›œ, é€™å€‹ç¯„ä¾‹åªæ˜¯æœ€ç°¡å–®çš„æƒ…å¢ƒ, StyleCop çš„å®˜æ–¹æ–‡ä»¶å€ä¹Ÿæœ‰ä¸€äº›ç°¡æ˜“èªªæ˜Ž, ä¸éŽå¦‚æžœè¦å®Œæ•´çš„å…§å®¹çš„è©±, å¯èƒ½éœ€è¦åŽ»æ•´åˆ StyleCop æ‰€æœ‰è¦å‰‡çš„è¨­å®šæª”, æˆ–æ˜¯ç›´æŽ¥çˆ¬ç¨‹å¼ç¢¼åˆ†æž XML çš„å®Œæ•´çµæ§‹äº†. ç¨‹å¼ç¢¼å…ˆä¸Šç¨‹å¼ç¢¼å†ä¾†æ…¢æ…¢èªªæ˜Ž.12345678910111213141516171819202122232425262728293031[SourceAnalyzer(typeof(CsParser))]public class ExtendedNamingRules : SourceAnalyzer&#123; public override void AnalyzeDocument(CodeDocument document) &#123; CsDocument csdocument = (CsDocument)document; if (csdocument.RootElement != null &amp;&amp; !csdocument.RootElement.Generated) &#123; csdocument.WalkDocument(new CodeWalkerElementVisitor&lt;object&gt;(VisitElement)); &#125; &#125; private bool VisitElement(CsElement element, CsElement parentElement, object context) &#123; // not target element if (element.Generated || element.ElementType != ElementType.Field || element.AccessModifier != AccessModifierType.Private) &#123; return true; &#125; if (!element.Declaration.Name.StartsWith("_")) &#123; AddViolation(element, Rules.PrivateFieldNamesMustStartWithUnderscore); &#125; return true; &#125;&#125; StyleCop æ˜¯æŠŠåŽŸå§‹ç¢¼æ‹†è§£æˆ Element, Statement å’Œ Expression, ç„¶å¾Œèµ°è¨ªæ‰€æœ‰ç¯€é»žä¸¦æ ¹æ“šå§”æ´¾æ–¹æ³•æ±ºå®šé©—è­‰é‚è¼¯èˆ‡è¡Œç‚º. é€™å€‹é¡žåˆ¥éœ€è¦ä½¿ç”¨ SourceAnalyzer é€™å€‹ Attribute ä¸¦ç¹¼æ‰¿ SourceAnalyzer å¾Œè¦†å¯«ç›¸é—œçš„åˆ†æžæ–¹æ³• void AnalyzeDocument(CodeDocument document), æŽ¥è‘— WalkDocument(...) é€™é‚Šæœƒé–‹å§‹èµ°è¨ªæ‰€æœ‰ç¨‹å¼ç¢¼, ç„¶å¾Œæ ¹æ“šå§”æ´¾æ–¹æ³• VisitElement(...) ä¾†åˆ¤å®šé•è¦èˆ‡å¦ä»¥åŠæ·»åŠ é•è¦è¨Šæ¯ç­‰, å¦å¤– WalkDocument æ–¹æ³•é‚„æœ‰å…¶ä»–å¤šè¼‰èƒ½å¦å¤–å¤šå¸¶å…©å€‹åƒæ•¸, æ˜¯ç”¨ä¾†é©—è­‰ Statement å’Œ Expression çš„å§”æ´¾æ–¹æ³•. å¾Œä¾†åœ¨ Element, Statement å’Œ Expression å¤–åˆå¤šäº†ä¸€å€‹ QueryClause, çœ‹èµ·ä¾†æ˜¯é‡å° LINQ èªžå¥åšçš„, ä¾‹å¦‚ var q = from prod in db.Prodcut where prod.Category == &quot;shoes&quot;, WalkDocument æ–¹æ³•æœ‰ä¸€å€‹å¤šè¼‰æä¾›å§”æ´¾æ–¹æ³• queryClauseCallback, ç”¨é€”å’Œå…¶ä»–å§”æ´¾æ‡‰è©²å·®ä¸å¤š. åœ¨åˆ»é€™äº›è¦å‰‡æ™‚ç™¼ç¾, å°æ–¼è¤‡é›œä¸€é»žçš„è¦å‰‡å¾ˆé›£ä¸‹æ‰‹, å…¶ä¸­ä¸€å€‹åŽŸå› æ˜¯ä¸çŸ¥é“ StyleCop æ˜¯æŠŠç¨‹å¼ç¢¼æ‹†è§£æˆä»€éº¼æ¨£å­, é©—è­‰æ™‚éœ€è¦ç”¨çš„æ‹†è§£å¾Œçš„ç¨‹å¼ç¢¼ç‰‡æ®µä¹Ÿä¸çŸ¥é“å¾žå“ªè£¡å¾—åˆ°, é€™æ™‚å€™ä¸€å€‹æ–¹æ³•æ˜¯åŽ»çœ‹ StyleCop çš„åŽŸå§‹ç¢¼, æˆ–æ˜¯å·æ‡¶ä¸€é»ž, åˆ©ç”¨æ¸¬è©¦åœ¨ debug æ¨¡å¼ä¸‹çœ‹ CsDocument çš„å®Œæ•´çµæ§‹èˆ‡ç›¸å°æ‡‰çš„å€¼, æ¸¬è©¦çš„æ–¹å¼å¾Œé¢æœƒæåˆ°. æ¸¬è©¦è‡ªè¨‚è¦å‰‡é€™å€‹æ¸¬è©¦çš„ç›®çš„æ˜¯æ¸¬è©¦è‡ªè¨‚è¦å‰‡æ˜¯ä¸æ˜¯èƒ½æ­£ç¢ºé©—è­‰ç¨‹å¼ç¢¼, æ¯”è¼ƒåƒæ•´åˆæ¸¬è©¦. é€™é‚Šçš„ç¯„ä¾‹éœ€è¦ä¾è³´ä¸€äº›çµ„ä»¶, å¾ž NuGet å®‰è£å³å¯ StyleCop (å¿…è¦) NUnit (æ¸¬è©¦æ¡†æž¶) FluentAssertions (Assert ç”¨çš„å¥—ä»¶) ä¸‹é¢æ˜¯ä¸»è¦çš„ç¨‹å¼ç¢¼ç‰‡æ®µèˆ‡èªªæ˜Ž12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273[TestFixture()]public class ExtendedStyleCopRulesTests&#123; [TestCaseSource(nameof(TestCase_RuleTest))] public void RuleTest(string checkId, StyleCopViolations expectedValidationResult) &#123; // arrange Directory.CreateDirectory(Locations.ValidationResultDirectory); string validationResultPath = Path.Combine(Locations.ValidationResultDirectory, $"&#123;checkId&#125;.xml"); string ruleSettingPath = Path.Combine(Locations.TestDataDirectory, checkId, $"&#123;checkId&#125;.StyleCop"); string codePath = Path.Combine(Locations.TestDataDirectory, checkId, $"&#123;checkId&#125;.cs"); CodeProject project = new CodeProject( checkId.GetHashCode(), Locations.BaseDirectory, new Configuration(null), 0); StyleCopConsole console = new StyleCopConsole( ruleSettingPath, false, validationResultPath, Locations.AddInDirectory, false, Locations.BaseDirectory); console.Core.Environment.AddSourceCode(project, codePath, null); // act console.Start(new CodeProject[] &#123; project &#125;, true); StyleCopViolations actualValidationResult; using (Stream s = new FileStream(validationResultPath, FileMode.Open)) &#123; var serializer = new XmlSerializer(typeof(StyleCopViolations)); actualValidationResult = (StyleCopViolations)serializer.Deserialize(s); &#125; // assert bool testDataExist = File.Exists(ruleSettingPath) &amp;&amp; File.Exists(codePath); testDataExist.Should().BeTrue(); actualValidationResult.ViolationItems.Should().BeEquivalentTo(expectedValidationResult.ViolationItems); &#125; private static List&lt;object[]&gt; TestCase_RuleTest() &#123; var expectedValidationResult = new StyleCopViolations() &#123; &#125;; return new List&lt;object[]&gt;() &#123; EA1301TestResource() &#125;; &#125; private static object[] EA1301TestResource() &#123; string checkId = "EA1301"; var expectedValidationResult = new StyleCopViolations() &#123; ViolationItems = new List&lt;StyleCopViolations.Violation&gt;() &#123; new StyleCopViolations.Violation() &#123; LineNumber = "7", RuleNamespace = "ExtendedStyleCopRules.NamingRules.ExtendedNamingRules", Rule = Rules.PrivateFieldNamesMustStartWithUnderscore.ToString(), RuleId = checkId &#125; &#125; &#125;; return new object[] &#123; checkId, expectedValidationResult &#125;; &#125;&#125; æ¸¬è©¦çš„éƒ¨åˆ†æ˜¯åƒè€ƒ StyleCope åŽŸå§‹ç¢¼ä¸­çš„æ¸¬è©¦å°ˆæ¡ˆ, å…¶å¯¦ä¸»è¦åŠŸèƒ½ StyleCop éƒ½æœ‰æä¾›, ä¹Ÿå°±æ˜¯ä¸Šé¢ç¨‹å¼ç¢¼ä¸­çš„ CodeProject å’Œ StyleCopConsole, é€™ä¸€å¥ console.Start(new CodeProject[] { project }, true) åŸ·è¡Œå¾Œæœƒæ ¹æ“šæŒ‡å®šçš„ç¨‹å¼ç¢¼æª”æ¡ˆ (codePath) ä»¥åŠå¥—ç”¨çš„ StyleCop è¦å‰‡ (ruleSettingPath) å¥è¡Œé©—è­‰, ä¸¦å°‡æª¢æŸ¥çµæžœè¼¸å‡ºæˆ XML å­˜æª”åˆ°æŒ‡å®šä½ç½® (validationResultPath), æŽ¥è‘—æˆ‘å€‘å†è®€å–æª¢æŸ¥çµæžœé©—è­‰æ˜¯å¦ç¬¦åˆé æœŸ. å®Œæ•´æ¸¬è©¦ç¨‹å¼ç¢¼å¯ä»¥çœ‹ GitHub å…¶å¯¦ StyleCop çš„æ¸¬è©¦å°ˆæ¡ˆæ˜¯é€£é æœŸé©—è­‰çµæžœéƒ½å¯«æˆ XML äº†, æ¯”é€™å€‹è¤‡é›œå¤šäº†, ä¸éŽä»¥è‡ªå·±çš„å°å°ˆæ¡ˆä¾†èªª, é‚„æ˜¯å…ˆç°¡å–®å°±å¥½, ç­‰è¦å‰‡å¤šåˆ°åƒ StyleCop é‚£æ¨£å†èªª (æ‡‰è©²ä¸å¯èƒ½). å¥—ç”¨è¦å‰‡ç·¨è­¯å¥½, æŠŠ dll æ”¾åˆ° StyleCop æ“´å……å…ƒä»¶çš„å®‰è£ç›®éŒ„ä¸‹, ç„¶å¾Œé‡é–‹ visual studio å°±å¯ä»¥äº†. çµè«–StyleCop æ•™å­¸è³‡æºå¤šé›†ä¸­åœ¨èªªæ˜Žæ€Žéº¼ä½¿ç”¨, è‡ªè¨‚è¦å‰‡çš„æ–‡ç« ä¹Ÿä¸å°‘, ä½†æœ‰æåˆ°æ¸¬è©¦çš„å¾ˆå°‘äº†, æ‰€ä»¥ä¹¾è„†ç›´æŽ¥è·³é€²åŽ»çœ‹ StyleCop å…§å»ºçš„è¦å‰‡å’Œæ¸¬è©¦æ˜¯æ€Žéº¼å¯«çš„, é †ä¾¿æ•´ç†äº†ä¸€ä¸‹ç›¸é—œçš„ XML è¦æ ¼åˆ»å€‹ XSD ä¾†è¼”åŠ©ä½¿ç”¨, è€Œä¸”æ¸¬è©¦çš„éƒ¨åˆ†èƒ½å”åŠ©æˆ‘å€‘åœ¨åµéŒ¯æ¨¡å¼ä¸‹åŽ»çœ‹è¢« StyleCop æ‹†è§£å¾Œçš„ç¨‹å¼ç¢¼, ä¹Ÿæ›´å®¹æ˜“çŸ¥é“æ€Žéº¼åˆ¤æ–·ç¨‹å¼ç¢¼æ˜¯å¦é•è¦. ä»¥å¾€æ²’çœ‹å¥—ä»¶åŽŸå§‹ç¢¼çš„ç¿’æ…£, é›–ç„¶å‰›é–‹å§‹çœ‹è¦ºå¾—å¾ˆæœ‰éšœç¤™, ä¸éŽç•¶ä½œè§€æ‘©ç·´ç¿’ä¹Ÿæ˜¯ä¸éŒ¯. åƒè€ƒInstant Stylecop Code Analysis How-to (æ›¸)StyleCopHow to Implement a Custom StyleCop RuleC# Code Reviews using StyleCop â€“ Detailed ArticlePart I: Creating Custom Rules for Microsoft Source AnalyzerPart II: Creating Custom Rules for Microsoft Source AnalyzerPart III: Creating Custom Rules for Microsoft Source Analyzer æœ‰äº›è³‡æ–™æ¯”è¼ƒä¹…äº†, å°ç´°ç¯€å’Œç¾åœ¨ä¸ä¸€å®šç›¸åŒ, ä¸éŽèªªæ˜Žå¾ˆè©³ç´°, å°æ–¼äº†è§£ StyleCop æ˜¯å¾ˆæœ‰å¹«åŠ©çš„]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[XmlSerializer çš„åºåˆ—åŒ–/ååºåˆ—åŒ– èˆ‡ BOM]]></title>
    <url>%2Fcontent%2F20181203-xml-serialize-deserialize.html</url>
    <content type="text"><![CDATA[XmlSerializer æä¾›è¨±å¤šåºåˆ—åŒ–å’Œååºåˆ—åŒ–ç›¸é—œçš„å¤šè¼‰, éƒ½æœ‰å„è‡ªçš„å„ªç¼ºé»ž, ä¾‹å¦‚æœ‰äº›æ–¹å¼åœ¨æŸäº›ç·¨ç¢¼ä¸‹æœƒå› ç‚º BOM(byte order mark) å‡ºç¾åœ¨é–‹é ­è€Œå°Žè‡´ååºåˆ—åŒ–å‡ºç¾ Exception æˆ–æ˜¯åºåˆ—åŒ–å‡ºå«æœ‰ BOM çš„å­—ä¸²å°Žè‡´æŽ¥æ”¶ç«¯ç„¡æ³•æˆåŠŸè§£æž, è€Œå„ç¨®æ–¹å¼çš„å½ˆæ€§èˆ‡æ˜“ç”¨æ€§éƒ½ç•¥æœ‰ä¸åŒ, æ‰€ä»¥ç¨å¾®è¨˜éŒ„å¹¾ç¨®åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹å¼èˆ‡ç‰¹å¾µ. åºåˆ—åŒ–XmlWriteré€™ç¨®åšæ³•æœ€æœ‰å½ˆæ€§, å¯ä»¥é è‘—æ”¹è®Š XmlWriterSettings ä»¥åŠ XmlSerializerNamespaces çš„è¨­å®šåŽ»æŽ§åˆ¶åºåˆ—åŒ–å‡ºä¾†çš„ XML å­—ä¸²çš„æ ¼å¼èˆ‡å…§å®¹, ä½†è¦ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ XmlWriterSettings é è¨­æ˜¯æœ‰ BOM çš„ UTF-8 ç·¨ç¢¼, å¦‚æžœæŽ¥æ”¶è³‡æ–™çš„ä¸€æ–¹ç„¡æ³•è™•ç†é€™ç¨®æ ¼å¼çš„è©±, éœ€è¦ç‰¹åˆ¥å°‡ XmlWriterSettings.Encoding è¨­æˆç„¡ BOM çš„ç·¨ç¢¼æ ¼å¼, ä¾‹å¦‚: var ws = new XmlWriterSettings() { Encoding = new UTF8Encoding() }, æ¯”è¼ƒé©åˆç”¨åœ¨éœ€è¦è·Ÿè¨±å¤šä¸åŒå¤–éƒ¨ç³»çµ±ä»‹æŽ¥çš„æ¨¡çµ„ä¸Š 123456789101112131415161718public string Serialize(Encoding encoding)&#123; var serializer = new XmlSerializer(typeof(MyModel)); var ws = new XmlWriterSettings() &#123; Encoding = encoding &#125;; var ns = new XmlSerializerNamespaces(new XmlQualifiedName[] &#123; XmlQualifiedName.Empty &#125;); using (var ms = new MemoryStream()) using (var xw = XmlWriter.Create(ms, ws)) &#123; serializer.Serialize(xw, new MyModel(), ns); return ws.Encoding.GetString(ms.ToArray()); &#125;&#125; StreamWriteré€™ç¨®åšæ³•å½ˆæ€§å°äº†ä¸€é»ž, åªèƒ½ç”¨ XmlSerializerNamespaces ä¾†æŽ§åˆ¶ namespace, æ¯”è¼ƒé›£é€éŽè¨­å®šåƒæ•¸ä¾†æ”¹è®Šè¼¸å‡ºæ ¼å¼å’Œå…§å®¹, ä½†æœ¬ä¾‹é‚„æ˜¯å¯ä»¥é€éŽæ”¹è®Šåƒæ•¸ encoding è‡ªå·±æ±ºå®šç·¨ç¢¼æ ¼å¼, ä¸”å¦å¤–ä¸€å€‹å»ºæ§‹å­å¤šè¼‰ StreamWriter(Stream) é è¨­å°±æ˜¯ç„¡ BOM çš„ UTF-8, æ¯”èµ·ä½¿ç”¨ XmlWriter èƒ½æ›´ç›´è¦ºçš„é¿å…åºåˆ—åŒ–æ™‚ç”¢ç”Ÿ BOM. 12345678910111213public string Serialize(Encoding encoding)&#123; var serializer = new XmlSerializer(typeof(MyModel)); var ns = new XmlSerializerNamespaces(new XmlQualifiedName[] &#123; XmlQualifiedName.Empty &#125;); using (var ms = new MemoryStream()) using (var sw = new StreamWriter(ms, encoding)) // 2nd arg default to utf-8 no BOM &#123; serializer.Serialize(sw, new MyModel(), ns); return encoding.GetString(ms.ToArray()); &#125;&#125; Streamé€™ç¨®åšæ³•å½ˆæ€§å°±æ›´å°äº†, åªèƒ½ç”¨ XmlSerializerNamespaces ä¾†æŽ§åˆ¶ namespace, é™¤äº†æ¯”è¼ƒé›£é€éŽè¨­å®šåƒæ•¸ä¾†æ”¹è®Šè¼¸å‡ºæ ¼å¼å’Œå…§å®¹å¤–, åƒæ•¸ ecoding ä¹Ÿåªèƒ½æ˜¯ UTF-8, ä½†å¦ä¸€æ–¹é¢, ç¨‹å¼ç¢¼æ¯”è¼ƒç°¡çŸ­ä¸”åºåˆ—åŒ–å‡ºä¾†çš„ XML å­—ä¸²ä¸æœƒæœ‰ BOM, ç”¨åœ¨ä¸éœ€è¦è·Ÿå¤–éƒ¨ç³»çµ±ä»‹æŽ¥çš„æ¨¡çµ„ä¸Šéžå¸¸é©åˆ. 123456789101112public string Serialize(Encoding encoding)&#123; var serializer = new XmlSerializer(typeof(MyModel)); var ns = new XmlSerializerNamespaces(new XmlQualifiedName[] &#123; XmlQualifiedName.Empty &#125;); using (var ms = new MemoryStream()) &#123; serializer.Serialize(ms, new MyModel(), ns); return encoding.GetString(ms.ToArray()); &#125;&#125; StringWriteré€™ç¨®è·Ÿç›´æŽ¥ä½¿ç”¨ Stream çš„åšæ³•å·®ä¸å¤šéƒ½ä¸å®¹æ˜“æ”¹è¼¸å‡ºæ ¼å¼å’Œå…§å®¹, å„ªé»žä¹Ÿä¸€æ¨£æ˜¯ç°¡çŸ­æ¸…æ™°ä¸”ä¸ç”¨è€ƒæ…® BOM çš„å•é¡Œ, è€Œç”¨ StringBuilder æ¯”ä¸Šé¢ç”¨ Stream å¤šäº†ä¸€å€‹ç‰¹æ€§æ˜¯é€£ç·¨ç¢¼æ ¼å¼éƒ½ä¸ç”¨è€ƒæ…®, åŒæ¨£é©åˆç”¨åœ¨ä¸éœ€è¦è·Ÿå¤–éƒ¨ç³»çµ±ä»‹æŽ¥çš„æ¨¡çµ„ä¸Š. StringBuilder é è¨­çš„ç·¨ç¢¼æ ¼å¼æ˜¯ UTF-16 12345678910111213public string Serialize()&#123; var serializer = new XmlSerializer(typeof(MyModel)); var ns = new XmlSerializerNamespaces(new XmlQualifiedName[] &#123; XmlQualifiedName.Empty &#125;); var sb = new StringBuilder(); using (var sw = new StringWriter(sb)) &#123; serializer.Serialize(sw, new MyModel(), ns); return sb.ToString(); &#125;&#125; å°çµæ¯ç¨®åšæ³•éƒ½æœ‰å„è‡ªçš„å„ªç¼ºé»ž, éœ€è¦åœ¨è¼¸å‡ºæ ¼å¼ä¸Šæ»¿è¶³å„ç¨®æƒ…å¢ƒçš„è©±, ç”¨ XmlWriter æ“ä½œæ˜¯æœ€é©åˆçš„, å¦‚æžœç·¨ç¢¼èˆ‡è¼¸å‡ºæ ¼å¼å–®ä¸€ä¸”å¹¾ä¹Žä¸æœƒæ”¹è®Šçš„è©±, ç”¨ Stream æˆ– StringWriter è™•ç†æœƒæ›´å¥½æ‡‚. å¦‚æžœä½¿ç”¨ XmlWriter æˆ–æ˜¯ SreamWriter å…©å€‹ç¯„ä¾‹æ“ä½œçš„è©±è¦æ³¨æ„åºåˆ—åŒ–å‡ºä¾†çš„å…§å®¹æ˜¯å¦æœ‰ BOM, å°¤å…¶æ˜¯éœ€è¦è·Ÿå¤–éƒ¨ç³»çµ±ä»‹æŽ¥æ™‚. ååºåˆ—åŒ–XmlReaderXmlReader æ˜¯æä¾›æœ€å¤šåƒæ•¸çš„æ–¹å¼, XmlReader.Create(Stream, XmlReaderSettings) å’Œ XmlReader.Create(TextReader, XmlReaderSettings) çš„ç¬¬äºŒå€‹åƒæ•¸æœ‰å¾ˆå¤šé¸é …å¯ä»¥èª¿æ•´, å¾žæ–¹æ³•å®šç¾©å¯ä»¥çœ‹å¾—å‡ºä¾† XmlReader.Create(â€¦) æœ‰å¾ˆå¤šå¤šè¼‰å¯ä»¥ç”¨, å¦‚æžœæ˜¯å¾ž Stream è®€å–è³‡æ–™çš„è©±, å³ä½¿ XML å­—ä¸²æœ‰ BOM ä¹Ÿä¸æœƒå‡ºéŒ¯, ä½†å¦‚æžœå¾ž StringReader è®€å–, åœ¨ XML å­—ä¸²æœ‰ BOM çš„æƒ…å¢ƒä¸‹æœƒæ‹‹å‡º Exception. 12345678910111213141516171819202122232425262728293031323334public T DeSerialize_FromStream&lt;T&gt;(string xml, Encoding encoding)&#123; var serializer = new XmlSerializer(typeof(T)); var xmlBytes = encoding.GetBytes(xml); using (var ms = new MemoryStream(xmlBytes)) using (var xr = XmlReader.Create(ms)) &#123; xr.Read(); var result = serializer.Deserialize(xr); if (result != null) &#123; return (T)result; &#125; return default(T); &#125;&#125;public T DeSerialize_FromStringReader&lt;T&gt;(string xml)&#123; var serializer = new XmlSerializer(typeof(T)); using (var sr = new StringReader(xml)) using (var xr = XmlReader.Create(sr)) &#123; xr.Read(); var result = serializer.Deserialize(xr); if (result != null) &#123; return (T)result; &#125; return default(T); &#125;&#125; StreamReader / Streamé€™å…©ç¨®æ–¹å¼å·®ä¸å¤š, å³ä½¿ XML å­—ä¸²æœ‰ BOM ä¹Ÿéƒ½ä¸æœƒå‡ºéŒ¯, åªå·®åœ¨ StreamReader å»ºæ§‹å­çš„åƒæ•¸æ¯”è¼ƒå¤š, å¦‚æžœå°ç·¨ç¢¼æ ¼å¼æ²’ç‰¹åˆ¥çš„éœ€æ±‚çš„è©±, ç›´æŽ¥æ“ä½œ Stream æ¯”è¼ƒå–®ç´”. 1234567891011121314151617181920212223242526272829303132public T DeSerialize_StreamReader&lt;T&gt;(string xml, Encoding encoding)&#123; var serializer = new XmlSerializer(typeof(T)); var xmlBytes = encoding.GetBytes(xml); using (var ms = new MemoryStream(xmlBytes)) using (var tr = new StreamReader(ms, encoding)) &#123; var result = serializer.Deserialize(tr); if (result != null) &#123; return (T)result; &#125; return default(T); &#125;&#125;public T DeSerialize_Stream&lt;T&gt;(string xml, Encoding encoding)&#123; var serializer = new XmlSerializer(typeof(T)); var xmlBytes = encoding.GetBytes(xml); using (var ms = new MemoryStream(xmlBytes)) &#123; var result = serializer.Deserialize(ms); if (result != null) &#123; return (T)result; &#125; return default(T); &#125;&#125; StringReaderé€™ç¨®æ–¹æ³•åœ¨ XML å­—ä¸²æœ‰ DOM çš„æ™‚å€™æœƒå‡º Exception, å„ªé»žæ˜¯ä¸ç”¨è€ƒæ…®ç·¨ç¢¼æ ¼å¼, åªéœ€è¦çŸ¥é“ XML å­—ä¸²å°±å¯ä»¥äº†. 1234567891011121314public T DeSerialize&lt;T&gt;(string xml)&#123; var serializer = new XmlSerializer(typeof(T)); using (var sr = new StringReader(xml)) &#123; var result = serializer.Deserialize(sr); if (result != null) &#123; return (T)result; &#125; return default(T); &#125;&#125; å°çµååºåˆ—åŒ–å¤§éƒ¨åˆ†çš„åšæ³•éƒ½å¾ˆç°¡å–®, ä»¥ç›®å‰å¯¦é©—çœ‹ä¾†, æŠŠ XML å­—ä¸²å…ˆè½‰æˆ Stream å†è™•ç†éƒ½å¯ä»¥ç›¸å®¹æœ‰ BOM çš„è³‡æ–™ä¾†æº, éœ€è¦è€ƒé‡çš„é»žä¼¼ä¹Žä¹Ÿæ¯”åºåˆ—åŒ–æ™‚å°‘å¾ˆå¤š. çµè«–é€™ç¯‡åªæ˜¯è¦å¯¦é©—å„ç¨®åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–çš„æ–¹å¼é‡åˆ° BOM æ™‚å€™çš„çµæžœ, æ‰€ä»¥æ²’æœ‰ç‰¹åˆ¥å¯¦é©—å„ç¨®ä¸åŒæ–¹å¼åœ¨å…¶ä»–è¤‡é›œçš„ XML è³‡æ–™ä¸‹çš„è½‰æ›çµæžœ, å¦‚æžœä¹‹å¾Œæœ‰é‡åˆ°å…¶ä»–å•é¡Œçš„è©±å†å›žä¾†è£œ. ç¯„ä¾‹ç¨‹å¼ç¢¼å¯åƒè€ƒ Demo]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[WebAPI å®‰å…¨çš„å–å¾— Request Body]]></title>
    <url>%2Fcontent%2F20181118-webapi-get-request-body-safety.html</url>
    <content type="text"><![CDATA[æ¨™é¡Œä¸‹çš„æœ‰é»žå¥‡æ€ª, æ¡†æž¶é è¨­æä¾› Model Binding ä¾†å°‡è«‹æ±‚å…§å®¹(request body)ç¶å®šåˆ°åƒæ•¸ä¸­, å…¶å¯¦ä¸€èˆ¬æƒ…å¢ƒä¸éœ€è¦æ‰‹å·¥åŽ»è®€å–å®ƒçš„. ä½†æ˜¯ä¹‹å‰é‡åˆ°ä¸€å€‹æƒ…å¢ƒæ˜¯éœ€è¦åœ¨ ActionFilterAttribute ä¸­å–å¾—è«‹æ±‚å…§å®¹ä¸¦ç´€éŒ„åˆ°æ—¥èªŒ (log) ä¸­, é€™æ™‚å€™å•é¡Œå°±ä¾†äº†. å…ˆä¾†æ®µç¨‹å¼ç¢¼, çœ‹èµ·ä¾†å¾ˆæ­£å¸¸, å°±æ˜¯åœ¨ ActionFilterAttribute ä¸­æŠŠè«‹æ±‚å…§å®¹æŠ“å‡ºä¾†, ç„¶å¾Œè¨˜éŒ„åˆ°æ—¥èªŒä¸­æ”¶å·¥, ä½†æŽ¥ä¸‹ä¾†æœ‰å€‹å•é¡Œâ€¦ 1234567891011121314public class DemoActionFilterAttribute : ActionFilterAttribute&#123; public override void OnActionExecuting(HttpActionContext actionContext) &#123; using (Stream s = actionContext.Request.Content.ReadAsStreamAsync().Result) using (StreamReader sr = new StreamReader(s)) &#123; s.Seek(0, SeekOrigin.Begin); var body = sr.ReadToEnd(); // Logging here... logger.Info(body); &#125; &#125;&#125; ä¸Šé¢èªªåˆ°ç´€éŒ„å®Œæ—¥èªŒæ”¶å·¥, é€™æ™‚å€™æˆ‘å€‘å›žåˆ° WebAPI ä¸­çš„ Action ä¾†çœ‹çœ‹ä¸‹é¢é€™æ®µç¨‹å¼ç¢¼, å¯ä»¥çœ‹åˆ° Action ä¸­åˆå†æ¬¡è®€å–ä¸€æ¬¡è«‹æ±‚å…§å®¹, ä½†æ˜¯é€™æ¬¡å»æœƒæ‹‹å‡ºä¾‹å¤–(exception), é€™å°±æ˜¯æœ‰å•é¡Œçš„åœ°æ–¹äº†. 123456789101112131415public class ValuesController : ApiController&#123; [HttpPost] [DemoActionFilter] public void Post() &#123; string data = string.Empty; using (Stream s = Request.Content.ReadAsStreamAsync().Result) using (StreamReader sr = new StreamReader(s)) &#123; s.Seek(0, SeekOrigin.Begin); data = sr.ReadToEnd(); &#125; &#125;&#125; Stream.Seek(0, SeekOrigin.Begin) æ˜¯ç”¨ä¾†é‡ç½® stream çš„è®€å–ä½ç½®çš„, ä¹Ÿå¯ä»¥é€™æ¨£å¯« Stream.Position = 0 ä¸ç”¨ usingç°¡å–®æš´åŠ›çš„åšæ³•å°±æ˜¯æŠŠ DemoActionFilterAttribute ä¸­è®€å–æ™‚çš„ usingæ‹¿æŽ‰, é€™æ¨£è³‡æºå°±ä¸æœƒè¢«å¼·åˆ¶å›žæ”¶, å¦‚ä¸‹: 123456789101112public class DemoActionFilterAttribute : ActionFilterAttribute&#123; public override void OnActionExecuting(HttpActionContext actionContext) &#123; Stream s = actionContext.Request.Content.ReadAsStreamAsync().Result; StreamReader sr = new StreamReader(s); s.Seek(0, SeekOrigin.Begin); string body = sr.ReadToEnd(); // Logging here... logger.Info(body); &#125;&#125; æˆ–æ˜¯åˆå§‹åŒ– StreamReader çš„æ™‚å€™è¦ç”¨åƒæ•¸æœ€å¤šçš„é‚£å€‹å¤šè¼‰, ä¸¦æŠŠæœ€å¾Œä¸€å€‹åƒæ•¸ leaveOpen è¨­æˆ true è®“ stream æœ¬èº«åœ¨ StreamReader é‡‹æ”¾å¾Œä¸æœƒè¢«é—œé–‰, ä½†é€™æ¨£é‚„è¦ç‰¹åˆ¥åŽ»æ³¨æ„å…¶ä»–åƒæ•¸é è¨­è¦å¡«ä»€éº¼æœ‰é»žéº»ç…©, è€Œä¸”ä¹Ÿä¸ç¢ºå®š ReadAsStreamAsync() é€™å€‹æ–¹æ³•ä½¿æœƒä¸æœƒå»ºç«‹ä¸€å€‹æ–°çš„ Stream ä»¥åŠæ˜¯å¦å¿…é ˆæ‰‹å‹•é‡‹æ”¾ , ä¾‹å¦‚ä¸‹é¢çš„ç¯„ä¾‹ 1234567891011121314public class DemoActionFilterAttribute : ActionFilterAttribute&#123; public override void OnActionExecuting(HttpActionContext actionContext) &#123; Stream s = actionContext.Request.Content.ReadAsStreamAsync().Result; using (var sr = new StreamReader(s, Encoding.UTF8, true, 1024, true)) &#123; s.Seek(0, SeekOrigin.Begin); string body = sr.ReadToEnd(); // Logging here... logger.Info(body); &#125; &#125;&#125; é€™å…©ç¨®åšæ³•é›–ç„¶æ˜¯èƒ½è®“ç¨‹å¼ç¢¼èƒ½æˆåŠŸé‹ä½œ, ä½†æ˜¯æ—¢ç„¶é€™äº›é¡žåˆ¥æœ‰å¯¦ä½œ IDisposable ä¾†å…è¨±ä½¿ç”¨ using ä¾†ææ—©å›žæ”¶è³‡æº, åœ¨ä¸å®Œå…¨ç¢ºå®šé€™äº›è³‡æºèƒ½è¢« GC å³æ™‚å›žæ”¶çš„æƒ…æ³ä¸‹, å†’ç„¶æŠŠ using æ‹†æŽ‰ä¼¼ä¹Žä¸æ˜¯é¦–é¸. æ”¹ç”¨ ReadAsStringAsyncé€™æ˜¯æœ€ç°¡çŸ­çš„ä½œæ³•, ä¸”é€™æ¨£åšåœ¨ Action ä¸­è¦å†æ¬¡è®€å– Sream æ™‚ä¸¦ä¸æœƒå‡ºéŒ¯, ä½†æ˜¯å»æœ‰å€‹é™åˆ¶ - Action ä¸èƒ½æœ‰åƒæ•¸.123456789public class DemoActionFilterAttribute : ActionFilterAttribute&#123; public override void OnActionExecuting(HttpActionContext actionContext) &#123; string body = actionContext.Request.Content.ReadAsStringAsync().Result; // Logging here... logger.Info(body); &#125;&#125; å¾žé€™å¼µåœ–å¯ä»¥çœ‹å‡º, å¦‚æžœ Action æœ‰åƒæ•¸çš„è©± (åƒæ˜¯é€™æ¨£ public void Post(MyModel model) ), æœƒå…ˆåš Model Binding (åœ¨åœ–ä¸­æ¨™è¨» C é»žçš„åœ°æ–¹) ç„¶å¾Œæ‰æ˜¯åš ActionFilter, æ‰€ä»¥ç•¶é€²åˆ° ActionFilterAttribute è£¡é¢æ™‚, è«‹æ±‚å·²ç¶“è¢«è®€å–éŽäº†, é€™æ™‚å€™è®€å‡ºä¾†çš„çµæžœæœƒæ˜¯ç©ºå­—ä¸². å› æ­¤, é€™ç¨®åšæ³•å¿…é ˆé™åˆ¶ Action ä¸èƒ½æœ‰åƒæ•¸, ä½†æ˜¯åªç‚ºäº† ActionFilterAttribute éœ€è¦è€Œé™åˆ¶çš„ Action çš„å¯¦ä½œæ–¹å¼æ˜¯ä¸åˆç†çš„, æœƒé€ æˆæœªä¾†æ“´å±•æˆ–ç¶­è­·ä¸Šçš„å›°æ“¾. è¤‡è£½ Streamæ—¢ç„¶è¦è®€å–å…§å®¹åˆä¸èƒ½æŠŠè³‡æºé‡‹æ”¾æŽ‰, ä¸å¦‚ç›´æŽ¥è¤‡è£½ä¸€ä»½å‡ºä¾†è®€å–, å†é‡‹æ”¾æŽ‰è¤‡è£½ç‰ˆçš„è³‡æºå°±å¥½äº†. 12345678910111213141516171819public class DemoActionFilterAttribute : ActionFilterAttribute&#123; public override void OnActionExecuting(HttpActionContext actionContext) &#123; using (Stream s = new MemoryStream()) &#123; actionContext.Request.Content.CopyToAsync(s); // need call it twice if model binding works actionContext.Request.Content.CopyToAsync(s); using (StreamReader sr = new StreamReader(s)) &#123; s.Seek(0, SeekOrigin.Begin); string body = sr.ReadToEnd(); // Logging here... logger.Info(body); &#125; &#125; &#125;&#125; ä¹‹å‰åœ¨æŸä¸€æœ¬æ›¸ä¸Šçœ‹åˆ°è¤‡è£½ stream ä¸å¥½, ä½†ç•¶æ™‚æ²’æœ‰ä»”ç´°çœ‹, æ‰€ä»¥ä¹Ÿä¸æ¸…æ¥šç‚ºä»€éº¼ä¸å¥½, ä¸éŽå€’æ˜¯æœ‰åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°ä¸€ç¯‡é—œæ–¼è¤‡è£½ stream çš„æ•ˆèƒ½å•é¡Œ, åŸºæœ¬ä¸Šæ˜¯å› ç‚ºçŸ­æ™‚é–“å¤§é‡è³‡æ–™æ¹§å…¥å†åŠ ä¸Šè³‡æºä¾†ä¸åŠé‡‹æ”¾, å°Žè‡´è¨˜æ†¶é«”ç”¨é‡é£†é«˜, é€™é‚Šçš„ä½œæ³•è·Ÿä»–æåˆ°çš„è§£æ³•æœ‰é»žä¸åŒ, ä½†åŽŸå‰‡éƒ½æ˜¯ç›¡æ—©é‡‹æ”¾è³‡æº. å¦å¤–é‚„æœ‰ä¸€å€‹å•é¡Œæ˜¯, é€™å€‹åšæ³•å¦‚æžœè·Ÿ Model Binding ä¸€èµ·ä½¿ç”¨, actionContext.Request.Content.CopyToAsync(s) è¦åŸ·è¡Œå…©æ¬¡æ‰èƒ½æ‰èƒ½æ­£ç¢ºçš„è¤‡è£½ stream, æŽ¨æ¸¬è·Ÿ Stream.Position æœ‰é—œä½†ä¸çŸ¥é“æ€Žéº¼è­‰å¯¦. å…§å»ºçš„ Model Bindingæˆ–æ˜¯æ›å€‹æ–¹å‘, Action å¿…é ˆå¸¶åƒæ•¸ä¸”é€éŽ Model Binding ç¶å®š, è€Œ ActionFilterAttribute ä¸­ç¶­æŒä¸å‹•, Action ç›´æŽ¥æ“ä½œç¶å®šå¥½çš„ç‰©ä»¶å°±å¥½, ä½†é€™æ¨£ ActionFilterAttribute ä¸­é‚„æ˜¯æŠŠè³‡æºé‡‹æ”¾æŽ‰äº†, å°±è¨­è¨ˆçš„è§’åº¦ä¾†çœ‹æˆ‘å€‘ä¸å¸Œæœ›åœ¨ä¸€å€‹é€šç”¨æ–¹æ³• (DemoActionFilterAttribute) ä¸­å°å…¨åŸŸçš„è³‡æºåšä¸€æ¬¡æ€§çš„ä½¿ç”¨, å› ç‚ºç„¡æ³•é æœŸé€™å€‹è³‡æºæ˜¯å¦æœƒå†æ¬¡è¢«ä½¿ç”¨. (æŽ¨è–¦) ç›´æŽ¥è®€å…§å»ºçš„å±¬æ€§é€™å€‹æ€è€ƒæ–¹å‘æ˜¯, é‚£æœ‰æ²’æœ‰å¯èƒ½å…§å»ºçš„ request ç›¸é—œç‰©ä»¶å°±æœ‰æä¾›è¨˜éŒ„è‘—è«‹æ±‚å…§å®¹çš„ Stream åž‹åˆ¥çš„å±¬æ€§è®“æˆ‘å€‘èƒ½ç›´æŽ¥è®€å–å‘¢? è€Œå…§å»ºçš„ç‰©ä»¶ä¸­çš„å±¬æ€§, æˆ‘å€‘å¯ä»¥åˆç†é æœŸä¸ç”¨æ‰‹å‹•åŽ»é‡‹æ”¾ç›¸é—œçš„è³‡æº. 123456789101112public class DemoActionFilterAttribute : ActionFilterAttribute&#123; public override void OnActionExecuting(HttpActionContext actionContext) &#123; var context = (HttpContextBase)actionContext.Request.Properties["MS_HttpContext"]; var bytes = new byte[context.Request.InputStream.Length]; context.Request.InputStream.Read(bytes, 0, bytes.Length); string body = Encoding.UTF8.GetString(bytes); // Logging here... logger.Info(body); &#125;&#125; é€™å€‹åšæ³•çœ‹èµ·ä¾†æ˜¯æœ€åˆç†çš„, ä¸€æ–¹é¢å¯ä»¥åœ¨ ActionFilter ä¸­è®€å–è«‹æ±‚å…§å®¹, ä¸ç”¨æ‰‹å‹•é‡‹æ”¾è³‡æºæ‰€ä»¥ä¸æœƒç ´å£žå®ƒ, é€™æ¨£å„å€‹ Action ä¸­å¦‚æžœæœ‰éœ€è¦ä¹Ÿå¯ä»¥å†æ¬¡è®€å–. å¦å¤–, è®€å– InputStream çš„æ–¹å¼ä¹Ÿå¯ä»¥æ­é… StreamReader, è¦ç‰¹åˆ¥å¸¶å…¥ leaveOpen åƒæ•¸é¿å…æŠŠ InputStream é—œé–‰äº†, æ¯”è¼ƒéº»ç…©, ä¾‹å¦‚ä¸‹é¢çš„ç¯„ä¾‹ 1234567891011121314public class DemoActionFilterAttribute : ActionFilterAttribute&#123; public override void OnActionExecuting(HttpActionContext actionContext) &#123; var context = (HttpContextBase)actionContext.Request.Properties["MS_HttpContext"]; context.Request.InputStream.Seek(0, SeekOrigin.Begin); using (var sr = new StreamReader(context.Request.InputStream, Encoding.UTF8, true, 1024, true)) &#123; string body = sr.ReadToEnd(); // Logging here... logger.Info(body); &#125; &#125;&#125; çµè«–é€™æ˜¯å·¥ä½œä¸Šé‡åˆ°çš„å•é¡Œ, ç ”ç©¶ä¸€ç•ªå¾Œè§£æ˜¯è§£äº†, ä¸éŽç•¢ç«Ÿæ²’æœ‰å®Œå…¨äº†è§£åº•å±¤çš„é‹ä½œ, æœ€å¾Œçš„è§£æ³•æ˜¯ä¸æ˜¯å¥½çš„æ–¹æ³•é‚„å¾ˆé›£èªª, å¯èƒ½ä¹‹å¾Œæœ‰ç©ºæˆ–æ˜¯åˆè¸©åˆ°ä»€éº¼ç›¸é—œå•é¡Œå†ä¾†ä»”ç´°æ·±ç©¶äº†.å¦å¤–å‰é¢å¹¾ç¨®è§£æ³•é›–ç„¶çœ‹èµ·ä¾†éƒ½æœ‰äº›ç¼ºé™·, ä½†ä¹Ÿä¸å…¨ç„¶æ˜¯ä¸å¥½, åªæ˜¯èªªåœ¨é€™å€‹æƒ…å¢ƒä¸‹ä¸å¤ªé©åˆè€Œå·². é‡ç½®è®€å–ä½ç½®é€™å€‹è¡Œç‚ºåœ¨è¦è®€å–çš„ stream å·²ç¶“è¢«è®€éŽæ™‚è¦åš, ä½†å‰é¢çš„ç¯„ä¾‹ä¸­, æŸäº›æƒ…å¢ƒä¸‹è¦è®€å–çš„ stream ä¸ä¸€å®šå·²ç¶“è¢«è®€éŽ, é€™å€‹å°±çœ‹å„äººæ˜¯ç¿’æ…£ä¸è«–å¦‚ä½•åªè¦è®€ stream éƒ½é‡ç½®è®€å–ä½ç½®, é‚„æ˜¯åªåœ¨å¿…è¦é‡ç½®çš„æ™‚å€™é‡ç½®äº†. åƒè€ƒWeb Api Request Content is empty in action filterSteam.CopyTo - Performance problemsLeave StreamReader without closing Stream]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[XmlWriterSettings.Encoding è¨­å®šç„¡æ•ˆ]]></title>
    <url>%2Fcontent%2F20181101-xmlwritersettings-encoding-not-working.html</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨å¯«ä¸€å€‹æ¯”è¼ƒæ–¹ä¾¿ä½¿ç”¨çš„å·¥å…·æ–¹æ³•ä¾†åš XML çš„åºåˆ—åŒ–çš„æ™‚å€™, ç™¼ç”Ÿäº†ä¸€å€‹ç¥žå¥‡çš„å•é¡Œ, XmlWriterSettings.Encoding é è¨­æ‡‰è©²æ˜¯ UTF-8, ä½†æ˜¯è½‰å‡ºä¾†çš„ XML å»æ˜¯ UTF-16, é€™å°±å¥‡äº†æ€ªäº†â€¦ XmlWriterSettings.Encoding è¨­å®šç„¡æ•ˆå…ˆä¾†çœ‹ä¸‹é¢é€™æ®µ Demo123456789101112private static string DemoForFailure()&#123; var xmlWriterSettings = new XmlWriterSettings(); var sb = new StringBuilder(); using (var xmlWriter = XmlWriter.Create(sb, xmlWriterSettings)) &#123; new XmlSerializer(typeof(string)).Serialize(xmlWriter, string.Empty); return sb.ToString(); &#125;&#125; ç¨‹å¼ç¢¼å°±æ˜¯å¾ˆç°¡å–®çš„æŠŠä¸€å€‹ç©ºå­—ä¸²æ‹¿åŽ»åºåˆ—åŒ–, ä½†æ˜¯è¼¸å‡ºçš„å­—ä¸²å»æ˜¯ &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-16&quot;?&gt;&lt;string /&gt;, å³ä½¿ç‰¹åˆ¥å†æ‰‹å‹•è¨­å®š Encoding ä¹Ÿæ˜¯ä¸€æ¨£, å¦‚: var xmlWriterSettings = new XmlWriterSettings() { Encoding = Encoding.UTF8 }; ç¨å¾®æŽ¨æ•²ä¸€ä¸‹ç¨‹å¼ç¢¼, çŒœæ¸¬æ‡‰è©²æ˜¯ StringBulider çš„å•é¡Œ, å¯èƒ½æ˜¯å› ç‚º StringBulider æ“ä½œå­—ä¸²æœ‰è‡ªå·±çš„ Encoding, æ‰€ä»¥å°±å¾€é€™æ–¹é¢åŽ»æ‰¾. åŽŸå› å› ç‚ºä»Šå¤©æ¯”è¼ƒæ‡¶ä¸æƒ³è‡ªå·±å¾€åº•éƒ¨åŽ»é‘½, æ‰€ä»¥å…ˆå•å• google å¤§ç¥žå…ˆ, ä¹Ÿæ˜¯é‹æ°£å¥½é‚„çœŸçš„æœ‰æ‰¾åˆ°ä¸€ç¯‡åˆ†æžæ–‡, å¤§æ„ä¸Šå°±æ˜¯ StringBuilder è¨­è¨ˆä¸Šæ˜¯ç›´æŽ¥æ“ä½œå­—å…ƒè€Œä¸æ˜¯ bytes, è€Œå­—ä¸²åœ¨ .NET è£¡é¢éƒ½æ˜¯ UTF-16 ç·¨ç¢¼çš„. è§£æ³•æ‰€ä»¥é€™é‚Šæ”¹ç”¨å­˜å– Stream çš„æ–¹å¼ä¾†æ“ä½œ, å¦‚ä¸‹12345678910111213private static string DemoForSuccess()&#123; var xmlWriterSettings = new XmlWriterSettings() &#123; Encoding = Encoding.UTF8 &#125;; using (var ms = new MemoryStream()) using (var sr = new StreamReader(ms)) using (var xmlWriter = XmlWriter.Create(ms, xmlWriterSettings)) &#123; new XmlSerializer(typeof(string)).Serialize(xmlWriter, string.Empty); ms.Position = 0; return sr.ReadToEnd(); &#125;&#125; çµè«–ä¹Ÿæ²’ä»€éº¼ç‰¹åˆ¥çš„æŠ€å·§å¥½çµè«–, ç‰¹åˆ¥å¯«å‡ºä¾†åªæ˜¯æ€•ä¹‹å¾Œå¿˜è¨˜, å†é‡åˆ°é‚„è¦å†è¸©ä¸€æ¬¡. åƒè€ƒXmlWriterSettings Encoding Being Ignored?]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[WebApi 2 ä¸­çš„ FilterAttribute ä»‹ç´¹èˆ‡æ‡‰ç”¨]]></title>
    <url>%2Fcontent%2F20180923-filters-of-webapi2.html</url>
    <content type="text"><![CDATA[ASP.NET WebApi 2 æä¾›äº†ä¸‰å€‹å¥½ç”¨çš„ FilterAttribute è®“é–‹ç™¼è€…å¯ä»¥æ“´å……å¾Œå°‡é€™äº› FilterAttribute å¥—ç”¨åœ¨ Controller / Action ä¸Šé¢, ä¹Ÿå¯ä»¥åœ¨ WebApiConfig.cs æˆ– Global.asax è£¡é¢è¨»å†Š , ä¸¦åœ¨ä¸€å€‹ API request ç”Ÿå‘½é€±æœŸä¸­çš„ç‰¹å®šæ™‚é–“è¢«åŸ·è¡Œ.é€™æ¨£åšçš„å¥½è™•æ˜¯å¯ä»¥å°‡è·Ÿ API ä¸»æ¥­å‹™é‚è¼¯ç„¡é—œ, å»åˆæ˜¯å¤§éƒ¨åˆ† API éƒ½è¦åšçš„äº‹æ”¶æ–‚èµ·ä¾†, åªéœ€è¦å°‡ Attribute å¥—ç”¨åœ¨æ­£ç¢ºçš„åœ°æ–¹å°±èƒ½ä¸€é«”é©ç”¨, é–‹ç™¼è€…å°±èƒ½æ›´å°ˆæ³¨åœ¨ API çš„ä¸»è¦å•†å‹™é‚è¼¯å±¤é¢. åœ¨äº†è§£ FilterAttribute çš„é‹ç”¨ä¹‹å‰, å¿…é ˆå…ˆçŸ¥é“ Attribute æ˜¯ä»€éº¼ä»¥åŠå¦‚ä½•ä½¿ç”¨ Attribute. ä¸‰ç¨® FilterAttribute ä»‹ç´¹ASP.NET WebApi 2 æä¾›äº†ä¸‰å€‹å¥½ç”¨çš„ FilterAttribute, åˆ†åˆ¥æ˜¯ AuthorizationFilterAttribute, ActionFilterAttribute èˆ‡ ExceptionFilterAttribute , è¦æ³¨æ„çš„æ˜¯å‘½åç©ºé–“éƒ½æ˜¯ System.Web.Http.Filters, ASP.NET MVC ä¹Ÿæœ‰æä¾›åŒåçš„ FilterAttribute, ä½†æ˜¯å‘½åç©ºé–“ä¸åŒ, å…§å®¹ä¹Ÿä¸ç›¡ç›¸åŒ. é€™ä¸‰å€‹ FilterAttribute æä¾›çš„åŠŸèƒ½å„ç•°: AuthorizationFilterAttribute æä¾›çš„æ˜¯é©—è­‰ç›¸é—œçš„æµç¨‹, èƒ½åœ¨é€² Action ä¹‹å‰å°±å…ˆåŸ·è¡Œç›¸é—œçš„é©—è­‰æ–¹æ³•. ActionFilterAttribute æœƒåˆ†åˆ¥åœ¨ Action åŸ·è¡Œå‰èˆ‡åŸ·è¡Œå®Œç•¢å¾ŒåŸ·è¡Œç›¸é—œæ–¹æ³•. ExceptionFilterAttribute åœ¨ä¾‹å¤–(unhandled exception)ç™¼ç”Ÿå¾ŒåŸ·è¡Œ. åŸºæœ¬ç”¨æ³•é€™ä¸‰ç¨® FilterAttribute çš„ä½¿ç”¨æ–¹å¼éƒ½ä¸€æ¨£, é€™é‚Šç”¨ ExceptionFilterAttribute ä¾†ç•¶ä½œç¯„ä¾‹. ç¹¼æ‰¿å°æ‡‰çš„ FilterAttribute, ä¸¦è¦†å¯«çˆ¶é¡žåˆ¥ä¸­çš„ç›¸é—œæ–¹æ³•. 1234567891011121314public class DemoExceptionFilterAttribute : ExceptionFilterAttribute&#123; public override void OnException(HttpActionExecutedContext actionExecutedContext) &#123; // Call base method base.OnException(actionExecutedContext); // Do somthing, ex: logging exception // _logger.Info(actionExecutedContext.Exception); // Set response information actionExecutedContext.Response = new HttpResponseMessage(HttpStatusCode.InternalServerError); &#125;&#125; å¥—ç”¨ FilterAttribute. å¥—ç”¨åˆ° Action 12345678public class DemoController : ApiController&#123; [DemoExceptionFilter] public IEnumerable&lt;string&gt; Get() &#123; throw new Exception(); &#125;&#125; å¥—ç”¨åˆ°ç‰¹å®š ApiController 12345678[DemoExceptionFilter]public class DemoController : ApiController&#123; public IEnumerable&lt;string&gt; Get() &#123; throw new Exception(); &#125;&#125; æ›´é€²ä¸€æ­¥, å¯ä»¥å°‡é€™äº› FilterAttribute å¥—ç”¨åœ¨ä¸€å€‹å…±ç”¨çš„ BaseApiController ä¸Š, åªè¦ç¹¼æ‰¿ BaseApiController, å°±èƒ½ç›´æŽ¥å¥—ç”¨. 12345678910111213[DemoExceptionFilter]public class BaseApiController : ApiController&#123;&#125;public class DemoController : BaseApiController&#123; public IEnumerable&lt;string&gt; Get() &#123; throw new Exception(); &#125;&#125; å¥—ç”¨åˆ°æ‰€æœ‰ ApiController - å¾ž ~/App_Start/WebApiConfig.cs 1234567891011121314151617public class DemoController : ApiController&#123; public IEnumerable&lt;string&gt; Get() &#123; throw new Exception(); &#125;&#125;// ~/App_Start/WebApiConfig.cspublic static void Register(HttpConfiguration config)&#123; // ... config.Filters.Add(new DemoExceptionFilterAttribute()); // ...&#125; å¥—ç”¨åˆ°æ‰€æœ‰ ApiController - å¾ž~/Global.asax 1234567891011121314151617public class DemoController : ApiController&#123; public IEnumerable&lt;string&gt; Get() &#123; throw new Exception(); &#125;&#125;// ~/Global.asaxprotected void Application_Start()&#123; // ... GlobalConfiguration.Configuration.Filters.Add(new DemoExceptionFilterAttribute()); // ...&#125; å–®ç¨å¥—ç”¨åªèƒ½å¥—ç”¨åœ¨ ApiController çš„è¡ç”Ÿé¡žåˆ¥æˆ– Action ä¸Š, å¦‚æžœæ˜¯å¥—ç”¨åœ¨å…¶ä»–æ–¹æ³•(ä¾‹å¦‚: xxxService.Do(), æˆ– this.Do()), å³ä½¿é‚£å€‹æ–¹æ³•æœ‰è¢« ApiController çš„ Action å‘¼å«åˆ°ä¹Ÿæ˜¯ç„¡æ³•è®“ FilterAttribute é‹ä½œçš„. é‡è¤‡å¥—ç”¨åŒä¸€å€‹ FilterAttribute ä¸æœƒå£ž, ä½†å› ç‚ºè¨»å†Šäº†å…©æ¬¡, æ‰€ä»¥ä¹ŸæœƒåŸ·è¡Œå…©æ¬¡, æ‰€ä»¥æ‡‰è©²è¦ç‰¹åˆ¥æ³¨æ„å¥—ç”¨æ–¹å¼é¿å…é‡è¤‡å¥—ç”¨. æŽ’é™¤ç‰¹å®š Action æˆ– Controllerå¦‚æžœå¤§éƒ¨åˆ† API éƒ½éœ€è¦å¥—ç”¨ä¸€å€‹ FilterAttribute, ä½†æœ‰å°‘æ•¸ä¸å¥—ç”¨, æ‡‰è©²è¦æ€Žéº¼å¯¦ä½œæŽ’é™¤æ©Ÿåˆ¶å‘¢? å¯¦ä½œæ¨™è¨˜ç‚ºæŽ’é™¤çš„ Attribute 123456789public class IgnoreFilterAttribute : Attribute&#123; public Type FilterType &#123; get; &#125; public IgnoreFilterAttribute(Type filterType) &#123; this.FilterType = filterType; &#125;&#125; æ“´å…… FilterAttribute ä»¥æ”¯æ´æŽ’é™¤åŠŸèƒ½ 123456789101112131415161718192021222324252627282930313233public class DemoExceptionFilterAttribute : ExceptionFilterAttribute&#123; public override void OnException(HttpActionExecutedContext actionExecutedContext) &#123; Func&lt;IgnoreFilterAttribute, bool&gt; ignoreCheck = (r) =&gt; &#123; // ignored type is one of... // 1. DemoExceptionFilterAttribute // 2. Base types of DemoExceptionFilterAttribute return r.FilterType.IsAssignableFrom(typeof(DemoExceptionFilterAttribute)); &#125;; var ignoredActions = actionExecutedContext .ActionContext .ActionDescriptor .GetCustomAttributes&lt;IgnoreFilterAttribute&gt;() .Any(ignoreCheck); var ignoredControllers = actionExecutedContext .ActionContext .ControllerContext .ControllerDescriptor .GetCustomAttributes&lt;IgnoreFilterAttribute&gt;() .Any(ignoreCheck); if (ignoredActions || ignoredControllers) &#123; return; &#125; // ... &#125;&#125; å¥—ç”¨æ¨™è¨˜ç‚ºæŽ’é™¤çš„ Attribute 1234567891011// apply to Controller//[IgnoreFilter(typeof(DemoExceptionFilterAttribute))]public class DemoController : ApiController&#123; // apply to Action [IgnoreFilter(typeof(DemoExceptionFilterAttribute))] public IEnumerable&lt;string&gt; Get() &#123; throw new Exception(); &#125;&#125; åŸ·è¡Œé †åºæ ¹æ“š The ASP.NET Web API 2 HTTP Message Lifecycle in 43 Easy Steps çš„èªªæ˜ŽåŠ ä¸Š ASP.NET WEB API 2: HTTP MESSAGE LIFECYLE æµç¨‹åœ–çš„å…§å®¹ä¾†çœ‹, AuthorizationFilterAttribute æœƒå…ˆåŸ·è¡Œ, ç„¶å¾Œæ‰æ˜¯ ActionFilterAttribute, è€Œä¾‹å¤–ç™¼ç”Ÿæ™‚æœƒåŸ·è¡ŒExceptionFilterAttribute, è‡³æ–¼åŒç¨®é¡žçš„å¤šå€‹ FilterAttribute æˆ–æ˜¯ä¸€å€‹ FilterAttribute ä¸­çš„ä¸åŒæ–¹æ³•åŸ·è¡Œçš„é †åº, å¯ä»¥å¾žä¸‹é¢çš„ç¨‹å¼ç¢¼è§€å¯Ÿå‡ºçµæžœ. é¦–å…ˆ, éœ€è¦ AuthorizationFilterAttribute å’Œ ActionFilterAttribute å„å…©çµ„, å¦å¤–ä¸€çµ„ ExceptionFilterAttribute, æŽ¥è‘—æŠŠé€™äº› FilterAttribute æ”¾åœ¨ WebApi å°ˆæ¡ˆé è¨­çš„ Action ä¸Š, ä¸” ExceptionFilterAttribute åˆ»æ„æ’åœ¨ä¸­é–“, è€Œ Action å°±ç°¡å–®çš„æ‹‹å‡ºä¸€å€‹ä¾‹å¤–. 12345678910111213public class ValuesController : ApiController&#123; // GET api/values [MyAuth2] [MyAuth1] [MyAction1] [MyException1] [MyAction2] public IEnumerable&lt;string&gt; Get() &#123; throw new Exception(); &#125;&#125; å¯¦ä½œéƒ¨åˆ†æ‰€æœ‰ FilterAttribute ä¸¦è¦†å¯«æ‰€æœ‰èƒ½è¦†å¯«çš„æ–¹æ³•, å…§å®¹åªæ˜¯å–®ç´”å¯«å€‹ç°¡å–®çš„æ­·ç¨‹è¨˜éŒ„åˆ° RouteTracer.Routes ä¸­, ä½†ExceptionFilterAttribute éœ€è¦å¦å¤–è² è²¬å›žå‚³æ­£ç¢ºçš„ç‹€æ…‹èˆ‡ RouteTracer.Routes å…§å®¹, æ‰èƒ½é †åˆ©è§€å¯ŸåŸ·è¡Œé †åº. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394public class MyAuth1 : AuthorizationFilterAttribute&#123; public override void OnAuthorization(HttpActionContext actionContext) &#123; RouteTracer.Routes.Add("MyAuth1.OnAuthorization"); base.OnAuthorization(actionContext); &#125; public override Task OnAuthorizationAsync(HttpActionContext actionContext, CancellationToken cancellationToken) &#123; RouteTracer.Routes.Add("MyAuth1.OnAuthorizationAsync"); return base.OnAuthorizationAsync(actionContext, cancellationToken); &#125;&#125;public class MyAuth2 : AuthorizationFilterAttribute&#123; public override void OnAuthorization(HttpActionContext actionContext) &#123; RouteTracer.Routes.Add("MyAuth2.OnAuthorization"); base.OnAuthorization(actionContext); &#125; public override Task OnAuthorizationAsync(HttpActionContext actionContext, CancellationToken cancellationToken) &#123; RouteTracer.Routes.Add("MyAuth2.OnAuthorizationAsync"); return base.OnAuthorizationAsync(actionContext, cancellationToken); &#125;&#125;public class MyAction1 : ActionFilterAttribute&#123; public override void OnActionExecuted(HttpActionExecutedContext actionExecutedContext) &#123; RouteTracer.Routes.Add("MyAction1.OnActionExecuted"); base.OnActionExecuted(actionExecutedContext); &#125; public override Task OnActionExecutedAsync(HttpActionExecutedContext actionExecutedContext, CancellationToken cancellationToken) &#123; RouteTracer.Routes.Add("MyAction1.OnActionExecutedAsync"); return base.OnActionExecutedAsync(actionExecutedContext, cancellationToken); &#125; public override void OnActionExecuting(HttpActionContext actionContext) &#123; RouteTracer.Routes.Add("MyAction1.OnActionExecuting"); base.OnActionExecuting(actionContext); &#125; public override Task OnActionExecutingAsync(HttpActionContext actionContext, CancellationToken cancellationToken) &#123; RouteTracer.Routes.Add("MyAction1.OnActionExecutingAsync"); return base.OnActionExecutingAsync(actionContext, cancellationToken); &#125;&#125;public class MyAction2 : ActionFilterAttribute&#123; public override void OnActionExecuted(HttpActionExecutedContext actionExecutedContext) &#123; RouteTracer.Routes.Add("MyAction2.OnActionExecuted"); base.OnActionExecuted(actionExecutedContext); &#125; public override Task OnActionExecutedAsync(HttpActionExecutedContext actionExecutedContext, CancellationToken cancellationToken) &#123; RouteTracer.Routes.Add("MyAction2.OnActionExecutedAsync"); return base.OnActionExecutedAsync(actionExecutedContext, cancellationToken); &#125; public override void OnActionExecuting(HttpActionContext actionContext) &#123; RouteTracer.Routes.Add("MyAction2.OnActionExecuting"); base.OnActionExecuting(actionContext); &#125; public override Task OnActionExecutingAsync(HttpActionContext actionContext, CancellationToken cancellationToken) &#123; RouteTracer.Routes.Add("MyAction2.OnActionExecutingAsync"); return base.OnActionExecutingAsync(actionContext, cancellationToken); &#125;&#125;public class MyException1 : ExceptionFilterAttribute&#123; public override void OnException(HttpActionExecutedContext actionExecutedContext) &#123; RouteTracer.Routes.Add("MyException1.OnException"); base.OnException(actionExecutedContext); actionExecutedContext.Response = new HttpResponseMessage(HttpStatusCode.OK); actionExecutedContext.Response.Content = new ObjectContent&lt;List&lt;string&gt;&gt;(RouteTracer.Routes, new XmlMediaTypeFormatter()); &#125;&#125; å¯¦éš›é‹ä½œå¾Œé é¢é¡¯ç¤ºçµæžœå¦‚ä¸‹, å¯ä»¥çœ‹å‡ºå„ç¨® FilterAttribute ä»¥åŠå…¶ä¸­çš„æ–¹æ³•çš„åŸ·è¡Œé †åº. 123456789101112131415&lt;ArrayOfstring xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt; &lt;string&gt;MyAuth2.OnAuthorizationAsync&lt;/string&gt; &lt;string&gt;MyAuth2.OnAuthorization&lt;/string&gt; &lt;string&gt;MyAuth1.OnAuthorizationAsync&lt;/string&gt; &lt;string&gt;MyAuth1.OnAuthorization&lt;/string&gt; &lt;string&gt;MyAction1.OnActionExecutingAsync&lt;/string&gt; &lt;string&gt;MyAction1.OnActionExecuting&lt;/string&gt; &lt;string&gt;MyAction2.OnActionExecutingAsync&lt;/string&gt; &lt;string&gt;MyAction2.OnActionExecuting&lt;/string&gt; &lt;string&gt;MyAction2.OnActionExecutedAsync&lt;/string&gt; &lt;string&gt;MyAction2.OnActionExecuted&lt;/string&gt; &lt;string&gt;MyAction1.OnActionExecutedAsync&lt;/string&gt; &lt;string&gt;MyAction1.OnActionExecuted&lt;/string&gt; &lt;string&gt;MyException1.OnException&lt;/string&gt;&lt;/ArrayOfstring&gt; å°±åŸ·è¡Œé †åºçš„é€™éƒ¨åˆ†, ç¸½çµä¾†èªª AuthorizationFilterAttribute å…ˆæ–¼ ActionFilterAttribute åŸ·è¡Œ (å¾žæµç¨‹åœ–ä¸Šä¾†çœ‹åˆç†). å¤šå€‹åŒç¨®é¡žçš„ FilterAttribute å¯¦ä½œ, æœƒä¾ç…§å¥—ç”¨çš„é †åºåŸ·è¡Œ, ä½† OnActionExecuted èˆ‡ OnActionExecutedAsync æ˜¯ååº (å¾žæµç¨‹åœ–ä¸Šä¾†çœ‹ä¹Ÿåˆç†, å› ç‚º OnActionExecuted ç³»åˆ—æ–¹æ³•æ˜¯åœ¨ Action åŸ·è¡Œå¾Œè¦ response æ™‚æ‰åŸ·è¡Œ). å¦‚æžœæœ‰ä¾‹å¤–ç™¼ç”Ÿçš„è©±, ExceptionFilterAttribute æœƒåœ¨æœ€å¾Œæ‰åŸ·è¡Œ. ä¸€å€‹ FilterAttribute å…§éƒ¨çš„æ–¹æ³•åŸ·è¡Œé †åºçœ‹èµ·ä¾†æ˜¯éžåŒæ­¥æ–¹æ³•å…ˆæ–¼åŒæ­¥æ–¹æ³•. å–®ä¸€æ¸¬è©¦å°±ä¸‹çµè«–å…¶å¯¦ä¸ç©©å¦¥, æ‰€ä»¥æˆ‘å¾Œä¾†åˆåšäº†å¹¾æ¬¡ä¸ä¸€æ¨£çš„æŽ’åºå¯¦é©—, çœ‹èµ·ä¾†çµæžœæ˜¯ç¬¦åˆæŽ¨æ¸¬çš„, ä½†ç„¡æ³•å®Œå…¨ä¿è­‰. æœ‰äº›ç‰¹æ€§å¯èƒ½æœƒéš¨è‘—ç‰ˆæœ¬çš„è®Šé·æ”¹è®Š, å¦‚æžœå¯¦éš›å°ˆæ¡ˆè¦ç”¨, åˆçœŸçš„å¾ˆåœ¨æ„é€™äº›é †åºæˆ–å…¶ä»–ç´°ç¯€çš„è©±, é‚„æ˜¯è¦å†å°±å¯¦éš›ç‹€æ³æ¸¬è©¦ä¸€è¼ª. çµè«–æƒ³åƒä¸€ä¸‹, ç•¶æœ‰ä¸€å¤©åœ˜éšŠè¦å°Žå…¥ log æ”¶é›†èˆ‡åˆ†æžå·¥å…·, éœ€è¦çµ±ä¸€ log çš„æ ¼å¼æ™‚, å¦‚æžœç•¶åˆæœ‰ç”¨ FilterAtrribute ä¾†å°é€šç”¨è¨Šæ¯å°±å¯ä»¥çœä¸‹éžå¸¸å¤šç‘£ç¢Žçš„å·¥, è€Œä¾‹å¤–è™•ç†ä¹Ÿæ˜¯åŒç†, ä¸”èƒ½é¿å…åˆ°è™•éƒ½æ˜¯ç‚ºäº†æŠ“ unhandled exception è€Œå¯«çš„ try-catch èªžå¥. åƒè€ƒHow to disable a global filter in ASP.Net MVC selectivelyASP.NET Web API Exception FilterExclude A FilterThe ASP.NET Web API 2 HTTP Message Lifecycle in 43 Easy StepsASP.NET WEB API 2: HTTP MESSAGE LIFECYLE]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å®‰å…¨çš„ä½¿ç”¨éžè¿´]]></title>
    <url>%2Fcontent%2F20180915-use-recursive-safety.html</url>
    <content type="text"><![CDATA[éžè¿´æœ‰ä¸€å€‹å¾ˆå¤§çš„å¥½è™•æ˜¯èƒ½ç”¨éžå¸¸ç°¡çŸ­çš„ç¨‹å¼ç¢¼é”åˆ°ç›¸å°è¤‡é›œå¾ˆå¤šçš„åŠŸèƒ½, ä¸€èˆ¬ä¾†èªªå¯è®€æ€§é«˜å¾ˆå¤š, ä½†ä¹Ÿä¼´éš¨è‘—ä¸€äº›å•é¡Œ, ä¾‹å¦‚ä¸æ…Žå¼•ç™¼å †ç–Šæº¢ä½(stack overflow), é€™ç¯‡ä¸»è¦æ˜¯è¦ç´€éŒ„æ€Žéº¼å®‰å…¨çš„ä½¿ç”¨éžè¿´. å †ç–Šæº¢ä½.NET ä¸­çš„ StackOverflowException æœ‰å…©ç¨®è§¸ç™¼æƒ…å¢ƒ, ä¸€ç¨®æ˜¯åœ¨ç¨‹å¼ç¢¼ä¸­åˆ»æ„æ‹‹å‡ºçš„, åƒé€™æ¨£: throw new StackOverflowException(), é€™å’Œä¸€èˆ¬çš„ä¾‹å¤–æ²’ä»€éº¼å·®åˆ¥, åªè¦æœ‰ catch åˆ°å°±å¯ä»¥åšå¾ŒçºŒè™•ç†, ä½†å¦ä¸€ç¨®çœŸçš„å› ç‚ºå †ç–Šæº¢ä½æ‰€å¼•ç™¼çš„ä¾‹å¤–, æ ¹æ“š MSDN çš„èªªæ˜Žæ˜¯ç„¡æ³•è¢« catch çš„, ä¸”ç¶“éŽå¯¦æ¸¬ç™¼ç¾å•é¡Œç™¼ç”Ÿæ™‚, ç¨‹åºæœƒç›´æŽ¥è¢«çµ‚æ­¢.å †ç–Šæº¢ä½é€™å€‹å•é¡Œé€šå¸¸æ˜¯ç”±ç„¡é™éžè¿´æ‰€å¼•ç™¼çš„, å¦‚æžœåœ¨ production ç’°å¢ƒç™¼ç”Ÿé€™å€‹éŒ¯èª¤, é€ æˆæœå‹™ç›´åœæ“º, é‚£çœŸçš„æœƒå¾ˆæ‚²åŠ‡. å…¶å¯¦å°± MSDN çœ‹ä¾†, ä¼¼ä¹Žæœ‰å…¶ä»–æ–¹å¼å¯ä»¥è®“ç³»çµ±ä¸è¦å› ç‚ºå †ç–Šæº¢ä½è€Œåœæ“º, ä½†å¤ªæ·±å¥§äº†çœ‹ä¸æ‡‚, å¦ä¸€æ–¹é¢ä¾†èªª, æœƒå‡ºç¾é€™å€‹å•é¡Œå¤§å¤šæ˜¯å› ç‚º bug, æ‰€ä»¥ç›®å‰ä¸æ‰“ç®—æ·±å…¥åŽ»çœ‹é€™ä¸€å¡Š. é˜²æ­¢å †ç–Šæº¢ä½æŽ§åˆ¶éžè¿´æ·±åº¦ç›®å‰çœ‹åˆ°æœ€ç°¡æ˜Žçš„æ–¹æ³•æ˜¯åˆ©ç”¨ä¸€å€‹åƒæ•¸åŽ»ç´€éŒ„ç›®å‰å †ç–Šçš„æ·±åº¦, ä¸¦åœ¨è¶…éŽè¨­å®šçš„æœ€é«˜æ·±åº¦æ™‚çµ‚æ­¢éžè¿´(æˆ–åšå…¶ä»–ç›¸æ‡‰çš„è™•ç†).12345678910111213public void Foo(int depth = 0)&#123; if (depth &gt; 9) &#123; return; &#125; // do something... Foo(++depth); // do something...&#125; åšå¥½å–®å…ƒæ¸¬è©¦å³ä½¿æœ‰æŽ§åˆ¶éžè¿´æ·±åº¦, ä½†é‚„æ˜¯æœ‰å¯èƒ½æœƒæŠŠæŽ§åˆ¶æ·±åº¦çš„åœ°æ–¹å¯«éŒ¯, æ‰€ä»¥å–®å…ƒæ¸¬è©¦é‚„æ˜¯å¯«å®Œæ•´é»žæ‰èƒ½å¤šä¸€å±¤ä¿éšœ. çµè«–é›–ç„¶ç„¡é™éžè¿´å¼•ç™¼çš„å•é¡Œæ¯”è¼ƒåš´é‡, ä½†åªè¦åšå¥½æŽ§åˆ¶èˆ‡æ¸¬è©¦, å…¶å¯¦éžè¿´é‚„æ˜¯å¾ˆå¥½ç”¨çš„, æ¯”è¼ƒéœ€è¦åœ¨æ„çš„åœ°æ–¹åè€Œæ˜¯å› ç‚ºéžè¿´ç›¸å°æŠ½è±¡ä¸€é»ž, å¦‚æžœéžè¿´å¯«å¾—å¤ªè¤‡é›œçš„è©±, å¾Œäººæœƒæ¯”è¼ƒé›£ç¶­è­·. åƒè€ƒMSDN: Troubleshooting Exceptions: System.StackOverflowExceptionWhatâ€™s a good general way of catching a StackOverflow exception in C#? - æœ€ä½³è§£ä¸‹é¢çš„æŽ¨æ–‡éƒ¨åˆ†æœ‰æåˆ°çœ‹ä¼¼æœ‰æ–¹æ³•è™•ç†å †ç–Šæº¢ä½, ä½†æœ‰é»žçŸ¯æž‰éŽæ­£ (a bit overkill)]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# çš„è‡ªå‹•å¯¦ä½œå±¬æ€§]]></title>
    <url>%2Fcontent%2F20180909-auto-implemented-properties.html</url>
    <content type="text"><![CDATA[è‡ªå‹•å¯¦ä½œå±¬æ€§(auto implemented properties)æ˜¯ C# éžå¸¸åŸºæœ¬çš„è¦æ ¼, é›–ç„¶ä»–è·Ÿ æ¬„ä½(fileds) ä½¿ç”¨ä¸Šéžå¸¸ç›¸ä¼¼, ä½†æœ¬è³ªä¸Šæ˜¯ä¸ä¸€æ¨£çš„æ±è¥¿.é€™ç¯‡ä¸»è¦æ˜¯ç´€éŒ„ä¸€äº›ç¶²è·¯ä¸Šçš„æ¯”è¼ƒè³‡è¨Šä»¥åŠè‡ªå·±å¥½å¥‡ä¸‹åšçš„ä¸€å€‹å°å¯¦é©—, æ²’ä»€éº¼å¤ªç‰¹åˆ¥çš„å…§å®¹. æ¬„ä½, å±¬æ€§èˆ‡è‡ªå‹•å¯¦ä½œå±¬æ€§å…ˆä¾†çœ‹çœ‹å®˜æ–¹å°æ–¼æ¬„ä½(fileds), å±¬æ€§(properties)èˆ‡è‡ªå‹•å¯¦ä½œå±¬æ€§(auto implemented properties)çš„ä»‹ç´¹, é€™éƒ¨åˆ†çš„ä»‹ç´¹èˆ‡æ¯”è¼ƒç¶²è·¯è³‡æ–™å¤šåˆ°çœ‹ä¸å®Œ, æˆ‘å°±æ‡¶å¾—å†å¤šæ•´ç†ä¸€æ¬¡äº†. å»ºè­°: private æ™‚ä½¿ç”¨æ¬„ä½, é™¤æ­¤ä¹‹å¤–ä½¿ç”¨è‡ªå‹•å¯¦ä½œå±¬æ€§. å¦‚æžœéœ€è¦å°æ¬„ä½é€²è¡Œè‡ªå‹•å¯¦ä½œå±¬æ€§çš„é è¨­è¡Œç‚ºä»¥å¤–çš„æ“ä½œæ™‚, ä½¿ç”¨å±¬æ€§. è‡ªå‹•å¯¦ä½œå±¬æ€§ç·¨è­¯å¾Œè®Šä»€éº¼?æ ¹æ“šå®˜æ–¹èˆ‡å¤§é‡ç¶²è·¯è³‡æ–™çš„èªªæ³•, è‡ªå‹•å¯¦ä½œå±¬æ€§ç·¨è­¯å¾Œæœƒç”¢ç”Ÿå…©å€‹å­˜(set)å–(get)ç”¨çš„æ–¹æ³•å’Œä¸€å€‹æ¬„ä½(backing field), æ˜¨å¤©å‰›å¥½å¥½å¥‡æƒ³èªªèƒ½ä¸èƒ½çŸ¥é“é€™å…©å€‹æ–¹æ³•å’Œæ¬„ä½ç©¶ç«Ÿé•·ä»€éº¼æ¨£å­.æ–¼æ˜¯åŸºæ–¼å¥½å¥‡, å°±åˆ©ç”¨åå°„çš„æ–¹å¼åœ¨ç›£çœ‹å¼(Watch)ä¸­åŽ»æŒ–è£¡é¢çš„å…§å®¹, æžœç„¶æ‰¾åˆ°ä¸€äº›æœ‰ç”¨çš„æ±è¥¿, æ•´ç†å¾Œå¦‚ä¸‹:123456789101112131415161718192021public class MyClass&#123; public string MyProperty &#123; get; set; &#125;&#125;static void Main(string[] args)&#123; var property = typeof(MyClass).GetProperty("MyProperty"); var runtimeField = typeof(MyClass).GetRuntimeFields().First(); // method name for get: get_MyProperty Console.WriteLine("method name for get: " + property.GetMethod.Name); //method name for set: set_MyProperty Console.WriteLine("method name for set: " + property.SetMethod.Name); // name for backing filed: &lt;MyProperty&gt;k__BackingField Console.WriteLine("name for backing filed: " + runtimeField.Name); Console.ReadLine();&#125; æ—¢ç„¶ç·¨è­¯å¾Œæœƒç”¢ç”Ÿé€™æ¨£çš„å…©å€‹æ–¹æ³•, é‚£å¦‚æžœæˆ‘åœ¨ class è£¡é¢åˆ»æ„åŠ ä¸Šé€™å…©å€‹æ–¹æ³•çš„è©±æœƒå¦‚ä½•å‘¢?12345678910111213public class MyClass&#123; public string MyProperty &#123; get; set; &#125; public string get_MyProperty() &#123; return null; &#125; public void set_MyProperty(string val) &#123; &#125;&#125; æžœç„¶, ç·¨è­¯ä¸æœƒéŽ, å‡ºç¾é€™æ¨£çš„éŒ¯èª¤ æœ¬ä¾†é‚„æƒ³è©¦è©¦çœ‹èƒ½ä¸èƒ½å¼„å‡ºè·Ÿ backing field è¡çªçš„æ¬„ä½, ä¸éŽå¤±æ•—äº†. å…¶å¯¦é€™å€‹å¯¦é©—å°æ–¼å¯¦ä½œä¸Šæ²’ä»€éº¼æ˜Žé¡¯çš„å¹«åŠ©, ä¸éŽæœ‰æ™‚å€™ç¨å¾®è¿½æ ¹ç©¶åº•ä¸€ä¸‹ä¹Ÿæ˜¯æœ‰è¶£. çµè«–å…¶å¯¦æ¬„ä½, å±¬æ€§èˆ‡è‡ªå‹•å¯¦ä½œå±¬æ€§çš„ä½¿ç”¨æ™‚æ©Ÿé‚„æ»¿æ˜Žç¢ºçš„, ä»¥å¾€ä½¿ç”¨ä¸Šä¹Ÿæ²’æœ‰ç‰¹åˆ¥é›£ä»¥æŠ‰æ“‡çš„æƒ…å¢ƒå‡ºç¾, ä¸éŽçœŸçš„è¦å›žç­” â€œç‚ºä»€éº¼é€™æ¨£ç”¨?â€ æ™‚, é‚„çœŸå›žç­”ä¸å‡ºä¾†, ç„¶å¾Œé€™é‚Šé †ä¾¿æ”¾ä¸€ä¸‹ç¶²è·¯ä¸Šå°æ–¼é€™éƒ¨åˆ†çš„æ–‡ç«  C# in Depth - Why Properties Matter ä½¿ç”¨ å±¬æ€§(Property) çš„å¥½è™• Difference between Auto - Implemented Properties and normal public member variables Is it bad practice to use public fields? Automated property with getter only, can be set, why?]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç°¡åŒ– if æ¢ä»¶å¼]]></title>
    <url>%2Fcontent%2F20180819-simplify-if-statement.html</url>
    <content type="text"><![CDATA[if æ¢ä»¶å¼å¾ˆå¸¸ç”¨, ä½†åœ¨æœ‰æ™‚å› ç‚ºä½¿ç”¨ä¸ç•¶é€ æˆé–±è®€æˆ–ç¶­è­·ä¸Šçš„å›°é›£, å°¤å…¶æ˜¯å·¢ç‹€çš„ if-else æ¢ä»¶å¼å°ç¶­è­·ä¸Šé€ æˆå¾ˆå¤§çš„è² æ“”, é€™å…¶å¯¦æ˜¯æœ‰ä¸€äº›å°æŠ€å·§å¯ä»¥ç°¡åŒ– if æ¢ä»¶å¼çš„, ç•¶ç„¶, é€™äº›æŠ€å·§ä¸æ˜¯è¬éˆä¸¹, ä½¿ç”¨ä¸Šé‚„æ˜¯æœ‰äº›ç´°ç¯€è¦æ³¨æ„çš„. ä¸€èˆ¬ if æ¢ä»¶å¼ä¸€èˆ¬çš„ if æ¢ä»¶å¼å…¶å¯¦æ²’ä»€éº¼å¥½ç°¡åŒ–çš„, ä½†å¦‚æžœä¹‹å¾Œçš„è™•ç†é‚è¼¯å¾ˆç°¡å–®æˆ–æ»¿è¶³ç‰¹å®šæƒ…å¢ƒçš„è©±, é‚„æ˜¯æœ‰ç°¡åŒ–çš„ç©ºé–“. ä¸‰å…ƒé‹ç®—å­ ?:å…ˆé™„ä¸Šå®˜æ–¹æ–‡ä»¶. ä¸‰å…ƒé‹ç®—å­æ˜¯åŸºæœ¬è¦æ ¼ä¹Ÿæ²’å•¥å¥½èªªçš„, ä½†å¦‚æžœç”¨ä¸å¥½åè€Œæœƒé™ä½Žå¯è®€æ€§. 1234567891011121314151617181920212223// string s;// if(isTure)// &#123;// s = "Empty"// &#125;// else// &#123;// s = foo;// &#125;string s = isTrue ? "Empty" : foo;// string s2;// if(isTure)// &#123;// s2 = GetTheString();// &#125;// else// &#123;// s2 = GetAnotherString();// &#125;string s2 = isTure ? GetTheString() : GetAnotherString(); å»ºè­°: ä¸€èˆ¬åªæœ‰ä¸€è¡Œæ–‡çš„æƒ…å¢ƒä¸‹æ‰é©ç”¨. ç”¨äº†ä»–ä¹‹å¾Œæœƒæ¯”åŽŸæœ¬çš„ if-else æ˜“è®€å°±ç”¨. ä¸Šä¾‹ä¸­ç¬¬äºŒç¨®åˆ†ä¸‰è¡Œçš„åšæ³•è¦è¦–æƒ…å¢ƒæ–Ÿé…Œä¸€ä¸‹, ä¸ä¸€å®šé©åˆ. é¿å…: ä½¿ç”¨å…©å±¤(æˆ–è¶…éŽ)çš„ä¸‰å…ƒé‹ç®—å­, å› ç‚ºå¯è®€æ€§å¾ˆå·®. Null æ¢ä»¶é‹ç®—å­ ?., ?[] èˆ‡ ??å…ˆé™„ä¸Š?., ?[] çš„å®˜æ–¹æ–‡ä»¶ ä»¥åŠ ?? çš„å®˜æ–¹æ–‡ä»¶, å…¶ä¸­ ?. å’Œ ?[] æ˜¯ C# 6.0 ä¹‹å¾Œçš„è¦æ ¼. ä¸»è¦ç”¨é€”æ˜¯æ¸›å°‘ç©ºå€¼åˆ¤æ–·çš„ç¨‹å¼ç¢¼, è®“ç¶­è­·æ™‚æ›´èƒ½å°ˆæ³¨æ–¼å•†æ¥­é‚è¼¯ä¸Š.12345678910111213141516171819202122232425262728293031323334353637383940414243// string s;// if(value == null)// &#123;// s = "Empty";// &#125;// else// s = value;// &#123;// &#125;string s = value ?? "Empty";// string s2;// if(obj == null)// &#123;// s2 = null;// &#125;// else// &#123;// s2 = obj.Property;// &#125;string s2 = obj?.Property;// string s3;// if(obj == null)// &#123;// s3 = "Empty";// &#125;// else// &#123;// s3 = obj.Property;// &#125;string s3 = obj?.Property ?? "Empty";// string s4;// if(objectWithIndexer == null)// &#123;// s4 = null;// &#125;// else// &#123;// s4 = objectWithIndexer["key"];// &#125;string s4 = objectWithIndexer?["key"]; å»ºè­°: å¾ˆå¥½ç”¨, å¯ä»¥ç›¡é‡ç”¨. å·¢ç‹€ if æ¢ä»¶å¼ç›¸ä¿¡ç¶­è­·éŽæœ‰æ­·å²åŒ…è¢±çš„ç³»çµ±çš„å·¥ç¨‹å¸«å¤šå°‘éƒ½è¦‹éŽå·¢ç‹€çš„ if æ¢ä»¶å¼, ç”šè‡³æ˜¯å·¢ç‹€çš„ if, else if, else å †ç–Šèµ·ä¾†çš„ç¨‹å¼ç¢¼ç‰‡æ®µ, é€™æ¨£çš„ç¨‹å¼ç¢¼å¸¸å¸¸çœ‹åˆ°å¾Œé¢å¿˜äº†å‰é¢, è¦èŠ±å¾ˆå¤šæ™‚é–“ç”šè‡³ç•«å‡ºæµç¨‹åœ–æ‰èƒ½ç†è§£è¤‡é›œçš„é‚è¼¯. åˆä½µåˆ¤æ–·æ¢ä»¶ä¸‹é¢çš„ç¨‹å¼ç¢¼æ˜¯æœ€å–®ç´”çš„æƒ…å¢ƒ, é€™é¡žåž‹çš„å·¢ç‹€ if æ¢ä»¶å¼å¯ä»¥å¾ˆè¼•æ˜“çš„åˆä½µ. 123456789101112131415// if(a)// &#123;// if(b)// &#123;// if(c)// &#123;// //Do something...// &#125;// &#125;// &#125;bool isTrue = (a &amp;&amp; b &amp;&amp; c);if(isTrue)&#123; //Do something...&#125; å»ºè­°: å¯¦éš›æƒ…æ³ç•¶ç„¶ä¸æœƒé€™éº¼å–®ç´”, å¦‚æžœåƒé›œ else if æˆ– else çš„æ™‚å€™å°±å¾ˆå®¹æ˜“å‡ºéŒ¯, å…ˆå¯«å¥½å–®å…ƒæ¸¬è©¦å†ä¾†åˆä½µæ¢ä»¶å¼æœƒæ¯”è¼ƒå¥½. ææ—©è¿”å›ž(return)ææ—©è¿”å›žæ˜¯ä¸€å€‹æˆ‘å¾ˆå–œæ­¡ç”¨çš„ä½œæ³•, ä½†ç”¨ä¸å¥½çš„è©±å¯è®€æ€§é‚„æ˜¯ä¸æœƒå¤ªå¥½. 1234567891011121314151617181920212223242526// if(a)// &#123;// // Do somthing...// &#125;// else if(b)// &#123;// // Do somthing...// &#125;// else// &#123;// // Do somthing// &#125;if(a)&#123; // Do somthing... return;&#125;if(b)&#123; // Do somthing... return;&#125;// Do somthing...return; å»ºè­°: ææ—©è¿”å›žçš„è¡Œç‚ºç›¡å¯èƒ½é›†ä¸­åœ¨æ–¹æ³•çš„æœ€å‰é¢, æˆ–åªé›†ä¸­åœ¨åŒä¸€å€‹å€å¡Š, é€™æ¨£çš„æ€è·¯å°±å–®ç´”æ˜¯åœ¨æŸäº›æƒ…å¢ƒä¸‹ææ—©è¿”å›ž, å¦å‰‡å¾€ç¹¼çºŒåŸ·è¡Œ. ææ—©è¿”å›žå‰è¦ç¢ºèªæ¢ä»¶å¼çµæŸå¾Œæ²’æœ‰å…¶ä»–é‚è¼¯. é¿å…: åœ¨ä¸€å€‹æ–¹æ³•ä¸­å¤šæ¬¡ä¸”åˆ†æ•£çš„ææ—©è¿”å›ž, é€™æ¨£ç¶­è­·æ™‚éœ€è¦ä¸€ç›´æ³¨æ„å“ªäº›åœ°æ–¹æœ‰ææ—©è¿”å›ž, åè€Œåˆ†æ•£æ³¨æ„åŠ›äº†. ä¾è·è²¬æ‹†åˆ†å‡ºä¸åŒæ–¹æ³•å¦‚æžœå‰é¢çš„æ–¹æ³•éƒ½åšäº†, ä¹Ÿé¿é–‹äº†èª¤ç”¨çš„æƒ…å¢ƒ, ä½†é‚„æ˜¯å­˜åœ¨å·¢ç‹€çš„ if æ¢ä»¶å¼æ™‚, å°±è¦è€ƒæ…®é€™å€‹æ–¹æ³•æ˜¯å¦é•åäº†å–®ä¸€è·è²¬åŽŸå‰‡(Single Responsibility Principle, SRP), ä¸¦è€ƒæ…®å°‡æŸäº›æƒ…å¢ƒé‡æ§‹æˆç¨ç«‹çš„æ–¹æ³•. çµè«–å…¶å¯¦é€™äº›åšæ³•ä¹Ÿä¸æ˜¯ä»€éº¼ç¥žå¥‡çš„æŠ€å·§, ä½†æ²’äººæé†’æˆ–æ˜¯æ²’åœ¨å°ˆæ¡ˆä¸­è¦‹éŽçš„è©±å°±å¾ˆé›£æ„è­˜åˆ°, æˆ‘å‰›å…¥è¡Œæ™‚ä¹Ÿæ˜¯å¸¸å¸¸å¼„å‡ºå·¢ç‹€çš„ if æ¢ä»¶å¼, è¦ºå¾—å°å¾Œé¢æŽ¥æ‰‹çš„äººæœ‰é»žæŠ±æ­‰XD åƒè€ƒå®˜æ–¹æ–‡ä»¶]]></content>
      <categories>
        <category>C#</category>
        <category>Clean Code</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è²¬ä»»éˆæ¨¡å¼(Chain of Responsibility)çš„è®Šå½¢]]></title>
    <url>%2Fcontent%2F20180618-chain-of-responsibility-like.html</url>
    <content type="text"><![CDATA[è²¬ä»»éˆæ¨¡å¼åœ¨æ•™ç§‘æ›¸ä¸Šçš„å…¸åž‹ç¯„ä¾‹æ˜¯ç”¨åœ¨ç°½æ ¸æµç¨‹ä¸Š, ä¹Ÿå°±æ˜¯ä¸€å€‹ä»»å‹™/è³‡æ–™æœƒä¾åºæµéŽå„å€‹è™•ç†ç¯€é»ž, æ¯å€‹ç¯€é»žæœƒåˆ¤æ–·ä»»å‹™/è³‡æ–™æ˜¯ä¸æ˜¯åœ¨è‡ªå·±çš„æ¬Šè²¬ç¯„åœå…§, æ±ºå®šè¦è‡ªå·±è™•ç†é‚„æ˜¯ç¹¼çºŒå¾€ä¸‹æ‹‹. å‰é™£å­å…¬å¸å°ˆæ¡ˆå‰›å¥½æœ‰ä¸€å€‹é¡žä¼¼æƒ…å¢ƒ, ä½†éœ€æ±‚èˆ‡æ•™ç§‘æ›¸ç”¨æ³•ä¸åŒ, ç¬¬ä¸€æ™‚é–“æƒ³åˆ°ä¸€å€‹è®Šå½¢çš„ä½œæ³•, è€Œå…¬å¸å¤§ç¥žä¹Ÿæä¾›äº†å¦ä¸€å€‹æ›´ç°¡æ½”çš„åšæ³•, è¶é‚„æ²’å¿˜æ•´ç†ä¸€ä¸‹è¨˜ä¸‹ä¾†. å®Œæ•´çš„ç¤ºç¯„å°ˆæ¡ˆå’Œæ–‡ä»¶ æƒ…å¢ƒæ˜¯é€™æ¨£çš„, æœ‰ä¸€ç³»åˆ—çš„äº¤æ˜“é©—è­‰æ©Ÿåˆ¶, åœ¨å¾ˆå¤šåœ°æ–¹éƒ½æœƒè¢«ç”¨åˆ°, è¦å‰‡æ˜¯å…ˆæª¢æŸ¥A, è‹¥Aé€šéŽå†æª¢æŸ¥B, è‹¥Bé€šéŽå†æª¢æŸ¥Câ€¦ä¾æ­¤é¡žæŽ¨, ç›´è¦ºå‘¼å«å„å€‹æª¢æŸ¥é»žçš„è©±, ç¨‹å¼ç¢¼æœƒé¡¯å¾—æœ‰é»žè¤‡é›œ. å¾žå±¤å±¤ä¸Šå ±è®Šæˆç”Ÿç”¢ç·šæ”¹é€ ä¸€ä¸‹è²¬ä»»éˆ, æŠŠè¡Œç‚ºè®Šæˆè®“ä¸€å€‹ä»»å‹™/è³‡æ–™æœƒä¾åºæµéŽå„å€‹è™•ç†ç¯€é»ž, å„ç¯€é»žè™•ç†è‡ªå·±è©²åšçš„éƒ¨åˆ†, æ²’å•é¡Œå†å¾€ä¸‹æ‹‹, å¦‚ä¸‹é¢ç¯„ä¾‹: å¾…é©—è­‰å…§å®¹12345678public class ValidateContext&#123; public decimal Amount &#123; get; set; &#125; public string Email &#123; get; set; &#125; public string Country &#123; get; set; &#125;&#125; å„å€‹é©—è­‰ç¯€é»ž : æ¯å€‹é©—è­‰é»žéƒ½ç¹¼æ‰¿è‡ª Validator.123456789101112131415161718192021222324252627282930313233343536373839404142434445public abstract class Validator&#123; public Validator NextValidator &#123; get; set; &#125; public abstract bool Validate(ValidateContext context);&#125;public class AmountValidator : Validator&#123; public override bool Validate(ValidateContext context) &#123; if (context.Amount &gt; 10 &amp;&amp; context.Amount &lt; 1000) &#123; return NextValidator?.Validate(context) ?? true; &#125; return false; &#125;&#125;public class EmailValidator : Validator&#123; public override bool Validate(ValidateContext context) &#123; if (context.Email == "ron.sun@mailserver.com") &#123; return NextValidator?.Validate(context) ?? true; &#125; return false; &#125;&#125;public class CountryValidator : Validator&#123; public override bool Validate(ValidateContext context) &#123; if (context.Country == "Taiwan") &#123; return NextValidator?.Validate(context) ?? true; &#125; return false; &#125;&#125; é©—è­‰æµç¨‹ç®¡ç†è€… : é€™é‚Šæœ‰äº›æ•™å­¸æœƒæŠŠä»–ç›´æŽ¥æ”¾åœ¨å‘¼å«ç«¯, ä½†å¦‚æžœè¦é‡ç”¨çš„è©±, é‚„æ˜¯æ‹‰å‡ºä¾†æ¯”è¼ƒé©åˆ.1234567891011121314151617181920212223242526public class ValidatorManager&#123; public bool BasicValidation(ValidateContext context) &#123; var amountValidator = new AmountValidator(); var emailValidator = new EmailValidator(); Validator rootValidator = amountValidator; amountValidator.NextValidator = emailValidator; return rootValidator.Validate(context); &#125; public bool FullValidation(ValidateContext context) &#123; var amountValidator = new AmountValidator(); var emailValidator = new EmailValidator(); var countryValidator = new CountryValidator(); Validator rootValidator = amountValidator; amountValidator.NextValidator = emailValidator; emailValidator.NextValidator = countryValidator; return rootValidator.Validate(context); &#125;&#125; å‘¼å«ç«¯123456789101112static void Main(string[] args)&#123; var mng = new ValidatorManager(); var context = new ValidateContext() &#123; Amount = 100&#125;; bool isValid = mng.Validate(context); if (isValid) &#123; Console.WriteLine("pass validations."); &#125; Console.ReadLine();&#125; è¦–æƒ…å¢ƒé‚„æ˜¯å¯ä»¥å†è®ŠåŒ–, ä¾‹å¦‚: é©—è­‰ä¸é€šéŽæ™‚ä¸ä¸­æ–·, ä¸€å®šè¦è·‘å®Œæ‰€æœ‰é©—è­‰æ‰è¿”å›žçµæžœèˆ‡éŒ¯èª¤è¨Šæ¯ç¸½çµ, é‚£å°±æ˜¯æŠŠè¿”å›žå¾ž bool æ”¹æˆä¸€å€‹ç‰©ä»¶, è®“æ¯å€‹é©—è­‰ç¯€é»žåŽ»æ“ä½œè¿”å›žç‰©ä»¶. List å’Œ Func æ­é…è¿´åœˆå§”æ´¾, é›†åˆèˆ‡è¿´åœˆçš„æ­é…, å¯ä»¥è®“ä¸€é€£ä¸²çš„æ–¹æ³•å‘¼å«è®Šå¾—æ›´ç°¡æ½”, ä¹Ÿæœ‰ä¸€é»žè²¬ä»»éˆçš„å‘³é“åœ¨è£¡é¢ , ç¯„ä¾‹å¦‚ä¸‹: é©—è­‰æ–¹æ³•1234567891011121314151617public class Validator&#123; public bool AmountValidate(decimal amount) &#123; return amount &gt; 10 &amp;&amp; amount &lt; 1000; &#125; public bool EmailValidate(string email) &#123; return email == "ron.sun@mailserver.com"; &#125; public bool CountryValidate(string country) &#123; return country == "Taiwan"; &#125;&#125; å‘¼å«ç«¯12345678910111213141516171819static void Main(string[] args)&#123; var context = new ValidateContext() &#123; Amount = 100 &#125;; var validator = new Validator(); var validateList = new List&lt;Func&lt;bool&gt;&gt;() &#123; () =&gt; validator.AmountValidate(100), () =&gt; validator.EmailValidate("name@mail.com"), () =&gt; validator.CountryValidate("Taiwan") &#125;; foreach(var item in validateList) &#123; var isValid = item(); if (!isValid) break; &#125; Console.ReadLine();&#125; é€™ç¨®åšæ³•è®“é›†åˆå…§çš„ Func&lt;&gt;, Action&lt;&gt; ç­‰å§”æ´¾æ–¹æ³•èƒ½ä¾åºè¢«è™•ç†, ä¸”é€™äº›æ–¹æ³•å¯ä»¥åˆ†åˆ¥åœ¨ä¸åŒçš„é¡žåˆ¥è£¡, ä¹Ÿä¸ç”¨åƒä¸€èˆ¬è²¬ä»»éˆå¿…é ˆè¡ç”Ÿè‡ªçˆ¶é¡žåˆ¥, å”¯ä¸€çš„é™åˆ¶å°±æ˜¯ Func&lt;&gt;, Action&lt;&gt; çš„åž‹åˆ¥åƒæ•¸å¿…é ˆå®Œå…¨ç›¸åŒ. çµè«–è²¬ä»»éˆçš„åŸºæœ¬æ¨£è²Œå°±åƒä¸€æ¢ç”Ÿç”¢ç·š, åŸºæ–¼é€™å€‹åŽŸå‰‡ä¸‹è¡ç”Ÿçš„è®Šå½¢æˆ–ç°¡åŒ–åšæ³•å…¶å¯¦é‚„ä¸å°‘, æˆ‘æŠŠä»–å€‘ç¨å¾®æ•´ç†åœ¨é€™å€‹å°ˆæ¡ˆè£¡.]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç”¨ C# è™•ç† query string]]></title>
    <url>%2Fcontent%2F20180608-handle-querystring-in-csharp.html</url>
    <content type="text"><![CDATA[åœ¨ç¶²é é–‹ç™¼ä¸Š, è™•ç† query stirng æ˜¯éžå¸¸å¸¸è¦‹çš„æƒ…å¢ƒ, è¦æ‰‹å‹•æ‹†çµ„ query string ä¹Ÿä¸é›£, æˆ–æ˜¯ä½¿ç”¨ .NET æœ¬èº«å°±æä¾›çš„ç›¸é—œåŠŸèƒ½è®“é€™ä»¶äº‹æ›´è¼•é¬†, è€Œå…©ç¨®åšæ³•å„æœ‰å„ªç¼ºé»ž. æ‰‹å‹•æ‹†çµ„æœ€ç›´è¦ºçš„æ–¹æ³•å°±æ˜¯æ‰‹å‹•æ‹†çµ„å­—ä¸², ä¾‹å¦‚: 1234567891011121314151617181920212223242526static void HandleQueryString()&#123; // æ‰‹å‹•æ‹† query string var queryString = "?q1=v1&amp;q2=v2&amp;q3=v3"; if (queryString.StartsWith("?")) &#123; queryString = queryString.Remove(0, 1); &#125; var splitedQueryString = queryString .Split('&amp;') .ToDictionary(r =&gt; r.Split('=')[0], v =&gt; v.Split('=')[1]); // æ‰‹å‹•çµ„ query string var queryDic = new Dictionary&lt;string, string&gt;() &#123; ["q1"] = "v1", ["q2"] = "v2", ["q3"] = "v3" &#125;; var formatedQueryString = queryDic .Select(r =&gt; $"&#123;r.Key&#125;=&#123;r.Value&#125;") .Aggregate((left, right) =&gt; $"&#123;left&#125;&amp;&#123;right&#125;");&#125; æ‰‹å‹•æ‹†çµ„ query string å¸¸å¸¸é‚„è¦è€ƒæ…®æ‹¿åˆ°çš„ query string å‰é¢æœ‰æ²’æœ‰å¤šå¸¶å•è™Ÿ, å¸¸ç”¨çš„è©±é‚„è¦å¦å¤–æŠ½å‡ºä¾†ç•¶å…±ç”¨æ–¹æ³•, æ¯”è¼ƒéº»ç…©ä½†ç›¸å°çš„å¾ˆç›´è¦º, ä¸”æ¯”è¼ƒä¸æœƒé‡åˆ°ç·¨ç¢¼å•é¡Œ. HttpUtility.ParseQueryStringå¦‚æžœä¸æƒ³æ‰‹å‹•æ‹†çµ„å­—ä¸²çš„è©±, å¯ä»¥ç”¨ HttpUtility.ParseQueryString() ä¾†è™•ç† query string, ä¾‹å¦‚: 123456789101112131415static void HandleQueryStringEasier()&#123; // æ‹† query string var queryString = "?q1=v1&amp;q2=v2&amp;q3=v3"; var splitedQueryString = HttpUtility.ParseQueryString(queryString); // çµ„ query string var query = HttpUtility.ParseQueryString(string.Empty); query["q1"] = "v1"; query["q2"] = "v2"; query["q3"] = "v3"; var formatedQueryString = query.ToString();&#125; é€™æ¨£åšè¼•é¬†å¾ˆå¤š, ä½†å¦‚æžœ query string è£¡é¢æœ‰ä¸­æ–‡å­—æˆ–ç‰¹æ®Šç¬¦è™Ÿçš„æ™‚å€™å®¹æ˜“è¡ç”Ÿå‡ºç·¨ç¢¼ç›¸é—œçš„å•é¡Œ, é¡žä¼¼çš„ç·¨ç¢¼è½‰æ›å•é¡Œåœ¨ HttpRequest.QueryString çš„è‡ªå‹• UrlDecode å•é¡Œ é€™ç¯‡ä¹Ÿæœ‰æåˆ°. çµè«–å…©ç¨®åšæ³•éƒ½å„æœ‰å„ªç¼º, å¯¦å‹™ä¸Šæ€Žéº¼åšé‚„æ˜¯å¾—è¦–æƒ…æ³æ±ºå®š, ä¸€èˆ¬ä¾†èªªæˆ‘é‚„æ˜¯æœƒå„ªå…ˆé¸æ“‡ HttpUtility.ParseQueryString, å¦‚æžœæœ‰ç„¡æ³•è§£æ±ºçš„ç·¨ç¢¼å•é¡Œå†è€ƒæ…®æ‰‹å‹•æ‹†çµ„.]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[const å’Œ readonly ç‰¹æ€§èˆ‡ä½¿ç”¨æ™‚æ©Ÿ]]></title>
    <url>%2Fcontent%2F20180519-const-vs-readonly.html</url>
    <content type="text"><![CDATA[åœ¨C#ä¸­ const å’Œ readonly éƒ½å¯ä»¥è¢«ç•¶ä½œå¸¸æ•¸ä¾†ä½¿ç”¨, ä½†å…©è€…åœ¨ç‰¹æ€§ä¸Šæœ‰è¨±å¤šçš„å·®ç•°, ä½¿ç”¨ä¸Šä¹Ÿæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹. constèªªæ˜Žconst åˆç¨±â€ç·¨è­¯æ™‚æœŸå¸¸æ•¸â€, å¯¦éš›å€¼åœ¨ç·¨è­¯æœŸé–“å°±æœƒè¢«å–ä»£åˆ°ä½¿ç”¨å¸¸æ•¸çš„å„å€‹åœ°æ–¹, æ‰€ä»¥ç›¸å°çš„é™åˆ¶æ¯”è¼ƒå¤š, ä¸‹é¢åªåˆ—èˆ‰ä¸€éƒ¨åˆ† const çš„é‡è¦ç‰¹æ€§, å®Œæ•´ç‰¹æ€§å¯åƒç…§ C# è¦æ ¼æ›¸(5.0ç‰ˆ ç« ç¯€10.4). å¸¸æ•¸è¢«è¦–ç‚ºéœæ…‹æˆå“¡, å‘¼å«æ–¹æ³•æ˜¯ MyClass.MY_CONST. å¸¸æ•¸å®£å‘Šä¸­çš„åž‹åˆ¥åªèƒ½æ˜¯ sbyte, byte, short, ushort, int, uint, long, ulong, char, float, double, decimal, bool, string, enum, æˆ– reference type. å¾ˆç¥žå¥‡çš„ä¸€é»žæ˜¯, å¸¸æ•¸çš„åž‹åˆ¥å¯ä»¥æ˜¯ reference type, ä½†æ˜¯åªèƒ½è³¦å€¼ null, ä¾‹å¦‚:public const MyClass MY_COSNT = null;stackoverflowä¸Šæœ‰äººè¨Žè«–éŽé€™å€‹ç‰¹æ€§çš„ç”¨æ³• (ä¸éŽæˆ‘ç›®å‰å¤§æ¦‚é‚„ä¸æœƒé€™æ¨£ç”¨å®ƒ) ä½¿ç”¨æ™‚æ©Ÿå¸¸æ•¸çš„æŽ¨è–¦ç”¨æ³•èˆ‡æ™‚æ©Ÿ é€™å€‹å€¼æ˜¯ä¸èƒ½åœ¨åŸ·è¡Œæ™‚æœŸè®Šå‹•çš„ å­˜å–ä¿®é£¾å­ä¸å»ºè­°ç”¨ public, å› ç‚ºåŸºæ–¼é€™å€‹æƒ…å¢ƒ, const ä¸é©åˆè·¨çµ„ä»¶å¼•ç”¨. readonlyèªªæ˜Žreadonly æ˜¯ç”¨åœ¨å”¯è®€æ¬„ä½ä¸Š, é™åˆ¶é€™å€‹æ¬„ä½åªèƒ½åœ¨å»ºæ§‹å­æˆ–éœæ…‹å»ºæ§‹å­ä¸­è¢«ä¿®æ”¹, ä½œç‚ºå¸¸æ•¸ä½¿ç”¨æ™‚åˆç¨±ç‚ºåŸ·è¡Œæ™‚æœŸå¸¸æ•¸, åŸ·è¡Œçš„æ™‚å€™å†åŽ»åƒè€ƒè®Šæ•¸å–å¾—çœŸæ­£çš„å€¼. ä½¿ç”¨æ™‚æ©Ÿå”¯è®€æ¬„ä½çš„æŽ¨è–¦ç”¨æ³•èˆ‡ä½¿ç”¨æ™‚æ©Ÿ åˆå§‹åŒ–å¾Œå°±ä¸èƒ½å†è¢«è®Šå‹• ä¸é©åˆæˆ–ç„¡æ³•ç”¨ const çš„æ™‚å€™ å”¯è®€æ¬„ä½çš„å€¼å¯ä»¥åœ¨å»ºæ§‹å­ä¸­è¢«æ”¹è®Šä¹Ÿè®“ä¸€äº›äººè¦ºå¾—ä»–ä¸æ˜¯é‚£éº¼å”¯è®€, ä¾‹å¦‚ä¸‹é¢çš„ç¨‹å¼ç¢¼:12345678910public static class C1&#123; public readonly static string str = &quot;a&quot;; static C1() &#123; str = &quot;b&quot;; str = &quot;c&quot;; &#125;&#125; å”¯è®€æ¬„ä½strè¢«è³¦å€¼â€aâ€ä¹‹å¾Œåˆåœ¨å»ºæ§‹å­ä¸­è¢«æ”¹è®Šäº†å…©æ¬¡å€¼. åå¥½ä½¿ç”¨ readonly è€Œéž constè€ƒæ…®ä¸€å€‹æƒ…å¢ƒ, ç¾åœ¨æœ‰ä¸€å€‹é¡žåˆ¥åº« DefaultLib, è£¡é¢æœ‰ä¸€å€‹é¡žåˆ¥ DefaultClass å¦‚ä¸‹:12345public class DefaultClass&#123; public const int AGE = 18; public readonly string NAME = "John";&#125; å¦ä¸€å€‹å°ˆæ¡ˆ Execute åƒè€ƒé€™å€‹é¡žåˆ¥åº«, ä¸¦å°å‡º AGE å’Œ NAME å¦‚ä¸‹:12345678910class Program&#123; static void Main(string[] args) &#123; Console.WriteLine(DefaultClass.AGE); Console.WriteLine(new DefaultClass().NAME); Console.Read(); &#125;&#125; åŸ·è¡Œå¾Œæ²’å•é¡Œ, å°å‡ºäº† 18 å’Œ John . æŽ¥ä¸‹ä¾†, æ”¹æˆ AGE = 20, NAME = &quot;Smith&quot; å¾Œåªç·¨è­¯ DefaultLib å°ˆæ¡ˆ, ä¸¦å°‡ DefaultLib.dll è¦†è“‹æŽ‰èˆŠçš„ dll å¾Œç›´æŽ¥åŸ·è¡Œ Execute.exe. çµæžœå°å‡ºäº† 18 å’Œ Smith é€™å…¶å¯¦å°±æ˜¯ä¸€é–‹å§‹èªªçš„ const ä½œç‚ºç·¨è­¯æ™‚æœŸå¸¸æ•¸, å¯¦éš›å€¼åœ¨ç·¨è­¯æœŸé–“å°±æœƒè¢«å–ä»£åˆ°ä½¿ç”¨å¸¸æ•¸çš„åœ°æ–¹, ä½† readonly æ˜¯åƒè€ƒè®Šæ•¸å–å¾—çœŸæ­£çš„å€¼, æ‰€ä»¥ Execute é€™å€‹å°ˆæ¡ˆç·¨è­¯å¾Œå°å‡º AGE èˆ‡ NAME çš„é‚£å…©è¡Œ, å…¶å¯¦æ˜¯12Console.WriteLine(18);Console.WriteLine(new DefaultClass().NAME); æ–¼æ˜¯, ä¸ç®¡åƒè€ƒçš„ DefaultLib.dll æ€Žéº¼è®ŠåŒ–, åªè¦ Execute å°ˆæ¡ˆä¸é‡æ–°ç·¨è­¯, ç¬¬ä¸€è¡Œå°çš„æ°¸é æ˜¯ 18 ,ä½†ä½¿ç”¨ readonly å°±ä¸æœƒæœ‰é€™å€‹å•é¡Œ. çµè«–é€™ç¯‡ä¸»è¦çš„é‡é»žæ˜¯åå¥½ä½¿ç”¨ readonly è€Œéž constè€Œå·², é€™ä¹Ÿä¸æ˜¯ä»€éº¼é®®ç‚ºäººçŸ¥çš„ç§˜å¯†, ç›¸é—œçš„æ–‡ç« googleä¸€ä¸‹å°±å¾ˆå¤šäº†, è€Œä¸”éƒ½å¯«å¾—æ›´å¥½, æœƒç‰¹åˆ¥å¯«ä¸€ç¯‡åªæ˜¯æƒ³æ•´ç†ä¸€ä¸‹å­¸ç¿’æˆæžœ, é‚„æ„å¤–ç™¼ç¾äº† const å¯ä»¥æ˜¯ reference type çš„ç¥žå¥‡ç‰¹æ€§. åƒè€ƒC#èªžè¨€è¦æ ¼æ›¸C# - const vs static readonlyWhy are we allowed to use const with reference types if we may only assign null to them?]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ¶ˆé™¤switch-case]]></title>
    <url>%2Fcontent%2F20180412-anti-switch-case.html</url>
    <content type="text"><![CDATA[Switch-case æ˜¯ä¸€å€‹ç¶“å¸¸è¢«ä½¿ç”¨åˆ°çš„èªžå¥, ä½†ç•¶æ¢ä»¶/æƒ…å¢ƒéŽå¤šçš„æ™‚å€™, ä»–æœƒè®Šå¾—å¾ˆè‚¥å¤§, æŸç¨®ç¨‹åº¦ä¸Šé€ æˆç¶­è­·ä¸Šçš„å›°æ“¾, ç¶²è·¯ä¸Šä¹Ÿæœ‰ä¸å°‘äººæå‡ºé‡å°éŽå¤§çš„ switch-case èªžå¥çš„é‡æ§‹æŠ€å·§, ä¾‹å¦‚: ç­–ç•¥æ¨¡å¼.ä½†æ˜¯ç­–ç•¥æ¨¡å¼æœƒé•·å‡ºå¾ˆå¤šæ–°çš„é¡žåˆ¥, å¦‚æžœæ¯å€‹ case çš„å¯¦ä½œå…§å®¹éƒ½å¾ˆå°, é€™æ¨£åšä¼¼ä¹Žæ˜¯æœ‰é»žè¤‡é›œäº†, æ‰€ä»¥é€™é‚Šæä¾›å…¶ä»–çš„æ›¿ä»£æ–¹æ¡ˆ(ä½†æœƒæœ‰ä¸€äº›é™åˆ¶). switch-caseçš„å•é¡Œå…ˆçœ‹ä¸€æ®µç¨‹å¼ç¢¼12345678910111213141516171819202122232425public string Convert(StringConverter converter, string input)&#123; switch (converter) &#123; case StringConverter.Rule1: return DoByRule1(input); break; case StringConverter.Rule2: return DoByRule2(input); break; case StringConverter.Rule3: return DoByRule3(input); //ä»¥ä¸‹çœç•¥100ç¨® default: return string.Empty; break; &#125;&#125;public void Main()&#123; // ... string result = Convert(StringConverter.Rule1, "this is input"); // ...&#125; ä¸Šé¢çš„ç¨‹å¼ç¢¼æ˜¯ç¶“éŽæœ€åˆæ­¥æ•´ç†çš„æ¨£å­, è‡³å°‘æ¯å€‹caseéƒ½æå–å‡ºä¸€å€‹æ–¹æ³•, ä½†æ˜¯å¦‚æžœæƒ…å¢ƒæŒçºŒå¢žåŠ , é€™å€‹switch-caseèªžå¥ä»ç„¶æœƒç¹¼çºŒæˆé•·ä¸‹åŽ», ä¼¼ä¹Žé‚„èƒ½åšä¸€äº›æ”¹å–„. ç”¨ Dictionary æ­é… Func æˆ– Action è§£æ±ºå¾žåŽŸæœ¬çš„ switch-case å¯ä»¥çœ‹å‡ºåŠŸèƒ½å…¶å¯¦å¾ˆå–®ç´”, å›ºå®šå‚³å…¥ä¸€å€‹å­—ä¸², ç¶“éŽæŸç¨®æ¼”ç®—éŽç¨‹, å›žå‚³å¦å¤–ä¸€å€‹å­—ä¸², åªä¸éŽæ ¹æ“šåˆ—èˆ‰(enum)çš„ä¸åŒ, è¦åšçš„äº‹ä¹Ÿä¸åŒ, é€™ç¨®æƒ…å¢ƒå°±å¾ˆé©åˆç”¨ Dictionary&lt;TKey, Func&lt;&gt;&gt; ä¾†è™•ç†. 12345678910111213141516private Dictionary&lt;StringConverter, Func&lt;string, string&gt;&gt; allRules = new Dictionary&lt;StringConverter, Func&lt;string, string&gt;&gt;() &#123; [StringConverter.Rule1] = (input) =&gt; &#123; return DoByRule1(input); &#125;, [StringConverter.Rule2] = (input) =&gt; &#123; return DoByRule2(input); &#125;, [StringConverter.Rule3] = (input) =&gt; &#123; return DoByRule3(input); &#125; //ä»¥ä¸‹çœç•¥100ç¨® &#125;;public void Main()&#123; // ... var rule = allRules[StringConverter.Rule1]; string result = rule("this is input"); // ...&#125; ç¶“éŽæ•´ç†å¾Œ, æˆ‘å€‘å°‡åˆ—èˆ‰èˆ‡è¡Œç‚ºçš„é…å°æŠ½å‡ºä¾†æˆç‚ºä¸€å€‹ Dictionary&lt;StringConverter, Func&lt;string, string&gt;&gt;, å¯è®€æ€§æé«˜äº†ä¸å°‘(å°¤å…¶ case å¾ˆå¤šçš„æ™‚å€™æœƒæ›´æ˜Žé¡¯).ä½†æ˜¯é€™ç¨®æ–¹å¼æ˜¯æœ‰ä¸€äº›é™åˆ¶çš„, æ‰€æœ‰æƒ…å¢ƒå¿…é ˆæœ‰ç›¸åŒçš„åƒæ•¸èˆ‡å›žå‚³åž‹åˆ¥, æ‰èƒ½æŠŠä»–å€‘å…¨éƒ¨æ”¾åˆ°ä¸€å€‹ Dictionary ä¸­, å¦‚æžœä¸å¹¸çš„æ‰€äº›æƒ…å¢ƒåƒæ•¸æˆ–å›žå‚³åž‹åˆ¥ä¸åŒ, é‚£å°±è¦è€ƒæ…®æ˜¯å¦å¦å¤–å°è£å…±ç”¨çš„ç‰©ä»¶ä½œç‚ºåƒæ•¸èˆ‡å›žå‚³åž‹åˆ¥, æ­¤èˆ‰æ˜¯æœ‰å‰¯ä½œç”¨çš„(å…±ç”¨çš„åƒæ•¸èˆ‡å›žå‚³åž‹åˆ¥ä¸­çš„æˆå“¡æ˜¯æ‰€æœ‰æƒ…å¢ƒçš„è¯é›†, å¯èƒ½æœƒå¾ˆå¤šæˆ–å¾ˆäº‚), å› æ­¤ä¹Ÿæ‡‰è©²è€ƒæ…®é€™æ¨£åšçš„æ•ˆç›Šæ˜¯å¦å¤§æ–¼å‰¯ä½œç”¨. æ­é… Action æ¦‚å¿µè·Ÿä¸Šä¸€å€‹ä¾‹å­ä¸€æ¨£, ä¸éŽæ˜¯ç”¨ç„¡åƒæ•¸çš„ Action. çµè«–æŠ€å·§è·Ÿæ‰‹æ³•æœ‰å¥½è™•å°±æœ‰å‰¯ä½œç”¨, æ‰€ä»¥ä¸æ˜¯æ‰€æœ‰ switch-case çš„æƒ…å¢ƒéƒ½é©åˆé€™æ¨£è™•ç†, æœ‰äº›æƒ…å¢ƒå¯èƒ½ç¶­æŒåŽŸæœ¬çš„ switch-case æœƒæ›´å¥½. é¡žä¼¼çš„æŠ€å·§é‚„æœ‰ç”¨ List&lt;Func&lt;&gt;&gt; æ­é… foreach, å¯ç”¨ä¾†é”æˆä¾åºåŸ·è¡Œä¸€ç³»åˆ—çš„è¡Œç‚ºçš„ç›®çš„, ä¹Ÿæ˜¯å¾ˆä¸éŒ¯ åƒè€ƒAbolishing Switch-Case Statement and Pattern Matching in C# 7.0]]></content>
      <categories>
        <category>C#</category>
        <category>Clean Code</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# ä¿®é£¾è©ž - partial]]></title>
    <url>%2Fcontent%2F20180409-usage-of-partial-in-csharp.html</url>
    <content type="text"><![CDATA[C# çš„ partial ä¿®é£¾è©žæ˜¯ç›¸å°å°‘ç”¨çš„ç‰¹æ€§, ä½†åœ¨æŸäº›æ™‚å€™èƒ½èµ·åˆ°å¾ˆé—œéµçš„ä½œç”¨, æ‰€ä»¥é‚„æ˜¯çŸ¥é“ä¸€ä¸‹æ¯”è¼ƒå¥½.partialä¸æ˜¯é—œéµå­—ä½†æ˜¯ä»–å¯ä»¥æ”¾åœ¨åœ¨class, struct, interface ä»¥åŠ void method(â€¦) çš„å‰é¢ä½œç‚ºä¿®é£¾è©ž, ä¸¦å°‡é¡žåž‹å®£å‘Šæˆ–æ–¹æ³•æ‹†åˆ†æˆå¤šå€‹, è€Œç·¨è­¯æ™‚æœƒå°‡æ‰€æœ‰å€æ®µçµåˆèµ·ä¾†, æ‰€ä»¥å°åŸ·è¡Œæ™‚æœŸæ²’æœ‰å½±éŸ¿. ç”¨æ³•éƒ¨åˆ†é¡žåˆ¥(partial class)ä»¥éƒ¨åˆ†é¡žåˆ¥ç‚ºä¾‹, æˆ‘å€‘å¯ä»¥å°‡ä¸€å€‹é¡žåˆ¥æ‹†æˆå¤šå€‹éƒ¨åˆ†é¡žåˆ¥ä¸¦ä¸”åˆ†åˆ¥æ”¾åœ¨ä¸åŒçš„å¤šå€‹æª”æ¡ˆä¸­, å¦‚ä¸‹: OrderService.cs1234public partial class OrderService&#123; // something...&#125; OrderService2.cs1234public partial class OrderService&#123; // something...&#125; ä»¥ç›®å‰æ‰€çŸ¥patialçš„ç”¨é€”å°æ–¼ interface, struct éƒ½ç›¸ä¼¼æ–¼ class éƒ¨åˆ†æ–¹æ³•(partial method)æ–¹æ³•å®£å‘Šåœ¨å…¶ä¸­ä¸€å€‹éƒ¨åˆ†é¡žåˆ¥ä¸­, ä¸¦åœ¨å¦å¤–å…¶ä¸­ä¸€å€‹éƒ¨åˆ†é¡žåˆ¥ä¸­å¯¦ä½œå·²å®£å‘Šçš„éƒ¨åˆ†æ–¹æ³•. OrderService.cs12345public partial class OrderService&#123; //å®£å‘Š partial void CreateOrder();&#125; OrderService2.cs12345678public partial class OrderService&#123; //å¯¦ä½œ partial void CreateOrder() &#123; // ... &#125;&#125; ç”¨é€”é‚£éº¼, ä»€éº¼æƒ…å¢ƒéœ€è¦ç‰¹æ„å°‡ç›¸åŒé¡žåˆ¥æ‹†åˆ†åˆ°ä¸åŒæª”æ¡ˆä¸­å‘¢? ä¸‹é¢ä¾ç„¶ä»¥éƒ¨åˆ†é¡žåˆ¥ç‚ºå‡ºç™¼é»žèªªæ˜Ž. éƒ¨åˆ†æ–¹æ³•çš„æƒ…å¢ƒç›®å‰é‚„æ²’é‡éŽ, æš«æ™‚æƒ³ä¸åˆ°ç¯„ä¾‹ æ“´å……ç”±å·¥å…·ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼å·¥å…·ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼åŽŸå‰‡ä¸Šæ˜¯ä¸å…è¨±äººç‚ºåŽ»ç›´æŽ¥ä¿®æ”¹å…§å®¹çš„, å› ç‚ºç•¶ä¸‹æ¬¡é‡æ–°ç”¢ç”Ÿçš„æ™‚å€™, æœƒå°‡ä¿®æ”¹çš„éƒ¨åˆ†ä¹Ÿè¦†è“‹æŽ‰, æ‰€ä»¥æˆ‘å€‘æœƒé€éŽ partial å°‡å·¥å…·ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼èˆ‡äººç‚ºæ“´å……çš„ç¨‹å¼ç¢¼åˆ†é–‹.é€™æ–¹é¢çš„æ‡‰ç”¨å¸¸è¦‹çš„æ˜¯åœ¨æ“´å…… EF(Entify Framework) è‡ªå‹•ç”¢ç”Ÿçš„ Models ä¸Š, EFç”¢ç”Ÿçš„ Models æ˜¯åŸºæ–¼è³‡æ–™åº«çš„æ¬„ä½çš„è¨­è¨ˆçš„, æœ‰æ™‚å€™æˆ‘å€‘éœ€è¦åŠ ä¸Šä¸€äº›æ¬„ä½æ–¹ä¾¿ä½¿ç”¨æ™‚å°±èƒ½æ´¾ä¸Šç”¨å ´, ä¾‹å¦‚: Member.cs (å·¥å…·ç”¢ç”Ÿ)123456public partial class Member&#123; public string FirstName &#123; get; set; &#125; public string LasName &#123; get; set; &#125;&#125; MemberExtend.cs (äººç‚ºæ“´å……)12345678910public partial class Member&#123; public string FullName &#123; get &#123; return $"&#123;FirstName&#125; &#123;LasName&#125;"; &#125; &#125;&#125; ä¸Šé¢çš„ä¾‹å­ä¸­, EFåœ¨æ›´æ–°Modelsæ™‚åªæœƒè¦†è“‹ Member.cs, å°æ–¼æ“´å……éƒ¨åˆ†å¯ä»¥ä¸ç”¨æ“”å¿ƒè¢«å½±éŸ¿. é¡žåˆ¥éŽå¤§ä¸”é›£ä»¥åˆ†å‰²æœ‰äº›é¡žåˆ¥æœ¬èº«åŒ…å«å¤§é‡çš„å…§å®¹, ä¸”å› ç‚ºç¨®ç¨®å› ç´ é›£ä»¥æ‹†åˆ†æ™‚, å°±å¯ä»¥åˆ©ç”¨partialä¸¦å°‡å…¶æ‹†åˆ†æˆä¸åŒæª”æ¡ˆ. å¦‚æžœå¯ä»¥çš„è©±é‚„æ˜¯é‡æ§‹å‡ºæ›´å°çš„å–®å…ƒ, åˆ†æˆå¤šå€‹éƒ¨åˆ†é¡žåž‹ä¸æ˜¯å„ªå…ˆé¸é …. é‡æ§‹å–®ä¸€é¡žåˆ¥æ™‚é€™æ˜¯é‹ç”¨åœ¨ä¹‹å‰å…¬å¸çš„å°ˆæ¡ˆä¸Šçš„, ç•¶æ™‚å› ç‚ºé¡žåˆ¥ä¸­çš„ç¨‹å¼ç¢¼éŽå¤šä¸”è¤‡é›œ, ç„¡æ³•ä¸€æ¬¡é‡æ§‹å®Œ, åˆæ“”å¿ƒç•¶ä¸‹åªé‡æ§‹ä¸€éƒ¨åˆ†æœƒè®“ä¹‹å¾Œè¦ç¹¼çºŒæ™‚éœ€è¦é‡æ–°èŠ±æ™‚é–“å†çœ‹éŽä¸€é, å°±å°‡é‡æ§‹å¾Œçš„ç¨‹å¼ç¢¼æ‹†æˆå¦ä¸€å€‹æª”æ¡ˆ, ç­‰ä¹‹å¾Œå…¨éƒ¨æ•´ç†å®Œå†åˆä½µæˆä¸€å€‹. é™åˆ¶ç”±æ–¼éƒ¨åˆ†é¡žåž‹ç·¨è­¯å¾Œæœƒè¢«è¦–ç‚ºä¸€å€‹é¡žåž‹, å…¶é™åˆ¶çš„å¤§åŽŸå‰‡æ˜¯ä¸èƒ½èˆ‡é€™å€‹ç‰¹æ€§çŸ›ç›¾, é€™é‚Šå¤§è‡´åˆ—å‡ºä¸€äº›. éƒ¨åˆ†æ–¹æ³• å›žå‚³å¿…é ˆç‚º void, ä¸” partial ä¸€å®šè¦æ”¾åœ¨ void å‰é¢ ä¸å¯æ˜Žç¢ºæŒ‡å®šå­˜å–ä¿®é£¾è©ž, éš±å«ç‚º private ä¸€å€‹æ–¹æ³•æœ€å¤šåªèƒ½åœ¨æ‰€æœ‰éƒ¨åˆ†é¡žåˆ¥ä¸­å®£å‘Šä¸€æ¬¡ æœ€å¤šåªèƒ½æœ‰ä¸€å€‹ä»¥ä¸‹çš„å¯¦ä½œ å¯ä»¥å®£å‘Šå¾Œä¸å¯¦ä½œ, ä½†ä¸èƒ½æœ‰å¯¦ä½œæ²’å®£å‘Š åƒæ•¸ä¸å¯æœ‰ out ä¿®é£¾è©ž ç„¡æ³•æ˜Žç¢ºå¯¦ä½œä»‹é¢æ–¹æ³• å…¶é¤˜æ—ç¹ä¸åŠå‚™è¼‰, æ›´å¤šç´°ç¯€åƒé–± C# è¦æ ¼æ›¸æˆ– MSDN å…¶ä»–éƒ¨åˆ†é¡žåž‹æ‰€æœ‰éƒ¨åˆ†é¡žåž‹çš„ å­˜å–ä¿®é£¾è©žä¸å¯è¡çª(ä½†å¯ä»¥åªæœ‰ä¸€å€‹éƒ¨åˆ†é¡žåž‹æ˜Žç¢ºæŒ‡å®šä¿®é£¾è©ž) æ³›åž‹åƒæ•¸çš„æ•¸é‡ã€é †åºèˆ‡åç¨±å¿…é ˆå®Œå…¨ä¸€è‡´ æ³›åž‹åƒæ•¸çš„æ¢ä»¶ç´„æŸä¸å¯è¡çª(å¯ä»¥åªæœ‰ä¸€å€‹éƒ¨åˆ†é¡žåž‹æ˜Žç¢ºæŒ‡å®šæ¢ä»¶ç´„æŸ) æ›´å¤šç´°ç¯€åƒé–± C# è¦æ ¼æ›¸æˆ– MSDN å®Œæ•´ç‰¹æ€§é—œæ–¼partialä¿®é£¾è©žçš„å®Œæ•´ç‰¹æ€§(éžå¸¸å¤šâ€¦), åƒé–±C#è¦æ ¼æ›¸, ç›¸é—œç›®éŒ„å¦‚ä¸‹(ä¸»è¦åœ¨ç¬¬10ç« çš„å¹¾å€‹å°ç¯€ä¸­, å…¶ä»–ç« å°±åªæ˜¯ç°¡ä»‹ç„¶å¾Œèªªåƒè€ƒç¬¬10ç« ). é¡žåˆ¥10.1.2 Partial ä¿®é£¾è©ž10.2 éƒ¨åˆ†é¡žåž‹10.6.8. éƒ¨åˆ†æ–¹æ³• çµæ§‹11.1.2 partial ä¿®é£¾è©ž ä»‹é¢13.1.2. partial ä¿®é£¾è©ž åƒè€ƒèˆ‡å»¶ä¼¸C#èªžè¨€è¦æ ¼æ›¸MSDNIntroduction to Partial Methods]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
      <tags>
        <tag>partial</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C#ä¸­çš„éš¨æ©Ÿæ•¸]]></title>
    <url>%2Fcontent%2F20180304-random-in-csharp.html</url>
    <content type="text"><![CDATA[å‰äº›æ—¥å­, æ”¶åˆ°ä¸€å€‹å°éœ€æ±‚éœ€è¦éš¨æ©Ÿç”¢ç”Ÿä¸€çµ„å¸¶å¤§å°å¯«å­—æ¯å’Œæ•¸å­—çš„äº‚æ•¸å­—ä¸², æƒ³èªªéœ€æ±‚æ»¿ç°¡å–®çš„, å¿«é€Ÿå¯«ä¸€ä¸‹å°±å¯«å®Œcommitäº†, ç„¶å¾ŒéŽä¸ä¹…å°±çˆ†æŽ‰äº†.ä¾†çœ‹çœ‹ç©¶ç«Ÿå¯«äº†äº›ä»€éº¼é¬¼æ±è¥¿~ 12345678910111213141516public class RandomUtil&#123; private string _charDic = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"; public string RandomString(int length) &#123; Random rdm = new Random(); string result = string.Empty; for (int i = 0; i &lt; length; i++) &#123; int nextIndex = rdm.Next(_charDic.Length); result += _charDic[nextIndex]; &#125; return result; &#125;&#125; ç¨‹å¼å…§å®¹å¾ˆå–®ç´”, å°±æ˜¯ç”¨System.Randoméš¨æ©Ÿç”Ÿå‡ºæŒ‡å®šé•·åº¦çš„å­—ä¸², ä½†å•é¡Œå°±å‡ºåœ¨éœ€è¦éš¨æ©Ÿç”¢ç”Ÿå…©çµ„, æ–¼æ˜¯å‘¼å«ç«¯å°±å‘¼å«äº†å…©æ¬¡, åƒæ˜¯é€™æ¨£: 123var rdm = new RandomUtil();Console.WriteLine(rdm.RandomString(10));Console.WriteLine(rdm.RandomString(10)); ç„¶å¾Œç”¢ç”Ÿçš„å…©å€‹çµæžœå­—ä¸²ä¸€æ¨¡ä¸€æ¨£, Why? åŒæ™‚å»ºç«‹å¤šå€‹RandomRandomçš„ç”¢ç”Ÿæ–¹å¼æ˜¯åŸºæ–¼ä¸€å€‹ç¨®å­ä¾†ç”¢ç”Ÿçš„, ä¹Ÿå°±æ˜¯public Random(int Seed)ä¸­çš„Seed, ä¹Ÿå°±æ˜¯èªªå¦‚æžœç¨®å­ä¸€æ¨£, é‚£å…©å€‹newå‡ºä¾†çš„Randomç‰©ä»¶ç”¢ç”Ÿçš„éš¨æ©Ÿæ•¸æ˜¯ä¸€æ¨¡ä¸€æ¨£çš„, è€Œå¦å¤–ä¸€å€‹ä¸å¸¶åƒæ•¸çš„å»ºæ§‹å­å‘¢?å¾žreferencesource.microsoft.comä¸Šé¢å¯ä»¥æŸ¥åˆ°åŽŸå§‹ç¢¼æ˜¯é€™æ¨£çš„: 1234public Random() : this(Environment.TickCount) &#123;&#125; æ˜¯çš„,é è¨­ä»¥Environment.TickCountåšç‚ºç¨®å­, è€ŒEnvironment.TickCountæ˜¯è¡ç”Ÿè‡ªç³»çµ±è¨ˆæ™‚å™¨çš„ä¸€å€‹å€¼. å› ç‚ºRandom()çš„äº‚æ•¸æ˜¯åŸºæ–¼ç³»çµ±è¨ˆæ™‚å™¨ç”¢ç”Ÿçš„, æ‰€ä»¥å¦‚æžœåœ¨æ¥µçŸ­æ™‚é–“å…§ (Environment.TickCountç›¸åŒ) å»ºç«‹å¤šå€‹Randomå¯¦ä¾‹,å°±æœƒå°Žè‡´ç”¢ç”Ÿçš„äº‚æ•¸æ˜¯ä¸€æ¨£çš„. çŸ¥é“å•é¡Œå¾Œ, è…¦ä¸­é–ƒéŽå…©å€‹åšæ³•: è§£ä¸€: Thread.Sleep()åœ¨new Random()ä¹‹å‰, å…ˆå»¶æ™‚ä¸€æ¯«ç§’, é¿å…æ‹¿åˆ°é‡è¤‡çš„æ™‚é–“, é›–ç„¶ç›´è¦ºä½†æˆ‘å€‹äººä¸å–œæ­¡. è§£äºŒ: å»ºç«‹å”¯ä¸€çš„Random1234567891011121314151617public class RandomUtil&#123; private string _charDic = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"; private Random _rdm = new Random(); public string RandomString(int length) &#123; string result = string.Empty; for (int i = 0; i &lt; length; i++) &#123; int nextIndex = _rdm.Next(_charDic.Length); result += _charDic[nextIndex]; &#125; return result; &#125;&#125; RandomUtilåˆå§‹åŒ–çš„æ™‚å€™å°±å»ºç«‹ä¸€å€‹å”¯ä¸€çš„Randomç‰©ä»¶, é¿å…çŸ­æ™‚é–“å…§é‡è¤‡å»ºç«‹, å‘¼å«ç«¯ç¨‹å¼ç¢¼ä¸è®Š, é€™æ¬¡å…©æ¬¡ç”¢ç”Ÿçš„çµæžœæ˜¯ä¸€æ¨£çš„äº†,å•é¡Œåœ¨å¤§éƒ¨åˆ†çš„æƒ…å¢ƒä¸‹è§£æ±ºäº†. å¤šåŸ·è¡Œç·’ç’°å¢ƒä¸‹çš„Randomè€ƒæ…®åŒæ™‚æœ‰å…©æ¢åŸ·è¡Œç·’éƒ½å»ºç«‹äº†Random, ç°¡å–®æ¯”å°ä¸€ä¸‹çµæžœ: 123456789101112131415161718192021string firstThreadResult = null;var firstThread = new Thread(new ThreadStart(() =&gt;&#123; firstThreadResult = new RandomUtil().RandomString(10);&#125;));string secondThreadResult = null;var secondThread = new Thread(new ThreadStart(() =&gt;&#123; secondThreadResult = new RandomUtil().RandomString(10);&#125;)); firstThread.Start();secondThread.Start();firstThread.Join();secondThread.Join(); var rdm = new RandomUtil();Console.WriteLine(firstThreadResult);Console.WriteLine(secondThreadResult); å¯¦é©—çµæžœé¡¯ç¤º, å…©å€‹ç”¢ç”Ÿçš„å­—ä¸²ä¸€æ¨£, æ‰€ä»¥åœ¨å¤šåŸ·è¡Œç·’çš„æƒ…å¢ƒä¸‹, é‚„æ˜¯æœ‰æ©Ÿæœƒç”¢ç”Ÿé‡è¤‡çš„äº‚æ•¸çµ„åˆ. è§£ä¸‰: RNGCryptoServiceProvider123456789101112131415161718192021public class RandomUtil&#123; private string _charDic = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"; private RNGCryptoServiceProvider _rng = new RNGCryptoServiceProvider(); public string RandomString(int length) &#123; string resultArr = string.Empty; for (int i = 0; i &lt; length; i++) &#123; var nextBytes = new byte[4]; _rng.GetBytes(nextBytes); var index = BitConverter.ToInt32(nextBytes, 0) % _charDic.Length; resultArr += _charDic[index]; &#125; return resultArr; &#125;&#125; RNGCryptoServiceProviderå¯ä»¥é¿å…Randomåœ¨å¤šåŸ·è¡Œç·’æƒ…å¢ƒä¸‹çš„é‡è¤‡å•é¡Œ, ä½†ç¼ºé»žå°±æ˜¯ä»–ä¸åƒRandomæä¾›é‚£éº¼å¤šæ–¹æ³•, æ‰€ä»¥éœ€è¦è‡ªå·±å¯¦ä½œNext(),Next(max),Next(min, max)ç­‰æ–¹æ³•. å¾Œä¾†æˆ‘æŠŠç›¸é—œæ–¹æ³•æ•´ç†é‡æ§‹éŽæ”¾åœ¨æˆ‘çš„ Github ä¸Šäº†, å¯¦ä½œç´°ç¯€æœ‰ä¸å°‘å·®ç•°, ä½†æ¦‚å¿µæ˜¯è·Ÿä¸Šé¢çš„ç¯„ä¾‹ä¸€æ¨£çš„. å»¶ä¼¸ - é—œæ–¼éš¨æ©Ÿæ•¸å¯†ç¢¼å­¸(éš¨æ©Ÿæ•¸ç­†è¨˜) åƒè€ƒRandom numbers - C# in depth]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
      <tags>
        <tag>Random</tag>
        <tag>RNGCryptoServiceProvider</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­£ç¢ºé‡æ‹‹ä¾‹å¤–]]></title>
    <url>%2Fcontent%2F20180131-correctly-re-throw-exception.html</url>
    <content type="text"><![CDATA[é‡æ‹‹ä¾‹å¤–æœ‰å¾ˆå¤šç¨®æ–¹å¼, åŒ…å« throw, throw ex, ä½¿ç”¨ inner exception ä»¥åŠ System.Runtime.ExceptionServices.ExceptionDispatchInfo, æˆ–æ˜¯ä¸è¦é‡æ‹‹ä¾‹å¤–. å…ˆç¸½çµé¸æ“‡å¦‚ä¸‹é †åº: æœ€å¥½ä¸è¦é‡æ‹‹ä¾‹å¤– é‡æ‹‹å„ªå…ˆé¸ System.Runtime.ExceptionServices.ExceptionDispatchInfo æ²’æœ‰æ¡†æž¶æ”¯æ´å‰‡ç”¨ Inner Exception throw æ‡‰è©²æ²’ä»€éº¼æƒ…å¢ƒéœ€è¦ç”¨åˆ°äº† throw ex æ˜¯å…·ç ´å£žæ€§çš„ä½œæ³•, é™¤éžæ˜¯è¦åˆ»æ„ç ´å£žå †ç–Šè¿½è¹¤ é€™ç¯‡æœƒæ•´ç†é€™å¹¾ç¨®æ–¹æ³•çš„ä½¿ç”¨èˆ‡å„ªç¼º, ä¸¦ä¸”å¦å¤–æåˆ° throw å’Œ throw ex å…©ç¨®æ–¹æ³•å°æ–¼å †ç–Šè¿½è¹¤çš„è² é¢å½±éŸ¿. throw &amp; throw exthrow vs throw exé€™å…©å€‹æœ€å¸¸è¦‹ä¹Ÿå¾ˆç›¸ä¼¼, æ‰€ä»¥ä¸€èµ·èªª, ä½¿ç”¨ throw æˆ–æ˜¯ throw ex éƒ½èƒ½é‡æ‹‹ä¾‹å¤–, ä½†ä½¿ç”¨ trow æ™‚æœƒä¿ç•™è¼ƒå®Œæ•´çš„å †ç–Šè¿½è¹¤(stack trace), è€Œ throw ex æœƒé‡ç½®å †ç–Šè¿½è¹¤, é€ æˆè¡Œæ•¸é¡¯ç¤ºåœ¨ throw ex é‚£ä¸€è¡Œã€‚å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯, ç”¨ throw ä¾†é‡æ‹‹ä¾‹å¤–å…¶å¯¦ä¹Ÿæœƒæ¼æŽ‰ä¸€äº›å †ç–Šè¿½è¹¤, é€™æœƒåœ¨ä¸‹é¢å±•ç¤ºã€‚ ä¸‹é¢çš„ç¯„ä¾‹ç¨‹å¼ä¸­ç›´æŽ¥ä½¿ç”¨ throw é‡æ‹‹ä¾‹å¤–, ä¸¦å°å‡ºå †ç–Šè¿½è¹¤å…§å®¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344using System;using System.Collections.Generic;using System.Linq;using System.Text;using System.Threading.Tasks;using System.Security.Cryptography;using System.IO;namespace ronsun.github.io.lab&#123; class Program &#123; static void Main(string[] args) &#123; try &#123; ThrowException(); &#125; catch(Exception ex) &#123; Console.WriteLine("======= ThrowException() ============="); Console.WriteLine(ex); &#125; Console.ReadLine(); &#125; static void ThrowException() &#123; try &#123; ExceptionHere(); &#125; catch(Exception ex) &#123; throw; &#125; &#125; static void ExceptionHere() &#123; throw new Exception("This is exception message."); &#125; &#125;&#125; é‹è¡Œå¾Œå¯ä»¥çœ‹åˆ°å †ç–Šè¿½è¹¤æœ€å¾Œæ˜¯åœåœ¨ ExceptionHere() è£¡é¢(41è¡Œ), ä¹Ÿå°±æ˜¯çœŸæ­£å¼•ç™¼ä¾‹å¤–çš„åœ°æ–¹ é€™é‚Šæœ‰å¦å¤–ä¸€å€‹è¦æ³¨æ„çš„åœ°æ–¹, å †ç–Šè¿½è¹¤çš„ç¬¬äºŒè¡Œæ˜¯åœåœ¨ throw çš„åœ°æ–¹(35è¡Œ), æœ¬ä¾‹çœ‹ä¸å‡ºå¤§çš„å½±éŸ¿æ˜¯å› ç‚ºæœ‰ä¸‹ä¸€å±¤å‘¼å«å¯ä»¥è¿½è¹¤, ä¸‹ä¸€å°ç¯€æœƒç”¨å¦ä¸€æ®µç¨‹å¼ç¢¼å±•ç¤ºé€™å€‹å•é¡Œ. 12345======= ThrowException() =============System.Exception: This is exception message. at ronsun.github.io.lab.Program.ExceptionHere() in C:\Users\Ron\Desktop\MyProjects\ronsun.github.io\ronsun.github.io.lab\Program.cs:line 41 at ronsun.github.io.lab.Program.ThrowException() in C:\Users\Ron\Desktop\MyProjects\ronsun.github.io\ronsun.github.io.lab\Program.cs:line 35 at ronsun.github.io.lab.Program.Main(String[] args) in C:\Users\Ron\Desktop\MyProjects\ronsun.github.io\ronsun.github.io.lab\Program.cs:line 17 ä½†å¦‚æžœåœ¨35è¡Œä½¿ç”¨ throw ex çš„è©±, å †ç–Šè¿½è¹¤æœ€å¾Œå°±æœƒåœåœ¨ ThrowException() é€™è£¡1234======= ThrowException() =============System.Exception: This is exception message. at ronsun.github.io.lab.Program.ThrowException() in C:\Users\Ron\Desktop\MyProjects\ronsun.github.io\ronsun.github.io.lab\Program.cs:line 35 at ronsun.github.io.lab.Program.Main(String[] args) in C:\Users\Ron\Desktop\MyProjects\ronsun.github.io\ronsun.github.io.lab\Program.cs:line 17 throw ä¹Ÿæœƒå½±éŸ¿å †ç–Šè¿½è¹¤çš„å…§å®¹ä»¥ä¸‹é¢çš„ç¨‹å¼ç¢¼ç‰‡æ®µç‚ºä¾‹, é€™æ¬¡ä¸å¦å¤–å‘¼å«ä¸€å€‹å¼•ç™¼ä¾‹å¤–çš„æ–¹æ³•, è€Œæ˜¯ç›´æŽ¥æ‹‹å‡ºä¸€å€‹ä¾‹å¤–12345678910111213141516171819202122232425static void Main(string[] args)&#123; try &#123; ThrowException(); &#125; catch(Exception ex) &#123; Console.WriteLine("======= ThrowException() ============="); Console.WriteLine(ex); &#125; Console.ReadLine();&#125;static void ThrowException()&#123; try &#123; throw new Exception("This is exception message."); &#125; catch(Exception ex) &#123; throw; &#125;&#125; è€Œæ­¤æ™‚çš„å †ç–Šè¿½è¹¤æœ€å¾Œå…¶å¯¦æ˜¯åœåœ¨ throw é‚£ä¸€è¡Œ, ä¹Ÿå°±æ˜¯èªªå¦‚æžœä¾‹å¤–æ˜¯ç™¼ç”Ÿåœ¨ ThrowException æ–¹æ³•ä¸­è€Œä¸æ˜¯ä¸‹ä¸€å±¤çš„å‘¼å«, ä¸” try å€å¡Šä¸­æœ‰å¾ˆå¤šç¨‹å¼ç¢¼çš„æ™‚å€™, é‚„æ˜¯æœƒæœ‰é›£ä»¥é™¤éŒ¯çš„å›°æ“¾. Inner ExceptionåŸºæ–¼å‰é¢çš„èªªæ˜Ž, æˆ‘å€‘çŸ¥é“é‡æ‹‹ä¾‹å¤–æœƒç ´å£žå †ç–Šè¿½è¹¤, æ‰€ä»¥å¦å¤–ä¸€ç¨®åšæ³•æ˜¯åœ¨é‡æ‹‹å‰å°‡åŽŸå§‹çš„ä¾‹å¤–æ”¾é€² Inner Exception ä¸­, å¦‚ä¸‹ç‰‡æ®µ: 123456789try&#123; DoSomething();&#125;catch (Exception ex)&#123; // handle exception, then... throw new Exception("outer", ex);&#125; ä½†é€™æ¨£åšçš„ç¼ºé»žå°±æ˜¯å…¶å¯¦æ˜¯é‡æ–°åŒ…è£äº†ä¾‹å¤–, å¦‚æžœå‘¼å«ç«¯æ²’æœ‰å¾€ä¸‹æŸ¥çœ‹ Inner Exception çš„æ™‚å€™å°±æœƒçœ‹ä¸åˆ°å®Œæ•´çš„ç´°ç¯€, å³ä½¿å‘¼å«ç«¯æœ‰å­˜å– Inner Exception ä¹Ÿæ¯”è¼ƒéº»ç…©, æ˜¯å±¬æ–¼åŠŸèƒ½æ­£å¸¸ä½†ä¸å¤ å„ªé›…çš„æ–¹å¼. System.Runtime.ExceptionServices.ExceptionDispatchInfoé æ¡†æž¶è§£æ±º, æ˜¯ç›®å‰çŸ¥é“çš„æ–¹æ³•ä¸­æœ€æ¼‚äº®çš„ 123456789try&#123; DoSomething();&#125;catch (Exception ex)&#123; // handle exception, then... ExceptionDispatchInfo.Capture(ex).Throw();&#125; ä½¿ç”¨å®¹æ˜“, çœ‹è¼¸å‡ºä¹Ÿæ²’ä»€éº¼å‰¯ä½œç”¨, å”¯ä¸€çš„é™åˆ¶å°±æ˜¯è¦ä¾è³´æ¡†æž¶. ä¸è¦é‡æ‹‹ä¾‹å¤–é€™å€‹æ–¹æ³•å¯«åœ¨å¯«åœ¨é€™è£¡æœ‰é»žå¥‡æ€ª, ä½†å€‹äººä¾†èªªæ˜¯éžå¸¸ä¸å–œæ­¡é‡æ‹‹ä¾‹å¤–çš„, æ¯”è¼ƒå‚¾å‘æŠŠæ‰€æœ‰ä¸éœ€è¦ç‰¹æ®Šè™•ç†çš„ä¾‹å¤–éƒ½è®“å…¨åŸŸä¾‹å¤–è™•ç†æ©Ÿåˆ¶åŽ»è™•ç†, ä¾‹å¦‚: Exception filters. çµè«–é›–ç„¶ç†æƒ³ä¸Šæ˜¯ä¸è¦é‡æ‹‹ä¾‹å¤–, ä½†å¦‚æžœçœŸçš„ä¸å¾—å·²éœ€è¦, å‰‡ä½¿ç”¨ System.Runtime.ExceptionServices.ExceptionDispatchInfo, è¬ä¸€ä½¿ç”¨çš„æ¡†æž¶ä¸æ”¯æ´çš„è©±, é‚£è‡³å°‘è¦ä½¿ç”¨ Inner Exception åŽ»è™•ç†. åƒè€ƒè³‡æ–™Is there a difference between â€œthrowâ€ and â€œthrow exâ€? debuggability problems associated with catch / rethrow â€˜throw e;â€™ vs. â€˜throw;â€™ How to rethrow exception correctly in .Net]]></content>
      <categories>
        <category>C#</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•é¿å…å¤§é‡åƒæ•¸ - ä»¥HttpHelperç‚ºä¾‹]]></title>
    <url>%2Fcontent%2F20171202-httpHelper-with-builder-like.html</url>
    <content type="text"><![CDATA[åœ¨è¨­è¨ˆ API çš„æ™‚å€™, å¸¸å¸¸æœƒè¢«åƒæ•¸éŽå¤šæ‰€å›°æ“¾è‘—, å› ç‚ºç•¶æ–¹æ³•æœ‰è‘—éŽå¤šåƒæ•¸æ™‚, ä½¿ç”¨çš„æ™‚å€™å®¹æ˜“çœ¼èŠ±, è€Œéœ€è¦å¢žæ¸›åƒæ•¸æ™‚ä¹Ÿå¾ˆä¸æ–¹ä¾¿, é€™é‚Šä»¥å¸¸è¦‹çš„ HttpHelper ç‚ºä¾‹ä¾†èªªæ˜Žã€‚ ä¸€èˆ¬ä¾†èªª, å¦‚æžœå°ˆæ¡ˆåªéœ€è¦è·Ÿå…§éƒ¨çš„ API æºé€šçš„è©±, å…¶å¯¦ç”¨ HttpClient ä¾†å¯¦ä½œæ—¢æ–¹ä¾¿åˆå¿«é€Ÿ, ä½†æ˜¯å¤§é‡å¤–éƒ¨å» å•†å°æŽ¥æºé€šçš„æ™‚å€™å¯èƒ½å°±ä¸å¤ªé©åˆ, å› ç‚ºæ¯å®¶å» å•†å°æŽ¥çš„æ–¹å¼éƒ½ä¸ä¸€æ¨£, æ‰€ä»¥ç›®å‰çš„å°ˆæ¡ˆæ˜¯ç”¨ WebRequest ä¾†å¯¦ä½œã€‚ æ“æœ‰å¤§é‡åƒæ•¸çš„æ–¹æ³•1234567891011121314public string Post(string url, string content, Encoding encoding, int contentType, string proxyAddress, string proxyUserName, string proxyPassword)&#123; var request = WebRequest.CreateHttp(url); request.ContentType = contentType; request.Method = WebRequestMethods.Http.Post; var contentBytes = encoding.GetBytes(content); request.ContentLength = contentBytes.Count(); //è¨­å®šproxy //ç™¼é€request, å–å¾—ä¸¦å›žå‚³response&#125; éœ€æ±‚çš„ä¸€é–‹å§‹, åƒæ•¸å¯èƒ½åªæœ‰ url è·Ÿ content, ä½†æ˜¯ç•¶å°æŽ¥å» å•†è¶Šä¾†è¶Šå¤šçš„æ™‚å€™, æœ‰äººè¦æ±‚åªèƒ½ç”¨ç‰¹å®šç·¨ç¢¼(UTF8, GBKâ€¦), è³‡æ–™æ ¼å¼ä¸åŒæ™‚ content type ä¹Ÿè¦ä¸åŒ, å› ç‚ºç¶²è·¯ç’°å¢ƒé™åˆ¶æœ‰æ™‚å€™è¦èµ° proxy ç­‰ç­‰çš„, é€™æ™‚å€™å°±æœƒå‡ºç¾å¤§é‡åƒæ•¸, å¼•ç™¼ä¸€äº›å•é¡Œ: å¢žåŠ åƒæ•¸, é‚£æ‰€æœ‰å‘¼å«ç«¯çš„ç¨‹å¼éƒ½è¦æ”¹, ä¸é›£, ä½†æ˜¯éº»ç…© å‘¼å«ç«¯æ”¹å¥½äº†, ç‚ºäº†é¿å…å¸¶éŒ¯å€¼, æ‰€ä»¥è¦æ¸¬è©¦ä¸€è¼ª, ä¹Ÿä¸é›£, ä½†æ˜¯å¾ˆèŠ±æ™‚é–“ é‚£å°±æœ‰æ”¹å–„çš„ç©ºé–“äº† é¸æ“‡æ€§å¼•æ•¸(Optional Arguments) è¨»: å£èªžä¸Šå¤§å¤šç¨±é¸æ“‡æ€§åƒæ•¸(Optional Parameters), ä¸éŽMSDNæ˜¯ç”¨é¸æ“‡æ€§å¼•æ•¸(Optional Arguments) è¨»: åƒæ•¸å’Œå¼•æ•¸æ„ç¾©ä¸Šæ˜¯ä¸åŒçš„ 123456789101112131415161718public string Post(string url, string content = "", Encoding encoding = null, int contentType = "application/x-www-form-urlencoded", string proxyAddress = "", string proxyUserName = "", string proxyPassword = "")&#123; if(encoding == null) &#123; encoding == Encoding.UTF8; &#125; var request = WebRequest.CreateHttp(url); request.ContentType = contentType; request.Method = WebRequestMethods.Http.Post; var contentBytes = encoding.GetBytes(content); request.ContentLength = contentBytes.Count(); //è¨­å®šproxy //ç™¼é€request, å–å¾—ä¸¦å›žå‚³response&#125; é€™æ¨£ç”¨çš„å¥½è™•æ˜¯, ç•¶éœ€è¦å¢žåŠ éžå¿…è¦åƒæ•¸çš„æ™‚å€™, å¯ä»¥ç›´æŽ¥åŠ åœ¨åƒæ•¸åˆ—æœ€å¾Œé¢, ä¸¦çµ¦ä»–ä¸€å€‹é è¨­å€¼, é‚£è‡³å°‘åŠ åƒæ•¸çš„æ™‚å€™ä¸ç”¨åƒå°‹å¯¶ä¸€æ¨£åˆ°è™•åŽ»æ‰¾å‘¼å«ç«¯ä¿®æ”¹äº†, é™ä½Žäº†æ‰‹èª¤ç”¢ç”Ÿbugçš„é¢¨éšª, ä¹Ÿå¯ä»¥æŠŠæ¸¬è©¦å°ˆæ³¨åœ¨é€™å€‹æ–¹æ³•å…§å°±å¥½ã€‚ ä½†æ˜¯, é‚„æ˜¯æœ‰ç¼ºé»ž: åƒæ•¸åˆ—é‚„æ˜¯è¶…é•· åƒæ•¸é è¨­å€¼åªèƒ½æ˜¯ç·¨è­¯æ™‚æœŸå°±æ±ºå®šå¥½çš„å¸¸æ•¸, æ‰€ä»¥Encodingé€™é¡žåƒæ•¸, å¿…é ˆé è¨­ç‚ºnull, ç„¶å¾Œå¦å¤–åœ¨æ–¹æ³•å…§åˆ¤æ–·è³¦äºˆé è¨­å€¼ æ–°çš„åƒæ•¸å¦‚æžœä¸æ˜¯åŠ åœ¨æœ€å¾Œé¢, åœ¨æŸäº›æƒ…å¢ƒä¸‹æœƒæœ‰å•é¡Œ è¨»:åŸºæ–¼ä»¥ä¸‹æ–¹æ³•, å‘¼å« foo(0, &quot;B&quot;); æ™‚ä»£è¡¨çš„æ˜¯ foo(0, b = &quot;B&quot;)ä½†æ˜¯å¦‚æžœæ’äº†ä¸€å€‹åƒæ•¸åœ¨bä¹‹å‰, è€Œåž‹åˆ¥å’Œbä¸€æ¨£, æ–¹æ³•ç°½ç« è®Šæˆpublic void foo(int a, string c = &quot;&quot;, string b = &quot;&quot;)é€™æ™‚å€™å‘¼å« foo(0, &quot;B&quot;);ä»£è¡¨çš„å°±æœƒæ˜¯foo(0, c = &quot;B&quot;)å› æ­¤é€™é‚Šæœƒå»ºè­°åœ¨å‘¼å«å¸¶æœ‰é¸æ“‡æ€§å¼•æ•¸çš„æ–¹æ³•æ™‚, æŽ¡ç”¨å…·åæ–¹å¼å‘¼å«, é¿å…ä¸Šé¢ç¯„ä¾‹ä¸­çš„èª¤ç”¨ æ‰€ä»¥é‚„æ˜¯æœ‰æ”¹å–„çš„ç©ºé–“ æŠŠæ‰€æœ‰åƒæ•¸åŒ…æˆä¸€å€‹conditionç‰©ä»¶123456789101112131415161718public class Condition&#123; public string Url &#123; get; set; &#125; public string Content &#123; get; set; &#125; public Encoding Cncoding &#123; get; set; &#125; = Encoding.UTF8; public string ContentType &#123; get; set; &#125; = "application/x-www-form-urlencoded"; //å…¶ä»–çœç•¥&#125;public string Post(Condition condition)&#123; //åŸºæ–¼conditionæº–å‚™requestç›¸é—œç‰©ä»¶ //è¨­å®šproxy //ç™¼é€request, å–å¾—ä¸¦å›žå‚³response&#125; å¥½å¤šäº†, é€™æ¬¡çš„æ”¹å–„é¿å…äº†ä¹‹å‰åƒæ•¸éŽé•·, é è¨­å€¼ä¹Ÿä¸å—é™æ–¼å¸¸æ•¸, åŒæ™‚ç•¶éœ€è¦å¢žåŠ éžå¿…å¡«çš„åƒæ•¸æ™‚, åªéœ€è¦ä¿®æ”¹ condition ç‰©ä»¶ä¸¦è¨­å¥½é è¨­å€¼, å‘¼å«ç«¯åŸºæœ¬ä¸Šä¸ç”¨æœ‰ä»»ä½•ä¿®æ”¹ã€‚ ä½†æ˜¯çœŸè¦åœ¨å¹æ¯›æ±‚ç–µçš„è©±, é‚„æ˜¯æœ‰ä¸€å€‹ç¼ºé»ž: APIä½¿ç”¨è€…ç„¡æ³•ä¸€çœ¼çœ‹å‡ºé‚£äº›åƒæ•¸æ˜¯å¿…å¡«. æˆ‘å€‹äººçš„ç¿’æ…£æ˜¯, å¦‚æžœä¸æƒ³è®“ä½¿ç”¨è€…èª¤ç”¨, é‚£å°±å¾žæŠ€è¡“å±¤é¢é˜»æ­¢ä»–, èª˜å°Žä½¿ç”¨è€…æ­£ç¢ºä½¿ç”¨, æ‰€ä»¥æŽ¥ä¸‹ä¾†æŽ¥ä¸‹ä¾† condition ç‰©ä»¶çš„è®Šå½¢ç›´æŽ¥å…ˆä¸Šå®Œæ•´ç‰ˆ, ä¸‹é¢æœƒç´°èªª 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public class Condition&#123; public string Url &#123; get; private set; &#125; public string Content &#123; get; private set; &#125; public Encoding Encoding &#123; get; private set; &#125; = Encoding.UTF8; public string ContentType &#123; get; private set; &#125; = "application/x-www-form-urlencoded"; public IWebProxy Proxy &#123; get; private set; &#125; = null; private Condition() &#123; &#125; public static Condition Create(string url) &#123; var reqParams = new Condition() &#123; Url = url &#125;; return reqParams; &#125; public Condition WithContentType(string contentType) &#123; ContentType = contentType; return this; &#125; public Condition WithContent(string content) &#123; Content = content; return this; &#125; public Condition WithEncoding(Encoding encoding) &#123; Encoding = encoding; return this; &#125; public Condition WithProxy() &#123; //default proxy IWebProxy defaultProxy = WebRequest.GetSystemWebProxy(); defaultProxy.Credentials = CredentialCache.DefaultCredentials; Proxy = defaultProxy; return this; &#125; public Condition WithProxy(string address, string userName, string password) &#123; IWebProxy webProxy = new WebProxy(address); webProxy.Credentials = new NetworkCredential(userName, password); Proxy = webProxy; return this; &#125;&#125; é€™æ¨£åšæœ‰å¹¾å€‹é‡é»žèˆ‡ç›®çš„ private Condition() { } æŠŠé è¨­çš„å»ºæ§‹å­è¨­æˆç§æœ‰, ç„¶å¾Œé€éŽæœ‰è‘—å¿…å¡«åƒæ•¸çš„éœæ…‹æ–¹æ³• Create(string url) ä¾†å»ºç«‹ç‰©ä»¶, ç›®çš„æ˜¯è®“ä½¿ç”¨è€…æ²’æœ‰æ©Ÿæœƒæ¼å¡«å¿…å¡«çš„åƒæ•¸ ä½¿ç”¨è€…å»ºç«‹ç‰©ä»¶å¾Œå¯ä»¥ç›´æŽ¥å‘¼å« WithXXXX(...) æ–¹æ³•è¨­å®šéžå¿…å¡«çš„åƒæ•¸, å…·é«”å‘¼å«ç¯„ä¾‹: Condition.Create(&quot;http://sample.com&quot;).WithContent(&quot;&lt;xml&gt;balalala&lt;/xml&gt;&quot;).WithProxy();, é€™æ¨£çš„æ–¹æ³•éˆéžå¸¸æ–¹ä¾¿, æ˜¯ä¾†è‡ªæ–¼ Fluent Interface çš„æ¦‚å¿µ é€™æ¨£ condition çµ„å¥½ç›´æŽ¥ä½œç‚º Post(Condition conditon) çš„åƒæ•¸å°±å¯ä»¥äº† é€™ç¨®æ–¹å¼æ˜¯å¾žå»ºæ§‹è€…æ¨¡å¼å’Œ Fluent Interface è®Šå½¢è€Œä¾†çš„, å»ºæ§‹è€…æ¨¡å¼æ˜¯æŠŠå»ºæ§‹è€… å’Œ è¢«å»ºæ§‹è€… åˆ†æˆå…©å€‹ç‰©ä»¶, åªä¸éŽå°æ–¼ä¸€å€‹åªæ˜¯è¦æ•´åˆå¤§é‡åƒæ•¸çš„éœ€æ±‚ä¾†èªª, è¦ç‰¹åˆ¥å»ºç«‹ Condition å’Œ ConditionBuilder å…©å€‹ç‰©ä»¶æ˜¯æœ‰é»žå¤ªå¤šäº†, æ‰€ä»¥ç¨å¾®è®ŠåŒ–ä¸€ä¸‹ç°¡åŒ–ä»–çš„è¤‡é›œåº¦, ç¶²è·¯ä¸Šä¹Ÿæœ‰çµåˆå»ºæ§‹è€…æ¨¡å¼å’Œ Fluent Interface åšæˆ Fluent Builder çš„ä¾‹å­.ä½†æ˜¯!!ä½†æ˜¯!!ä½†æ˜¯!! å¦‚æžœä¸æ˜¯éžå¸¸è¤‡é›œçš„æƒ…å¢ƒçš„è©±, é€™æ¨£æ˜¯æœ‰é»žéŽåº¦è¨­è¨ˆäº†, é›–ç„¶å‘¼å«èµ·ä¾†å¾ˆæ–¹ä¾¿, ä½†æœƒä½¿å¾— Condition è®Šå¾—æ¯”è¼ƒè¤‡é›œ, å¦‚æžœç³»çµ±ä¸­åˆ°è™•éƒ½æ˜¯é€™ç¨®æ±è¥¿çš„è©±å…¶å¯¦æœƒæé«˜å¾ŒçºŒçš„ç¶­è­·é–€æª»çš„. (æŽ¨è–¦)åªå°‡é¸å¡«åƒæ•¸åŒ…æˆ Condition ç‰©ä»¶123456789101112131415161718192021public class RequestOptions&#123; public Encoding Cncoding &#123; get; set; &#125; = Encoding.UTF8; public string ContentType &#123; get; set; &#125; = "application/x-www-form-urlencoded"; //å…¶ä»–çœç•¥&#125;public string Post(string url, string content, RequestOptions options = null)&#123; if(options == null) &#123; options = new RequestOptions(); &#125; //åŸºæ–¼optionsæº–å‚™requestç›¸é—œç‰©ä»¶ //è¨­å®šproxy //ç™¼é€request, å–å¾—ä¸¦å›žå‚³response&#125; é€™å€‹ç‰ˆæœ¬æ˜¯æˆ‘ç›®å‰æœ€æŽ¨è–¦çš„, ä¸€æ–¹é¢ä»–æ¸›å°‘äº†åƒæ•¸çš„æ•¸é‡, å¦ä¸€æ–¹é¢æŠŠå¿…å¡«èˆ‡é¸å¡«åƒæ•¸åˆ†é–‹, é¿å…ä½¿ç”¨è€…èª¤ç”¨, ä¹Ÿå¤ ç°¡å–®å¥½æ‡‚. å¾Œè¨˜å…¶å¯¦è‡ªå·±åœ¨å¯«æ±è¥¿å¸¸å¸¸å¼„åˆ°éŽåº¦è¨­è¨ˆçš„çª˜å¢ƒ, æœ€è¿‘åœ¨ç·´ç¿’æ€Žéº¼æ¨£æ‰èƒ½æŠŠç¨‹å¼å¯«å¾—å‰›å¥½, åˆèƒ½åœ¨æ˜“ç”¨, å¥½ç¶­è­·èˆ‡å¥½æ“´å……ä¸­é–“æ‰¾åˆ°å¹³è¡¡é»ž(ä½†å¥½é›£XDD). åƒè€ƒè³‡æ–™how-to-avoid-too-many-parameters-problem-in-api-designBuilder Design Pattern and Fluent Builder]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å°‡ä¸Šæ¸¸æœªåˆä½µçš„PRåˆä½µåˆ°è‡ªå·±çš„fork]]></title>
    <url>%2Fcontent%2F20171014-unmerged-pull-request-to-my-fork.html</url>
    <content type="text"><![CDATA[æƒ…å¢ƒæ˜¯é€™æ¨£çš„, æˆ‘åœ¨githubä¸Šforkäº†ä¸€å€‹å°ˆæ¡ˆéŽä¾†, ä¸¦ä¸”åšäº†ä¸€äº›ä¿®æ”¹, å¾Œä¾†ç™¼ç¾æˆ‘çš„ä¸Šæ¸¸å°ˆæ¡ˆæœ‰å¹¾å€‹pull requestå‰›å¥½è§£æ±ºçš„æˆ‘ä¸€ç›´è§£æ±ºä¸äº†çš„å•é¡Œ, è©²æ€Žéº¼æŠŠé‚£äº›è®Šæ›´åŒæ­¥åˆ°æˆ‘çš„forkå‘¢? å…ˆèªªä¸€ä¸‹é€™æ•…äº‹çš„äººäº‹æ™‚åœ°ç‰©: æƒ…å¢ƒå¦‚ä¸Š JohnDao ä»–æ˜¯pull requestçš„ä½œè€… issue-fix-branch-1æ˜¯é€™å€‹è®Šæ›´æ‰€åœ¨çš„branch AwesomeProject æ˜¯é€™å€‹å°ˆæ¡ˆçš„åå­— å¯¦ä½œéƒ¨åˆ† å…ˆæ–°å¢žé ç«¯å„²å­˜åº«åˆ°è¦mergeçš„ä¾†æºå°ˆæ¡ˆ1git remote add JohnDao-Repo https://github.com/JohnDao/AwesomeProject.git ç„¶å¾ŒæŠŠè®Šæ›´fetchä¸‹ä¾†1git fetch JohnDao-Repo æœ€å¾ŒæŠŠè®Šæ›´mergeé€²ä¾†, ç„¶å¾Œpush1git merge JohnDao-Repo/issue-fix-branch-1 çµè«–é€™æ¨£å°±èƒ½å°‡åˆ¥äºº(JohnDao)æäº¤ä½†æ˜¯é‚„æ²’è¢«åŽŸä½œè€…åˆä½µå›žåŽ»çš„pull requestå…ˆåˆä½µåˆ°è‡ªå·±é€™è£¡äº†ã€‚ åƒè€ƒè³‡æ–™How to apply unmerged upstream pull requests from other forks into my fork?git: how to merge a pull request into a fork?What is â€œgit remote add â€¦â€ and â€œgit push origin masterâ€?]]></content>
      <categories>
        <category>Git</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨Visual studio 2017ä¸Šä½¿ç”¨AxoCoveré¡¯ç¤ºæ¸¬è©¦ç¨‹å¼ç¢¼æ¶µè“‹ç¯„åœ]]></title>
    <url>%2Fcontent%2F20171009-test-code-coverage-AxoCover.html</url>
    <content type="text"><![CDATA[ç•¶æˆ‘å€‘æƒ³çŸ¥é“ç›®å‰ç”¢å“çš„æ¸¬è©¦ç¨‹å¼æ¶µè“‹çŽ‡çš„æ™‚å€™, å¯ä»¥ä½¿ç”¨Visual Studio 2017å…§å»ºçš„åŠŸèƒ½ä¾†åˆ†æž, ä½†åªæœ‰ä¼æ¥­ç‰ˆæ”¯æ´é€™å€‹åŠŸèƒ½, æ‰€ä»¥å¦å¤–æ‰¾äº†AxoCoverä¾†ç”¨çœ‹çœ‹ã€‚ AxoCoverå®‰è£æ‰“é–‹ Tools &gt; Extensions and Updates, ä¸¦æ‰¾åˆ°AxoCoverå¾Œç›´æŽ¥å®‰è£(å®‰è£æ™‚éœ€è¦é—œé–‰Visual Studioæ‰èƒ½ç¹¼çºŒ)ã€‚ ä½¿ç”¨å®‰è£å®Œæˆé–‹å•ŸVisual Studioå¾Œ, å¯åœ¨Tool &gt; AxoCoveræ‰“é–‹åŠŸèƒ½è¦–çª—ã€‚ ä¸€é–‹å§‹çš„åŠŸèƒ½è¦–çª—çœ‹èµ·ä¾†ä»€éº¼éƒ½æ²’æœ‰, ç…§è‘—ä¸Šé¢çš„æç¤ºç·¨è­¯ä¸€ä¸‹å°ˆæ¡ˆå¾Œ, å¯ä»¥çœ‹åˆ°å®Œæ•´çš„åŠŸèƒ½é é¢ã€‚ æŽ¥è‘—å°±å¹¾å€‹ä¸»è¦åŠŸèƒ½èªªæ˜Žä¸€ä¸‹ Tests Tests &gt; RunåŸ·è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦ã€‚ Tests &gt; Coveråˆ†æžæ¸¬è©¦æ¶µè“‹çŽ‡, çµæžœå¯åœ¨Reporté ç±¤çœ‹åˆ°ã€‚ Tests &gt; Buildç·¨è­¯ã€‚ Reposrté€™é‚Šå¯ä»¥çœ‹åˆ°æ¶µè“‹çŽ‡çš„åˆ†æžã€‚ Reposrt &gt; Exportå°‡åŸ·è¡Œèˆ‡æ¶µè“‹çŽ‡åˆ†æžçµæžœåˆ†åˆ¥è¼¸å‡ºåˆ°~/.axoCover/runs ä»¥åŠ~/.axoCover/reports, å…¶ä¸­~/.axoCover/reportsä¸‹æ˜¯ç”¨ä¸€å€‹ç²¾ç¾Žçš„éœæ…‹ç¶²é ä¾†é¡¯ç¤ºæ¸¬è©¦æ¶µè“‹çŽ‡å ±è¡¨ã€‚ SettingsAxoCoverçš„ç›¸é—œè¨­å®šå…¨åœ¨é€™ã€‚ æ“ä½œä¸Šå¤§è‡´æ˜¯é€™æ¨£å­çš„, æŽ¥è‘—å¯ä»¥æ‰“é–‹ç¨‹å¼ç¢¼ä¸¦ä¸”æ¸…æ¥šçš„çœ‹åˆ°æœ‰è¢«æ¸¬è©¦ç¢¼æ¶µè“‹åˆ°çš„éƒ¨åˆ†æ˜¯ç¶ è‰², æ²’æ¶µè“‹åˆ°çš„éƒ¨åˆ†æ˜¯ç´…è‰², è€Œéƒ¨åˆ†æ¶µè“‹çš„é‚£ä¸€è¡Œæœƒæœ‰ä¸€å€‹å¾ˆå°çš„é»ƒè‰²åœ–æ¨™ã€‚]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[C# çš„ explicit èˆ‡ implicit é—œéµå­—]]></title>
    <url>%2Fcontent%2F20170924-explicit-implicit-keywords.html</url>
    <content type="text"><![CDATA[ä¾†ç´€éŒ„ä¸€ä¸‹ C# çš„å…©å€‹é—œéµå­— , explicit ä»¥åŠ implicitã€‚ å®šç¾©èˆ‡ä½¿ç”¨æ™‚æ©Ÿimplicitéš±å«è½‰æ›, ä¸éœ€è¦æ˜Žç¢ºæŒ‡å®šè½‰æ›é¡žåž‹, ä¾‹å¦‚ int è½‰æ›æˆ float æ™‚, åªéœ€è¦ç›´æŽ¥æŒ‡å®šè®Šæ•¸, å¦‚ä¸‹: 12int i = 10;float f = i; éš±å«è½‰æ›ä½¿ç”¨æ–¼è½‰æ›ä¸æœƒé€ æˆè³‡æ–™èª¤å·®æˆ–ä¾‹å¤–çš„æƒ…å¢ƒ, ä»¥æœ¬ä¾‹ä¾†èªª, int è½‰æ›æˆ float å€¼ä¸æœƒæœ‰èª¤å·®, ä½†åéŽä¾†å°±æœƒ, æ‰€ä»¥ float è½‰æ›æˆ int æ™‚éœ€è¦æ˜Žç¢ºè½‰æ›ã€‚ explicitæ˜Žç¢ºè½‰æ›, å¿…é ˆæ˜Žç¢ºæŒ‡å®šè½‰æ›é¡žåž‹, åŒæ¨£çš„ä¾‹å­, ç•¶ float è¦è½‰æ›æˆ int çš„æ™‚å€™, å°±æœƒè®Šæˆ: 12float f = 10.12f;int i = (int)f; æ˜Žç¢ºè½‰æ›ä½¿ç”¨æ–¼è½‰æ›å¯èƒ½æœƒé€ æˆè³‡æ–™èª¤å·®æˆ–ä¾‹å¤–æ™‚, ä»¥æœ¬ä¾‹ä¾†èªª, 10.12 è½‰æˆ int å¾Œ, çµæžœæ˜¯æœƒä¸åŒçš„, æ‰€ä»¥æ‡‰è©²ç”¨æ˜Žç¢ºè½‰æ›æ¯”è¼ƒæ°ç•¶ã€‚ è‡ªè¨‚ç‰©ä»¶çš„éš±å«èˆ‡æ˜Žç¢ºè½‰æ›ç¯„ä¾‹æƒ…å¢ƒé¦–å…ˆæˆ‘å€‘å…ˆä¾†è€ƒæ…®ä¸€å€‹æƒ…å¢ƒ, ç¾åœ¨æœ‰å…©å€‹é¡žåˆ¥, æ¤…å­ (Chair) ä»¥åŠæ¿å‡³ (Bench) ã€‚ æ¤…å­åªèƒ½åä¸€å€‹äºº, æ¿å‡³å‰‡æ²’æœ‰é™åˆ¶, æ‰€ä»¥æ¤…å­è½‰æ›æˆæ¿å‡³æ™‚å¯ä»¥æ˜¯éš±å«è½‰æ›, ä½†åéŽä¾†å°±æ‡‰è©²ç”¨æ˜Žç¢ºè½‰æ›ã€‚ å…ˆä¾†å€‹æ¤…å­, æœ‰å€‹ HeadCount å±¬æ€§, ç•¶æŒ‡å®šçµ¦ä»–çš„å€¼å¤§æ–¼ 1 çš„æ™‚å€™, ä»£è¡¨äººæ•¸è¶…è¼‰äº†, æœƒæ‹‹å‡ºä¸€å€‹ä¾‹å¤–, ä¸”æœ‰ä¸€å€‹éš±å«è½‰æ›çš„æ–¹æ³• public static implicit operator Bench(Chair chair) å¦‚ä¸‹: 1234567891011121314151617181920212223242526272829public class Chair&#123; private int _headCount; public int HeadCount &#123; get &#123; return _headCount; &#125; set &#123; if (value &gt; 1) &#123; throw new ArgumentException("æ¤…å­åº§ä½åªèƒ½å®¹ç´ä¸€å€‹äºº"); &#125; _headCount = value; &#125; &#125; // Chair è½‰ Bench å¯ä»¥æ˜¯éš±å«è½‰æ› // é€™å€‹æ–¹æ³•ä¹Ÿå¯ä»¥æ”¾åœ¨ Bench ä¸­, ä½†ä¸èƒ½å…©é‚Šéƒ½å¯«, ç·¨è­¯ä¸æœƒéŽ public static implicit operator Bench(Chair chair) &#123; return new Bench() &#123; HeadCount = chair.HeadCount &#125;; &#125;&#125; å†ä¾†æ˜¯æ¿å‡³, æ¿å‡³æ²’æœ‰äººæ•¸é™åˆ¶, æœ‰ä¸€å€‹æ˜Žç¢ºè½‰æ›çš„æ–¹æ³• public static explicit operator Chair(Bench bench) å¦‚ä¸‹: 1234567891011121314public class Bench&#123; public int HeadCount &#123; get; set; &#125; // Bench è½‰ Chair éœ€è¦æ˜Žç¢ºè½‰æ› // é€™å€‹æ–¹æ³•ä¹Ÿå¯ä»¥æ”¾åœ¨ Chair ä¸­, ä½†ä¸èƒ½å…©é‚Šéƒ½å¯«, ç·¨è­¯ä¸æœƒéŽ public static explicit operator Chair(Bench bench) &#123; return new Chair() &#123; HeadCount = bench.HeadCount &#125;; &#125;&#125; ç”¨æˆ¶ç¨‹å¼:12345678910111213141516static void Main(string[] args)&#123; Chair chair = new Chair() &#123; HeadCount = 1 &#125;; Bench bench = new Bench() &#123; HeadCount = 1 &#125;; //ç•¶ bench çš„ HeadCount å€¼å¤§æ–¼1æ™‚, é€™é‚Šæœƒæ‹‹ Exception å‡ºä¾† Chair chairFromBench = (Chair)bench; Bench benchFromChair = chair;&#125; ä½¿ç”¨èªªæ˜ŽæŽ¥è‘—èªªæ˜Žä¸€ä¸‹è½‰æ›çš„éƒ¨åˆ†, å¯¦ä½œè½‰æ›æ–¹æ³•æœ‰å¹¾å€‹é™åˆ¶ å­˜å–ä¿®é£¾è©žå¿…é ˆæ˜¯ public å¿…é ˆæ˜¯éœæ…‹æ–¹æ³•(static) å¿…é ˆæœ‰ implicit æˆ– explicit é—œéµå­— å¿…é ˆæœ‰ operator é—œéµå­— ç¸½æ‹¬ä¾†èªªæ–¹æ³•å¿…é ˆé•·é€™æ¨£12345public static implicit operator Destination(Source src)public static explicit operator Destination(Source src)public static implicit operator Source(Destination dest)public static explicit operator Source(Destination dest) çµè«–implicit / explicit operator å¯ä»¥å¯«åœ¨ä¾†æºæˆ–ç›®æ¨™ä¸­, ä½†æ˜¯æ²’è¦ç¯„åˆå®¹æ˜“äº‚, ç›®å‰çœ‹èµ·ä¾†å¯«åœ¨ä¾†æºä¸­æ¯”è¼ƒå¥½, è¨­è¨ˆé¡žåˆ¥ A çš„æ™‚å€™ç”±é¡žåˆ¥ A æ±ºå®šè‡ªå·±å¯ä»¥éš±å«æˆ–æ˜¯æ˜Žç¢ºè½‰æ›æˆä½•ç¨®é¡žåˆ¥, ç›¸è¼ƒæ–¼å¯«åœ¨ç›®æ¨™é¡žåˆ¥ä¸­ä¾†èªªæ¯”è¼ƒåˆç†. åƒè€ƒMS]]></content>
      <categories>
        <category>C#</category>
        <category>Language Spec</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Hexo èˆ‡ hexo-theme-next çš„é›¶ç¢Žç‰‡æ®µ]]></title>
    <url>%2Fcontent%2F20170902-hexo-and-next-fragments.html</url>
    <content type="text"><![CDATA[Hexoä»¥åŠhexo-theme-nextæ¨£æ¿åœ¨ä½¿ç”¨ä¸Šæœ‰æ»¿å¤šç´°ç¯€è·Ÿå°åœ°æ–¹æ˜¯éœ€è¦ä¸€ç›´æ‰¾è³‡æ–™è§£æ±ºçš„, ä½†æ˜¯æ¯å€‹å°æ±è¥¿éƒ½å¯«ä¸€ç¯‡è¦ºå¾—å¤ªé›¶æ•£äº†, æ‰€ä»¥æŠŠç›¸é—œçš„ç‰‡æ®µéƒ½æ”¾åœ¨é€™è£¡ã€‚ Hexoskip_renderhexoå¯ä»¥é€éŽskip_renderåƒæ•¸è®“ç‰¹å®šæª”æ¡ˆä¸è¢«æ¸²æŸ“, å°±ä»¥è³‡ç”¢è³‡æ–™å¤¾ç‚ºä¾‹å§ã€‚ é¦–å…ˆç›´æŽ¥å»ºç«‹ä¸€å€‹æ–°çš„Post, ç„¶å¾Œå°‡sample.htmlæª”æ¡ˆæ”¾åˆ°render_sampleè³‡æ–™å¤¾ä¸‹, é€™æ™‚å€™è³‡æ–™å¤¾çµæ§‹çœ‹èµ·ä¾†æ˜¯é€™æ¨£çš„1234|-- _posts/2017-09/| |-- render_sample.md| |-- render-sample| | |-- sample.html æŽ¥è‘—hexo g ä¸€ä¸‹, é€™æ™‚å€™éœæ…‹æ–‡ç« çš„ç›®éŒ„æœƒè®Šæˆé€™æ¨£12345|-- render-sample| |-- sample.html| |-- index.html| |-- sample| |-- index.html é€™å°±æ˜¯å•é¡Œé»ž, sample.htmlæ‡‰è©²ç´”ç²¹ä½œç‚ºè³‡ç”¢ä½¿ç”¨æ‰å°, sampleè³‡æ–™å¤¾ä¸æ‡‰è©²å­˜åœ¨çš„ã€‚ æ‰€ä»¥æˆ‘å€‘å¿…é ˆæ‰¾å‡ºhexoçš„_config.ymlæª”, ä¸¦ä¸”è¨­å®šskip_renderåƒæ•¸, æŒ‡å®šè³‡ç”¢è³‡æ–™å¤¾ä¸è¢«æ¸²æŸ“ skip_render: _posts/*/*/** æŽ¥è‘—å†é‡æ–°hexo gä¸€ä¸‹, ç›®éŒ„å°±å¯ä»¥æ­£ç¢ºçš„ç”¢å‡ºäº†123|-- render-sample| |-- sample.html| |-- index.html é€™é‚Šå¼•è¿°ä¸€ä¸‹hexoå®˜æ–¹æ–‡ä»¶çš„èªªæ˜Ž: skip_render: è·³éŽæŒ‡å®šæª”æ¡ˆçš„æ¸²æŸ“ï¼Œæ‚¨å¯ä½¿ç”¨ glob è¡¨é”å¼ ä¾†é…å°è·¯å¾‘ã€‚ hexo-theme-next]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨xs3på°‡xsdè½‰æ›æˆæ–‡ä»¶]]></title>
    <url>%2Fcontent%2F20170902-xsd-to-document-by-xs3p.html</url>
    <content type="text"><![CDATA[æœ‰æ™‚å€™å°ˆæ¡ˆä¸­æœƒéœ€è¦ä½¿ç”¨xmlåšç‚ºè¨­å®šæ–‡ä»¶åŽ»å®šç¾©ç¨‹å¼çš„è¡Œç‚ºèˆ‡åƒæ•¸, è€Œconfigæœ‰å¯èƒ½æœƒéžå¸¸è¤‡é›œ, æ‰€ä»¥ç‚ºäº†é–‹ç™¼ä¸Šçš„æ–¹ä¾¿æœƒç”¨xsdä¾†å®šç¾©, ä¸¦ä¸”éœ€è¦ç”¢å‡ºä¸€ä»½æ–‡ä»¶ä¾†è®“æ–°æ‰‹å¿«é€Ÿäº†è§£configæ‡‰è©²å¦‚ä½•ç·¨å¯«, æ‰€ä»¥æˆ‘å€‘éœ€è¦ä¸€äº›å·¥å…·ä¾†å¹«ä¾†è£½ä½œæ–‡ä»¶ã€‚ ç›®å‰é€™å€‹å°ˆæ¡ˆ, éœ€è¦æ–‡ä»¶åŒ–çš„xsdåªæœ‰ä¸€å€‹, æ‰€ä»¥ä¸¦æ²’æœ‰ä½¿ç”¨å¤§ç ²ç´šçš„ Liquid Studio ä»¥åŠ DocFlex, è€Œæ˜¯ç”¨äº†æ¯”è¼ƒè¼•é‡ç°¡å–®çš„ xs3p , ä½†æ˜¯ å®˜æ–¹çš„xs3p æŽ’ç‰ˆå¤ªé™½æ˜¥, æ‰€ä»¥é€™é‚ŠæŽ¨è–¦ä½¿ç”¨ Githubä¸Šçš„ç¾ŽåŒ–ç‰ˆ, æˆ–æ˜¯æˆ‘å¾Œä¾† fork å‡ºä¾†æ”¹éŽçš„ç‰ˆæœ¬. æŽ¥è‘—æœƒç”¨ bitfehler ç‰ˆæœ¬çš„ xs3p ä»‹ç´¹é€™å€‹å°å·¥å…·çš„ä½¿ç”¨. ä¸‹è¼‰å·¥å…·èˆ‡ä¾è³´å…ƒä»¶ xs3pç¾ŽåŒ–ç‰ˆ Command Line Transformation Utility (msxsl.exe) MSXML 4.0 Service Pack 3: å¯ä»¥ä¸è£, ä½†è½‰æ›æ™‚Annotationä¸­å¦‚æžœæœ‰CDATAå€æ®µæœƒè½‰ä¸å‡ºä¾†ã€‚ xs3pè³‡æ–™å¤¾çµæ§‹èˆ‡ä½¿ç”¨ä¸»è¦æ–‡ä»¶ /examples: ç¯„ä¾‹è³‡æ–™å¤¾ã€‚ /examples/test_*.bat : åŸ·è¡Œå„ç¨®è½‰æ›å·¥å…·çš„æ‰¹æ¬¡æª”ã€‚ /examples/*.xsd: ç¯„ä¾‹XSDæª”ã€‚ /xs3p.xsl: è½‰æ›æ™‚éœ€è¦ä½¿ç”¨çš„æ¨£å¼å®šç¾©ã€‚ ä½¿ç”¨(ä»¥msxmlç‚ºä¾‹) å°‡ msxsl.exe æ”¾åˆ° /examples è³‡æ–™å¤¾ä¸­ã€‚ é»žæ“Š /examples/test_msxsl.bat ç›´æŽ¥åŸ·è¡Œã€‚ æœƒåœ¨ /examples/msxsl-results ä¸­ç”¢å‡º /examples ç›®éŒ„ä¸‹æ‰€æœ‰XSDæª”è½‰æ›å¾Œçš„htmlæ–‡ä»¶ã€‚ ç¯„ä¾‹XSD èˆ‡ ç¯„ä¾‹HTMLã€‚ å„ç¨®å•é¡Œç·¨ç¢¼å•é¡Œè½‰å‡ºä¾†çš„htmlæª”æ‰€éœ€è¦çš„css, jsç­‰è³‡æºéƒ½æ˜¯é€£åˆ°cdnä¸Šæ‹¿, å¦‚æžœåœ¨chromeä¸Šé¢æ¨£å¼ç„¡æ³•å¥—ç”¨, å¯èƒ½æ˜¯ç·¨ç¢¼å•é¡Œ, è¦åœ¨ xs3p.xsl ä¸­çš„ &lt;link&gt; å…ƒç´ ä¸­åŠ ä¸Š charset=&quot;UTF-8&quot;ã€‚ 1&lt;link href=&quot;&#123;$bootstrapURL&#125;/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; charset=&quot;UTF-8&quot;/&gt; å‘½åç©ºé–“å•é¡Œç”¨xs3pæ­é…msxml.exeåŽ»ç”¢ç”Ÿxsdæ–‡ä»¶æ™‚, éœ€è¦ç‰¹åˆ¥ç•¶ä¸€å€‹å‘½åç©ºé–“è¨­å®šå¤šå€‹å‰ç¶´, åªèªç¬¬ä¸€å€‹ã€‚ èˆ‰ä¾‹, ä¸‹é¢çš„ç¯„ä¾‹ä¸­, xmlns:firstä»¥åŠ xmlns:meæ˜¯åŒæ¨£çš„å‘½åç©ºé–“, è½‰æ›æ™‚åªèªç¬¬ä¸€å€‹, æ‰€ä»¥å¦‚æžœxsdä¸­ä»¥meç‚ºå‰ç¶´çš„typeè½‰æ›å‡ºä¾†çš„è¶…é€£çµéƒ½æœƒæ˜¯å¤±æ•ˆçš„, å¦‚é™„åœ–12345678910&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;xs:schema id="ComponentDefinition" targetNamespace="http://www.ronsun.com/ComponentDefinition/Guide.md" elementFormDefault="qualified" xmlns:first="http://www.ronsun.com/ComponentDefinition/Guide.md" xmlns:me="http://www.ronsun.com/ComponentDefinition/Guide.md" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;&lt;/xs:schema&gt; åˆ—èˆ‰é¡žåž‹çš„Annotationç„¡æ³•è½‰æ›å¦‚ä¸‹ç¯„ä¾‹å°‡è¨»è§£åŠ åœ¨enumerationä¸­, è½‰æ›å¾Œçš„æ–‡ä»¶æœƒéºæ¼æŽ‰è¨»è§£ã€‚123456789101112131415161718&lt;xs:simpleType name="componentTypeEnum"&gt; &lt;xs:restriction base="xs:string"&gt; &lt;xs:enumeration value="Typ1"&gt; &lt;xs:annotation&gt; &lt;xs:documentation&gt; &lt;![CDATA[This is type1]]&gt; &lt;/xs:documentation&gt; &lt;/xs:annotation&gt; &lt;/xs:enumeration&gt; &lt;xs:enumeration value="Typ2"&gt; &lt;xs:annotation&gt; &lt;xs:documentation&gt; &lt;![CDATA[This is type1]]&gt; &lt;/xs:documentation&gt; &lt;/xs:annotation&gt; &lt;/xs:enumeration&gt; &lt;/xs:restriction&gt;&lt;/xs:simpleType&gt; å› æ‡‰æ–¹å¼æ˜¯æŠŠè¨»è§£åŠ åœ¨simpleTypeä¸‹, å¦‚:1234567891011121314&lt;xs:simpleType name="componentTypeEnum"&gt; &lt;xs:annotation&gt; &lt;xs:documentation&gt; &lt;![CDATA[ `Type1`: this is type1 `Type2`: this is type2 ]]&gt; &lt;/xs:documentation&gt; &lt;/xs:annotation&gt; &lt;xs:restriction base="xs:string"&gt; &lt;xs:enumeration value="Typ1" /&gt; &lt;xs:enumeration value="Typ2" /&gt; &lt;/xs:restriction&gt;&lt;/xs:simpleType&gt; å¾Œè¨˜é€™å€‹å·¥å…·ç”¨èµ·ä¾†å¾ˆä¸éŒ¯, ä¸éŽå¦‚ä¸Šé¢æ‰€èªª, æœ‰ä¸€äº›ç´°ç¯€ä¸ç¬¦åˆç›®å‰å°ˆæ¡ˆéœ€æ±‚, æ‰€ä»¥åªå¥½è‡ªå·±å¦å¤– fork å‡ºä¾†æ”¹æˆ ronsun/xs3p.]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ–°å¢žä¸€å€‹ä½¿ç”¨è€…å®šç¾©å‡½æ•¸æä¾›äº‚æ•¸å­—ä¸²]]></title>
    <url>%2Fcontent%2F20170820-mssql-random-string.html</url>
    <content type="text"><![CDATA[é¦–å…ˆ, éœ€æ±‚ä¸Šæ˜¯é€™æ¨£çš„:è¦åœ¨è³‡æ–™åº«ä¸­å»ºç«‹ä¸€å€‹UDF(User-defined function), å®ƒçš„åŠŸèƒ½æ˜¯è¦èƒ½ç”¢ç”Ÿä¸€çµ„æ ¼å¼åƒé€™æ¨£ zAc-jVu-euO-nQ7 çš„äº‚æ•¸å­—ä¸²ã€‚ åƒè€ƒè¨±å¤šç¶²è·¯æ–‡ç« ä¸¦å¯¦ä½œå¾Œ, ç™¼ç¾åœ¨Functionè£¡é¢ä¸¦ä¸èƒ½ä½¿ç”¨RAND()é€™é¡žçš„å‡½æ•¸, æ‰€ä»¥åªèƒ½å…ˆå»ºç«‹ä¸€å€‹æª¢è¦–è¡¨(View), æŽ¥è‘—æ‰èƒ½åœ¨å‡½æ•¸ä¸­æ’ˆå‡ºç”¢ç”Ÿåœ¨æª¢è¦–è¡¨ä¸­çš„äº‚æ•¸ä¾†åšå‹•ä½œã€‚ å»ºç«‹æª¢è¦–è¡¨1234CREATE VIEW Get_RANDASSELECT RAND() AS RandomNumberGO å»ºç«‹å‡½æ•¸ 123456789101112131415161718192021222324252627282930313233343536373839404142434445CREATE FUNCTION [dbo].[fu_CZ_NewID]()RETURNS VARCHAR(100)ASBEGIN --éœ€æ±‚: -- ç”¢ç”Ÿä¸€å€‹æ ¼å¼ç‚º 6ev-zS5-lMN-pwg çš„äº‚æ•¸å­—ä¸² -- * é•·åº¦ç‚º15å€‹å­—å…ƒ -- * æ¯ä¸‰å€‹å­—å…ƒä»¥'-'ç¬¦è™Ÿä½œç‚ºåˆ†éš”ç¬¦è™Ÿ --@id: è¦ç”¢ç”Ÿçš„å­—ä¸² DECLARE @id VARCHAR(100) = ''; --@length: è¦ç”¢ç”Ÿçš„å­—ä¸²é•·åº¦ DECLARE @length INT = 15; --@group: æ¯éš”å¹¾å€‹å­—è¦åŠ ä¸Šåˆ†éš”å­—å…ƒ DECLARE @group INT = 3; ---@chars: äº‚æ•¸è³‡æ–™ä¾†æº DECLARE @chars VARCHAR(100) = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890'; --@count: è¿´åœˆèµ·å§‹å€¼ DECLARE @count INT = 0; WHILE (@count &lt; @length) BEGIN DECLARE @current INT = (SELECT RandomNumber FROM dbo.Get_RAND) * 100 IF(@current &lt;= LEN(@chars)) BEGIN --åˆ¤æ–·æ˜¯å¦åŠ åˆ†éš”å­—å…ƒ IF((LEN(@id) + 1) % (@group + 1) = 0) BEGIN SET @id += '-'; SET @count += 1; END SET @id += SUBSTRING(@chars, @current, 1); SET @count += 1; END END -- Return the result of the function RETURN @idEND]]></content>
      <categories>
        <category>MSSQL</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[HttpRequest.QueryString çš„è‡ªå‹• UrlDecode å•é¡Œ]]></title>
    <url>%2Fcontent%2F20170813-HhttpRequest.QueryString-auto-urlDecode.html</url>
    <content type="text"><![CDATA[HttpRequest.QueryString[â€œqâ€] åœ¨ç”¨ä¾†å–å¾—query stringçš„å€¼æ˜¯å¾ˆæ–¹ä¾¿, ä½†æ˜¯æœƒè‡ªå‹•å°‡query stringå…ˆåšéŽUrlDecode, é€™åœ¨query string æœ‰æŸäº›ç‰¹æ®Šå­—å…ƒçš„æ™‚å€™ç”¢ç”Ÿå•é¡Œ ç›´æŽ¥ä¸ŠDemo 123456789101112131415161718192021public ActionResult Index()&#123; //sample query string (plain text): q=aaa$bbb+ccc //q = "aaa$bbb ccc" string q = this.Request.QueryString["q"]; // solution 1: encode after get query string // useful if query string not contain other characters can be encode //q = "aaa%24bbb+ccc" in this case string q2 = HttpUtility.UrlEncode(this.Request.QueryString["q"]); // solution 2: split string to get value // if query string contain charactors can be encode, this is safety way List&lt;string&gt; queryStrings = this.Request.Url.Query.Replace("?", "").Split('&amp;').ToList(); //q3 = "aaa$bbb+ccc" string q3 = queryStrings.Where(r =&gt; r.Split('=')[0] == "q").Select(r =&gt; r.Split('=')[1]).FirstOrDefault(); return View();&#125;]]></content>
      <categories>
        <category>C#</category>
        <category>.NET</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç½®åº• - å·¥å…·ç®±èˆ‡å„ªè³ªå‚³é€é–€]]></title>
    <url>%2Fcontent%2F19000101-tools-and-references.html</url>
    <content type="text"><![CDATA[ç¸½æœ‰ä¸€äº›å°å·¥å…·ä¸€å€‹ä¸å°å¿ƒå°±æœƒå¿˜, é‚„æœ‰ä¸€äº›å¥½æ–‡ç« è¦æŸ¥çš„æ™‚å€™æ‰¾ä¸åˆ°. å·¥å…·ç®±ç·šä¸Šå·¥å…· Regex Regex 101: ç·šä¸Šregexæª¢æŸ¥é™„é€ŸæŸ¥è¡¨èˆ‡è§£æž. Debuggex: ç·šä¸Šregexæª¢æŸ¥é™„é€ŸæŸ¥è¡¨èˆ‡åœ–åƒåŒ–è§£æž. Regulex: ç·šä¸Šregexåœ–åƒåŒ–è§£æž, æ²’æœ‰æª¢æŸ¥åŠŸèƒ½ä½†æ¯”è¼ƒå¥½çœ‹. Markdown Editor StackEdit: å¥½ç”¨å¥½çœ‹. C# ç·šä¸ŠIDE dotnetfiddle .net source browser .net framework .net core å…¶ä»– archive.org: ç¶²é ä¸‹æž¶/æ¶ˆå¤±å¾Œå¯ä»¥å¾žé€™è£¡æ‰¾åˆ°å‚™ä»½, å‚™ä»½æ¯” google cache é‚„è¦ä¹…. å‚³é€é–€C# / .NETWebClient vs HttpClient vs HttpWebRequest API è¨­è¨ˆREST &amp; RESTful (1)REST &amp; RESTful (2) å®˜æ–¹æ–‡ä»¶å¾®è»Ÿ Framework è¨­è¨ˆæ–¹é‡Visual Studio ä¸­çš„é è¨­éµç›¤å¿«é€Ÿéµ å…¶ä»–Visual Studio 2017 keyboard shortcutsAirbnb è³‡æ·±å·¥ç¨‹å¸«åˆ†äº«ï¼šæ€Žæ¨£æ‰æ˜¯æ­£ç¢ºã€æœ‰æ•ˆçš„ code reviewC# æ¸©æ•…è€ŒçŸ¥æ–°ï¼šStreamç¯‡ï¼ˆâ€”ï¼‰C# æ¸©æ•…è€ŒçŸ¥æ–°ï¼šStreamç¯‡ï¼ˆäºŒï¼‰C# æ¸©æ•…è€ŒçŸ¥æ–°ï¼šStreamç¯‡ï¼ˆä¸‰ï¼‰C# æ¸©æ•…è€ŒçŸ¥æ–°ï¼šStreamç¯‡ï¼ˆå››ï¼‰C# æ¸©æ•…è€ŒçŸ¥æ–°ï¼šStreamç¯‡ï¼ˆäº”ï¼‰C# æ¸©æ•…è€ŒçŸ¥æ–°ï¼šStreamç¯‡ï¼ˆå…­ï¼‰C# æ¸©æ•…è€ŒçŸ¥æ–°ï¼šStreamç¯‡ï¼ˆä¸ƒï¼‰]]></content>
      <categories>
        <category>Top</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[categories]]></title>
    <url>%2Fcategories%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[tags]]></title>
    <url>%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
</search>
