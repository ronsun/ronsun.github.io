---
title: Framework Design Guidelines 整理與心得 (0 & 1)
date: 2022-09-28 00:27:43
categories:
- Reading
- Framework Design Guidelines
tags:
---

這系列文章的目的是為了之後參考與快速回顧而基於 Framework Design Guidelines 這本書寫的整理與心得，這不是翻譯，所以內容都是閱讀理解後再梳理下來的，和書中語句必然不同，也只會保留我自已覺得需要的部分，並帶一些自己的想法與註解。  

本篇包含了前言與第一章的部分。  

<!--more-->

### 前言
這些設計方針是經過設計後，並且歷經了好幾個版本的 .NET Framework，書中包含了許多備註說明了一些設計上的取捨，這些備註是很有經驗的人提出，包含框架設計者與業內專家以及使用者。  

#### 方針書寫方式
條列式的建議會分成幾個層級:  
+ **應該** (Do)   
  應該遵守的規則，"幾乎沒有"例外。  
+ **考慮** (Consider)  
  通常要遵守的規則，但如果有合理的原因也可以不遵守。  
+ **避免** (Avoid)  
  原則上要避免的事，偶有例外。  
+ **不應** (Do Not)  
  禁止事項，"幾乎沒有"例外。  


### 介紹
#### 設計完善的框架的品質
對於設計完善的框架定義有很多面向，諸如效能、可讀性、安全性、依賴性管理等。 對於框架當然需要堅持相同的標準，畢竟框架不同於其他軟體在於它提供的是高度重用的 API。  

##### 設計完善的框架是簡單的 (Simple)  
多數的框架其實都不缺功能，因為總是有各種理由可以加功能，但另一方面簡易性的部分卻常常因為時程壓力、無限擴張的需求、或是為了滿足各種邊際情境而被犧牲。  

對於框架來說簡易性是絕對必要的，所以如果對於複雜度有任何一點疑慮，把需求先暫緩然後花更多時間去設計會好過於急著在當下這個版本上線，畢竟功能隨時都能加，但幾乎不可能移除。  

總之如果覺得一個功能哪裡怪怪的就別加，不然到時候後悔就來不及了，另外本書中也有很多內容是為了找出功能性和簡易性之間的平衡。   

> 根據發佈後使用者多寡，對於設計變更的容忍度也會不同，如果只是小組內專案使用，設計變更稍微多一點也是可以接受的，但如果要發佈到公開環境(外網)，那就要如同上面的說的嚴謹。  

要確認 API 是不是簡單，可以直接找工程師來試用看用起來有沒有順手，實際功能和預期的有沒有一樣，或是自己用看看，總之就是透過試用來蒐集使用者體驗。  

##### 設計完善的框架的設計成本是很高的  
好的框架需要花費很多時間和資源，他在開發過程是一的獨立的項目，倒也不是要先做好框架才能做產品，而是在整個產品從設計、開發、測試到後期維護過程都要考慮框架的設計與維護，並注意他是一個獨立的主題且需要規劃進開發時程，而不是做產品的過程"順便"拉出來的共用程式碼而已。  

最理想的框架設是有人專責處理，不管是單獨的職缺或是開發過程中有人專職設計都好，就是不要一組人一邊開發產品一邊加框架，這很容易會讓框架中出現產品的細部實作或是將不應該被看到的細節暴露出來。  

> 這個問題也體現在架構複雜的大型專案中，分離式的架構本意是為了區分職責，但在這時候如果分工是依照需求功能去分工，往往會變成每個人都需要開發整個產品相關的多個專案，導致校長兼撞鐘的現象: 將實作放在不適當的位置。  
> 舉一個實際的例子，一個電商網站背後有一個 WebAPI 專案提供服務給前台、後台和手機 APP 呼叫使用，開發時如果以需求分工，就可能會有個人需要同時開發 APP 和 WebAPI，因為 API 介面和和呼叫端的 APP 都是同一個人開發，很容易就設計出特規的 API，導致之後如果其他呼叫端需要使用類似的功能時相容性就很差，甚至最後會有一大群很像又有微小差異的 API 們，難管理又混亂，更糟的是把該 WebAPI 職責做的邏輯放到 APP 中做，造成職責混亂的問題。   
> 反之，如果 WebAPI 設計和 APP 是不同人專責處理，這時候開 API 規格的人就會更能專注於設計出更通用的 API，甚至本來就有類似的 API 可以組合、擴充、改造來符合目前的需求，根本不需要再開一個相似的 API，也更不容易造成程式碼的職責混亂。  
> 之前一個大專案就是這樣校長兼撞鐘，說真的即使刻意要一人扮演兩個開發角色，也難免有上述問題的發生。  

##### 設計完善的框架的是需要各種取捨的  
完美的設計是不存在的，在設計中要了解可能的各種解法與其優點、缺點等，並經過適當的取捨，本書中的建議也不是絕對的準則，畢竟在需要各種取捨的原則下，現實中有時候也需要考慮規則外的替代方案。  

> 在一般專案中也是，面對問題時盡量提供多種解決方案並分析優缺點，而不是只提出一種方案，雖然比較費神花心力，但經過各方面的分析後的解法通常可以避免許多後期維護上的痛苦。  

##### 設計完善的框架的會基於現存的設計  
多數成功的框架都基於已存在的設計建立的，而當我們會想提出一些新奇的設計要特別謹慎，太多新奇的概念會讓整體設計更容易變糟。

> 當然前提是已存在的設計是適用的，不是說一定只能用現有的作法。

##### 設計完善的框架要考慮到後續發展  
雖然我們可能在設計階段下了很多苦心並偶爾為了以防萬一而加了一些功能，但是另一方面必須考慮隨著時間推移，有沒有可能會出現維護不便甚至無法向下相容的問題。 一般來說功能如果不夠完善，與其急著上版不如下一版再上。  

> 多個香爐多隻鬼，加功能容易但是維護或移除是很難的，尤其是沒必要的功能或是還沒設計好的半成品就別急著上線增加後續發展上的風險

##### 設計完善的框架要能高度整合  
現代框架設計上要能整合整個生態系，包含工具、語言以及其他面向。

> 即使只是公司內部框架，也是有需要注意這點，盡量要能將公司內部的技術生態系整合進來。  

##### 設計完善的框架要非常一致  
這是非常關鍵的一環，設計風格、模式、概念、規範等要非常一致，這樣使用者在了解框架時才能快速上手並融會貫通，也能輕易辨識出一些特殊功能或是舊的設計。

##### 設計完善的框架要具可測試性  
包含但不限於單元測試，另外除了內部的可測試性外，另外一點還是要考慮使用者在使用時寫出來的程式碼是否也能有足夠的可測試性。  

### 結論
第一章雖然比較偏概念，還沒進到細節的部分，但都是很有用的建議。  